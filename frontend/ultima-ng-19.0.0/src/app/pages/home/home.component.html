@if(loading() || isAuthenticatedAndRedirecting()){
<div class="text-center">
    <div class="relative">
        <p-progress-spinner ariaLabel="Verifying account" [style]="{'width': '5rem', 'height': '5rem'}" strokeWidth="4"
            animationDuration=".5s" class="text-primary" />
    </div>
    <h2 class="text-2xl font-semibold mb-2">Vérification du compte ...</h2>
    <p class="text-surface-600 dark:text-surface-300">Veuillez patienter pendant que nous vérifions vos identifiants.
    </p>
</div>
} @else {
<div class="bg-surface-50 dark:bg-surface-950">
    <topbar />
    <div class="h-screen">
        <div style="perspective: 101px"
            class="h-screen overflow-x-hidden overflow-y-auto absolute top-0 left-0 right-0 bottom-0">
            <div id="parallaxBody" class="lg:top-0 block absolute left-0 right-0 h-full z-20">
                <div class="card">
                    <br><br><br>
                    <!-- Modern Cards Layout - Grille 12 colonnes -->
                    <div class="grid grid-cols-12 gap-6 mb-8 max-w-7xl mx-auto px-4">
                        <!-- LIGNE 1 -->
                        <!-- GESTION ECREDIT Card -->
                        <div
                            class="col-span-12 md:col-span-4 bg-green-500 rounded-2xl p-8 text-white shadow-lg hover:shadow-xl transition-all duration-300 hover:-translate-y-1 cursor-pointer">
                            <div class="flex items-center mb-6">
                                <i class="pi pi-credit-card text-3xl mr-4"></i>
                                <h3 class="text-xl font-bold">GESTION ECREDIT</h3>
                            </div>
                            <p class="text-green-100 mb-6 text-sm leading-relaxed">
                                Faire une nouvelle demande de Crédit
                            </p>

                            <!-- PrimeNG Menu Dropdowns -->
                            <div class="flex gap-4">
                                <!-- Premier Menu -->
                                <p-button label="Demandes" icon="pi pi-chevron-down" iconPos="right"
                                    (click)="demandesMenu.toggle($event)"
                                    [style]="{'background': 'white', 'color': '#10b981', 'border': 'none', 'border-radius': '1.5rem'}"
                                    class="p-button-sm">
                                </p-button>
                                <p-menu #demandesMenu [model]="demandesItems" [popup]="true"></p-menu>
                            </div>
                        </div>

                        <!-- GESTION RECLAMATIONS Card -->
                        <div
                            class="col-span-12 md:col-span-4 bg-orange-500 rounded-2xl p-8 text-white shadow-lg hover:shadow-xl transition-all duration-300 hover:-translate-y-1 cursor-pointer">
                            <div class="flex items-center mb-6">
                                <i class="pi pi-headphones text-3xl mr-4"></i>
                                <h3 class="text-xl font-bold"><strong>GESTION RECLAMATIONS</strong></h3>
                            </div>
                            <p class="text-orange-100 mb-6 text-sm leading-relaxed">
                                Gestion des réclamations et incidents
                            </p>
                            <button
                                class="bg-white text-orange-500 px-6 py-2 rounded-full font-medium hover:bg-gray-100 transition-colors">
                                Acceder
                            </button>
                            <div class="mt-4 flex items-center text-orange-200 font-semibold">
                                <i class="pi pi-info-circle mr-2"></i>
                                <span>En cours</span>
                            </div>
                        </div>

                        <!-- ESOCIETARIAT Card -->
                        <div
                            class="col-span-12 md:col-span-4 bg-cyan-600 rounded-2xl p-8 text-white shadow-lg hover:shadow-xl transition-all duration-300 hover:-translate-y-1 cursor-pointer">
                            <div class="flex items-center mb-6">
                                <i class="pi pi-users text-3xl mr-4"></i>
                                <h3 class="text-xl font-bold"><strong>ESOCIETARIAT</strong></h3>
                            </div>
                            <p class="text-cyan-100 mb-6 text-sm leading-relaxed">
                                Gestion pour l'assainissement du sociétariat
                            </p>
                            <button
                                class="bg-gray-800 text-white px-6 py-2 rounded-full font-medium hover:bg-gray-700 transition-colors">
                                Acceder
                            </button>
                            <div class="mt-4 flex items-center text-orange-200 font-semibold">
                                <i class="pi pi-info-circle mr-2"></i>
                                <span>En cours</span>
                            </div>
                        </div>
                        <!-- ARRETE DE CAISSE Card -->
                        <div class="col-span-12 md:col-span-4 rounded-2xl p-8 text-white shadow-lg hover:shadow-xl transition-all duration-300 hover:-translate-y-1 cursor-pointer"
                            style="background-color: #7c3aed;">
                            <div class="flex items-center mb-6">
                                <i class="pi pi-video text-3xl mr-4"></i>
                                <h3 class="text-xl font-bold"><strong>GESTION ARRETE DE CAISSE</strong></h3>
                            </div>
                            <p class="mb-6 text-sm leading-relaxed" style="color: #ddd6fe;">
                                Gestion pour la remontée des arrêtés de caisse
                            </p>
                            <button
                                class="bg-white px-6 py-2 rounded-full font-medium hover:bg-gray-100 transition-colors"
                                style="color: #7c3aed;">
                                Acceder
                            </button>
                            <div class="mt-4 flex items-center text-orange-200 font-semibold">
                                <i class="pi pi-info-circle mr-2"></i>
                                <span>En cours</span>
                            </div>
                        </div>

                        <!-- GESTION DU PERSONNEL Card -->
                        <div class="col-span-12 md:col-span-4 rounded-2xl p-8 text-white shadow-lg hover:shadow-xl transition-all duration-300 hover:-translate-y-1 cursor-pointer"
                            style="background-color: #059669;" (click)="openPersonnelDialog()">
                            <div class="flex items-center mb-6">
                                <i class="pi pi-user-plus text-3xl mr-4"></i>
                                <h3 class="text-xl font-bold"><strong>GESTION DU PERSONNEL</strong></h3>
                            </div>
                            <p class="mb-6 text-sm leading-relaxed" style="color: #d1fae5;">
                                Gestion avance salaire et des tâcherons
                            </p>
                            <button
                                class="bg-white px-6 py-2 rounded-full font-medium hover:bg-gray-100 transition-colors"
                                style="color: #059669;">
                                Souscrire
                            </button>
                            <div class="mt-4 flex items-center" style="color: #d1fae5;">
                                <i class="pi pi-check-circle mr-2"></i>
                                <span>Disponible</span>
                            </div>
                        </div>

                        <!-- DIGI-MAP Card -->
                        <div
                            class="col-span-12 md:col-span-4 bg-gray-900 rounded-2xl p-8 text-white shadow-lg hover:shadow-xl transition-all duration-300 hover:-translate-y-1 cursor-pointer">
                            <div class="flex items-center mb-6">
                                <i class="pi pi-bars text-3xl mr-4"></i>
                                <h3 class="text-xl font-bold"><strong>DIGI-MAP</strong></h3>
                            </div>
                            <p class="text-gray-300 mb-6 text-sm leading-relaxed">
                                Géolocalisation de nos points de services
                            </p>
                            <button
                                class="bg-cyan-500 text-white px-6 py-2 rounded-full font-medium hover:bg-cyan-400 transition-colors">
                                Acceder
                            </button>
                            <div class="mt-4 flex items-center text-orange-200 font-semibold">
                                <i class="pi pi-info-circle mr-2"></i>
                                <span>En cours</span>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Dialog Inscription Personnel -->
<p-dialog header="Inscription Personnel" [(visible)]="showPersonnelDialog" [modal]="true" [style]="{ width: '500px' }"
    [closable]="true" [draggable]="false" styleClass="personnel-dialog">

    <div class="p-4">
        <!-- Message de succès -->
        @if (personnelState().message) {
        <div class="mb-4">
            <p-message severity="success" [text]="personnelState().message"></p-message>
        </div>
        }

        <!-- Message d'erreur -->
        @if (personnelState().error) {
        <div class="mb-4">
            <p-message severity="error" [text]="personnelState().error"></p-message>
        </div>
        }

        <form #personnelForm="ngForm" (ngSubmit)="registerPersonnel(personnelForm)" class="flex flex-col gap-4">
            <!-- Matricule -->
            <p-input-group>
                <p-inputgroup-addon>
                    <i class="pi pi-id-card"></i>
                </p-inputgroup-addon>
                <input pInputText name="matricule" ngModel #matricule="ngModel" placeholder="Matricule *" required />
            </p-input-group>
            @if(matricule.invalid && matricule.touched) {
            <small class="text-red-500">Le matricule est obligatoire</small>
            }

            <!-- Prénom -->
            <p-input-group>
                <p-inputgroup-addon>
                    <i class="pi pi-user"></i>
                </p-inputgroup-addon>
                <input pInputText name="firstName" ngModel #firstName="ngModel" placeholder="Prénom *" required />
            </p-input-group>
            @if(firstName.invalid && firstName.touched) {
            <small class="text-red-500">Le prénom est obligatoire</small>
            }

            <!-- Nom -->
            <p-input-group>
                <p-inputgroup-addon>
                    <i class="pi pi-user"></i>
                </p-inputgroup-addon>
                <input pInputText name="lastName" ngModel #lastName="ngModel" placeholder="Nom *" required />
            </p-input-group>
            @if(lastName.invalid && lastName.touched) {
            <small class="text-red-500">Le nom est obligatoire</small>
            }

            <!-- Email -->
            <p-input-group>
                <p-inputgroup-addon>
                    <i class="pi pi-envelope"></i>
                </p-inputgroup-addon>
                <input pInputText name="email" ngModel #email="ngModel" placeholder="Email *" required email
                    type="email" />
            </p-input-group>
            @if(email.invalid && email.touched && email.errors?.['required']) {
            <small class="text-red-500">L'email est obligatoire</small>
            }
            @if(email.invalid && email.touched && email.errors?.['email']) {
            <small class="text-red-500">Format d'email invalide</small>
            }

            <!-- Téléphone -->
            <p-input-group>
                <p-inputgroup-addon>
                    <i class="pi pi-phone"></i>
                </p-inputgroup-addon>
                <input pInputText name="phone" ngModel #phone="ngModel" placeholder="Téléphone" />
            </p-input-group>

            <!-- Mot de passe -->
            <p-input-group>
                <p-inputgroup-addon>
                    <i class="pi pi-lock"></i>
                </p-inputgroup-addon>
                <input pInputText name="password" ngModel #password="ngModel" type="password"
                    placeholder="Mot de passe *" required minlength="6" />
            </p-input-group>
            @if(password.invalid && password.touched && password.errors?.['required']) {
            <small class="text-red-500">Le mot de passe est obligatoire</small>
            }
            @if(password.invalid && password.touched && password.errors?.['minlength']) {
            <small class="text-red-500">Le mot de passe doit contenir au moins 6 caractères</small>
            }

            <!-- Info message -->
            <div class="bg-blue-50 p-3 rounded-lg text-sm text-blue-700">
                <i class="pi pi-info-circle mr-2"></i>
                <span>Le nom d'utilisateur sera généré automatiquement à partir de votre prénom et nom.</span>
            </div>

            <!-- Boutons -->
            <div class="flex justify-end gap-3 mt-4">
                <p-button label="Annuler" icon="pi pi-times" severity="secondary" (onClick)="closePersonnelDialog()"
                    [outlined]="true">
                </p-button>
                <p-button type="submit" label="S'inscrire" icon="pi pi-check" [loading]="personnelState().loading"
                    [disabled]="personnelForm.invalid || personnelState().loading"
                    [style]="{'background-color': '#059669', 'border-color': '#059669'}">
                </p-button>
            </div>
        </form>
    </div>
</p-dialog>

<p-toast />
}