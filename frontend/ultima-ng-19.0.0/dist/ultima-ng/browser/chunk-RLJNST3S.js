import{a as U}from"./chunk-IAYGIRSF.js";import{a as J,k as $}from"./chunk-SRGIHKGJ.js";import"./chunk-KLDL5O4H.js";import"./chunk-PXEEYFPS.js";import"./chunk-4MNJFNZT.js";import"./chunk-7A4CRAMP.js";import"./chunk-3WTE2CKQ.js";import"./chunk-LA2FUI34.js";import"./chunk-ZNTL7BEM.js";import"./chunk-MPVO6A2U.js";import"./chunk-D6YNXGTA.js";import"./chunk-ED7TFTUL.js";import"./chunk-MZ7FZGG3.js";import"./chunk-HNZBC55R.js";import"./chunk-J62YMCRW.js";import"./chunk-J6B6CWYC.js";import"./chunk-IEQZB3PI.js";import"./chunk-ATSSA22C.js";import"./chunk-XYTTGGFW.js";import"./chunk-ZNT52ZF3.js";import"./chunk-Z7KSDRLV.js";import"./chunk-N4Q6Z3MW.js";import{b as N,d as F}from"./chunk-UCSGE5ZL.js";import"./chunk-2O7XYKW4.js";import"./chunk-R2ZYXRFE.js";import{a as q,b as z}from"./chunk-NRZ4QNP7.js";import"./chunk-GFZUU5ZD.js";import"./chunk-BODZH67C.js";import"./chunk-KR7F45VC.js";import{e as V,g as B}from"./chunk-XKXBFP6V.js";import"./chunk-ULM4QL4Q.js";import{sa as j}from"./chunk-3YZBLOIS.js";import"./chunk-2I6ZAGC7.js";import{b as H}from"./chunk-FVCMZ6IK.js";import"./chunk-VDYO34A5.js";import"./chunk-Y2QT2WK5.js";import"./chunk-S35HUXPS.js";import{j as D,l as w,u as R,y as L}from"./chunk-GZWLZB4Q.js";import{Ac as A,Bb as E,Ec as k,Gb as e,Hb as t,Mc as p,Rb as g,Sb as v,Va as o,_,cc as r,dc as c,ea as S,ec as M,gb as O,lc as y,mb as b,mc as P,pc as T,va as x,vb as h,wc as I,xb as f}from"./chunk-MKA3N2SS.js";import{a as m,b as u}from"./chunk-GAL4ENT6.js";var G=()=>({"min-width":"100%"}),K=()=>[5,10,25,50],Q=(l,n,a)=>({"status-attente":l,"status-rejete":n,"status-valide":a});function W(l,n){if(l&1&&(e(0,"div",14),r(1),t()),l&2){let a=v();o(),c(a.error())}}function X(l,n){l&1&&(e(0,"div",15),r(1,"Chargement..."),t())}function Z(l,n){l&1&&(e(0,"tr")(1,"th"),r(2,"Code Client"),t(),e(3,"th"),r(4,"Nom"),t(),e(5,"th"),r(6,"Pr\xE9nom"),t(),e(7,"th"),r(8,"T\xE9l\xE9phone"),t(),e(9,"th"),r(10,"Statut"),t(),e(11,"th"),r(12,"Agence"),t(),e(13,"th"),r(14,"Cr\xE9\xE9 le"),t()())}function ee(l,n){if(l&1&&(e(0,"tr")(1,"td"),r(2),t(),e(3,"td"),r(4),t(),e(5,"td"),r(6),t(),e(7,"td"),r(8),t(),e(9,"td")(10,"span",20),r(11),t()(),e(12,"td"),r(13),t(),e(14,"td"),r(15),I(16,"date"),t()()),l&2){let a=n.$implicit;o(2),c(a.codCliente),o(2),c(a.nomClient),o(2),c(a.prenomClient),o(2),c(a.telPrincipal),o(2),h("ngClass",T(13,Q,a.correctionStatut==="EN_ATTENTE",a.correctionStatut==="REJETE",a.correctionStatut==="VALIDE")),o(),c(a.correctionStatut||"EN_ATTENTE"),o(2),c(a.codeAgence),o(2),c(A(16,8,a.createdAt,"dd/MM/yyyy HH:mm","","fr-FR"))}}function te(l,n){l&1&&(e(0,"tr")(1,"td",21),r(2,"Aucune correction trouv\xE9e pour ce point de service"),t()())}function ne(l,n){if(l&1&&(e(0,"p-table",16),b(1,Z,15,0,"ng-template",17)(2,ee,17,17,"ng-template",18)(3,te,3,0,"ng-template",19),t()),l&2){let a=v();h("value",a.items())("tableStyle",P(6,G))("paginator",!0)("rows",10)("rowsPerPageOptions",P(7,K))("showCurrentPageReport",!0)}}D(U);var Y=class l{pointCode;pointLibele;userService=_(H);route=_(N);router=_(F);state=x({loading:!1,allItems:[],filteredItems:[],error:void 0,statut:null});isLoading=p(()=>this.state().loading);items=p(()=>this.state().filteredItems);allItems=p(()=>this.state().allItems);error=p(()=>this.state().error);statut=p(()=>this.state().statut);countAll=p(()=>this.allItems().length);countEnAttente=p(()=>this.allItems().filter(n=>n.correctionStatut==="EN_ATTENTE").length);countRejete=p(()=>this.allItems().filter(n=>n.correctionStatut==="REJETE").length);countValide=p(()=>this.allItems().filter(n=>n.correctionStatut==="VALIDE").length);ngOnChanges(n){n.pointCode&&this.pointCode&&this.load(null)}ngOnInit(){this.route.queryParamMap.subscribe(n=>{let a=n.get("code"),i=n.get("libele");a&&(this.pointCode=a,this.pointLibele=i||this.pointLibele,this.load(null))})}load(n,a=!1){if(!this.pointCode){this.state.update(i=>u(m({},i),{error:"Code point de service manquant"}));return}if(!a&&this.allItems().length>0){this.applyFilter(n);return}this.state.update(i=>u(m({},i),{loading:!0,error:void 0,statut:n})),this.userService.getCorrectionsByPointVente$(this.pointCode,void 0).subscribe({next:i=>{let s=(i.data?.corrections||[]).map(d=>u(m({},d),{createdAt:Array.isArray(d.createdAt)&&d.createdAt.length>=3?new Date(d.createdAt[0],(d.createdAt[1]||1)-1,d.createdAt[2]||1,d.createdAt[3]||0,d.createdAt[4]||0,d.createdAt[5]||0,d.createdAt[6]||0).toISOString():d.createdAt})),C=n?s.filter(d=>d.correctionStatut===n):s;this.state.update(d=>u(m({},d),{allItems:s,filteredItems:C,loading:!1,statut:n}))},error:i=>{let s=i.error?.message||"Erreur lors du chargement des corrections.";this.state.update(C=>u(m({},C),{loading:!1,error:s}))}})}applyFilter(n){let a=this.allItems(),i=n?a.filter(s=>s.correctionStatut===n):a;this.state.update(s=>u(m({},s),{filteredItems:i,statut:n}))}filterAll(){this.applyFilter(null)}filterAttente(){this.applyFilter("EN_ATTENTE")}filterRejete(){this.applyFilter("REJETE")}filterValide(){this.applyFilter("VALIDE")}refresh(){this.load(this.statut()??null,!0)}goBack(){this.router.navigate(["/dashboards"])}static \u0275fac=function(a){return new(a||l)};static \u0275cmp=O({type:l,selectors:[["app-societariat-detail-ps"]],inputs:{pointCode:"pointCode",pointLibele:"pointLibele"},features:[y([{provide:k,useValue:"fr-FR"}]),S],decls:35,vars:16,consts:[[1,"panel"],[1,"panel-header"],[1,"header-left"],["pButton","","type","button","icon","pi pi-arrow-left","pTooltip","Retour aux statistiques","tooltipPosition","right",1,"p-button-text","p-button-rounded","back-btn",3,"click"],[1,"subtitle"],[1,"header-right"],["pButton","","type","button","icon","pi pi-refresh","pTooltip","Rafra\xEEchir",1,"p-button-text","p-button-rounded",3,"click","disabled"],[1,"stats-summary"],[1,"stat-card","total",3,"click"],[1,"stat-value"],[1,"stat-label"],[1,"stat-card","en-attente",3,"click"],[1,"stat-card","rejete",3,"click"],[1,"stat-card","valide",3,"click"],[1,"error"],[1,"loading"],["currentPageReportTemplate","Affichage {first} \xE0 {last} sur {totalRecords} entr\xE9es",3,"value","tableStyle","paginator","rows","rowsPerPageOptions","showCurrentPageReport"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"status-badge",3,"ngClass"],["colspan","7",1,"empty"]],template:function(a,i){a&1&&(e(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),g("click",function(){return i.goBack()}),t(),e(4,"div")(5,"h4"),r(6,"D\xE9tails des corrections"),t(),e(7,"p",4),r(8),t()()(),e(9,"div",5)(10,"button",6),g("click",function(){return i.refresh()}),t()()(),e(11,"div",7)(12,"div",8),g("click",function(){return i.filterAll()}),e(13,"span",9),r(14),t(),e(15,"span",10),r(16,"Tous"),t()(),e(17,"div",11),g("click",function(){return i.filterAttente()}),e(18,"span",9),r(19),t(),e(20,"span",10),r(21,"En attente"),t()(),e(22,"div",12),g("click",function(){return i.filterRejete()}),e(23,"span",9),r(24),t(),e(25,"span",10),r(26,"Rejet\xE9es"),t()(),e(27,"div",13),g("click",function(){return i.filterValide()}),e(28,"span",9),r(29),t(),e(30,"span",10),r(31,"Valid\xE9es"),t()()(),b(32,W,2,1,"div",14)(33,X,2,0,"div",15)(34,ne,4,8,"p-table",16),t()),a&2&&(o(8),M("Point de service : ",i.pointLibele||i.pointCode||"Non renseign\xE9",""),o(2),h("disabled",i.isLoading()),o(2),f("active",i.statut()===null),o(2),c(i.countAll()),o(3),f("active",i.statut()==="EN_ATTENTE"),o(2),c(i.countEnAttente()),o(3),f("active",i.statut()==="REJETE"),o(2),c(i.countRejete()),o(3),f("active",i.statut()==="VALIDE"),o(2),c(i.countValide()),o(3),E(i.error()?32:-1),o(),E(i.isLoading()?33:34))},dependencies:[L,w,R,$,J,j,B,V,z,q],styles:["[_nghost-%COMP%]{display:block}.panel[_ngcontent-%COMP%]{border:1px solid #e5e7eb;border-radius:8px;padding:1rem;background:#fff;box-shadow:0 1px 2px #0000000a}.panel-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:.5rem;margin-bottom:1rem}.panel-header[_ngcontent-%COMP%]   .header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.panel-header[_ngcontent-%COMP%]   .header-left[_ngcontent-%COMP%]   .back-btn[_ngcontent-%COMP%]{color:#6366f1}.panel-header[_ngcontent-%COMP%]   .header-left[_ngcontent-%COMP%]   .back-btn[_ngcontent-%COMP%]:hover{background:#6366f11a}.panel-header[_ngcontent-%COMP%]   .header-right[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.panel-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;font-weight:700}.panel-header[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{margin:.25rem 0 0;color:#6b7280}.stats-summary[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);gap:.75rem;margin-bottom:1rem}@media (max-width: 768px){.stats-summary[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}@media (max-width: 480px){.stats-summary[_ngcontent-%COMP%]{grid-template-columns:1fr}}.stat-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:1rem;border-radius:8px;cursor:pointer;transition:all .2s ease;border:2px solid transparent}.stat-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 12px #0000001a}.stat-card.active[_ngcontent-%COMP%]{border-color:currentColor;transform:scale(1.02)}.stat-card[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700}.stat-card[_ngcontent-%COMP%]   .stat-label[_ngcontent-%COMP%]{font-size:.85rem;margin-top:.25rem}.stat-card.total[_ngcontent-%COMP%]{background:linear-gradient(135deg,#e0e7ff,#c7d2fe);color:#4338ca}.stat-card.en-attente[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fef3c7,#fde68a);color:#b45309}.stat-card.rejete[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fee2e2,#fecaca);color:#dc2626}.stat-card.valide[_ngcontent-%COMP%]{background:linear-gradient(135deg,#d1fae5,#a7f3d0);color:#059669}.status-badge[_ngcontent-%COMP%]{display:inline-block;padding:.25rem .5rem;border-radius:4px;font-size:.75rem;font-weight:600;text-transform:uppercase}.status-badge.status-attente[_ngcontent-%COMP%]{background:#fef3c7;color:#b45309}.status-badge.status-rejete[_ngcontent-%COMP%]{background:#fee2e2;color:#dc2626}.status-badge.status-valide[_ngcontent-%COMP%]{background:#d1fae5;color:#059669}.empty[_ngcontent-%COMP%]{text-align:center;color:#6b7280}.error[_ngcontent-%COMP%]{padding:.5rem .75rem;background:#fef2f2;border:1px solid #fecdd3;border-radius:6px;color:#b91c1c;margin-bottom:.75rem}.loading[_ngcontent-%COMP%]{padding:1rem;text-align:center;color:#6b7280}  .p-paginator{padding:.75rem;border-top:1px solid #e5e7eb}  .p-paginator .p-paginator-current{color:#6b7280;font-size:.875rem}"]})};export{Y as SocietariatDetailPsComponent};
