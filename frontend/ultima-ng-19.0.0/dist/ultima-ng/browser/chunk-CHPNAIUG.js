import{a as Xt,b as en}from"./chunk-T5HP75DJ.js";import{a as cn,b as mn}from"./chunk-H7FN4LGP.js";import{a as pn,b as un}from"./chunk-LYHZ4GLG.js";import{a as rn,b as ln,c as sn,e as dn,f as bt}from"./chunk-MVMJFDGQ.js";import{a as tn}from"./chunk-I76KYJHC.js";import{a as on}from"./chunk-RBONMZKN.js";import{b as nn}from"./chunk-K2RLQDMJ.js";import{a as ft,b as Ct,c as Oe}from"./chunk-Q5MOEBGQ.js";import{a as gn}from"./chunk-7EYRITSZ.js";import"./chunk-4QTRYJBC.js";import{a as ht}from"./chunk-ZT3TTGVJ.js";import"./chunk-JA4WM3ZQ.js";import{b as an}from"./chunk-2VJNGR3L.js";import{a as _e,b as fe}from"./chunk-E24E7YRI.js";import{a as xt,b as vt}from"./chunk-4JPZ5GKU.js";import{a as pt,b as $e}from"./chunk-GBSAZIIF.js";import{a as ct,b as mt}from"./chunk-F6BLPIFZ.js";import"./chunk-SQPWYWAP.js";import"./chunk-TOQUJNDH.js";import{c as Q,d as Y}from"./chunk-JK4JG2UW.js";import{a as Zt}from"./chunk-4V2AF3JO.js";import"./chunk-3VC7NE7E.js";import"./chunk-KX7VGL6R.js";import"./chunk-5YYAURUY.js";import"./chunk-EEIFWQSI.js";import{a as Be,b as Me}from"./chunk-KNXQC5ZK.js";import"./chunk-7ZFHYQCZ.js";import{a as ut,b as le}from"./chunk-ML3LU6MO.js";import{b as Kt}from"./chunk-WMO3Y22R.js";import{a as $,d as qe,e as ze,k as q}from"./chunk-SRGIHKGJ.js";import"./chunk-KLDL5O4H.js";import{a as Qt,b as Yt}from"./chunk-PXEEYFPS.js";import"./chunk-4MNJFNZT.js";import"./chunk-7A4CRAMP.js";import"./chunk-3WTE2CKQ.js";import{a as gt,b as _t}from"./chunk-LA2FUI34.js";import"./chunk-ZNTL7BEM.js";import{a as J,b as z}from"./chunk-QZOXHZZK.js";import"./chunk-MPVO6A2U.js";import"./chunk-D6YNXGTA.js";import"./chunk-ED7TFTUL.js";import"./chunk-MZ7FZGG3.js";import{a as ge,b as W}from"./chunk-C4WQ325L.js";import"./chunk-HNZBC55R.js";import"./chunk-J62YMCRW.js";import{c as Gt,d as Ht}from"./chunk-J6B6CWYC.js";import"./chunk-IEQZB3PI.js";import"./chunk-ATSSA22C.js";import{a as st,b as dt}from"./chunk-BGHZ5NVU.js";import"./chunk-XYTTGGFW.js";import"./chunk-ZNT52ZF3.js";import{a as Ne,b as Ee,c as Fe,d as Pe}from"./chunk-Z7KSDRLV.js";import"./chunk-N4Q6Z3MW.js";import{a as U,b as K}from"./chunk-3BEM77IG.js";import{d as Re,e as at}from"./chunk-UCSGE5ZL.js";import"./chunk-2O7XYKW4.js";import{a as B}from"./chunk-YTFCGSG6.js";import"./chunk-RHLJ6NE2.js";import{a as rt,b as je}from"./chunk-R2ZYXRFE.js";import{a as re,b as H}from"./chunk-NRZ4QNP7.js";import"./chunk-GFZUU5ZD.js";import"./chunk-BODZH67C.js";import"./chunk-KR7F45VC.js";import{a as lt,b as ye,e as ae,f as ue,g as F}from"./chunk-XKXBFP6V.js";import{a as Ut,b as Jt}from"./chunk-ULM4QL4Q.js";import{ka as Z,oa as w,sa as N}from"./chunk-3YZBLOIS.js";import{b as Le,e as te,i as ne,x as ie,y as Wt}from"./chunk-2I6ZAGC7.js";import{b as V}from"./chunk-FVCMZ6IK.js";import"./chunk-VDYO34A5.js";import"./chunk-Y2QT2WK5.js";import{c as nt,d as it,f as ke,g as Ve,h as ot}from"./chunk-S35HUXPS.js";import{l as et,m as qt,n as Ie,t as zt,u as Ae,w as tt,x as Bt,y as j}from"./chunk-GZWLZB4Q.js";import{A as Ke,Ab as jt,Ac as Xe,Bb as _,Eb as me,Fb as pe,Gb as n,Hb as i,Ib as m,Mb as y,Mc as O,Rb as f,Sb as d,U as Lt,Va as l,Wb as he,_ as P,bc as Se,cc as r,dc as u,ec as C,fa as v,fc as T,ga as b,gb as D,ic as I,jc as A,k as Ye,kc as k,lc as G,ma as oe,mb as g,mc as M,nc as Je,oc as Nt,u as Rt,ub as Ze,va as E,vb as p,wc as L,xb as Ce,xc as Ft,yb as X,yc as ee,zb as de,zc as $t}from"./chunk-MKA3N2SS.js";import{a as h,b as S}from"./chunk-GAL4ENT6.js";var En=()=>["/dashboards/agent-credit/list-selection-ind"],Cn=()=>[10,25,50],Pn=()=>["nom","prenom","numeroMembre","activite","telephone"];function Mn(o,t){o&1&&(n(0,"p-message",13),r(1," Nouvelle demande Pour la Selection, Voir pour plus de d\xE9tails. "),n(2,"a",16),r(3," Voir la liste \u2192 "),i()()),o&2&&(l(2),p("routerLink",M(1,En)))}function On(o,t){o&1&&(n(0,"div",14)(1,"div",17),m(2,"i",18),n(3,"p",19),r(4,"V\xE9rification de votre statut d'activation..."),i()()())}function wn(o,t){if(o&1&&(n(0,"div",31)(1,"p",35),m(2,"i",36),n(3,"strong"),r(4,"Note:"),i(),r(5," Votre point de service actuel est "),n(6,"strong"),r(7),i()()()),o&2){let e,a=d(2);l(7),T("",(e=a.state().pointVente)==null?null:e.libele," (",(e=a.state().pointVente)==null?null:e.code,")")}}function Dn(o,t){if(o&1){let e=y();n(0,"div",15)(1,"div",20)(2,"div",21),m(3,"i",22),i(),n(4,"div",23)(5,"h3",24),r(6," \u{1F6AB} Acc\xE8s Restreint - Agent Non Activ\xE9 "),i(),n(7,"div",25)(8,"p",26),r(9," Vous n'\xEAtes pas activ\xE9 dans ce point de service. "),i(),n(10,"p",27),r(11," Pour acc\xE9der aux fonctionnalit\xE9s de gestion des cr\xE9dits, votre compte doit \xEAtre activ\xE9 par le Responsable d'Agence (RA) pour ce point de service. "),i(),n(12,"div",28)(13,"h4",29),r(14,"\u{1F4CB} Que faire ?"),i(),n(15,"ul",30)(16,"li"),r(17,"Contactez votre Responsable d'Agence (RA)"),i(),n(18,"li"),r(19,"Demandez l'activation de votre compte pour ce point de service"),i(),n(20,"li"),r(21,"Une fois activ\xE9, rafra\xEEchissez cette page"),i()()(),g(22,wn,8,2,"div",31),i(),n(23,"div",32)(24,"button",33),f("click",function(){v(e);let s=d();return b(s.refresh())}),i(),n(25,"button",34),f("click",function(){v(e);let s=d();return b(s.reloadPage())}),i()()()()()}if(o&2){let e=d();l(22),_(e.state().user?22:-1),l(2),p("loading",e.state().checkingStatus)}}function Tn(o,t){if(o&1){let e=y();n(0,"div",44)(1,"p-icon-field",45),m(2,"p-inputicon",46),n(3,"input",47),f("input",function(s){v(e),d();let c=Se(2),x=d(2);return b(x.onGlobalFilter(c,s))}),i()()()}}function In(o,t){o&1&&(n(0,"tr")(1,"th",48),r(2," Date "),m(3,"p-sortIcon",49),i(),n(4,"th",50),r(5," Nom "),m(6,"p-sortIcon",51),i(),n(7,"th",52),r(8," N\xB0 Membre "),m(9,"p-sortIcon",53),i(),n(10,"th",54),r(11," Montant "),m(12,"p-sortIcon",55),i(),n(13,"th",56),r(14," Activit\xE9 "),m(15,"p-sortIcon",57),i(),n(16,"th",58),r(17," Statut Validation "),m(18,"p-sortIcon",59),i(),n(19,"th",60),r(20,"Action"),i()())}function An(o,t){if(o&1){let e=y();n(0,"tr")(1,"td"),r(2),L(3,"date"),i(),n(4,"td"),r(5),i(),n(6,"td"),r(7),i(),n(8,"td"),r(9),L(10,"currency"),i(),n(11,"td"),r(12),i(),n(13,"td"),m(14,"p-tag",61),i(),n(15,"td")(16,"button",62),f("click",function(){let s=v(e).$implicit,c=d(3);return b(c.miseEnPlaceCredit(s.numeroMembre))}),i()()()}if(o&2){let e=t.$implicit,a=d(3);l(2),u(ee(3,7,e.createdAt,"dd/MM/yyyy")),l(3),T("",e.prenom," ",e.nom,""),l(2),u(e.numeroMembre),l(2),u(ee(10,10,e.montant,"GNF ")),l(3),u(e.activite),l(2),p("value",a.getStateValidation(e.statutDemande,e.validationState))}}function kn(o,t){o&1&&(n(0,"tr")(1,"td",63),r(2," Aucune demande avec statut de validation 'VALIDATION' trouv\xE9e. "),i()())}function Vn(o,t){if(o&1&&(n(0,"div",37)(1,"p-table",39,0),g(3,Tn,4,0,"ng-template",40)(4,In,21,0,"ng-template",41)(5,An,17,13,"ng-template",42)(6,kn,3,0,"ng-template",43),i()()),o&2){let e=d(2);l(),p("value",e.state().filteredDemandeAttentes)("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",M(6,Cn))("globalFilterFields",M(7,Pn))}}function Rn(o,t){if(o&1){let e=y();n(0,"div",44)(1,"p-icon-field",45),m(2,"p-inputicon",46),n(3,"input",66),f("input",function(s){v(e),d();let c=Se(4),x=d(2);return b(x.onGlobalFilter(c,s))}),i()()()}}function Ln(o,t){o&1&&(n(0,"tr")(1,"th",67),r(2," Date "),m(3,"p-sortIcon",68),i(),n(4,"th",69),r(5," N\xB0 Membre "),m(6,"p-sortIcon",70),i(),n(7,"th",71),r(8," Statut Cr\xE9dit "),m(9,"p-sortIcon",72),i(),n(10,"th",73),r(11,"Action"),i()())}function jn(o,t){if(o&1){let e=y();n(0,"tr")(1,"td"),r(2),L(3,"date"),i(),n(4,"td"),r(5),i(),n(6,"td"),m(7,"p-tag",74),i(),n(8,"td")(9,"button",75),f("click",function(){let s=v(e).$implicit,c=d(3);return b(c.viewCreditDetails(s.referenceCredit,s.codeMembre))}),i()()()}if(o&2){let e=t.$implicit,a=d(3);l(2),u(ee(3,4,e.createAt,"dd/MM/yyyy")),l(3),u(e.codeMembre),l(2),p("value",e.status)("severity",a.getStatusSeverity(e.status,""))}}function Nn(o,t){o&1&&(n(0,"tr")(1,"td",76),r(2,"Aucun cr\xE9dit trouv\xE9."),i()())}function Fn(o,t){if(o&1&&(n(0,"div",38)(1,"h3",64),r(2," Liste des Cr\xE9dits Not\xE9s par le Directeur D'agence "),i(),n(3,"p-table",65,1),g(5,Rn,4,0,"ng-template",40)(6,Ln,12,0,"ng-template",41)(7,jn,10,7,"ng-template",42)(8,Nn,3,0,"ng-template",43),i()()),o&2){let e=d(2);l(3),p("value",e.state().creditDtos)("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",M(5,Cn))}}function $n(o,t){if(o&1&&g(0,Vn,7,8,"div",37)(1,Fn,9,6,"div",38),o&2){let e,a,s=d();_(((e=s.state().demandeAttentes)==null?null:e.length)>0?0:-1),l(),_(((a=s.state().creditDtos)==null?null:a.length)>0?1:-1)}}var St=class o{state=E({user:void 0,loading:!1,message:void 0,error:void 0,filteredDemandeAttentes:[],isAgentActive:void 0,checkingStatus:!1});userService=P(V);router=P(Re);destroyRef=P(oe);messageService=P(w);ngOnInit(){console.log("\u{1F527} AgentCredit ngOnInit - Loading user..."),this.loadUserAndCheckStatus()}loadUserAndCheckStatus(){console.log("\u{1F464} Loading user from API..."),this.state.update(t=>S(h({},t),{checkingStatus:!0})),this.userService.getInstanceUser$().pipe(B(this.destroyRef)).subscribe({next:t=>{console.log("\u{1F4E5} User API response:",t);let e=t.data?.user;if(!e){console.error("\u274C No user in response"),this.state.update(a=>S(h({},a),{checkingStatus:!1,error:"Impossible de charger les informations utilisateur"})),this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de charger vos informations",life:5e3});return}console.log("\u2705 User loaded:",{userId:e.userId,pointventeId:e.pointventeId,role:e.role,firstName:e.firstName,lastName:e.lastName}),this.state.update(a=>S(h({},a),{user:e})),e.userId&&e.pointventeId?this.checkAgentStatus(e):(console.error("\u274C User missing userId or pointventeId"),this.state.update(a=>S(h({},a),{checkingStatus:!1,isAgentActive:!1,error:"Point de vente non assign\xE9"})),this.messageService.add({severity:"warn",summary:"Attention",detail:"Aucun point de vente assign\xE9 \xE0 votre compte",life:5e3}))},error:t=>{console.error("\u274C Error loading user:",t),this.state.update(e=>S(h({},e),{checkingStatus:!1,error:"Erreur lors du chargement des informations utilisateur"})),this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de charger vos informations",life:5e3})}})}checkAgentStatus(t){console.log("\u{1F50D} checkAgentStatus called for:",{userId:t.userId,pointventeId:t.pointventeId}),this.userService.checkAgentDisponibility$(t.userId,t.pointventeId).pipe(B(this.destroyRef)).subscribe({next:e=>{console.log("\u{1F4E5} Status check response:",e);let a=e.data?.disponibilityAgent,s=a?.isActive||!1;console.log("\u2705 Agent status:",{isActive:s,message:a?.message,currentPs:a?.currentPs}),this.state.update(c=>S(h({},c),{isAgentActive:s,checkingStatus:!1})),s?(console.log("\u2705 Agent is ACTIVE - Loading demandes..."),this.messageService.add({severity:"success",summary:"Acc\xE8s Autoris\xE9",detail:"Chargement des donn\xE9es...",life:3e3}),this.laodDemandeAttenteByPointVente()):(console.warn("\u26A0\uFE0F Agent is NOT active"),this.messageService.add({severity:"error",summary:"Acc\xE8s Restreint",detail:"Vous n'\xEAtes pas activ\xE9 dans ce point de service. Veuillez contacter votre responsable.",life:1e4}))},error:e=>{console.error("\u274C Error checking agent status:",e),this.state.update(a=>S(h({},a),{isAgentActive:!1,checkingStatus:!1,error:"Impossible de v\xE9rifier votre statut"})),this.messageService.add({severity:"warn",summary:"Erreur",detail:"Impossible de v\xE9rifier votre statut d'activation. Veuillez r\xE9essayer.",life:5e3})}})}laodDemandeAttenteByPointVente(){if(console.log("\u{1F4CB} laodDemandeAttenteByPointVente called"),!this.state().user?.pointventeId){console.warn("\u26A0\uFE0F No pointventeId available");return}if(this.state().isAgentActive===!1){console.warn("\u26A0\uFE0F Cannot load data - Agent not active"),this.messageService.add({severity:"warn",summary:"Acc\xE8s Refus\xE9",detail:"Vous devez \xEAtre activ\xE9 pour acc\xE9der aux donn\xE9es",life:3e3});return}console.log("\u{1F504} Loading demandes attente..."),this.state.update(e=>S(h({},e),{loading:!0,error:void 0})),this.userService.getAllDemandeAttente$().pipe(B(this.destroyRef)).subscribe({next:e=>{console.log("\u{1F4E5} Demandes attente response:",e);let a=e.data?.demandeAttentes||[],s=a.filter(c=>c.validationState==="VALIDATION");console.log("\u2705 Loaded demandes:",{total:a.length,filtered:s.length}),this.state.update(c=>S(h({},c),{demandeAttentes:a,filteredDemandeAttentes:s,pointVente:e.data?.pointVente,creditDtos:e.data?.creditDtos||[],nombreDemandeInd:e.data?.nombreDemandeInd||0,loading:!1})),a.length>0&&this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:`${a.length} demande(s) charg\xE9e(s)`,life:3e3})},error:e=>{console.error("\u274C Error loading demandes:",e),this.state.update(a=>S(h({},a),{error:"Erreur lors du chargement des demandes",loading:!1})),this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de charger les demandes en attente",life:5e3})}})}refresh(){console.log("\u{1F504} Refresh clicked"),this.state().isAgentActive?this.laodDemandeAttenteByPointVente():this.loadUserAndCheckStatus()}reloadPage(){window.location.reload()}getStatusLabel(t,e){return t==="EN_ATTENTE"&&e==="NOUVEAU"?"NOUVELLE DEMANDE":t==="EN_ATTENTE"&&e==="SELECTION"?"SELECTION":t}getStateValidation(t,e){return t==="EN_ATTENTE"&&e==="NOUVEAU"?"EN ATTENTE POUR LA SELECTION":t==="EN_ATTENTE"&&e==="SELECTION"?"EN ATTENTE POUR LA VALIDATION":t==="EN_ATTENTE"&&e==="APPROVED"?"DEMANDE APPROVEE PAR L'AGENT":e}onGlobalFilter(t,e){t.filterGlobal(e.target.value,"contains")}getStatusSeverity(t,e){if(t==="APPROVED")return"success";if(t==="EN_ATTENTE")return"info";if(t==="REJECTED")return"danger"}miseEnPlaceCredit(t){if(!this.state().isAgentActive){this.messageService.add({severity:"error",summary:"Acc\xE8s Refus\xE9",detail:"Vous devez \xEAtre activ\xE9 dans ce point de service pour effectuer cette action",life:5e3});return}this.router.navigate(["/dashboards/agent-credit/verification/",t])}viewCreditDetails(t,e){if(!this.state().isAgentActive){this.messageService.add({severity:"error",summary:"Acc\xE8s Refus\xE9",detail:"Vous devez \xEAtre activ\xE9 dans ce point de service pour effectuer cette action",life:5e3});return}this.router.navigate(["/dashboards/agent-credit/detail-credit-ind/",t,e])}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=D({type:o,selectors:[["app-agent-credit"]],features:[G([w])],decls:22,vars:8,consts:[["dt",""],["dtCredits",""],[1,"card","h-full"],[1,"p-2","h-full","flex","flex-col","justify-between"],[1,"flex","items-center","justify-between","mb-4"],[1,"flex","gap-4","flex-col","justify-between","w-full","md:flex-row","md:items-center"],[1,"flex","gap-4","items-center"],[1,"text-4xl"],[1,"flex","flex-col","gap-1","text-surface-600","dark:text-surface-200"],[1,"text-2xl","font-semibold"],[1,"text-color"],[1,"font-bold","text-primary"],[1,"flex","items-center","gap-2"],["severity","info"],[1,"flex","justify-center","items-center","py-8"],[1,"card","bg-red-50","border-2","border-red-200","p-6","mx-4","my-6"],[1,"px-2","py-1","ml-2","font-bold","bg-blue-100","text-blue-700","rounded-md","border","border-blue-300","hover:bg-blue-200",3,"routerLink"],[1,"flex","flex-col","items-center","gap-3"],[1,"pi","pi-spin","pi-spinner","text-4xl","text-blue-500"],[1,"text-gray-600"],[1,"flex","items-start","gap-4"],[1,"flex-shrink-0"],[1,"pi","pi-exclamation-triangle","text-5xl","text-red-600"],[1,"flex-1"],[1,"text-2xl","font-bold","text-red-800","mb-3"],[1,"space-y-3","text-red-700"],[1,"text-lg","font-semibold"],[1,"text-base"],[1,"bg-white","rounded-lg","p-4","border","border-red-300","mt-4"],[1,"font-semibold","text-red-800","mb-2"],[1,"list-disc","list-inside","space-y-2","text-red-700"],[1,"mt-4","p-3","bg-yellow-50","border","border-yellow-300","rounded-lg"],[1,"mt-6","flex","gap-3"],["pButton","","pRipple","","label","V\xE9rifier mon statut","icon","pi pi-refresh",1,"p-button-outlined","p-button-danger",3,"click","loading"],["pButton","","pRipple","","label","Recharger la page","icon","pi pi-replay",1,"p-button-outlined",3,"click"],[1,"text-yellow-800","text-sm"],[1,"pi","pi-info-circle","mr-2"],[1,"card"],[1,"card","mt-5"],["paginatorDropdownAppendTo","body","responsiveLayout","scroll","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} entries",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","globalFilterFields"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"flex","flex-wrap","gap-2","items-center","justify-between"],[1,"w-full","sm:w-80","order-1","sm:order-none"],[1,"pi","pi-search"],["pInputText","","type","text","placeholder","Global Search",1,"w-full",3,"input"],["pSortableColumn","createdAt",1,"white-space-nowrap",2,"width","10%"],["field","createdAt"],["pSortableColumn","nom",1,"white-space-nowrap",2,"width","15%"],["field","nom"],["pSortableColumn","numeroMembre",1,"white-space-nowrap",2,"width","15%"],["field","numeroMembre"],["pSortableColumn","montant",1,"white-space-nowrap",2,"width","10%"],["field","montant"],["pSortableColumn","activite",1,"white-space-nowrap",2,"width","15%"],["field","activite"],["pSortableColumn","statutDemande",1,"white-space-nowrap",2,"width","15%"],["field","statutDemande"],[1,"white-space-nowrap",2,"width","10%"],["severity","secondary",3,"value"],["pButton","","pRipple","","label","Mise en Place","text","",1,"ml-auto",3,"click"],["colspan","8",1,"text-center","p-4"],[1,"text-xl","font-medium","mb-3"],["paginatorDropdownAppendTo","body","responsiveLayout","scroll","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} entries",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions"],["pInputText","","type","text","placeholder","Recherche globale",1,"w-full",3,"input"],["pSortableColumn","dateCreation",1,"white-space-nowrap",2,"width","15%"],["field","dateCreation"],["pSortableColumn","codeMembre",1,"white-space-nowrap",2,"width","15%"],["field","codeMembre"],["pSortableColumn","status",1,"white-space-nowrap",2,"width","15%"],["field","status"],[1,"white-space-nowrap",2,"width","15%"],[3,"value","severity"],["pButton","","pRipple","","label","D\xE9tails","text","",1,"ml-auto",3,"click"],["colspan","6",1,"text-center","p-4"]],template:function(e,a){if(e&1&&(n(0,"div",2),m(1,"p-toast"),n(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6)(6,"div",7),r(7,"\u{1F44B}"),i(),n(8,"div",8)(9,"span",9),r(10," Bonjour, "),n(11,"span",10),r(12),i()(),n(13,"span"),r(14," Point de Service "),n(15,"span",11),r(16),i()()()(),n(17,"div",12),g(18,Mn,4,2,"p-message",13),i()()()(),g(19,On,5,0,"div",14)(20,Dn,26,2,"div",15)(21,$n,2,2),i()),e&2){let s,c,x;l(12),T(" ",(s=a.state().user)==null?null:s.firstName," ",(s=a.state().user)==null?null:s.lastName,"! "),l(4),T(" @ ",(c=a.state().pointVente)==null?null:c.libele," : ",(c=a.state().pointVente)==null?null:c.code," "),l(2),_(((x=a.state().user)==null?null:x.role)==="AGENT_CREDIT"&&a.state().nombreDemandeInd>0?18:-1),l(),_(a.state().checkingStatus?19:-1),l(),_(!a.state().checkingStatus&&a.state().isAgentActive===!1?20:-1),l(),_(a.state().isAgentActive===!0&&!a.state().checkingStatus?21:-1)}},dependencies:[j,tt,Ae,F,ae,N,Jt,Ut,$e,pt,at,q,$,qe,ze,Ee,Ne,Pe,Fe,z,J,Y,Q],encapsulation:2})};var zn=()=>({width:"50px",height:"50px"}),Bn=()=>({width:"90vw",maxWidth:"1500px"}),vn=()=>[10,25,50],Un=()=>["objetFinancement","statut","montantDemande"],Jn=()=>({width:"85vw",maxWidth:"1400px"}),Wn=()=>["nom","prenom","codeMembre","activite","telephone"];function Gn(o,t){if(o&1&&m(0,"p-chip",21),o&2){let e,a=d();p("label","Analyses: "+(((e=a.state().demandeAnalyseCredits)==null?null:e.length)||0))}}function Hn(o,t){if(o&1&&m(0,"p-chip",22),o&2){let e=d();p("label","Total: "+e.formatMontantGNF(e.getTotalMontant()))}}function Qn(o,t){o&1&&(n(0,"div",23),m(1,"p-progressSpinner",24),n(2,"span",25),r(3,"Chargement des demandes..."),i()()),o&2&&(l(),X(M(2,zn)))}function Yn(o,t){if(o&1&&(n(0,"div",26),m(1,"i",27),r(2),i()),o&2){let e=d();l(2),C(" ",e.state().error," ")}}function Kn(o,t){if(o&1){let e=y();n(0,"div",48)(1,"p-icon-field",49),m(2,"p-inputicon",50),n(3,"input",51),f("input",function(s){v(e),d();let c=Se(18),x=d(2);return b(x.onGlobalFilter(c,s))}),i()(),n(4,"div",52),m(5,"i",53),r(6),i()()}if(o&2){let e,a=d(3);l(6),C(" ",(e=a.state().demandeAnalyseCredits)==null?null:e.length," analyse(s) trouv\xE9e(s) ")}}function Zn(o,t){o&1&&(n(0,"tr")(1,"th",54),m(2,"i",55),r(3,"Date Demande "),m(4,"p-sortIcon",56),i(),n(5,"th",57),m(6,"i",58),r(7,"Objet du Financement "),m(8,"p-sortIcon",59),i(),n(9,"th",60),m(10,"i",61),r(11,"Montant Demand\xE9 "),m(12,"p-sortIcon",62),i(),n(13,"th",63),m(14,"i",64),r(15,"Dur\xE9e "),m(16,"p-sortIcon",65),i(),n(17,"th",66),m(18,"i",67),r(19,"Statut "),m(20,"p-sortIcon",68),i(),n(21,"th",69),m(22,"i",70),r(23,"Actions "),i()())}function Xn(o,t){if(o&1&&(n(0,"small",74),r(1),i()),o&2){let e=d().$implicit;l(),C(" Taux: ",e.tauxInteret,"% ")}}function ei(o,t){if(o&1){let e=y();n(0,"tr",71)(1,"td")(2,"div",72)(3,"span",73),r(4),i(),n(5,"small",74),r(6),i()()(),n(7,"td")(8,"div",72)(9,"span",75),r(10),i(),n(11,"small",76),m(12,"i",77),r(13),i()()(),n(14,"td",78)(15,"div",79)(16,"span",80),r(17),i(),g(18,Xn,2,1,"small",81),i()(),n(19,"td",82),m(20,"p-chip",83),i(),n(21,"td",82),m(22,"p-tag",84),i(),n(23,"td",82)(24,"p-button",85),f("click",function(){let s=v(e).$implicit,c=d(3);return b(c.viewAnalyseCredit(s.demandeCreditId,s.userId))}),i()()()}if(o&2){let e=t.$implicit,a=d(3);l(4),u(a.formatDate(e.dateDemande)),l(2),C("ID: ",e.demandeCreditId,""),l(4),C(" ",e.objetFinancement||"Non sp\xE9cifi\xE9",""),l(3),C("Entreprise ID: ",e.entrepriseId," "),l(4),C(" ",a.formatMontantGNF(e.montantDemande)," "),l(),p("ngIf",e.tauxInteret),l(2),p("label",e.dureeMois+" mois"),l(2),p("value",a.getAnalyseStatusLabel(e.statut))("severity",a.getAnalyseStatusSeverity(e.statut))}}function ti(o,t){o&1&&(n(0,"tr")(1,"td",86)(2,"div",87),m(3,"i",88),n(4,"span",89),r(5,"Aucune demande d'analyse trouv\xE9e"),i(),n(6,"small",74),r(7,"Les nouvelles demandes d'analyse appara\xEEtront ici"),i()()()())}function ni(o,t){if(o&1){let e=y();n(0,"div",31)(1,"div",32)(2,"div",33)(3,"h3",34),m(4,"i",35),r(5," Demandes d'Analyse de Cr\xE9dit encours "),m(6,"p-chip",36),i(),n(7,"div",37)(8,"p-button",38),f("click",function(){v(e);let s=d(2);return b(s.refreshData())}),i(),n(9,"p-button",39),f("click",function(s){v(e);let c=Se(11),x=d(2);return b(x.toggleAnalyseTable(c,s))}),i()()(),n(10,"p-popover",40,0)(12,"div",32)(13,"div",41)(14,"h4",42),m(15,"i",35),r(16," Demandes d'Analyse de Cr\xE9dit encours "),i()(),n(17,"p-table",43,1),g(19,Kn,7,1,"ng-template",44)(20,Zn,24,0,"ng-template",45)(21,ei,25,9,"ng-template",46)(22,ti,8,0,"ng-template",47),i()()()()()}if(o&2){let e,a,s=d(2);l(6),p("label","Nouveau: "+(((e=s.state().demandeAnalyseCredits)==null?null:e.length)||0)),l(2),p("loading",s.state().loading),l(),p("badge",(a=s.state().demandeAnalyseCredits)==null?null:a.length.toString()),l(),X(M(11,Bn)),l(7),p("value",s.state().demandeAnalyseCredits)("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",M(12,vn))("globalFilterFields",M(13,Un))}}function ii(o,t){o&1&&m(0,"p-divider")}function oi(o,t){if(o&1){let e=y();n(0,"div",48)(1,"p-icon-field",49),m(2,"p-inputicon",50),n(3,"input",98),f("input",function(s){v(e),d();let c=Se(17),x=d(2);return b(x.onGlobalFilter(c,s))}),i()(),n(4,"div",52),m(5,"i",53),r(6),i()()}if(o&2){let e,a=d(3);l(6),C(" ",(e=a.state().filteredDemandeAttentes)==null?null:e.length," demande(s) trouv\xE9e(s) ")}}function ai(o,t){o&1&&(n(0,"tr")(1,"th",99),m(2,"i",55),r(3,"Date de cr\xE9ation "),m(4,"p-sortIcon",100),i(),n(5,"th",101),m(6,"i",102),r(7,"Membre "),m(8,"p-sortIcon",103),i(),n(9,"th",104),m(10,"i",105),r(11,"R\xE9f\xE9rence "),m(12,"p-sortIcon",106),i(),n(13,"th",107),m(14,"i",61),r(15,"Montant "),m(16,"p-sortIcon",108),i(),n(17,"th",109),m(18,"i",70),r(19,"Actions "),i()())}function ri(o,t){if(o&1){let e=y();n(0,"tr",71)(1,"td")(2,"div",72)(3,"span",73),r(4),L(5,"date"),i(),n(6,"small",74),r(7),L(8,"date"),i()()(),n(9,"td")(10,"div",72)(11,"span",75),r(12),i(),n(13,"small",76),r(14),i()()(),n(15,"td"),m(16,"p-chip",83),i(),n(17,"td",78)(18,"div",79)(19,"span",110),r(20),i(),n(21,"small",74),r(22,"Montant demand\xE9"),i()()(),n(23,"td",82)(24,"p-button",111),f("click",function(){let s=v(e).$implicit,c=d(3);return b(c.viewInstanceCredit(s.referenceCredit,s.codeMembre,c.user==null?null:c.user.userId))}),i()()()}if(o&2){let e=t.$implicit,a=d(3);l(4),u(ee(5,6,e.createAt,"dd/MM/yyyy")),l(3),u(ee(8,9,e.createAt,"HH:mm")),l(5),u(e.codeMembre),l(2),u(e.nom||"Nom non disponible"),l(2),p("label",e.referenceCredit),l(4),C(" ",a.formatMontantGNF(e.montantCredit)," ")}}function li(o,t){o&1&&(n(0,"tr")(1,"td",112)(2,"div",87),m(3,"i",113),n(4,"span",89),r(5,"Aucune demande en attente trouv\xE9e"),i(),n(6,"small",74),r(7,"Les nouvelles demandes appara\xEEtront ici"),i()()()())}function si(o,t){if(o&1&&(n(0,"div",114)(1,"span",115),m(2,"i",116),r(3),i(),n(4,"span",117),m(5,"i",61),r(6),i()()),o&2){let e,a=d(3);l(3),C(" Total des demandes: ",((e=a.state().filteredDemandeAttentes)==null?null:e.length)||0," "),l(3),C(" Montant total: ",a.formatMontantGNF(a.getTotalMontant())," ")}}function di(o,t){if(o&1){let e=y();n(0,"div",90)(1,"div",33)(2,"h3",34),m(3,"i",91),r(4," Gestion des Cr\xE9dits "),i(),n(5,"div",37)(6,"p-button",38),f("click",function(){v(e);let s=d(2);return b(s.refreshData())}),i(),n(7,"p-button",92),f("click",function(s){v(e);let c=Se(9),x=d(2);return b(x.toggleDataTable(c,s))}),i()()(),n(8,"p-popover",93,2)(10,"div",32)(11,"div",41)(12,"h4",42),m(13,"i",94),r(14," Demandes en attente de notation "),i(),m(15,"p-chip",95),i(),n(16,"p-table",96,3),g(18,oi,7,1,"ng-template",44)(19,ai,20,0,"ng-template",45)(20,ri,25,12,"ng-template",46)(21,li,8,0,"ng-template",47)(22,si,7,2,"ng-template",97),i()()()()}if(o&2){let e,a=d(2);l(6),p("loading",a.state().loading),l(),p("badge",(e=a.state().filteredDemandeAttentes)==null?null:e.length.toString()),l(),X(M(11,Jn)),l(7),p("label","Total: "+a.formatMontantGNF(a.getTotalMontant())),l(),p("value",a.state().filteredDemandeAttentes)("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",M(12,vn))("globalFilterFields",M(13,Wn))}}function ci(o,t){if(o&1){let e=y();n(0,"div",118)(1,"div",119),m(2,"i",120),n(3,"h3",121),r(4,"Aucune demande en attente"),i(),n(5,"p",122),r(6," Toutes les demandes de cr\xE9dit ont \xE9t\xE9 trait\xE9es. Les nouvelles demandes appara\xEEtront automatiquement ici. "),i(),n(7,"p-button",123),f("click",function(){v(e);let s=d(2);return b(s.refreshData())}),i()()()}if(o&2){let e=d(2);l(7),p("loading",e.state().loading)}}function mi(o,t){if(o&1&&(n(0,"div"),g(1,ni,23,14,"div",28)(2,ii,1,0,"p-divider",20)(3,di,23,14,"div",29)(4,ci,8,1,"div",30),i()),o&2){let e,a,s,c=d();l(),p("ngIf",c.hasAnalyseCredits()),l(),p("ngIf",c.hasAnalyseCredits()&&((e=c.state().filteredDemandeAttentes)==null?null:e.length)>0),l(),p("ngIf",((a=c.state().filteredDemandeAttentes)==null?null:a.length)>0),l(),p("ngIf",((s=c.state().filteredDemandeAttentes)==null?null:s.length)===0&&!c.hasAnalyseCredits()&&!c.state().loading)}}var yt=class o{user;state=E({loading:!1,message:void 0,error:void 0,filteredDemandeAttentes:[],demandeAnalyseCredits:[]});userService=P(V);router=P(Re);destroyRef=P(oe);messageService=P(w);getStatusLabel(t,e){return t==="EN_ATTENTE"&&e==="NOUVEAU"?"NOUVELLE DEMANDE":t==="EN_ATTENTE"&&e==="SELECTION"?"SELECTION":t}ngOnInit(){this.laodAllCreditByAgence()}getStateValidation(t){return t==="ENCOURS"?"EN ATTENTE POUR LA NOTATION":t==="VALIDE"?"DEMANDE APROUVEE PAR LE DIRECTEUR":t==="REJECTED"?"DEMANDE REJETEE PAR LE DIRECTEUR":t}onGlobalFilter(t,e){t.filterGlobal(e.target.value,"contains")}getStatusSeverity(t){if(t==="ENCOURS")return"info";if(t==="VALIDE")return"success";if(t==="REJECTED")return"danger"}getAnalyseStatusSeverity(t){switch(t?.toUpperCase()){case"VUE":return"info";case"EN_ATTENTE":return"warn";case"APPROUVE":return"success";case"REJETE":return"danger";case"EN_COURS":return"info";default:return"secondary"}}getAnalyseStatusLabel(t){switch(t?.toUpperCase()){case"VUE":return"Vue";case"EN_ATTENTE":return"En attente";case"APPROUVE":return"Approuv\xE9";case"REJETE":return"Rejet\xE9";case"EN_COURS":return"En cours";default:return t||"Inconnu"}}formatMontantGNF(t){return!t||t===0?"0 GNF":new Intl.NumberFormat("fr-FR",{style:"currency",currency:"GNF",minimumFractionDigits:0,maximumFractionDigits:0}).format(t)}getTotalMontant(){return this.state().filteredDemandeAttentes?.reduce((t,e)=>t+(e.montantCredit||0),0)||0}hasAnalyseCredits(){return!!(this.state().demandeAnalyseCredits&&this.state().demandeAnalyseCredits.length>0)}formatDate(t){if(!t)return"Non d\xE9finie";try{return new Date(t).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric"})}catch{return t}}laodAllCreditByAgence(){this.state.set(S(h({},this.state()),{loading:!0})),this.userService.getListCreditEnAttente$().pipe(B(this.destroyRef)).subscribe({next:t=>{console.log("\u{1F50D} Response re\xE7ue:",t);let e=Array.isArray(t.data.creditDtos)?t.data.creditDtos:t.data.creditDtos?[t.data.creditDtos]:[],a=e.filter(c=>c.status==="ENCOURS"),s=Array.isArray(t.data.demandeAnalyseCredits)?t.data.demandeAnalyseCredits:t.data.demandeAnalyseCredits?[t.data.demandeAnalyseCredits]:[];console.log("\u{1F4CA} Demandes d'analyse trouv\xE9es:",s),this.state.set(S(h({},this.state()),{creditDtos:e,filteredDemandeAttentes:a,demandeAnalyseCredits:s,agence:t.data.agence,loading:!1})),s.length>0&&this.messageService.add({severity:"info",summary:"Demandes d'analyse disponibles",detail:`${s.length} demande(s) d'analyse de cr\xE9dit trouv\xE9e(s)`,life:5e3})},error:t=>{console.error("Error loading credits:",t),this.state.set(S(h({},this.state()),{error:"Erreur lors du chargement des informations des demandes en attente de credit",loading:!1})),this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de charger les informations du des demandes en attente de credit",life:5e3})},complete:()=>{}})}toggleDataTable(t,e){t.toggle(e)}toggleAnalyseTable(t,e){t.toggle(e)}selectedDemande;onDemandeSelect(t,e){this.selectedDemande=e.data,t.hide(),this.messageService.add({severity:"info",summary:"Demande S\xE9lectionn\xE9e",detail:`Membre: ${this.selectedDemande.codeMembre} ${this.selectedDemande.nom}`,life:3e3})}viewInstanceCredit(t,e,a){console.log("viewInstanceCredit",t,e,a),this.router.navigate(["/dashboards/resp-agent/",t,e,a])}viewAnalyseCredit(t,e){console.log("viewAnalyseCredit",t,e),this.router.navigate([`dashboards/credit/${e}/resume-credit/${t}`])}refreshData(){this.laodAllCreditByAgence(),this.messageService.add({severity:"info",summary:"Actualisation",detail:"Donn\xE9es actualis\xE9es avec succ\xE8s",life:2e3})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=D({type:o,selectors:[["app-resp-agent"]],inputs:{user:"user"},decls:24,vars:10,consts:[["analysePopover",""],["analyseTable",""],["demandesPopover",""],["dt",""],[1,"card","h-full"],[1,"p-4","h-full","flex","flex-col","justify-between"],[1,"flex","items-center","justify-between","mb-6"],[1,"flex","gap-4","flex-col","justify-between","w-full","md:flex-row","md:items-center"],[1,"flex","gap-4","items-center"],[1,"text-4xl"],[1,"flex","flex-col","gap-1","text-surface-600","dark:text-surface-200"],[1,"text-2xl","font-semibold"],[1,"text-color"],[1,"font-bold","text-primary"],[1,"flex","gap-3","flex-wrap"],["styleClass","bg-purple-100 text-purple-800",3,"label",4,"ngIf"],["styleClass","bg-orange-100 text-orange-800",3,"label"],["styleClass","bg-blue-100 text-blue-800",3,"label",4,"ngIf"],["class","flex justify-content-center align-items-center my-5",4,"ngIf"],["class","p-message p-message-error p-3 mb-4",4,"ngIf"],[4,"ngIf"],["styleClass","bg-purple-100 text-purple-800",3,"label"],["styleClass","bg-blue-100 text-blue-800",3,"label"],[1,"flex","justify-content-center","align-items-center","my-5"],["strokeWidth","4"],[1,"ml-3","text-600"],[1,"p-message","p-message-error","p-3","mb-4"],[1,"pi","pi-times-circle","mr-2"],["class","card mb-4 border-l-4 border-purple-500",4,"ngIf"],["class","card",4,"ngIf"],["class","card text-center p-6",4,"ngIf"],[1,"card","mb-4","border-l-4","border-purple-500"],[1,"p-4"],[1,"flex","flex-wrap","gap-3","align-items-center","justify-content-between","mb-4"],[1,"text-xl","font-semibold","m-0","text-900"],[1,"pi","pi-chart-line","mr-2","text-purple-600"],["severity","warning",1,"ml-2",3,"label"],[1,"flex","gap-2"],["icon","pi pi-refresh","severity","secondary","size","small","pTooltip","Actualiser les donn\xE9es",3,"click","loading"],["type","button","label","Voir les analyses","icon","pi pi-eye","badgeClass","p-badge-warning","severity","warn",3,"click","badge"],["id","analyse_popover"],[1,"flex","justify-content-between","align-items-center","mb-4"],[1,"text-lg","font-semibold","m-0"],["paginatorDropdownAppendTo","body","responsiveLayout","scroll","currentPageReportTemplate","Affichage de {first} \xE0 {last} sur {totalRecords} analyses","styleClass","p-datatable-striped",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","globalFilterFields"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"flex","flex-wrap","gap-3","items-center","justify-between"],[1,"w-full","sm:w-80"],[1,"pi","pi-search"],["pInputText","","type","text","placeholder","Rechercher par objet, statut...",1,"w-full",3,"input"],[1,"text-sm","text-600"],[1,"pi","pi-info-circle","mr-1"],["pSortableColumn","dateDemande",1,"white-space-nowrap",2,"width","15%"],[1,"pi","pi-calendar","mr-1"],["field","dateDemande"],["pSortableColumn","objetFinancement",1,"white-space-nowrap",2,"width","30%"],[1,"pi","pi-tag","mr-1"],["field","objetFinancement"],["pSortableColumn","montantDemande",1,"white-space-nowrap","text-right",2,"width","20%"],[1,"pi","pi-money-bill","mr-1"],["field","montantDemande"],["pSortableColumn","dureeMois",1,"white-space-nowrap","text-center",2,"width","10%"],[1,"pi","pi-clock","mr-1"],["field","dureeMois"],["pSortableColumn","statut",1,"white-space-nowrap","text-center",2,"width","10%"],[1,"pi","pi-flag","mr-1"],["field","statut"],[1,"white-space-nowrap","text-center",2,"width","15%"],[1,"pi","pi-cog","mr-1"],[1,"hover:bg-surface-50"],[1,"flex","flex-column","gap-1"],[1,"font-medium"],[1,"text-500"],[1,"font-semibold","text-900"],[1,"text-600"],[1,"pi","pi-building","mr-1"],[1,"text-right"],[1,"flex","flex-column","gap-1","align-items-end"],[1,"font-bold","text-lg","text-purple-600"],["class","text-500",4,"ngIf"],[1,"text-center"],["styleClass","bg-blue-50 text-blue-700 text-xs",3,"label"],[3,"value","severity"],["pRipple","","icon","pi pi-chart-line","label","Voir le Detail ","size","small","severity","warn","pTooltip","Proc\xE9der \xE0 l'analyse du cr\xE9dit",3,"click"],["colspan","6",1,"text-center","p-6"],[1,"flex","flex-column","align-items-center","gap-3"],[1,"pi","pi-chart-line","text-4xl","text-400"],[1,"text-600","font-medium"],[1,"card"],[1,"pi","pi-list","mr-2","text-primary"],["type","button","label","Afficher les demandes pour notation","icon","pi pi-eye","badgeClass","p-badge-danger","severity","info",3,"click","badge"],["id","demandes_popover"],[1,"pi","pi-calendar-plus","mr-2","text-primary"],["styleClass","bg-green-100 text-green-800 font-semibold",3,"label"],["paginatorDropdownAppendTo","body","responsiveLayout","scroll","currentPageReportTemplate","Affichage de {first} \xE0 {last} sur {totalRecords} demandes","styleClass","p-datatable-striped",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","globalFilterFields"],["pTemplate","summary"],["pInputText","","type","text","placeholder","Rechercher par nom, num\xE9ro membre...",1,"w-full",3,"input"],["pSortableColumn","createAt",1,"white-space-nowrap",2,"width","15%"],["field","createAt"],["pSortableColumn","codeMembre",1,"white-space-nowrap",2,"width","25%"],[1,"pi","pi-user","mr-1"],["field","codeMembre"],["pSortableColumn","referenceCredit",1,"white-space-nowrap",2,"width","20%"],[1,"pi","pi-bookmark","mr-1"],["field","referenceCredit"],["pSortableColumn","montantCredit",1,"white-space-nowrap","text-right",2,"width","20%"],["field","montantCredit"],[1,"white-space-nowrap","text-center",2,"width","20%"],[1,"font-bold","text-lg","text-green-600"],["pRipple","","icon","pi pi-arrow-right","label","Traiter","size","small","severity","success","pTooltip","Proc\xE9der \xE0 la mise en place du cr\xE9dit",3,"click"],["colspan","5",1,"text-center","p-6"],[1,"pi","pi-inbox","text-4xl","text-400"],[1,"flex","align-items-center","justify-content-between","p-2","bg-surface-50","border-round"],[1,"text-sm","font-medium"],[1,"pi","pi-calculator","mr-1"],[1,"text-sm","font-semibold","text-green-600"],[1,"card","text-center","p-6"],[1,"flex","flex-column","align-items-center","gap-4"],[1,"pi","pi-check-circle","text-6xl","text-green-500"],[1,"text-xl","font-semibold","text-900","m-0"],[1,"text-600","m-0","max-w-30rem"],["icon","pi pi-refresh","label","Actualiser","severity","secondary",3,"click","loading"]],template:function(e,a){if(e&1&&(n(0,"div",4)(1,"div",5)(2,"div",6)(3,"div",7)(4,"div",8)(5,"div",9),r(6,"\u{1F44B}"),i(),n(7,"div",10)(8,"span",11),r(9,"Bonjour, "),n(10,"span",12),r(11),i()(),n(12,"span"),r(13,"Agence de "),n(14,"span",13),r(15),i()()()(),n(16,"div",14),g(17,Gn,1,1,"p-chip",15),m(18,"p-chip",16),g(19,Hn,1,1,"p-chip",17),i()()(),g(20,Qn,4,3,"div",18)(21,Yn,3,1,"div",19)(22,mi,5,4,"div",20),m(23,"p-toast"),i()()),e&2){let s,c,x;l(11),T("",a.user==null?null:a.user.firstName," ",a.user==null?null:a.user.lastName,"!"),l(4),u((s=a.state().agence)==null?null:s.libele),l(2),p("ngIf",a.hasAnalyseCredits()),l(),he("label","Demandes en attente: ",((c=a.state().filteredDemandeAttentes)==null?null:c.length)||0,""),l(),p("ngIf",((x=a.state().filteredDemandeAttentes)==null?null:x.length)>0),l(),p("ngIf",a.state().loading),l(),p("ngIf",a.state().error&&!a.state().loading),l(),p("ngIf",!a.state().loading)}},dependencies:[j,Ie,Ae,q,$,N,qe,ze,Pe,Fe,Ee,Ne,z,J,en,Xt,F,ue,Y,Q,K,U,Me,Be,W,le,ut,Oe],encapsulation:2})};var bn=()=>({width:"450px"}),gi=(o,t)=>({"badge-dr":o,"badge-user":t}),_i=o=>({"row-urgent":o}),fi=o=>({"ng-invalid":o});function Ci(o,t){if(o&1&&(n(0,"div",10)(1,"span",11),r(2,"D\xE9l\xE9gation : "),i(),n(3,"span",12),r(4),L(5,"uppercase"),i(),n(6,"span",13),r(7,"R\xF4le : "),i(),n(8,"span",14),r(9),i()()),o&2){let e,a=d();l(4),u(Ft(5,3,(e=a.delegation())==null?null:e.libele)),l(4),p("ngClass",Nt(5,gi,a.user.role==="DR",a.user.role!=="DR")),l(),C(" ",a.user.role," ")}}function xi(o,t){o&1&&(n(0,"div",15),m(1,"p-progressSpinner"),i())}function vi(o,t){o&1&&(n(0,"tr"),m(1,"th",20),n(2,"th"),r(3,"N\xB0 Commande"),i(),n(4,"th"),r(5,"Service"),i(),n(6,"th"),r(7,"Cat\xE9gorie"),i(),n(8,"th"),r(9,"Statut"),i(),n(10,"th"),r(11,"Validation"),i(),n(12,"th"),r(13,"Date Cr\xE9ation"),i()())}function bi(o,t){if(o&1&&(n(0,"p"),r(1),i()),o&2){let e=d().ngIf;l(),u(e.detailStandard)}}function hi(o,t){if(o&1&&(n(0,"div",48)(1,"strong"),r(2),i(),r(3),i()),o&2){let e=t.$implicit,a=d(2).ngIf;l(2),C("",e,":"),l(),C(" ",a[e]," ")}}function Si(o,t){if(o&1&&(n(0,"div"),g(1,hi,4,2,"div",47),i()),o&2){let e=d().ngIf,a=d(4);l(),p("ngForOf",a.Object.keys(e))}}function yi(o,t){if(o&1&&(n(0,"div"),g(1,bi,2,1,"p",25)(2,Si,2,1,"div",25),i()),o&2){let e=t.ngIf;l(),p("ngIf",e.detailStandard),l(),p("ngIf",!e.detailStandard)}}function Ei(o,t){if(o&1&&(n(0,"tr")(1,"td",32),m(2,"i",49),r(3," Date de traitement "),i(),n(4,"td",34),r(5),i()()),o&2){let e=d(2).$implicit,a=d(2);l(5),u(a.formatDate(e.dateTraitement))}}function Pi(o,t){if(o&1&&(n(0,"tr")(1,"td",32),m(2,"i",50),r(3," Trait\xE9 par "),i(),n(4,"td",34),r(5),i()()),o&2){let e=d(2).$implicit;l(5),C("ID: ",e.traitePar,"")}}function Mi(o,t){if(o&1&&(n(0,"div",55)(1,"div",56),m(2,"i",57),r(3," Observations "),i(),n(4,"div",58),r(5),i()()),o&2){let e=d(3).$implicit;l(5),u(e.observations)}}function Oi(o,t){if(o&1&&(n(0,"div",59)(1,"div",60),m(2,"i",61),r(3," Motif de refus/rejet "),i(),n(4,"div",62),r(5),i()()),o&2){let e=d(3).$implicit;l(5),u(e.motif)}}function wi(o,t){if(o&1&&(n(0,"div",1)(1,"div",28)(2,"div",29),m(3,"i",51),n(4,"span"),r(5,"Observations & Motifs"),i()(),n(6,"div",52),g(7,Mi,6,1,"div",53)(8,Oi,6,1,"div",54),i()()()),o&2){let e=d(2).$implicit;l(7),p("ngIf",e.observations),l(),p("ngIf",e.motif)}}function Di(o,t){if(o&1&&(n(0,"span"),r(1),i()),o&2){let e=d(3).$implicit;l(),C("par l'utilisateur #",e.traitePar,"")}}function Ti(o,t){if(o&1&&(n(0,"div",63),m(1,"i",30),n(2,"span"),r(3),g(4,Di,2,1,"span",25),i()()),o&2){let e=d(2).$implicit,a=d(2);l(3),C("Trait\xE9 le ",a.formatDate(e.dateTraitement)," "),l(),p("ngIf",e.traitePar)}}function Ii(o,t){o&1&&(n(0,"span"),r(1," Actions disponibles pour cette commande en cours "),i())}function Ai(o,t){o&1&&(n(0,"span"),r(1," Cette commande a \xE9t\xE9 valid\xE9e par un DR "),i())}function ki(o,t){o&1&&(n(0,"span"),r(1," Cette commande a \xE9t\xE9 accept\xE9e "),i())}function Vi(o,t){o&1&&(n(0,"span"),r(1," Cette commande a \xE9t\xE9 refus\xE9e "),i())}function Ri(o,t){if(o&1){let e=y();n(0,"tr")(1,"td",26)(2,"div",27)(3,"div",0)(4,"div",1)(5,"div",28)(6,"div",29),m(7,"i",30),n(8,"span"),r(9,"Informations Compl\xE8tes de la Commande"),i()(),n(10,"table",31)(11,"tbody")(12,"tr")(13,"td",32),m(14,"i",33),r(15," Demandeur "),i(),n(16,"td",34),r(17),i()(),n(18,"tr")(19,"td",32),m(20,"i",35),r(21," D\xE9l\xE9gation "),i(),n(22,"td",34),r(23),i()(),n(24,"tr")(25,"td",32),m(26,"i",36),r(27," Agence "),i(),n(28,"td",34),r(29),i()(),n(30,"tr")(31,"td",32),m(32,"i",37),r(33," Point de vente "),i(),n(34,"td",34),r(35),i()(),n(36,"tr")(37,"td",32),m(38,"i",38),r(39," Description "),i(),n(40,"td",34),g(41,yi,3,2,"div",25),i()(),n(42,"tr")(43,"td",32),m(44,"i",39),r(45," Quantit\xE9 command\xE9e "),i(),n(46,"td",34),r(47),i()(),g(48,Ei,6,1,"tr",25)(49,Pi,6,1,"tr",25),i()()()(),g(50,wi,9,2,"div",40),n(51,"div",1)(52,"div",41),g(53,Ti,5,2,"div",42),n(54,"div",43)(55,"button",44),f("click",function(){v(e);let s=d().$implicit,c=d(2);return b(c.openRejectDialog(s))}),i(),n(56,"button",45),f("click",function(){v(e);let s=d().$implicit,c=d(2);return b(c.openValidateDialog(s))}),i()(),n(57,"div",46),m(58,"i",30),g(59,Ii,2,0,"span",25)(60,Ai,2,0,"span",25)(61,ki,2,0,"span",25)(62,Vi,2,0,"span",25),i()()()()()()()}if(o&2){let e=d().$implicit,a=d(2);p("@rowExpand",a.isExpanded(e)?"expanded":"collapsed"),l(17),u(e.userFullName||e.username),l(6),u(e.delegationLibele||"-"),l(6),u(e.agenceLibele||"-"),l(6),u(e.pointventeLibele||"-"),l(6),p("ngIf",a.parseDetails(e.detailBonCommande)),l(6),u(e.qte||0),l(),p("ngIf",e.dateTraitement),l(),p("ngIf",e.traitePar),l(),p("ngIf",e.observations||e.motif),l(3),p("ngIf",e.dateTraitement),l(2),p("disabled",a.isRejectDisabled(e)||a.processingAction())("pTooltip",a.getRejectTooltip(e)),l(),p("disabled",a.isValidateDisabled(e)||a.processingAction())("pTooltip",a.getValidateTooltip(e)),l(3),p("ngIf",e.status==="ENCOURS"&&(!e.stateValidation||e.stateValidation==="EN_ATTENTE")),l(),p("ngIf",e.stateValidation==="VALIDE"),l(),p("ngIf",e.stateValidation==="ACCEPTE"),l(),p("ngIf",e.stateValidation==="REFUSE")}}function Li(o,t){if(o&1){let e=y();n(0,"tr",21)(1,"td")(2,"button",22),f("click",function(){let s=v(e).$implicit,c=d(2);return b(c.toggleRow(s))}),i()(),n(3,"td",12),r(4),i(),n(5,"td"),r(6),i(),n(7,"td")(8,"span",23),r(9),i()(),n(10,"td"),m(11,"p-tag",24),i(),n(12,"td"),m(13,"p-tag",24),i(),n(14,"td"),r(15),i()(),g(16,Ri,63,19,"tr",25)}if(o&2){let e=t.$implicit,a=d(2);p("ngClass",Je(12,_i,a.isUrgent(e))),l(2),p("pTooltip",a.isExpanded(e)?"Masquer les d\xE9tails":"Afficher les d\xE9tails")("icon",a.isExpanded(e)?"pi pi-chevron-down":"pi pi-chevron-right"),l(2),u(e.numeroCommande),l(2),u(e.service),l(3),u(e.categorieLibele||"-"),l(2),p("value",e.status)("severity",a.getStatusSeverity(e.status)),l(2),p("value",a.getStateValidationLabel(e.stateValidation||"EN_ATTENTE"))("severity",a.getValidationSeverity(e.stateValidation||"EN_ATTENTE")),l(2),u(a.formatDate(e.dateCreation)),l(),p("ngIf",a.isExpanded(e))}}function ji(o,t){o&1&&(n(0,"tr")(1,"td",64),m(2,"i",65),n(3,"p",66),r(4,"Aucun bon de commande trouv\xE9"),i()()())}function Ni(o,t){if(o&1&&(n(0,"p-table",16),g(1,vi,14,0,"ng-template",17)(2,Li,17,14,"ng-template",18)(3,ji,5,0,"ng-template",19),i()),o&2){let e=d();p("value",e.stocks())("paginator",!0)("rows",10)("showCurrentPageReport",!0)}}function Fi(o,t){o&1&&(n(0,"span"),r(1," En tant que DR, cette commande sera marqu\xE9e comme "),n(2,"strong"),r(3,"VALID\xC9E"),i(),r(4,". "),i())}function $i(o,t){o&1&&(n(0,"span"),r(1," Cette commande sera marqu\xE9e comme "),n(2,"strong"),r(3,"ACCEPT\xC9E"),i(),r(4,". "),i())}function qi(o,t){if(o&1){let e=y();n(0,"div",67)(1,"div",68)(2,"p",69)(3,"strong"),r(4,"Commande :"),i(),r(5),i(),n(6,"p",69)(7,"strong"),r(8,"Service :"),i(),r(9),i(),n(10,"p",69)(11,"strong"),r(12,"Demandeur :"),i(),r(13),i()(),n(14,"div",70),m(15,"i",71),g(16,Fi,5,0,"span",25)(17,$i,5,0,"span",25),i(),n(18,"div",72)(19,"label",73),r(20,"Observations (optionnel)"),i(),n(21,"textarea",74),k("ngModelChange",function(s){v(e);let c=d();return A(c.validateObservations,s)||(c.validateObservations=s),b(s)}),r(22,"            "),i()()()}if(o&2){let e=d();l(5),C(" ",e.selectedStock().numeroCommande," "),l(4),C(" ",e.selectedStock().service," "),l(4),C(" ",e.selectedStock().userFullName||e.selectedStock().username," "),l(3),p("ngIf",(e.user==null?null:e.user.role)==="DR"),l(),p("ngIf",(e.user==null?null:e.user.role)!=="DR"),l(4),I("ngModel",e.validateObservations),p("disabled",e.processingAction())}}function zi(o,t){if(o&1){let e=y();n(0,"button",75),f("click",function(){v(e);let s=d();return b(s.closeDialogs())}),i(),n(1,"button",76),f("click",function(){v(e);let s=d();return b(s.validateCommand())}),i()}if(o&2){let e=d();p("disabled",e.processingAction()),l(),p("disabled",e.processingAction())("loading",e.processingAction())}}function Bi(o,t){o&1&&(n(0,"small",85),r(1," Le motif de rejet est obligatoire "),i())}function Ui(o,t){if(o&1){let e=y();n(0,"div",67)(1,"div",68)(2,"p",69)(3,"strong"),r(4,"Commande :"),i(),r(5),i(),n(6,"p",69)(7,"strong"),r(8,"Service :"),i(),r(9),i(),n(10,"p",69)(11,"strong"),r(12,"Demandeur :"),i(),r(13),i()(),n(14,"div",77),m(15,"i",78),r(16," Cette action est irr\xE9versible. La commande sera marqu\xE9e comme "),n(17,"strong"),r(18,"REFUS\xC9E"),i(),r(19,". "),i(),n(20,"div",79)(21,"label",80),r(22,"Motif de rejet *"),i(),n(23,"textarea",81),k("ngModelChange",function(s){v(e);let c=d();return A(c.rejectMotif,s)||(c.rejectMotif=s),b(s)}),r(24,"            "),i(),g(25,Bi,2,0,"small",82),i(),n(26,"div",72)(27,"label",83),r(28,"Observations compl\xE9mentaires (optionnel)"),i(),n(29,"textarea",84),k("ngModelChange",function(s){v(e);let c=d();return A(c.rejectObservations,s)||(c.rejectObservations=s),b(s)}),r(30,"            "),i()()()}if(o&2){let e=d();l(5),C(" ",e.selectedStock().numeroCommande," "),l(4),C(" ",e.selectedStock().service," "),l(4),C(" ",e.selectedStock().userFullName||e.selectedStock().username," "),l(10),I("ngModel",e.rejectMotif),p("disabled",e.processingAction())("ngClass",Je(9,fi,!e.rejectMotif()&&e.showRejectDialog())),l(2),p("ngIf",!e.rejectMotif()&&e.showRejectDialog()),l(4),I("ngModel",e.rejectObservations),p("disabled",e.processingAction())}}function Ji(o,t){if(o&1){let e=y();n(0,"button",75),f("click",function(){v(e);let s=d();return b(s.closeDialogs())}),i(),n(1,"button",86),f("click",function(){v(e);let s=d();return b(s.rejectCommand())}),i()}if(o&2){let e=d();p("disabled",e.processingAction()),l(),p("disabled",e.processingAction()||!e.rejectMotif())("loading",e.processingAction())}}var Et=class o{user;Object=Object;userService=P(V);messageService=P(w);confirmationService=P(Z);stocks=E([]);delegation=E(null);loading=E(!1);delegationId=E(null);expandedRows=E({});showRejectDialog=E(!1);showValidateDialog=E(!1);selectedStock=E(null);rejectMotif=E("");validateObservations=E("");rejectObservations=E("");processingAction=E(!1);ngOnInit(){this.user?.delegationId?(this.delegationId.set(this.user.delegationId),this.loadStocksByDelegation()):this.showWarning("Aucune d\xE9l\xE9gation associ\xE9e \xE0 cet utilisateur")}isUrgent(t){return t&&t.urgent===!0}openValidateDialog(t){this.selectedStock.set(t),this.validateObservations.set(""),this.showValidateDialog.set(!0)}openRejectDialog(t){this.selectedStock.set(t),this.rejectMotif.set(""),this.rejectObservations.set(""),this.showRejectDialog.set(!0)}toggleRow(t){let e=this.expandedRows(),a=t.idCmd.toString();this.expandedRows.set(S(h({},e),{[a]:!e[a]}))}isExpanded(t){return this.expandedRows()[t.idCmd.toString()]||!1}loadStocksByDelegation(){let t=this.delegationId();t&&(this.loading.set(!0),this.userService.getStockEncoursByDelegation$(t).subscribe({next:e=>{console.log("Stocks par d\xE9l\xE9gation:",e),e?.data?.stocks?(this.stocks.set(e.data.stocks),this.delegation.set(e.data.delegation),this.showSuccess(`${e.data.stocks.length} bon(s) de commande charg\xE9(s)`)):this.stocks.set([])},error:e=>{console.error("Erreur:",e),this.showError("Erreur lors du chargement des bons de commande"),this.stocks.set([])},complete:()=>{this.loading.set(!1)}}))}parseDetails(t){try{return t?JSON.parse(t):null}catch{return{detailStandard:t}}}getStatusSeverity(t){switch(t){case"ACCEPT":return"success";case"REJET":return"danger";case"ENCOURS":return"warn";default:return"warn"}}getValidationSeverity(t){switch(t){case"VALIDE":case"ACCEPTE":return"success";case"REFUSE":return"danger";case"EN_ATTENTE":default:return"warn"}}formatDate(t){if(!t)return"-";if(Array.isArray(t)){let[e,a,s,c=0,x=0]=t;return new Date(e,a-1,s,c,x).toLocaleString("fr-FR")}return new Date(t).toLocaleString("fr-FR")}showSuccess(t){this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:t,life:3e3})}showError(t){this.messageService.add({severity:"error",summary:"Erreur",detail:t,life:5e3})}showWarning(t){this.messageService.add({severity:"warn",summary:"Attention",detail:t,life:4e3})}rejectCommand(t){let e=t||this.selectedStock();if(e){if(!this.rejectMotif()||this.rejectMotif().trim().length===0){this.showWarning("Le motif de rejet est obligatoire");return}this.confirmationService.confirm({message:`\xCAtes-vous s\xFBr de vouloir rejeter la commande ${e.numeroCommande} ?`,header:"Confirmation de rejet",icon:"pi pi-exclamation-triangle",acceptLabel:"Oui, rejeter",rejectLabel:"Annuler",acceptButtonStyleClass:"p-button-danger",accept:()=>{this.performRejection(e)},reject:()=>{this.showInfo("Rejet annul\xE9")}})}}performRejection(t){this.processingAction.set(!0);let e=this.rejectMotif(),a=this.rejectObservations();this.userService.rejectCommand(t.idCmd,e,a).subscribe({next:s=>{this.showSuccess(`Commande ${t.numeroCommande} rejet\xE9e avec succ\xE8s`),this.loadStocksByDelegation(),this.closeDialogs(),this.updateLocalStock(t.idCmd,{stateValidation:"REFUSE",motif:e,dateTraitement:new Date,traitePar:this.user?.userId})},error:s=>{console.error("Erreur rejet:",s),this.showError(s.error?.message||"Erreur lors du rejet de la commande")},complete:()=>{this.processingAction.set(!1)}})}validateCommand(t){let e=t||this.selectedStock();e&&this.confirmationService.confirm({message:`\xCAtes-vous s\xFBr de vouloir valider la commande ${e.numeroCommande} ?`,header:"Confirmation de validation",icon:"pi pi-check-circle",acceptLabel:"Oui, valider",rejectLabel:"Annuler",acceptButtonStyleClass:"p-button-success",accept:()=>{this.performValidation(e)},reject:()=>{this.showInfo("Validation annul\xE9e"),this.closeDialogs()}})}performValidation(t){this.processingAction.set(!0);let e=this.validateObservations();this.userService.validateCommand(t.idCmd,e).subscribe({next:a=>{this.showSuccess(`Commande ${t.numeroCommande} valid\xE9e avec succ\xE8s`),this.loadStocksByDelegation(),this.closeDialogs(),this.updateLocalStock(t.idCmd,{stateValidation:this.user?.role==="DR"?"VALIDE":"ACCEPTE",dateTraitement:new Date,traitePar:this.user?.userId})},error:a=>{console.error("Erreur validation:",a),this.showError(a.error?.message||"Erreur lors de la validation de la commande")},complete:()=>{this.processingAction.set(!1)}})}shouldShowActionButtons(t){return t.status==="ENCOURS"||t.stateValidation==="EN_ATTENTE"}isRejectDisabled(t){return t.status!=="ENCOURS"||t.stateValidation==="REFUSE"||t.stateValidation==="VALIDE"||t.stateValidation==="ACCEPTE"}isValidateDisabled(t){return t.status!=="ENCOURS"||t.stateValidation==="REFUSE"||t.stateValidation==="VALIDE"||t.stateValidation==="ACCEPTE"}getStateValidationLabel(t){return{VALIDE:"Valid\xE9 par DR",ACCEPTE:"Accept\xE9",REFUSE:"Refus\xE9",EN_ATTENTE:"En attente"}[t]||t}getRejectTooltip(t){return t.stateValidation==="REFUSE"?"Cette commande a d\xE9j\xE0 \xE9t\xE9 rejet\xE9e":t.stateValidation==="VALIDE"||t.stateValidation==="ACCEPTE"?"Impossible de rejeter une commande valid\xE9e":t.status==="ACCEPT"?"Impossible de rejeter une commande accept\xE9e":t.status==="REJET"?"Cette commande a d\xE9j\xE0 \xE9t\xE9 rejet\xE9e":"Rejeter cette commande"}getValidateTooltip(t){return t.stateValidation==="VALIDE"||t.stateValidation==="ACCEPTE"?"Cette commande a d\xE9j\xE0 \xE9t\xE9 valid\xE9e":t.stateValidation==="REFUSE"?"Impossible de valider une commande refus\xE9e":t.status==="ACCEPT"?"Cette commande a d\xE9j\xE0 \xE9t\xE9 accept\xE9e":t.status==="REJET"?"Impossible de valider une commande rejet\xE9e":"Valider cette commande"}showInfo(t){this.messageService.add({severity:"info",summary:"Information",detail:t,life:3e3})}closeDialogs(){this.showValidateDialog.set(!1),this.showRejectDialog.set(!1),this.selectedStock.set(null),this.rejectMotif.set(""),this.validateObservations.set(""),this.rejectObservations.set("")}updateLocalStock(t,e){let s=this.stocks().map(c=>c.idCmd===t?h(h({},c),e):c);this.stocks.set(s)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=D({type:o,selectors:[["app-list-stock"]],inputs:{user:"user"},features:[G([w,Z])],decls:14,vars:21,consts:[[1,"grid"],[1,"col-12"],["header","Bons de Commande - Espace DR"],["class","mb-3",4,"ngIf"],["class","flex justify-content-center p-4",4,"ngIf"],["currentPageReportTemplate","Affichage de {first} \xE0 {last} sur {totalRecords} entr\xE9es","responsiveLayout","scroll","dataKey","idCmd",3,"value","paginator","rows","showCurrentPageReport",4,"ngIf"],["header","Validation de la commande",3,"visibleChange","visible","modal","draggable","resizable","closable"],["class","dialog-content",4,"ngIf"],["pTemplate","footer"],["header","Rejet de la commande",3,"visibleChange","visible","modal","draggable","resizable","closable"],[1,"mb-3"],[1,"ml-3","text-500"],[1,"font-bold"],[1,"ml-4","text-500"],[1,"font-bold","badge",3,"ngClass"],[1,"flex","justify-content-center","p-4"],["currentPageReportTemplate","Affichage de {first} \xE0 {last} sur {totalRecords} entr\xE9es","responsiveLayout","scroll","dataKey","idCmd",3,"value","paginator","rows","showCurrentPageReport"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[2,"width","3rem"],[3,"ngClass"],["type","button","pButton","",1,"p-button-text","p-button-rounded","p-button-plain",3,"click","pTooltip","icon"],[1,"badge","badge-info"],[3,"value","severity"],[4,"ngIf"],["colspan","8"],[1,"detail-container"],[1,"detail-card"],[1,"detail-header"],[1,"pi","pi-info-circle"],[1,"detail-table"],[1,"label-cell"],[1,"pi","pi-user","mini-icon"],[1,"value-cell"],[1,"pi","pi-map-marker","mini-icon"],[1,"pi","pi-home","mini-icon"],[1,"pi","pi-shopping-cart","mini-icon"],[1,"pi","pi-file-text","mini-icon"],[1,"pi","pi-sort-numeric-up","mini-icon"],["class","col-12",4,"ngIf"],[1,"action-buttons-container"],["class","action-status-info",4,"ngIf"],[1,"action-buttons"],["pButton","","type","button","label","Rejeter","icon","pi pi-times",1,"p-button-danger","p-button-raised",3,"click","disabled","pTooltip"],["pButton","","type","button","label","Valider","icon","pi pi-check",1,"p-button-success","p-button-raised",3,"click","disabled","pTooltip"],[1,"action-info"],["class","mb-1",4,"ngFor","ngForOf"],[1,"mb-1"],[1,"pi","pi-calendar","mini-icon"],[1,"pi","pi-user-edit","mini-icon"],[1,"pi","pi-comments"],[1,"observations-content"],["class","observation-box",4,"ngIf"],["class","motif-box",4,"ngIf"],[1,"observation-box"],[1,"observation-label"],[1,"pi","pi-eye","mini-icon"],[1,"observation-text"],[1,"motif-box"],[1,"motif-label"],[1,"pi","pi-exclamation-triangle"],[1,"motif-text"],[1,"action-status-info"],["colspan","8",1,"text-center","p-4"],[1,"pi","pi-inbox","text-4xl","text-300"],[1,"mt-3"],[1,"dialog-content"],[1,"info-section","mb-3"],[1,"mb-2"],[1,"alert","alert-info","mb-3"],[1,"pi","pi-info-circle","mr-2"],[1,"field"],["for","validate-observations"],["pTextarea","","id","validate-observations","rows","3","placeholder","Ajoutez des observations si n\xE9cessaire...",1,"w-full",3,"ngModelChange","ngModel","disabled"],["pButton","","label","Annuler","icon","pi pi-times",1,"p-button-text",3,"click","disabled"],["pButton","","label","Confirmer la validation","icon","pi pi-check",1,"p-button-success",3,"click","disabled","loading"],[1,"alert","alert-warning","mb-3"],[1,"pi","pi-exclamation-triangle","mr-2"],[1,"field","mb-3"],["for","reject-motif",1,"required"],["pTextarea","","id","reject-motif","rows","3","placeholder","Indiquez le motif de rejet (obligatoire)...",1,"w-full",3,"ngModelChange","ngModel","disabled","ngClass"],["class","p-error",4,"ngIf"],["for","reject-observations"],["id","reject-observations","pTextarea","","rows","2","placeholder","Observations suppl\xE9mentaires...",1,"w-full",3,"ngModelChange","ngModel","disabled"],[1,"p-error"],["pButton","","label","Confirmer le rejet","icon","pi pi-ban",1,"p-button-danger",3,"click","disabled","loading"]],template:function(e,a){e&1&&(n(0,"div",0)(1,"div",1),m(2,"p-toast")(3,"p-confirmDialog"),n(4,"p-card",2),g(5,Ci,10,8,"div",3)(6,xi,2,0,"div",4)(7,Ni,4,4,"p-table",5),i()()(),n(8,"p-dialog",6),k("visibleChange",function(c){return A(a.showValidateDialog,c)||(a.showValidateDialog=c),c}),g(9,qi,23,7,"div",7)(10,zi,2,3,"ng-template",8),i(),n(11,"p-dialog",9),k("visibleChange",function(c){return A(a.showRejectDialog,c)||(a.showRejectDialog=c),c}),g(12,Ui,31,11,"div",7)(13,Ji,2,3,"ng-template",8),i()),e&2&&(l(5),p("ngIf",a.user),l(),p("ngIf",a.loading()),l(),p("ngIf",!a.loading()),l(),X(M(19,bn)),I("visible",a.showValidateDialog),p("modal",!0)("draggable",!1)("resizable",!1)("closable",!a.processingAction()),l(),p("ngIf",a.selectedStock()),l(2),X(M(20,bn)),I("visible",a.showRejectDialog),p("modal",!0)("draggable",!1)("resizable",!1)("closable",!a.processingAction()),l(),p("ngIf",a.selectedStock()))},dependencies:[j,et,qt,Ie,zt,ie,Le,te,ne,q,$,N,z,J,F,ae,W,ge,Y,Q,K,U,le,H,re,mt,ct,fe,_e,vt,xt],styles:['[_nghost-%COMP%]     .detail-container{padding:1.5rem;background:linear-gradient(135deg,#f5f7fa,#f9fbfd);border-radius:12px;animation:_ngcontent-%COMP%_slideDown .3s ease-out}[_nghost-%COMP%]     .detail-card{background:#fff;border-radius:10px;box-shadow:0 2px 8px #00000014;overflow:hidden;margin-bottom:1rem;transition:transform .2s ease,box-shadow .2s ease}[_nghost-%COMP%]     .detail-card:hover{transform:translateY(-2px);box-shadow:0 4px 12px #0000001f}[_nghost-%COMP%]     .detail-header{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:.75rem 1rem;font-weight:600;font-size:.95rem;display:flex;align-items:center;gap:.5rem}[_nghost-%COMP%]     .detail-header i{font-size:1.1rem}[_nghost-%COMP%]     .detail-table{width:100%;border-collapse:collapse}[_nghost-%COMP%]     .detail-table tbody tr{border-bottom:1px solid #f0f0f0;transition:background-color .2s ease}[_nghost-%COMP%]     .detail-table tbody tr:last-child{border-bottom:none}[_nghost-%COMP%]     .detail-table tbody tr:hover{background-color:#f8f9fc}[_nghost-%COMP%]     .detail-table .label-cell{padding:.75rem 1rem;color:#6b7280;font-size:.875rem;font-weight:500;width:45%;display:flex;align-items:center;gap:.5rem}[_nghost-%COMP%]     .detail-table .label-cell .mini-icon{color:#9ca3af;font-size:.875rem}[_nghost-%COMP%]     .detail-table .value-cell{padding:.75rem 1rem;color:#1f2937;font-size:.9rem;font-weight:600}[_nghost-%COMP%]     .description-content{padding:1rem}[_nghost-%COMP%]     .description-content .description-box{background:#f9fafb;border-left:4px solid #667eea;padding:1rem;border-radius:6px}[_nghost-%COMP%]     .description-content .description-box .description-text{margin:0;color:#374151;line-height:1.6;font-size:.95rem}[_nghost-%COMP%]     .description-content .description-box .description-items{display:flex;flex-direction:column;gap:.5rem}[_nghost-%COMP%]     .description-content .description-box .description-items .description-item{display:flex;gap:.5rem}[_nghost-%COMP%]     .description-content .description-box .description-items .description-item .item-key{color:#6b7280;font-weight:500;min-width:120px}[_nghost-%COMP%]     .description-content .description-box .description-items .description-item .item-value{color:#1f2937;font-weight:600}[_nghost-%COMP%]     .observations-content{padding:1rem;display:flex;flex-direction:column;gap:1rem}[_nghost-%COMP%]     .observations-content .observation-box{background:#e0f2fe;border-radius:8px;padding:1rem;border-left:4px solid #0ea5e9}[_nghost-%COMP%]     .observations-content .observation-box .observation-label{color:#0369a1;font-weight:600;font-size:.875rem;margin-bottom:.5rem;display:flex;align-items:center;gap:.5rem}[_nghost-%COMP%]     .observations-content .observation-box .observation-label i{font-size:.875rem}[_nghost-%COMP%]     .observations-content .observation-box .observation-text{color:#0c4a6e;line-height:1.5;font-size:.95rem}[_nghost-%COMP%]     .observations-content .motif-box{background:#fee2e2;border-radius:8px;padding:1rem;border-left:4px solid #ef4444}[_nghost-%COMP%]     .observations-content .motif-box .motif-label{color:#dc2626;font-weight:600;font-size:.875rem;margin-bottom:.5rem;display:flex;align-items:center;gap:.5rem}[_nghost-%COMP%]     .observations-content .motif-box .motif-label i{font-size:1rem}[_nghost-%COMP%]     .observations-content .motif-box .motif-text{color:#991b1b;line-height:1.5;font-size:.95rem;font-weight:500}[_nghost-%COMP%]     .action-buttons-container{background:#fff;border-radius:10px;box-shadow:0 2px 8px #00000014;padding:1.5rem;margin-top:.5rem;position:relative;overflow:hidden}[_nghost-%COMP%]     .action-buttons-container:before{content:"";position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,#ef4444,#22c55e);animation:_ngcontent-%COMP%_shimmer 2s ease-in-out infinite}[_nghost-%COMP%]     .action-buttons-container .action-buttons{display:flex;gap:1rem;justify-content:center;align-items:center;margin-bottom:1rem}[_nghost-%COMP%]     .action-buttons-container .action-buttons .p-button{min-width:140px;font-weight:600;transition:all .3s ease;position:relative;overflow:hidden}[_nghost-%COMP%]     .action-buttons-container .action-buttons .p-button:before{content:"";position:absolute;top:50%;left:50%;width:0;height:0;border-radius:50%;background:#ffffff4d;transform:translate(-50%,-50%);transition:width .6s,height .6s}[_nghost-%COMP%]     .action-buttons-container .action-buttons .p-button:hover:before{width:300px;height:300px}[_nghost-%COMP%]     .action-buttons-container .action-buttons .p-button.p-button-danger{background:linear-gradient(135deg,#ef4444,#dc2626);border:none}[_nghost-%COMP%]     .action-buttons-container .action-buttons .p-button.p-button-danger:hover:not(:disabled){background:linear-gradient(135deg,#dc2626,#b91c1c);transform:translateY(-2px);box-shadow:0 6px 20px #ef444466}[_nghost-%COMP%]     .action-buttons-container .action-buttons .p-button.p-button-danger:active:not(:disabled){transform:translateY(0)}[_nghost-%COMP%]     .action-buttons-container .action-buttons .p-button.p-button-danger:disabled{background:#e5e7eb;color:#9ca3af;opacity:.6;cursor:not-allowed}[_nghost-%COMP%]     .action-buttons-container .action-buttons .p-button.p-button-success{background:linear-gradient(135deg,#22c55e,#16a34a);border:none}[_nghost-%COMP%]     .action-buttons-container .action-buttons .p-button.p-button-success:hover:not(:disabled){background:linear-gradient(135deg,#16a34a,#15803d);transform:translateY(-2px);box-shadow:0 6px 20px #22c55e66}[_nghost-%COMP%]     .action-buttons-container .action-buttons .p-button.p-button-success:active:not(:disabled){transform:translateY(0)}[_nghost-%COMP%]     .action-buttons-container .action-buttons .p-button.p-button-success:disabled{background:#e5e7eb;color:#9ca3af;opacity:.6;cursor:not-allowed}[_nghost-%COMP%]     .action-buttons-container .action-buttons .p-button .pi{margin-right:.5rem;transition:transform .3s ease}[_nghost-%COMP%]     .action-buttons-container .action-buttons .p-button:hover:not(:disabled) .pi{transform:scale(1.2)}[_nghost-%COMP%]     .action-buttons-container .action-info{text-align:center;color:#6b7280;font-size:.875rem;display:flex;align-items:center;justify-content:center;gap:.5rem}[_nghost-%COMP%]     .action-buttons-container .action-info i{color:#9ca3af;font-size:1rem;animation:_ngcontent-%COMP%_pulse 2s ease-in-out infinite}@keyframes _ngcontent-%COMP%_shimmer{0%,to{opacity:.5}50%{opacity:1}}@keyframes _ngcontent-%COMP%_pulse{0%,to{transform:scale(1);opacity:.7}50%{transform:scale(1.1);opacity:1}}[_nghost-%COMP%]     .badge-info{background:linear-gradient(135deg,#e0e7ff,#c7d2fe);color:#4338ca;padding:.25rem .75rem;border-radius:20px;font-size:.8rem;font-weight:600;text-transform:uppercase;letter-spacing:.5px}@keyframes _ngcontent-%COMP%_slideDown{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}@media (max-width: 768px){[_nghost-%COMP%]     .detail-container{padding:1rem}[_nghost-%COMP%]     .detail-table .label-cell, [_nghost-%COMP%]     .detail-table .value-cell{padding:.5rem .75rem;font-size:.8rem}[_nghost-%COMP%]     .detail-header{font-size:.9rem;padding:.5rem .75rem}[_nghost-%COMP%]     .action-buttons-container{padding:1rem}[_nghost-%COMP%]     .action-buttons-container .action-buttons{flex-direction:column;width:100%}[_nghost-%COMP%]     .action-buttons-container .action-buttons .p-button{width:100%;max-width:300px}}[_nghost-%COMP%]     .p-datatable .p-datatable-tbody tr{transition:background-color .2s ease}[_nghost-%COMP%]     .p-datatable .p-datatable-tbody tr:hover{background-color:#f8f9fa}.dialog-content[_ngcontent-%COMP%]{padding:.5rem 0}.info-section[_ngcontent-%COMP%]{background:#f8f9fa;padding:1rem;border-radius:6px}.alert[_ngcontent-%COMP%]{padding:.75rem;border-radius:6px;display:flex;align-items:flex-start}.alert-info[_ngcontent-%COMP%]{background:#e0f2fe;color:#0369a1}.alert-warning[_ngcontent-%COMP%]{background:#fed7aa;color:#92400e}.required[_ngcontent-%COMP%]:after{content:" *";color:#ef4444}.field[_ngcontent-%COMP%]{margin-bottom:1rem}.field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem;font-weight:600;color:#374151}.badge-dr[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:.25rem .75rem;border-radius:20px;font-weight:600}.badge-user[_ngcontent-%COMP%]{background:linear-gradient(135deg,#4facfe,#00f2fe);color:#fff;padding:.25rem .75rem;border-radius:20px;font-weight:600}.row-urgent[_ngcontent-%COMP%]{background-color:#fef2f2!important}.action-status-info[_ngcontent-%COMP%]{background:#f0f9ff;color:#0369a1;padding:.5rem 1rem;border-radius:6px;margin-bottom:1rem;display:flex;align-items:center;gap:.5rem;font-size:.875rem}'],data:{animation:[nt("rowExpand",[Ve("collapsed",ke({height:"0px",minHeight:"0",display:"none"})),Ve("expanded",ke({height:"*"})),ot("expanded <=> collapsed",it("225ms cubic-bezier(0.4, 0.0, 0.2, 1)"))])]}})};var Gi=()=>[5,10,20,50],Hi=()=>["nomCliente","codCliente","numId","telPrincipal","codeAgence"],Qi=()=>({"min-width":"80rem"});function Yi(o,t){if(o&1){let e=y();n(0,"div",3)(1,"h2",4),m(2,"i",5),r(3," Corrections Rejet\xE9es "),i(),n(4,"div",6)(5,"p-iconField",7),m(6,"p-inputIcon",8),n(7,"input",9),k("ngModelChange",function(s){v(e);let c=d();return A(c.state().searchValue,s)||(c.state().searchValue=s),b(s)}),i()(),n(8,"button",10),f("click",function(){v(e);let s=d();return b(s.refresh())}),i(),n(9,"button",11),f("click",function(){v(e);let s=d();return b(s.exportData())}),i()()()}if(o&2){let e=d();l(7),I("ngModel",e.state().searchValue)}}function Ki(o,t){o&1&&(n(0,"div",15),m(1,"p-progressSpinner"),n(2,"p"),r(3,"Chargement des corrections rejet\xE9es..."),i()())}function Zi(o,t){if(o&1){let e=y();n(0,"div",16),m(1,"i",17),n(2,"p"),r(3),i(),n(4,"button",18),f("click",function(){v(e);let s=d(2);return b(s.loadListePPRejet())}),i()()}if(o&2){let e=d(2);l(3),u(e.state().error)}}function Xi(o,t){if(o&1&&(n(0,"div",25)(1,"div",26)(2,"span",27)(3,"strong"),r(4),i(),r(5," correction(s) rejet\xE9e(s) sur "),n(6,"strong"),r(7),i(),r(8," total "),i()(),n(9,"div",28),m(10,"p-tag",29),i()()),o&2){let e=d(3);l(4),u(e.filteredCount),l(3),u(e.totalRejet),l(3),p("value","Rejet\xE9es: "+e.rejetCount)("rounded",!0)}}function eo(o,t){o&1&&(n(0,"tr")(1,"th",30),r(2,"#"),i(),n(3,"th",31),r(4," Code Client "),m(5,"p-sortIcon",32),i(),n(6,"th",33),r(7," Nom Complet "),m(8,"p-sortIcon",34),i(),n(9,"th"),r(10,"N\xB0 Identit\xE9"),i(),n(11,"th"),r(12,"T\xE9l\xE9phone"),i(),n(13,"th",35),r(14," Date Naissance "),m(15,"p-sortIcon",36),i(),n(16,"th"),r(17,"Sexe"),i(),n(18,"th"),r(19,"\xC9tat Civil"),i(),n(20,"th",37),r(21," Statut "),m(22,"p-sortIcon",38),i(),n(23,"th"),r(24,"Agence"),i(),n(25,"th",39),r(26," Date Rejet "),m(27,"p-sortIcon",40),i(),n(28,"th",41),r(29,"Actions"),i()())}function to(o,t){if(o&1&&(n(0,"small",44),m(1,"i",56),r(2),i()),o&2){let e=d().$implicit;l(2),C(" ",e.telOtro," ")}}function no(o,t){if(o&1&&(n(0,"span"),r(1),i()),o&2){let e=d().$implicit;l(),u(e.fechNacimiento)}}function io(o,t){o&1&&(n(0,"span",57),r(1,"-"),i())}function oo(o,t){if(o&1&&(n(0,"small",44),r(1),i()),o&2){let e=d().$implicit;l(),C(" Conjoint: ",e.conjoint," ")}}function ao(o,t){if(o&1){let e=y();n(0,"tr")(1,"td"),r(2),i(),n(3,"td")(4,"span",42),r(5),i()(),n(6,"td")(7,"div",43)(8,"strong"),r(9),i(),n(10,"small",44),r(11),i()()(),n(12,"td")(13,"div",45)(14,"span"),r(15),i(),n(16,"small",44),r(17),i()()(),n(18,"td")(19,"div",46),m(20,"i",47),r(21),g(22,to,3,1,"small",48),i()(),n(23,"td"),g(24,no,2,1,"span",49)(25,io,2,0,"span",50),i(),n(26,"td"),m(27,"p-tag",51),i(),n(28,"td")(29,"span"),r(30),i(),g(31,oo,2,1,"small",48),i(),n(32,"td"),m(33,"p-tag",51),i(),n(34,"td")(35,"span",52),r(36),i()(),n(37,"td")(38,"small",53),r(39),i()(),n(40,"td")(41,"div",54)(42,"button",55),f("click",function(){let s=v(e).$implicit,c=d(3);return b(c.processRejectedCorrection(s))}),i()()()()}if(o&2){let e=t.$implicit,a=t.rowIndex,s=d(3);l(2),u(a+1),l(3),u(e.codCliente),l(4),u(e.nomCliente),l(2),T("",e.nomClient," ",e.prenomClient,""),l(4),u(e.numId),l(2),C("Type: ",e.typePiece,""),l(4),C(" ",e.telPrincipal," "),l(),p("ngIf",e.telOtro&&e.telOtro!==e.telPrincipal),l(2),p("ngIf",e.fechNacimiento),l(),p("ngIf",!e.fechNacimiento),l(2),p("value",s.getSexeLabel(e.indSexo))("severity",e.indSexo==="M"?"info":"success"),l(3),u(s.getEtatCivilLabel(e.estCivil)),l(),p("ngIf",e.conjoint),l(2),p("value",s.getStatusLabel(e.correctionStatut))("severity",s.getStatusSeverity(e.correctionStatut)),l(3),u(e.codeAgence),l(3),u(e.updatedAt)}}function ro(o,t){o&1&&(n(0,"tr")(1,"td",58)(2,"div",59),m(3,"i",60),n(4,"p",61),r(5," Aucune correction rejet\xE9e trouv\xE9e "),i(),n(6,"p",62),r(7," Les corrections rejet\xE9es appara\xEEtront ici "),i()()()())}function lo(o,t){if(o&1&&(n(0,"span",69),m(1,"i",5),r(2," Rejet\xE9es: "),n(3,"strong"),r(4),i()()),o&2){let e=d(4);l(4),u(e.rejetCount)}}function so(o,t){if(o&1&&(n(0,"span",65),m(1,"i",70),r(2," Filtr\xE9es: "),n(3,"strong"),r(4),i()()),o&2){let e=d(4);l(4),u(e.filteredCount)}}function co(o,t){if(o&1&&(n(0,"div",63)(1,"div",64)(2,"span",65),m(3,"i",66),r(4," Total: "),n(5,"strong"),r(6),i()(),g(7,lo,5,1,"span",67)(8,so,5,1,"span",68),i()()),o&2){let e=d(3);l(6),u(e.totalRejet),l(),p("ngIf",e.rejetCount>0),l(),p("ngIf",e.state().searchValue)}}function mo(o,t){if(o&1&&(n(0,"div",19)(1,"p-table",20),g(2,Xi,11,4,"ng-template",21)(3,eo,30,0,"ng-template",1)(4,ao,43,19,"ng-template",22)(5,ro,8,0,"ng-template",23)(6,co,9,3,"ng-template",24),i()()),o&2){let e=d(2);l(),p("value",e.filteredList())("paginator",!0)("rows",10)("rowsPerPageOptions",M(7,Gi))("showCurrentPageReport",!0)("globalFilterFields",M(8,Hi))("tableStyle",M(9,Qi))}}function po(o,t){if(o&1&&g(0,Ki,4,0,"div",12)(1,Zi,5,1,"div",13)(2,mo,7,10,"div",14),o&2){let e=d();p("ngIf",e.state().loading),l(),p("ngIf",e.state().error&&!e.state().loading),l(),p("ngIf",!e.state().loading&&!e.state().error)}}var Ot=class o{user;state=E({listRejet:[],loading:!1,message:void 0,error:void 0,statusOptions:[{label:"En attente",value:"EN_ATTENTE"},{label:"Suspendu",value:"SUSPENDU"},{label:"Valid\xE9",value:"VALIDE"},{label:"Rejet\xE9",value:"REJETE"}],dateKeys:["fecVencim","fechNacimiento","dateAttente","createdAt","updatedAt"],selectedPP:null,searchValue:""});userService=P(V);router=P(Re);destroyRef=P(oe);messageService=P(w);ngOnInit(){this.loadListePPRejet()}loadListePPRejet(){this.state.update(t=>S(h({},t),{loading:!0,error:void 0})),this.userService.getListPPRejet$().pipe(B(this.destroyRef)).subscribe({next:t=>{if(t.code===200&&t.data?.listRejet){let e=Array.isArray(t.data.listRejet)?t.data.listRejet:[t.data.listRejet],a=this.processDateArrays(e);this.state.update(s=>S(h({},s),{listRejet:a,loading:!1,message:t.message})),this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:`${a.length} correction(s) rejet\xE9e(s) charg\xE9e(s)`,life:3e3})}else this.state.update(e=>S(h({},e),{listRejet:[],loading:!1,error:t.message||"Aucune donn\xE9e trouv\xE9e"})),this.messageService.add({severity:"info",summary:"Information",detail:"Aucune correction rejet\xE9e trouv\xE9e",life:3e3})},error:t=>{this.state.update(e=>S(h({},e),{loading:!1,error:t.message||"Erreur lors du chargement des donn\xE9es"})),this.messageService.add({severity:"error",summary:"Erreur",detail:"Erreur lors du chargement des donn\xE9es",life:5e3}),console.error("Erreur lors du chargement:",t)}})}processDateArrays(t){return t.map(e=>{let a=h({},e);return e.fecVencim&&Array.isArray(e.fecVencim)&&(a.fecVencim=this.arrayToDateString(e.fecVencim)),e.fechNacimiento&&Array.isArray(e.fechNacimiento)&&(a.fechNacimiento=this.arrayToDateString(e.fechNacimiento)),e.createdAt&&Array.isArray(e.createdAt)&&(a.createdAt=this.arrayToDateTimeString(e.createdAt)),e.updatedAt&&Array.isArray(e.updatedAt)&&(a.updatedAt=this.arrayToDateTimeString(e.updatedAt)),a})}arrayToDateString(t){if(!t||t.length<3)return"";let[e,a,s]=t;return`${String(s).padStart(2,"0")}/${String(a).padStart(2,"0")}/${e}`}arrayToDateTimeString(t){if(!t||t.length<6)return"";let[e,a,s,c,x,R]=t;return`${String(s).padStart(2,"0")}/${String(a).padStart(2,"0")}/${e} ${String(c).padStart(2,"0")}:${String(x).padStart(2,"0")}`}getStatusSeverity(t){switch(t){case"EN_ATTENTE":return"info";case"VALIDE":return"success";case"REJETE":return"danger";case"SUSPENDU":return"warn";default:return"secondary"}}getStatusLabel(t){switch(t){case"EN_ATTENTE":return"En attente";case"VALIDE":return"Valid\xE9";case"REJETE":return"Rejet\xE9";case"SUSPENDU":return"Suspendu";default:return t}}getSexeLabel(t){return t==="M"?"Masculin":t==="F"?"F\xE9minin":t}getEtatCivilLabel(t){switch(t){case"S":return"C\xE9libataire";case"M":return"Mari\xE9(e)";case"D":return"Divorc\xE9(e)";case"V":return"Veuf/Veuve";case"C":return"Concubinage";default:return t}}filteredList(){let t=this.state().searchValue.toLowerCase();return t?this.state().listRejet.filter(e=>e.nomCliente?.toLowerCase().includes(t)||e.codCliente?.toLowerCase().includes(t)||e.numId?.toLowerCase().includes(t)||e.telPrincipal?.includes(t)||e.codeAgence?.toLowerCase().includes(t)):this.state().listRejet}refresh(){this.state.update(t=>S(h({},t),{searchValue:""})),this.loadListePPRejet()}viewDetails(t){this.state.update(e=>S(h({},e),{selectedPP:t})),console.log("D\xE9tails de:",t),this.messageService.add({severity:"info",summary:"D\xE9tails",detail:`Consultation des d\xE9tails de ${t.nomCliente}`,life:2e3})}processRejectedCorrection(t){console.log("Traitement de la correction rejet\xE9e:",t),this.router.navigate(["dashboards/update-correction-rejet/",t.codCliente])}exportData(){let t=this.filteredList();if(t.length===0){this.messageService.add({severity:"warn",summary:"Export",detail:"Aucune donn\xE9e \xE0 exporter",life:3e3});return}console.log("Export des donn\xE9es:",t),this.messageService.add({severity:"success",summary:"Export",detail:`${t.length} enregistrement(s) export\xE9(s)`,life:3e3})}get totalRejet(){return this.state().listRejet.length}get rejetCount(){return this.filteredList().filter(t=>t.correctionStatut==="REJETE").length}get filteredCount(){return this.filteredList().length}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=D({type:o,selectors:[["app-correction-rejet-pp"]],inputs:{user:"user"},features:[G([w])],decls:5,vars:0,consts:[[1,"correction-rejet-container"],["pTemplate","header"],["pTemplate","content"],[1,"card-header"],[1,"card-title"],[1,"pi","pi-times-circle"],[1,"header-actions"],["iconPosition","left"],["styleClass","pi pi-search"],["type","text","pInputText","","placeholder","Rechercher...",1,"search-input",3,"ngModelChange","ngModel"],["pButton","","icon","pi pi-refresh","pTooltip","Rafra\xEEchir",1,"p-button-rounded","p-button-outlined",3,"click"],["pButton","","icon","pi pi-download","pTooltip","Exporter",1,"p-button-rounded","p-button-outlined",3,"click"],["class","loading-container",4,"ngIf"],["class","error-container",4,"ngIf"],["class","table-container",4,"ngIf"],[1,"loading-container"],[1,"error-container"],[1,"pi","pi-exclamation-triangle"],["pButton","","label","R\xE9essayer","icon","pi pi-refresh",3,"click"],[1,"table-container"],["currentPageReportTemplate","Affichage de {first} \xE0 {last} sur {totalRecords} entr\xE9es","styleClass","p-datatable-striped","responsiveLayout","scroll",3,"value","paginator","rows","rowsPerPageOptions","showCurrentPageReport","globalFilterFields","tableStyle"],["pTemplate","caption"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","summary"],[1,"table-caption"],[1,"caption-left"],[1,"caption-text"],[1,"caption-right"],["severity","danger",3,"value","rounded"],[2,"width","3rem"],["pSortableColumn","codCliente"],["field","codCliente"],["pSortableColumn","nomCliente"],["field","nomCliente"],["pSortableColumn","fechNacimiento"],["field","fechNacimiento"],["pSortableColumn","correctionStatut"],["field","correctionStatut"],["pSortableColumn","updatedAt"],["field","updatedAt"],[2,"width","14rem"],[1,"code-badge"],[1,"client-info"],[1,"text-muted","d-block"],[1,"id-info"],[1,"phone-info"],[1,"pi","pi-phone"],["class","text-muted d-block",4,"ngIf"],[4,"ngIf"],["class","text-muted",4,"ngIf"],[3,"value","severity"],[1,"agence-code"],[1,"date-text"],[1,"action-buttons"],["pButton","","icon","pi pi-pencil","pTooltip","Traiter la correction",1,"p-button-rounded","p-button-text","p-button-warning",3,"click"],[1,"pi","pi-mobile"],[1,"text-muted"],["colspan","12",1,"text-center"],[1,"empty-message"],[1,"pi","pi-inbox",2,"font-size","3rem","color","#ccc"],[2,"margin-top","1rem","font-size","1.1rem","color","#666"],[2,"margin-top","0.5rem","color","#999"],[1,"summary-section"],[1,"summary-stats"],[1,"stat-item"],[1,"pi","pi-users"],["class","stat-item stat-danger",4,"ngIf"],["class","stat-item",4,"ngIf"],[1,"stat-item","stat-danger"],[1,"pi","pi-filter"]],template:function(e,a){e&1&&(n(0,"div",0),m(1,"p-toast"),n(2,"p-card"),g(3,Yi,10,1,"ng-template",1)(4,po,3,3,"ng-template",2),i()())},dependencies:[j,Ie,q,$,N,qe,ze,F,ae,je,rt,K,U,z,J,H,re,Kt,ie,Le,te,ne,Ee,Ne,Pe,Fe,W,ge,Y,Q],styles:[".correction-rejet-container[_ngcontent-%COMP%]{padding:1rem}.correction-rejet-container[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem 1.5rem;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border-radius:8px 8px 0 0}.correction-rejet-container[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .card-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;font-size:1.5rem;font-weight:600;margin:0}.correction-rejet-container[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .card-title[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.8rem}.correction-rejet-container[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]{display:flex;gap:.75rem;align-items:center}.correction-rejet-container[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   .search-input[_ngcontent-%COMP%]{width:300px}.correction-rejet-container[_ngcontent-%COMP%]   .loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:400px;gap:1.5rem}.correction-rejet-container[_ngcontent-%COMP%]   .loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.1rem;color:#666;margin:0}.correction-rejet-container[_ngcontent-%COMP%]   .error-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:400px;gap:1.5rem}.correction-rejet-container[_ngcontent-%COMP%]   .error-container[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:4rem;color:#ef4444}.correction-rejet-container[_ngcontent-%COMP%]   .error-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.1rem;color:#666;margin:0;text-align:center;max-width:500px}.correction-rejet-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]{padding:0}.correction-rejet-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .table-caption[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem;background:#f8f9fa;border-bottom:2px solid #e9ecef}.correction-rejet-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .table-caption[_ngcontent-%COMP%]   .caption-left[_ngcontent-%COMP%]   .caption-text[_ngcontent-%COMP%]{font-size:1rem;color:#495057}.correction-rejet-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .table-caption[_ngcontent-%COMP%]   .caption-left[_ngcontent-%COMP%]   .caption-text[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#212529;font-weight:600}.correction-rejet-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .table-caption[_ngcontent-%COMP%]   .caption-right[_ngcontent-%COMP%]{display:flex;gap:.5rem}.correction-rejet-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .code-badge[_ngcontent-%COMP%]{display:inline-block;padding:.25rem .5rem;background:#e3f2fd;color:#1976d2;border-radius:4px;font-family:monospace;font-size:.9rem;font-weight:500}.correction-rejet-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .client-info[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;color:#212529;font-weight:600;margin-bottom:.25rem}.correction-rejet-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .client-info[_ngcontent-%COMP%]   .text-muted[_ngcontent-%COMP%]{color:#6c757d;font-size:.875rem}.correction-rejet-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .id-info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block;font-weight:500;color:#495057}.correction-rejet-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .id-info[_ngcontent-%COMP%]   .text-muted[_ngcontent-%COMP%]{color:#6c757d;font-size:.85rem;margin-top:.25rem}.correction-rejet-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .phone-info[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#6c757d;margin-right:.25rem}.correction-rejet-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .phone-info[_ngcontent-%COMP%]   .text-muted[_ngcontent-%COMP%]{color:#6c757d;font-size:.85rem;margin-top:.25rem}.correction-rejet-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .agence-code[_ngcontent-%COMP%]{display:inline-block;padding:.25rem .5rem;background:#fff3cd;color:#856404;border-radius:4px;font-weight:500;font-size:.9rem}.correction-rejet-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .date-text[_ngcontent-%COMP%]{color:#6c757d;font-size:.85rem}.correction-rejet-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{display:flex;gap:.25rem;justify-content:center}.correction-rejet-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{transform:scale(1.1);transition:transform .2s ease}.correction-rejet-container[_ngcontent-%COMP%]   .empty-message[_ngcontent-%COMP%]{padding:3rem 1rem}.correction-rejet-container[_ngcontent-%COMP%]   .empty-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.correction-rejet-container[_ngcontent-%COMP%]   .summary-section[_ngcontent-%COMP%]{padding:1rem;background:#f8f9fa;border-top:2px solid #e9ecef}.correction-rejet-container[_ngcontent-%COMP%]   .summary-section[_ngcontent-%COMP%]   .summary-stats[_ngcontent-%COMP%]{display:flex;gap:2rem;justify-content:center;flex-wrap:wrap}.correction-rejet-container[_ngcontent-%COMP%]   .summary-section[_ngcontent-%COMP%]   .summary-stats[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.5rem 1rem;background:#fff;border-radius:6px;border:1px solid #e9ecef;font-size:.95rem;color:#495057}.correction-rejet-container[_ngcontent-%COMP%]   .summary-section[_ngcontent-%COMP%]   .summary-stats[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#6c757d}.correction-rejet-container[_ngcontent-%COMP%]   .summary-section[_ngcontent-%COMP%]   .summary-stats[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#212529;font-weight:600;margin-left:.25rem}.correction-rejet-container[_ngcontent-%COMP%]   .summary-section[_ngcontent-%COMP%]   .summary-stats[_ngcontent-%COMP%]   .stat-item.stat-danger[_ngcontent-%COMP%]{background:#fee2e2;border-color:#fecaca;color:#991b1b}.correction-rejet-container[_ngcontent-%COMP%]   .summary-section[_ngcontent-%COMP%]   .summary-stats[_ngcontent-%COMP%]   .stat-item.stat-danger[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#dc2626}.correction-rejet-container[_ngcontent-%COMP%]   .summary-section[_ngcontent-%COMP%]   .summary-stats[_ngcontent-%COMP%]   .stat-item.stat-danger[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#991b1b}@media (max-width: 768px){.correction-rejet-container[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{flex-direction:column;gap:1rem;text-align:center}.correction-rejet-container[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]{width:100%;justify-content:center;flex-wrap:wrap}.correction-rejet-container[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   .search-input[_ngcontent-%COMP%]{width:100%;max-width:300px}.correction-rejet-container[_ngcontent-%COMP%]   .table-caption[_ngcontent-%COMP%]{flex-direction:column;gap:1rem;text-align:center}.correction-rejet-container[_ngcontent-%COMP%]   .summary-stats[_ngcontent-%COMP%]{justify-content:center!important}}.correction-rejet-container[_ngcontent-%COMP%]     .p-datatable .p-datatable-tbody tr{transition:background-color .2s ease}.correction-rejet-container[_ngcontent-%COMP%]     .p-datatable .p-datatable-tbody tr:hover{background-color:#f8f9fa!important}.correction-rejet-container[_ngcontent-%COMP%]     .p-tag{font-weight:500;font-size:.85rem}.correction-rejet-container[_ngcontent-%COMP%]     .p-button.p-button-outlined{background:#fff;color:#667eea;border-color:#fff}.correction-rejet-container[_ngcontent-%COMP%]     .p-button.p-button-outlined:hover{background:#ffffffe6;border-color:#ffffffe6}.correction-rejet-container[_ngcontent-%COMP%]     .p-iconfield .p-inputtext{padding-left:2.5rem}"]})};var go=()=>({width:"50px",height:"50px"}),_o=()=>[5,10,20],fo=()=>({width:"100%"});function Co(o,t){if(o&1&&(n(0,"p",3),r(1," Agence: "),n(2,"strong"),r(3),i(),r(4," | Responsable: "),n(5,"strong"),r(6),i()()),o&2){let e,a,s=d();l(3),u((e=s.state().user)==null?null:e.agenceId),l(3),T("",(a=s.state().user)==null?null:a.firstName," ",(a=s.state().user)==null?null:a.lastName,"")}}function xo(o,t){o&1&&(n(0,"div",5),m(1,"p-progressSpinner"),i()),o&2&&(l(),X(M(2,go)))}function vo(o,t){if(o&1&&(n(0,"div",10)(1,"span",11),r(2),i()()),o&2){let e=d(2);l(2),T(" Agents (",e.state().agents.length,") | Points de vente disponibles (",e.state().pointsVente.length,") ")}}function bo(o,t){o&1&&(n(0,"tr")(1,"th"),r(2,"Agent"),i(),n(3,"th"),r(4,"Email / T\xE9l\xE9phone"),i(),n(5,"th"),r(6,"PS Actuel"),i(),n(7,"th"),r(8,"Statut"),i(),n(9,"th",12),r(10,"S\xE9lectionner PS"),i(),n(11,"th",13),r(12,"Action"),i()())}function ho(o,t){if(o&1&&(n(0,"div",18),m(1,"i",27),r(2),i()),o&2){let e=d().$implicit;l(2),u(e.phone)}}function So(o,t){o&1&&m(0,"i",22)}function yo(o,t){o&1&&m(0,"p-tag",28)}function Eo(o,t){o&1&&m(0,"p-tag",29)}function Po(o,t){if(o&1&&g(0,yo,1,0,"p-tag",28)(1,Eo,1,0,"p-tag",29),o&2){let e=d().$implicit;_(e.isActive?0:1)}}function Mo(o,t){if(o&1&&(n(0,"div",19),m(1,"i",33),n(2,"span"),r(3),i()()),o&2){let e=d().$implicit;l(3),T("",e.libele," (",e.code,")")}}function Oo(o,t){if(o&1&&g(0,Mo,4,2,"div",19),o&2){let e=t.$implicit;_(e?0:-1)}}function wo(o,t){if(o&1&&(n(0,"div",34),m(1,"i",20),n(2,"div")(3,"div",14),r(4),i(),n(5,"div",15),r(6),i()()()),o&2){let e=t.$implicit;l(4),u(e.libele),l(2),C("Code: ",e.code,"")}}function Do(o,t){if(o&1){let e=y();n(0,"p-dropdown",30),k("ngModelChange",function(s){v(e);let c=d().$implicit;return A(c.selectedPointVenteId,s)||(c.selectedPointVenteId=s),b(s)}),g(1,Oo,1,1,"ng-template",31)(2,wo,7,2,"ng-template",32),i()}if(o&2){let e=d().$implicit,a=d(2);X(M(6,fo)),I("ngModel",e.selectedPointVenteId),p("options",a.state().pointsVente)("showClear",!1)("filter",!0)}}function To(o,t){o&1&&(n(0,"span",24),r(1,"Rotation active"),i())}function Io(o,t){if(o&1){let e=y();n(0,"button",35),f("click",function(){v(e);let s=d().$implicit,c=d(2);return b(c.deactivateRotation(s))}),i()}if(o&2){let e=d().$implicit;p("loading",e.isLoading)("disabled",e.isLoading)}}function Ao(o,t){if(o&1){let e=y();n(0,"button",36),f("click",function(){v(e);let s=d().$implicit,c=d(2);return b(c.activateRotation(s))}),i()}if(o&2){let e=d().$implicit;p("loading",e.isLoading)("disabled",e.isLoading||!e.selectedPointVenteId)}}function ko(o,t){if(o&1&&(n(0,"tr")(1,"td")(2,"div",14),r(3),i(),n(4,"div",15),r(5),i()(),n(6,"td")(7,"div",16)(8,"div"),m(9,"i",17),r(10),i(),g(11,ho,3,1,"div",18),i()(),n(12,"td")(13,"div",19),m(14,"i",20),n(15,"span",21),r(16),i()()(),n(17,"td"),g(18,So,1,0,"i",22)(19,Po,2,1),i(),n(20,"td"),g(21,Do,3,7,"p-dropdown",23)(22,To,2,0,"span",24),i(),n(23,"td"),g(24,Io,1,2,"button",25)(25,Ao,1,2,"button",26),i()()),o&2){let e=t.$implicit;l(3),u(e.fullName),l(2),u(e.username),l(5),u(e.email),l(),_(e.phone?11:-1),l(5),u(e.pointVenteDisplay),l(2),_(e.isLoading?18:19),l(3),_(e.isActive?22:21),l(3),_(e.isActive?24:25)}}function Vo(o,t){if(o&1&&(n(0,"p-table",6),g(1,vo,3,2,"ng-template",7)(2,bo,13,0,"ng-template",8)(3,ko,26,8,"ng-template",9),i()),o&2){let e=d();p("value",e.state().agents)("paginator",!0)("rows",10)("rowsPerPageOptions",M(4,_o))}}var wt=class o{state=E({agents:[],pointsVente:[],loading:!1});userService=P(V);messageService=P(w);confirmationService=P(Z);destroyRef=P(oe);ngOnInit(){this.loadUserAndData()}loadUserAndData(){this.state.update(t=>S(h({},t),{loading:!0})),this.userService.getInstanceUser$().pipe(B(this.destroyRef)).subscribe({next:t=>{let e=t.data?.user;if(!e?.agenceId){this.messageService.add({severity:"error",summary:"Erreur",detail:"Aucune agence associ\xE9e \xE0 votre compte",life:3e3}),this.state.update(a=>S(h({},a),{loading:!1}));return}console.log("\u{1F464} Utilisateur connect\xE9:",e),this.state.update(a=>S(h({},a),{user:e})),this.loadAgenceData(e.agenceId)},error:t=>{console.error("\u274C Erreur chargement utilisateur:",t),this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de charger les informations utilisateur",life:3e3}),this.state.update(e=>S(h({},e),{loading:!1}))}})}loadAgenceData(t){Rt({pointsVente:this.userService.getAllPointVenteByAgenceId$(t),agents:this.userService.getListAgentCredit$(t)}).pipe(B(this.destroyRef)).subscribe({next:e=>{let a=e.pointsVente.data?.pointVentes||[],s=e.agents.data?.agentCreditDTO||[];console.log("\u{1F3E2} Points de vente charg\xE9s:",a.length),console.log("\u{1F465} Agents charg\xE9s:",s.length);let c=s.filter(x=>x.userId&&x.pointventeId);this.state.update(x=>S(h({},x),{pointsVente:a,agents:c})),c.length>0?this.loadAgentsStatus(c):this.state.update(x=>S(h({},x),{loading:!1}))},error:e=>{console.error("\u274C Erreur chargement donn\xE9es agence:",e),this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de charger les donn\xE9es de l'agence",life:3e3}),this.state.update(a=>S(h({},a),{loading:!1}))}})}loadAgentsStatus(t){let e=t.map(a=>this.userService.checkAgentDisponibility$(a.userId,a.pointventeId).pipe(Ke(()=>Ye({data:{disponibilityAgent:{isActive:!1}}}))));Rt(e).pipe(B(this.destroyRef)).subscribe({next:a=>{let s=t.map((c,x)=>S(h({},c),{isActive:a[x]?.data?.disponibilityAgent?.isActive||!1,selectedPointVenteId:c.pointventeId,isLoading:!1}));this.state.update(c=>S(h({},c),{agents:s,loading:!1}))}})}activateRotation(t){if(console.log("\u{1F504} Activation pour:",t),!t.selectedPointVenteId){this.messageService.add({severity:"warn",summary:"Attention",detail:"Veuillez s\xE9lectionner un point de vente",life:3e3});return}let e=this.state().pointsVente.find(a=>a.id===t.selectedPointVenteId);this.confirmationService.confirm({message:`Activer la rotation pour ${t.fullName} au point de vente ${e?.libele} (${e?.code}) ?`,header:"Confirmation d'activation",icon:"pi pi-check-circle",acceptLabel:"Oui, activer",rejectLabel:"Annuler",accept:()=>{this.performActivation(t)}})}performActivation(t){this.updateAgentLoadingState(t.userId,!0);let e={userId:t.userId,pointVenteId:t.selectedPointVenteId};this.userService.activateRotation$(e).pipe(B(this.destroyRef)).subscribe({next:()=>{this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:`Rotation activ\xE9e pour ${t.fullName}`,life:3e3}),this.updateAgentAfterActivation(t.userId,t.selectedPointVenteId)},error:a=>{console.error("\u274C Erreur activation:",a),this.updateAgentLoadingState(t.userId,!1),this.messageService.add({severity:"error",summary:"Erreur",detail:a.message||"Impossible d'activer la rotation",life:3e3})}})}deactivateRotation(t){this.confirmationService.confirm({message:`D\xE9sactiver la rotation pour ${t.fullName} ?`,header:"Confirmation de d\xE9sactivation",icon:"pi pi-exclamation-triangle",acceptLabel:"Oui, d\xE9sactiver",rejectLabel:"Annuler",acceptButtonStyleClass:"p-button-danger",accept:()=>{this.performDeactivation(t)}})}performDeactivation(t){this.updateAgentLoadingState(t.userId,!0),this.userService.deactivateRotation$(t.userId).pipe(B(this.destroyRef)).subscribe({next:()=>{this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:`Rotation d\xE9sactiv\xE9e pour ${t.fullName}`,life:3e3}),this.updateAgentStatus(t.userId,!1)},error:e=>{console.error("\u274C Erreur d\xE9sactivation:",e),this.updateAgentLoadingState(t.userId,!1),this.messageService.add({severity:"error",summary:"Erreur",detail:e.message||"Impossible de d\xE9sactiver",life:3e3})}})}updateAgentAfterActivation(t,e){let a=this.state().pointsVente.find(s=>s.id===e);this.state.update(s=>S(h({},s),{agents:s.agents.map(c=>c.userId===t?S(h({},c),{isActive:!0,isLoading:!1,pointventeId:e,pointventeLibele:a?.libele??"",pointventeCode:a?.code??"",pointVenteDisplay:a?`${a.libele} (${a.code})`:"Non assign\xE9"}):c)}))}updateAgentLoadingState(t,e){this.state.update(a=>S(h({},a),{agents:a.agents.map(s=>s.userId===t?S(h({},s),{isLoading:e}):s)}))}updateAgentStatus(t,e){this.state.update(a=>S(h({},a),{agents:a.agents.map(s=>s.userId===t?S(h({},s),{isActive:e,isLoading:!1}):s)}))}refresh(){let t=this.state().user;t?.agenceId&&this.loadAgenceData(t.agenceId)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=D({type:o,selectors:[["app-rotation-agent"]],features:[G([w,Z])],decls:11,vars:4,consts:[[1,"card"],[1,"flex","justify-between","items-center","mb-6"],[1,"text-2xl","font-bold","text-surface-900","dark:text-surface-0","mb-2"],[1,"text-surface-600","dark:text-surface-400"],["pButton","","pRipple","","icon","pi pi-refresh","label","Actualiser",1,"p-button-outlined",3,"click","loading"],[1,"flex","justify-center","items-center","py-8"],["styleClass","p-datatable-gridlines",3,"value","paginator","rows","rowsPerPageOptions"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold"],[2,"min-width","250px"],[2,"width","180px"],[1,"font-semibold"],[1,"text-sm","text-gray-600"],[1,"text-sm"],[1,"pi","pi-envelope","text-blue-500","mr-1"],[1,"mt-1"],[1,"flex","items-center","gap-2"],[1,"pi","pi-map-marker","text-orange-500"],[1,"font-medium"],[1,"pi","pi-spin","pi-spinner","text-blue-500"],["optionLabel","libele","optionValue","id","placeholder","S\xE9lectionner un point de vente","filterBy","libele,code","appendTo","body",3,"ngModel","options","showClear","filter","style"],[1,"text-gray-500","italic"],["pButton","","pRipple","","icon","pi pi-times-circle","label","D\xE9sactiver",1,"p-button-danger","p-button-sm","w-full",3,"loading","disabled"],["pButton","","pRipple","","icon","pi pi-check-circle","label","Activer",1,"p-button-success","p-button-sm","w-full",3,"loading","disabled"],[1,"pi","pi-phone","text-green-500","mr-1"],["value","ACTIF","severity","success","icon","pi pi-check-circle"],["value","INACTIF","severity","danger","icon","pi pi-times-circle"],["optionLabel","libele","optionValue","id","placeholder","S\xE9lectionner un point de vente","filterBy","libele,code","appendTo","body",3,"ngModelChange","ngModel","options","showClear","filter"],["pTemplate","selectedItem"],["pTemplate","item"],[1,"pi","pi-map-marker","text-blue-500"],[1,"flex","items-center","gap-2","p-2"],["pButton","","pRipple","","icon","pi pi-times-circle","label","D\xE9sactiver",1,"p-button-danger","p-button-sm","w-full",3,"click","loading","disabled"],["pButton","","pRipple","","icon","pi pi-check-circle","label","Activer",1,"p-button-success","p-button-sm","w-full",3,"click","loading","disabled"]],template:function(e,a){e&1&&(m(0,"p-toast")(1,"p-confirmDialog"),n(2,"div",0)(3,"div",1)(4,"div")(5,"h2",2),r(6," Gestion des Rotations - Agents de Cr\xE9dit "),i(),g(7,Co,7,3,"p",3),i(),n(8,"button",4),f("click",function(){return a.refresh()}),i()(),g(9,xo,2,3,"div",5)(10,Vo,4,5,"p-table",6),i()),e&2&&(l(7),_(a.state().user?7:-1),l(),p("loading",a.state().loading),l(),_(a.state().loading?9:-1),l(),_(!a.state().loading&&a.state().agents.length>0?10:-1))},dependencies:[j,ie,te,ne,q,$,N,F,ae,W,z,J,dt,st,K,U,Y,Q,fe,_e,H],encapsulation:2})};var Dt=class o{imprimerRapport(t,e,a={}){let s=window.open("","_blank","width=1200,height=800");if(!s){console.error("Impossible d'ouvrir la fen\xEAtre d'impression");return}let c=this.genererHTML(t,e,a);s.document.write(c),s.document.close(),s.onload=()=>{setTimeout(()=>{s.print(),a.autoClose!==!1&&s.close()},500)}}imprimerRapportLogistique(t,e={}){let a=window.open("","_blank","width=1200,height=800");if(!a){console.error("Impossible d'ouvrir la fen\xEAtre d'impression");return}let s=this.genererHTMLLogistique(t,e);a.document.write(s),a.document.close(),a.onload=()=>{setTimeout(()=>{a.print(),e.autoClose!==!1&&a.close()},500)}}genererHTMLLogistique(t,e){let a=this.getLogistiqueStyles(),s=this.genererContenuLogistique(t,e);return`
            <!DOCTYPE html>
            <html>
            <head>
                <meta charset="utf-8">
                <title>Rapport Logistique - Bons de Commande Accept\xE9s</title>
                <style>${a}</style>
            </head>
            <body>
                ${s}
            </body>
            </html>
        `}genererContenuLogistique(t,e){let a=new Date().toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),s=this.calculerStatistiquesLogistique(t),c=this.grouperParDelegation(t);return`
            <div class="print-container">
                <!-- En-t\xEAte -->
                <div class="header">
                    <div class="logo-section">
                        <div class="company-name">${e.companyName||"ENTREPRISE"}</div>
                    </div>
                    <div class="header-content">
                        <h1>\u{1F4E6} RAPPORT LOGISTIQUE</h1>
                        <h2>Bons de Commande Accept\xE9s par le DE</h2>
                        <div class="header-meta">
                            <span class="meta-item">\u{1F4C5} ${a}</span>
                            <span class="meta-item">\u{1F4CB} ${t.length} commande(s)</span>
                            <span class="meta-item">\u{1F4CA} ${s.totalQuantite} unit\xE9(s)</span>
                        </div>
                    </div>
                </div>

                <!-- Statistiques globales -->
                <div class="section stats-section">
                    <h3>\u{1F4CA} SYNTH\xC8SE GLOBALE</h3>
                    <div class="stats-grid">
                        <div class="stat-card stat-primary">
                            <div class="stat-icon">\u{1F4CB}</div>
                            <div class="stat-info">
                                <div class="stat-value">${s.totalCommandes}</div>
                                <div class="stat-label">Commandes</div>
                            </div>
                        </div>
                        <div class="stat-card stat-success">
                            <div class="stat-icon">\u{1F4E6}</div>
                            <div class="stat-info">
                                <div class="stat-value">${s.totalQuantite}</div>
                                <div class="stat-label">Unit\xE9s totales</div>
                            </div>
                        </div>
                        <div class="stat-card stat-warning">
                            <div class="stat-icon">\u{1F504}</div>
                            <div class="stat-info">
                                <div class="stat-value">${s.commandesModifiees}</div>
                                <div class="stat-label">Qt\xE9 modifi\xE9es</div>
                            </div>
                        </div>
                        <div class="stat-card stat-info">
                            <div class="stat-icon">\u{1F3E2}</div>
                            <div class="stat-info">
                                <div class="stat-value">${s.nombreDelegations}</div>
                                <div class="stat-label">D\xE9l\xE9gations</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Synth\xE8se par d\xE9l\xE9gation -->
                <div class="section">
                    <h3>\u{1F3E2} SYNTH\xC8SE PAR D\xC9L\xC9GATION</h3>
                    <table class="summary-table">
                        <thead>
                            <tr>
                                <th style="width: 5%">#</th>
                                <th style="width: 35%">D\xE9l\xE9gation</th>
                                <th style="width: 20%" class="text-center">Nb Commandes</th>
                                <th style="width: 20%" class="text-center">Qt\xE9 Demand\xE9e</th>
                                <th style="width: 20%" class="text-center">Qt\xE9 Valid\xE9e</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${c.map((x,R)=>`
                                <tr>
                                    <td class="text-center">${R+1}</td>
                                    <td><strong>${x.delegation}</strong></td>
                                    <td class="text-center"><span class="badge badge-primary">${x.count}</span></td>
                                    <td class="text-center">${x.qteDemandee}</td>
                                    <td class="text-center"><strong class="text-success">${x.qteValidee}</strong></td>
                                </tr>
                            `).join("")}
                        </tbody>
                        <tfoot>
                            <tr class="total-row">
                                <td colspan="2"><strong>TOTAL</strong></td>
                                <td class="text-center"><strong>${s.totalCommandes}</strong></td>
                                <td class="text-center"><strong>${s.totalQteDemandee}</strong></td>
                                <td class="text-center"><strong class="text-success">${s.totalQuantite}</strong></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>

                <!-- D\xE9tail par commande (optionnel) -->
                ${e.includeDetails?this.genererDetailsCommandes(t):""}

                <!-- Pied de page -->
                <div class="footer">
                    <div class="footer-content">
                        <p>Document g\xE9n\xE9r\xE9 automatiquement le ${a}</p>
                        <p class="text-small">Rapport logistique - Bons de commande accept\xE9s par le Directeur d'Exploitation</p>
                    </div>
                    ${e.includeSignature?`
                        <div class="signature-section">
                            <div class="signature-box">
                                <p>Responsable Logistique</p>
                                <div class="signature-line"></div>
                                <p class="signature-date">Date: _______________</p>
                            </div>
                            <div class="signature-box">
                                <p>Validation</p>
                                <div class="signature-line"></div>
                                <p class="signature-date">Date: _______________</p>
                            </div>
                        </div>
                    `:""}
                </div>
            </div>
        `}renderQuantite(t){let e=t.qteSuggeree||t.qte;if(t.qteSuggeree&&t.qteSuggeree!==t.qte){let a=t.qteSuggeree-(t.qte||0),s=a>0?"text-success":"text-danger",c=a>0?"+":"";return`<strong class="text-warning">${e}</strong> <small class="${s}">(${c}${a})</small>`}return`<strong>${e}</strong>`}genererDetailsCommandes(t){return`
            <div class="section">
                <h3>\u{1F4C4} FICHES D\xC9TAILL\xC9ES</h3>
                ${t.map((e,a)=>this.genererFicheCommande(e,a+1)).join("")}
            </div>
        `}genererFicheCommande(t,e){let a=this.parseDetailCommande(t.detailBonCommande||""),s=t.qteSuggeree&&t.qteSuggeree!==t.qte;return`
            <div class="fiche-commande">
                <div class="fiche-header">
                    <div class="fiche-numero">
                        <span class="numero-badge">${e}</span>
                        <strong>Commande N\xB0 ${t.numeroCommande}</strong>
                    </div>
                    <div class="fiche-status status-accepted">\u2713 Accept\xE9</div>
                </div>
                <div class="fiche-body">
                    <div class="fiche-grid">
                        <div class="fiche-col">
                            <div class="fiche-field">
                                <label>Service</label>
                                <span>${t.service}</span>
                            </div>
                            <div class="fiche-field">
                                <label>D\xE9tails</label>
                                <span>${a}</span>
                            </div>
                            <div class="fiche-field">
                                <label>Demandeur</label>
                                <span>${t.userFullName||t.username}</span>
                            </div>
                        </div>
                        <div class="fiche-col">
                            <div class="fiche-field">
                                <label>D\xE9l\xE9gation</label>
                                <span>${t.delegationLibele||"-"}</span>
                            </div>
                            <div class="fiche-field">
                                <label>Agence</label>
                                <span>${t.agenceLibele||"-"}</span>
                            </div>
                            <div class="fiche-field">
                                <label>Point de vente</label>
                                <span>${t.pointventeLibele||"-"}</span>
                            </div>
                        </div>
                    </div>
                    <div class="fiche-quantites ${s?"modified":""}">
                        <div class="qte-box">
                            <label>Qt\xE9 demand\xE9e</label>
                            <span class="qte-value">${t.qte}</span>
                        </div>
                        <div class="qte-arrow">\u2192</div>
                        <div class="qte-box qte-finale">
                            <label>Qt\xE9 valid\xE9e</label>
                            <span class="qte-value">${t.qteSuggeree||t.qte}</span>
                        </div>
                        ${s&&t.motifQte?`
                            <div class="qte-motif">
                                <label>Motif</label>
                                <span>${t.motifQte}</span>
                            </div>
                        `:""}
                    </div>
                    <div class="fiche-dates">
                        <span>\u{1F4C5} Cr\xE9ation: ${this.formatDateLogistique(t.dateCreation)}</span>
                        <span>\u2713 Acceptation: ${this.formatDateLogistique(t.dateTraitement)}</span>
                    </div>
                    ${t.observations?`
                        <div class="fiche-observations">
                            <label>Observations</label>
                            <p>${t.observations}</p>
                        </div>
                    `:""}
                </div>
            </div>
        `}calculerStatistiquesLogistique(t){let e=t.length,a=t.reduce((R,Qe)=>R+(Qe.qteSuggeree||Qe.qte||0),0),s=t.reduce((R,Qe)=>R+(Qe.qte||0),0),c=t.filter(R=>R.qteSuggeree&&R.qteSuggeree!==R.qte).length,x=new Set(t.map(R=>R.delegationLibele).filter(Boolean));return{totalCommandes:e,totalQuantite:a,totalQteDemandee:s,commandesModifiees:c,nombreDelegations:x.size}}grouperParDelegation(t){let e=new Map;return t.forEach(a=>{let s=a.delegationLibele||"Non sp\xE9cifi\xE9e",c=e.get(s)||{count:0,qteDemandee:0,qteValidee:0};e.set(s,{count:c.count+1,qteDemandee:c.qteDemandee+(a.qte||0),qteValidee:c.qteValidee+(a.qteSuggeree||a.qte||0)})}),Array.from(e.entries()).map(([a,s])=>({delegation:a,count:s.count,qteDemandee:s.qteDemandee,qteValidee:s.qteValidee})).sort((a,s)=>s.count-a.count)}formatDateLogistique(t){if(!t)return"-";let e;if(Array.isArray(t))e=new Date(t[0],t[1]-1,t[2],t[3]||0,t[4]||0);else if(typeof t=="string")e=new Date(t);else return"-";return e.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}getLogistiqueStyles(){return`
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                font-size: 10px;
                line-height: 1.4;
                color: #1f2937;
                background: white;
            }

            .print-container {
                max-width: 210mm;
                margin: 0 auto;
                padding: 10mm;
            }

            /* En-t\xEAte */
            .header {
                background: linear-gradient(135deg, #059669 0%, #047857 100%);
                color: white;
                padding: 15px;
                border-radius: 8px;
                margin-bottom: 12px;
                text-align: center;
            }

            .company-name {
                font-size: 12px;
                font-weight: bold;
                letter-spacing: 2px;
                margin-bottom: 5px;
                opacity: 0.9;
            }

            .header h1 {
                font-size: 20px;
                font-weight: bold;
                margin-bottom: 3px;
            }

            .header h2 {
                font-size: 12px;
                font-weight: normal;
                opacity: 0.9;
                margin-bottom: 10px;
            }

            .header-meta {
                display: flex;
                justify-content: center;
                gap: 20px;
                flex-wrap: wrap;
            }

            .meta-item {
                background: rgba(255, 255, 255, 0.2);
                padding: 5px 12px;
                border-radius: 15px;
                font-size: 11px;
            }

            /* Sections */
            .section {
                margin-bottom: 10px;
            }

            .section h3 {
                background: #f3f4f6;
                color: #374151;
                padding: 8px 12px;
                font-size: 12px;
                font-weight: bold;
                border-left: 4px solid #059669;
                margin-bottom: 10px;
            }

            /* Statistiques */
            .stats-section {
                background: #f8fafc;
                padding: 10px;
                border-radius: 10px;
                border: 1px solid #e5e7eb;
            }

            .stats-grid {
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                gap: 10px;
            }

            .stat-card {
                display: flex;
                align-items: center;
                gap: 8px;
                padding: 10px;
                border-radius: 8px;
                background: white;
                border: 2px solid;
            }

            .stat-card.stat-primary {
                border-color: #3b82f6;
                background: #eff6ff;
            }

            .stat-card.stat-success {
                border-color: #22c55e;
                background: #f0fdf4;
            }

            .stat-card.stat-warning {
                border-color: #f59e0b;
                background: #fffbeb;
            }

            .stat-card.stat-info {
                border-color: #06b6d4;
                background: #ecfeff;
            }

            .stat-icon {
                font-size: 18px;
            }

            .stat-info .stat-value {
                font-size: 18px;
                font-weight: bold;
                color: #1f2937;
            }

            .stat-info .stat-label {
                font-size: 10px;
                color: #6b7280;
                text-transform: uppercase;
            }

            /* Tableaux */
            .summary-table, .detail-table {
                width: 100%;
                border-collapse: collapse;
                font-size: 10px;
            }

            .summary-table th, .detail-table th {
                background: #374151;
                color: white;
                padding: 10px 8px;
                text-align: left;
                font-weight: 600;
                font-size: 9px;
                text-transform: uppercase;
            }

            .summary-table td, .detail-table td {
                padding: 8px;
                border-bottom: 1px solid #e5e7eb;
                vertical-align: middle;
            }

            .summary-table tbody tr:hover, .detail-table tbody tr:hover {
                background: #f9fafb;
            }

            .summary-table tfoot .total-row {
                background: #f3f4f6;
                font-weight: bold;
            }

            .summary-table tfoot .total-row td {
                border-top: 2px solid #374151;
                padding: 12px 8px;
            }

            .detail-table .row-modified {
                background: #fefce8;
            }

            .text-center {
                text-align: center;
            }

            .text-right {
                text-align: right;
            }

            .text-small {
                font-size: 9px;
            }

            .text-muted {
                color: #9ca3af;
            }

            .text-success {
                color: #16a34a;
            }

            .text-warning {
                color: #d97706;
            }

            .text-danger {
                color: #dc2626;
            }

            .badge {
                display: inline-block;
                padding: 3px 8px;
                border-radius: 10px;
                font-size: 10px;
                font-weight: bold;
            }

            .badge-primary {
                background: #dbeafe;
                color: #1d4ed8;
            }

            /* Fiches d\xE9taill\xE9es */
            .fiche-commande {
                border: 1px solid #e5e7eb;
                border-radius: 6px;
                margin-bottom: 10px;
                page-break-inside: avoid;
                overflow: hidden;
            }

            .fiche-header {
                background: #f3f4f6;
                padding: 8px 12px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                border-bottom: 1px solid #e5e7eb;
            }

            .fiche-numero {
                display: flex;
                align-items: center;
                gap: 10px;
                font-size: 12px;
            }

            .numero-badge {
                background: #374151;
                color: white;
                width: 24px;
                height: 24px;
                border-radius: 50%;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                font-size: 11px;
                font-weight: bold;
            }

            .fiche-status {
                padding: 4px 10px;
                border-radius: 15px;
                font-size: 10px;
                font-weight: bold;
            }

            .status-accepted {
                background: #dcfce7;
                color: #166534;
            }

            .fiche-body {
                padding: 10px;
            }

            .fiche-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 15px;
                margin-bottom: 10px;
            }

            .fiche-field {
                margin-bottom: 5px;
            }

            .fiche-field label {
                display: block;
                font-size: 9px;
                color: #6b7280;
                text-transform: uppercase;
                margin-bottom: 2px;
            }

            .fiche-field span {
                font-size: 11px;
                color: #1f2937;
            }

            .fiche-quantites {
                display: flex;
                align-items: center;
                gap: 10px;
                padding: 8px;
                background: #f9fafb;
                border-radius: 6px;
                margin-bottom: 8px;
            }

            .fiche-quantites.modified {
                background: #fefce8;
                border: 1px solid #fcd34d;
            }

            .qte-box {
                text-align: center;
            }

            .qte-box label {
                display: block;
                font-size: 9px;
                color: #6b7280;
                margin-bottom: 4px;
            }

            .qte-value {
                font-size: 18px;
                font-weight: bold;
                color: #374151;
            }

            .qte-finale .qte-value {
                color: #059669;
            }

            .qte-arrow {
                font-size: 18px;
                color: #9ca3af;
            }

            .qte-motif {
                flex: 1;
                padding-left: 15px;
                border-left: 2px solid #fcd34d;
            }

            .qte-motif label {
                display: block;
                font-size: 9px;
                color: #6b7280;
                margin-bottom: 2px;
            }

            .qte-motif span {
                font-size: 10px;
                color: #92400e;
                font-style: italic;
            }

            .fiche-dates {
                display: flex;
                gap: 15px;
                font-size: 9px;
                color: #6b7280;
                margin-bottom: 6px;
            }

            .fiche-observations {
                background: #fef3c7;
                padding: 10px;
                border-radius: 6px;
                border-left: 3px solid #f59e0b;
            }

            .fiche-observations label {
                display: block;
                font-size: 9px;
                color: #92400e;
                font-weight: bold;
                margin-bottom: 4px;
            }

            .fiche-observations p {
                font-size: 10px;
                color: #78350f;
                margin: 0;
            }

            /* Pied de page */
            .footer {
                margin-top: 15px;
                padding-top: 10px;
                border-top: 2px solid #e5e7eb;
            }

            .footer-content {
                text-align: center;
                color: #6b7280;
                margin-bottom: 10px;
            }

            .signature-section {
                display: flex;
                justify-content: space-around;
                margin-top: 30px;
            }

            .signature-box {
                text-align: center;
                min-width: 200px;
            }

            .signature-box p {
                font-weight: bold;
                margin-bottom: 40px;
            }

            .signature-line {
                border-bottom: 1px solid #374151;
                margin-bottom: 10px;
            }

            .signature-date {
                font-size: 10px;
                color: #6b7280;
            }

            /* Utilitaires */
            .page-break-before {
                page-break-before: always;
            }

            /* Impression */
            @media print {
                body {
                    margin: 0;
                    -webkit-print-color-adjust: exact !important;
                    print-color-adjust: exact !important;
                }

                .print-container {
                    padding: 5mm;
                }

                .fiche-commande, .section {
                    page-break-inside: avoid;
                }

                .header {
                    -webkit-print-color-adjust: exact !important;
                    print-color-adjust: exact !important;
                }
            }

            @page {
                margin: 10mm;
                size: A4;
            }
        `}genererHTML(t,e,a){let s=this.getStyles(),c=this.genererContenu(t,e,a);return`
            <!DOCTYPE html>
            <html>
            <head>
                <meta charset="utf-8">
                <title>Rapport des Bons de Commande - ${t}</title>
                <style>${s}</style>
            </head>
            <body>
                ${c}
            </body>
            </html>
        `}genererContenu(t,e,a){let s=new Date().toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return`
            <div class="print-container">
                <div class="header">
                    <div class="header-content">
                        <h1>RAPPORT DES BONS DE COMMANDE</h1>
                        <div class="header-info">
                            <p><strong>D\xE9l\xE9gation:</strong> ${t}</p>
                            <p><strong>Date d'impression:</strong> ${s}</p>
                            <p><strong>Nombre de commandes:</strong> ${e.length}</p>
                        </div>
                    </div>
                </div>
                ${this.genererListeCommandes(e)}
                <div class="footer">
                    <p>Document g\xE9n\xE9r\xE9 automatiquement le ${s}</p>
                    ${a.includeSignature?'<div class="signature-section"><p>Signature du responsable: ___________________</p></div>':""}
                </div>
            </div>
        `}genererListeCommandes(t){return`
            <div class="section">
                <h2>D\xC9TAILS DES COMMANDES (${t.length})</h2>
                ${t.map((e,a)=>this.genererDetailCommande(e,a+1)).join("")}
            </div>
        `}genererDetailCommande(t,e){let a=this.getStatusClass(t.status),s=this.getStatusLabel(t.status),c=this.parseDetailCommande(t.detailBonCommande);return`
            <div class="commande-card">
                <div class="commande-header">
                    <div class="commande-number">
                        <span class="number-badge">${e}</span>
                        <strong>Commande N\xB0 ${t.numeroCommande}</strong>
                    </div>
                    <div class="commande-status ${a}">${s}</div>
                </div>
                <div class="commande-body">
                    <div class="commande-grid">
                        <div class="commande-col">
                            <div class="info-group">
                                <div class="info-label">\u{1F527} Service</div>
                                <div class="info-value">${t.service}</div>
                            </div>
                            <div class="info-group">
                                <div class="info-label">\u{1F4DD} D\xE9tails</div>
                                <div class="info-value">${c}</div>
                            </div>
                            <div class="info-group">
                                <div class="info-label">\u{1F464} Utilisateur</div>
                                <div class="info-value">${t.nomCompletUtilisateur}</div>
                            </div>
                            <div class="info-group">
                                <div class="info-label">\u{1F4DE} Contact</div>
                                <div class="info-value">${t.contactUtilisateur||"N/A"}</div>
                            </div>
                        </div>
                        <div class="commande-col">
                            <div class="info-group">
                                <div class="info-label">\u{1F4CD} D\xE9l\xE9gation</div>
                                <div class="info-value">${t.delegation}</div>
                            </div>
                            <div class="info-group">
                                <div class="info-label">\u{1F3E2} Agence</div>
                                <div class="info-value">${t.agence}</div>
                            </div>
                            <div class="info-group">
                                <div class="info-label">\u{1F3EA} Point de Vente</div>
                                <div class="info-value">${t.pointVente} (${t.codePointVente})</div>
                            </div>
                            <div class="info-group">
                                <div class="info-label">\u23F1\uFE0F Dur\xE9e traitement</div>
                                <div class="info-value highlight">${t.dureeTraitementFormatee}</div>
                            </div>
                        </div>
                    </div>
                    <div class="dates-section">
                        <div class="date-item"><strong>\u{1F4C5} Cr\xE9ation:</strong> ${this.formatDate(t.dateCreation)}</div>
                        <div class="date-item"><strong>\u2713 Traitement:</strong> ${this.formatDate(t.dateTraitement)}</div>
                    </div>
                    ${t.observations?`<div class="observations-section"><strong>\u{1F4AC} Observations:</strong><p>${t.observations}</p></div>`:""}
                </div>
            </div>
        `}parseDetailCommande(t){if(!t)return"N/A";try{return JSON.parse(t).detailStandard||t}catch{return t}}formatDate(t){if(!t)return"N/A";let e;if(Array.isArray(t))e=new Date(t[0],t[1]-1,t[2],t[3]||0,t[4]||0,t[5]||0);else if(typeof t=="string")e=new Date(t);else return"N/A";return e.toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}getStatusClass(t){return{ENCOURS:"status-warning",TERMINE:"status-success",ANNULE:"status-danger",EN_ATTENTE:"status-info",VALIDE:"status-success",ACCEPTE:"status-success"}[t]||"status-secondary"}getStatusLabel(t){return{ENCOURS:"En cours",TERMINE:"Termin\xE9",ANNULE:"Annul\xE9",EN_ATTENTE:"En attente",VALIDE:"Valid\xE9",ACCEPTE:"Accept\xE9"}[t]||t}getStyles(){return`
            * { margin: 0; padding: 0; box-sizing: border-box; }
            body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 11px; line-height: 1.4; color: #333; background: white; }
            .print-container { max-width: 210mm; margin: 0 auto; padding: 15mm; }
            .header { text-align: center; margin-bottom: 25px; border-bottom: 3px solid #2c3e50; padding-bottom: 15px; }
            .header h1 { font-size: 26px; font-weight: bold; color: #2c3e50; margin-bottom: 12px; }
            .header-info { display: flex; justify-content: space-around; flex-wrap: wrap; }
            .header-info p { margin: 4px 10px; font-size: 11px; }
            .section { margin-bottom: 25px; page-break-inside: avoid; }
            .section h2 { background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); color: white; padding: 10px 15px; font-size: 14px; margin-bottom: 15px; font-weight: bold; }
            .commande-card { background: white; border: 2px solid #dee2e6; border-radius: 8px; margin-bottom: 20px; page-break-inside: avoid; overflow: hidden; }
            .commande-header { background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 12px 15px; border-bottom: 2px solid #dee2e6; display: flex; justify-content: space-between; align-items: center; }
            .commande-number { display: flex; align-items: center; gap: 10px; font-size: 13px; font-weight: bold; color: #2c3e50; }
            .number-badge { background: #2c3e50; color: white; width: 28px; height: 28px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-weight: bold; font-size: 12px; }
            .commande-status { padding: 5px 12px; border-radius: 20px; font-weight: bold; font-size: 11px; text-transform: uppercase; }
            .status-warning { background: #fff3cd; color: #856404; border: 1px solid #ffc107; }
            .status-success { background: #d4edda; color: #155724; border: 1px solid #28a745; }
            .status-danger { background: #f8d7da; color: #721c24; border: 1px solid #dc3545; }
            .status-info { background: #d1ecf1; color: #0c5460; border: 1px solid #17a2b8; }
            .status-secondary { background: #e2e3e5; color: #383d41; border: 1px solid #6c757d; }
            .commande-body { padding: 15px; }
            .commande-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 15px; }
            .commande-col { display: flex; flex-direction: column; gap: 10px; }
            .info-group { border-bottom: 1px solid #e9ecef; padding-bottom: 8px; }
            .info-label { font-size: 10px; color: #6c757d; font-weight: 600; margin-bottom: 3px; text-transform: uppercase; }
            .info-value { font-size: 11px; color: #2c3e50; font-weight: 500; }
            .info-value.highlight { color: #2196F3; font-weight: bold; }
            .dates-section { background: #f8f9fa; padding: 10px 15px; border-radius: 6px; margin-top: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
            .date-item { font-size: 10px; }
            .date-item strong { color: #2c3e50; }
            .observations-section { background: #fff3cd; padding: 10px 15px; border-radius: 6px; margin-top: 15px; border-left: 4px solid #ffc107; }
            .observations-section strong { display: block; margin-bottom: 5px; color: #856404; font-size: 11px; }
            .observations-section p { color: #333; font-size: 10px; line-height: 1.5; }
            .footer { margin-top: 30px; padding-top: 15px; border-top: 2px solid #dee2e6; text-align: center; font-size: 10px; color: #6c757d; }
            .signature-section { margin-top: 25px; text-align: right; font-size: 11px; }
            @media print { body { margin: 0; } .print-container { padding: 10mm; } .commande-card { page-break-inside: avoid; } .section { page-break-inside: avoid; } .footer { page-break-inside: avoid; } }
            @page { margin: 15mm; size: A4; }
        `}static \u0275fac=function(e){return new(e||o)};static \u0275prov=Lt({token:o,factory:o.\u0275fac,providedIn:"root"})};var Ro=()=>({width:"700px"}),Lo=()=>({width:"500px"}),jo=()=>({"min-width":"200px"}),No=()=>({"min-width":"80rem"}),Fo=()=>[5,10,25,50],$o=(o,t)=>t.delegation;function qo(o,t){if(o&1&&(n(0,"div",10)(1,"div",17)(2,"div",18)(3,"div",19),m(4,"i",20),i(),n(5,"div",21)(6,"div",22),r(7),i(),n(8,"div",23),r(9,"Commandes \xE0 traiter"),i()()()(),n(10,"div",17)(11,"div",24)(12,"div",19),m(13,"i",25),i(),n(14,"div",21)(15,"div",22),r(16),i(),n(17,"div",23),r(18,"Quantit\xE9 totale"),i()()()(),n(19,"div",17)(20,"div",26)(21,"div",19),m(22,"i",27),i(),n(23,"div",21)(24,"div",22),r(25),i(),n(26,"div",23),r(27,"D\xE9l\xE9gations"),i()()()()()),o&2){let e=d();l(7),u(e.totalCommandes()),l(9),u(e.totalQuantite()),l(9),u(e.getCommandesParDelegation().length)}}function zo(o,t){o&1&&(n(0,"div",11)(1,"div",28),m(2,"p-progressSpinner"),n(3,"p",29),r(4,"Chargement des bons accept\xE9s..."),i()()())}function Bo(o,t){if(o&1){let e=y();n(0,"div",34)(1,"div",3)(2,"h3",35),m(3,"i",36),r(4," Bons de Commande Accept\xE9s par le DE "),i(),n(5,"div",37)(6,"span",38),m(7,"i",39),n(8,"input",40),f("ngModelChange",function(s){v(e);let c=d(2);return b(c.searchTerm.set(s))}),i()(),n(9,"p-dropdown",41),f("ngModelChange",function(s){v(e);let c=d(2);return b(c.selectedDelegation.set(s))}),i(),n(10,"div",42)(11,"p-button",43),f("onClick",function(){v(e);let s=d(2);return b(s.printRapportSynthese())}),i(),n(12,"p-button",44),f("onClick",function(){v(e);let s=d(2);return b(s.printRapportComplet())}),i()()()()()}if(o&2){let e=d(2);l(8),p("ngModel",e.searchTerm()),l(),X(M(9,jo)),p("options",e.delegations())("ngModel",e.selectedDelegation()),l(2),p("outlined",!0)("disabled",e.filteredStocks().length===0),l(),p("outlined",!0)("disabled",e.filteredStocks().length===0)}}function Uo(o,t){o&1&&(n(0,"tr"),m(1,"th",48),n(2,"th",49),r(3,"N\xB0 Commande"),i(),n(4,"th"),r(5,"Service"),i(),n(6,"th"),r(7,"D\xE9l\xE9gation"),i(),n(8,"th"),r(9,"Demandeur"),i(),n(10,"th",50),r(11,"Qt\xE9"),i(),n(12,"th",51),r(13,"\xC9tat"),i(),n(14,"th",49),r(15,"Date Acceptation"),i(),n(16,"th",50),r(17,"Actions"),i()())}function Jo(o,t){if(o&1&&(n(0,"span",68),r(1),i(),m(2,"i",69),n(3,"span",70),r(4),i()),o&2){let e=d().$implicit;l(),u(e.qte),l(3),u(e.qteSuggeree)}}function Wo(o,t){if(o&1&&(n(0,"span",61),r(1),i()),o&2){let e=d().$implicit;l(),u(e.qteSuggeree||e.qte)}}function Go(o,t){if(o&1&&(n(0,"div",77)(1,"span",78),r(2,"Qt\xE9 valid\xE9e:"),i(),n(3,"span",81),r(4),i()()),o&2){let e=d(2).$implicit;l(4),u(e.qteSuggeree)}}function Ho(o,t){if(o&1&&(n(0,"div",77)(1,"span",78),r(2,"Motif:"),i(),n(3,"span",82),r(4),i()()),o&2){let e=d(2).$implicit;l(4),u(e.motifQte)}}function Qo(o,t){if(o&1&&(n(0,"div",80)(1,"h5",75),m(2,"i",83),r(3," Observations "),i(),n(4,"p",84),r(5),i()()),o&2){let e=d(2).$implicit;l(5),u(e.observations)}}function Yo(o,t){if(o&1&&(n(0,"tr")(1,"td",71)(2,"div",72)(3,"div",73)(4,"div",17)(5,"div",74)(6,"h5",75),m(7,"i",76),r(8," Informations "),i(),n(9,"div",77)(10,"span",78),r(11,"Service:"),i(),n(12,"span",79),r(13),i()(),n(14,"div",77)(15,"span",78),r(16,"Cat\xE9gorie:"),i(),n(17,"span",79),r(18),i()(),n(19,"div",77)(20,"span",78),r(21,"D\xE9tails:"),i(),n(22,"span",79),r(23),i()()()(),n(24,"div",17)(25,"div",74)(26,"h5",75),m(27,"i",27),r(28," Localisation "),i(),n(29,"div",77)(30,"span",78),r(31,"D\xE9l\xE9gation:"),i(),n(32,"span",79),r(33),i()(),n(34,"div",77)(35,"span",78),r(36,"Agence:"),i(),n(37,"span",79),r(38),i()(),n(39,"div",77)(40,"span",78),r(41,"Point de vente:"),i(),n(42,"span",79),r(43),i()()()(),n(44,"div",17)(45,"div",74)(46,"h5",75),m(47,"i",25),r(48," Quantit\xE9s "),i(),n(49,"div",77)(50,"span",78),r(51,"Qt\xE9 demand\xE9e:"),i(),n(52,"span",79),r(53),i()(),n(54,"div",77)(55,"span",78),r(56,"Qt\xE9 actuelle:"),i(),n(57,"span",79),r(58),i()(),g(59,Go,5,1,"div",77)(60,Ho,5,1,"div",77),i()()(),g(61,Qo,6,1,"div",80),i()()()),o&2){let e,a=d().$implicit,s=d(3);p("@rowExpand","expanded"),l(13),u(a.service),l(5),u(a.categorieLibele||"-"),l(5),u(((e=s.parseDetails(a.detailBonCommande))==null?null:e.detailStandard)||"-"),l(10),u(a.delegationLibele||"-"),l(5),u(a.agenceLibele||"-"),l(5),u(a.pointventeLibele||"-"),l(10),u(a.qte),l(5),u(a.qteActuelle||a.qte),l(),_(a.qteSuggeree?59:-1),l(),_(a.motifQte?60:-1),l(),_(a.observations?61:-1)}}function Ko(o,t){if(o&1){let e=y();n(0,"tr")(1,"td")(2,"button",52),f("click",function(){let s=v(e).$implicit,c=d(3);return b(c.toggleRow(s))}),i()(),n(3,"td")(4,"span",53),r(5),i()(),n(6,"td")(7,"span",54),r(8),i()(),n(9,"td")(10,"span",55),m(11,"i",56),r(12),i()(),n(13,"td")(14,"div",57)(15,"span",58),r(16),i(),n(17,"small",59),r(18),i()()(),n(19,"td",28)(20,"div",60),g(21,Jo,5,2)(22,Wo,2,1,"span",61),i()(),n(23,"td",28),m(24,"p-tag",62),i(),n(25,"td")(26,"span",63),r(27),i()(),n(28,"td",28)(29,"div",64)(30,"button",65),f("click",function(){let s=v(e).$implicit,c=d(3);return b(c.openDetailDialog(s))}),i(),n(31,"button",66),f("click",function(){let s=v(e).$implicit,c=d(3);return b(c.printCommande(s))}),i(),n(32,"button",67),f("click",function(){let s=v(e).$implicit,c=d(3);return b(c.quickValidate(s))}),i()()()(),g(33,Yo,62,12,"tr")}if(o&2){let e=t.$implicit,a=d(3);Ce("row-expanded",a.isExpanded(e)),l(2),p("icon",a.isExpanded(e)?"pi pi-chevron-down":"pi pi-chevron-right"),l(3),u(e.numeroCommande),l(3),u(e.service),l(4),C(" ",e.delegationLibele||"-"," "),l(4),u(e.userFullName||e.username),l(2),u(e.agenceLibele),l(3),_(e.qteSuggeree&&e.qteSuggeree!==e.qte?21:22),l(3),p("value",a.getValidationLabel(e.stateValidation))("severity",a.getValidationSeverity(e.stateValidation)),l(3),u(a.formatDate(e.dateTraitement)),l(5),p("disabled",a.processingAction()),l(),_(a.isExpanded(e)?33:-1)}}function Zo(o,t){o&1&&(n(0,"tr")(1,"td",85)(2,"div",86),m(3,"i",87),n(4,"p",6),r(5,"Aucun bon de commande accept\xE9 trouv\xE9"),i(),n(6,"small",88),r(7,"Les bons valid\xE9s par le DE appara\xEEtront ici"),i()()()())}function Xo(o,t){if(o&1&&(n(0,"div",89)(1,"span")(2,"strong"),r(3),i(),r(4," commande(s) - "),n(5,"strong"),r(6),i(),r(7," unit\xE9(s) au total "),i()()),o&2){let e=d(3);l(3),u(e.filteredStocks().length),l(3),u(e.totalQuantite())}}function ea(o,t){if(o&1&&(n(0,"p-table",31),g(1,Uo,18,0,"ng-template",30)(2,Ko,34,14,"ng-template",45)(3,Zo,8,0,"ng-template",46)(4,Xo,8,2,"ng-template",47),i()),o&2){let e=d(2);p("value",e.filteredStocks())("tableStyle",M(6,No))("paginator",!0)("rows",10)("rowsPerPageOptions",M(7,Fo))("showCurrentPageReport",!0)}}function ta(o,t){if(o&1){let e=y();n(0,"div",32),m(1,"i",90),n(2,"h3",91),r(3,"Aucun bon de commande en attente"),i(),n(4,"p",88),r(5," Les bons de commande accept\xE9s par le Directeur d'Exploitation appara\xEEtront ici. "),i(),n(6,"p-button",92),f("onClick",function(){v(e);let s=d(2);return b(s.loadStockAcceptes())}),i()()}o&2&&(l(6),p("outlined",!0))}function na(o,t){o&1&&(n(0,"div",34)(1,"h3",35),m(2,"i",94),r(3," Synth\xE8se par D\xE9l\xE9gation "),i()())}function ia(o,t){if(o&1){let e=y();n(0,"div",93)(1,"div",95),f("click",function(){let s=v(e).$implicit,c=d(3);return b(c.selectedDelegation.set(s.delegation))}),n(2,"div",96),m(3,"i",97),r(4),i(),n(5,"div",98)(6,"span",99)(7,"strong"),r(8),i(),r(9," cmd "),i(),n(10,"span",99)(11,"strong"),r(12),i(),r(13," unit\xE9s "),i()()()()}if(o&2){let e=t.$implicit;l(4),C(" ",e.delegation," "),l(4),u(e.count),l(4),u(e.quantite)}}function oa(o,t){if(o&1&&(n(0,"p-card",33),g(1,na,4,0,"ng-template",30),n(2,"div",73),me(3,ia,14,3,"div",93,$o),i()()),o&2){let e=d(2);l(3),pe(e.getCommandesParDelegation())}}function aa(o,t){if(o&1&&(n(0,"p-card"),g(1,Bo,13,10,"ng-template",30)(2,ea,5,8,"p-table",31)(3,ta,7,1,"div",32),i(),g(4,oa,5,0,"p-card",33)),o&2){let e=d();l(2),_(e.filteredStocks().length>0?2:3),l(2),_(e.getCommandesParDelegation().length>1?4:-1)}}function ra(o,t){if(o&1&&(n(0,"p",108)(1,"strong"),r(2,"Motif:"),i(),n(3,"span",114),r(4),i()()),o&2){let e=d(2);l(4),u(e.selectedStock().motifQte)}}function la(o,t){if(o&1&&(n(0,"div",112)(1,"h5",115),m(2,"i",116),r(3,"D\xE9tails de la commande "),i(),n(4,"p",117),r(5),i()()),o&2){let e,a=d(2);l(5),u((e=a.parseDetails(a.selectedStock().detailBonCommande))==null?null:e.detailStandard)}}function sa(o,t){if(o&1&&(n(0,"div",113)(1,"h5",115),m(2,"i",118),r(3,"Observations "),i(),n(4,"p",117),r(5),i()()),o&2){let e=d(2);l(5),u(e.selectedStock().observations)}}function da(o,t){if(o&1&&(n(0,"div",13)(1,"div",100)(2,"div",89)(3,"div")(4,"h4",101),r(5),i(),n(6,"span",102),r(7),i()(),m(8,"p-tag",103),i()(),m(9,"p-divider"),n(10,"div",73)(11,"div",104)(12,"div",105)(13,"h5",106),m(14,"i",107),r(15,"Demandeur "),i(),n(16,"p",108)(17,"strong"),r(18,"Nom:"),i(),r(19),i(),n(20,"p",108)(21,"strong"),r(22,"Agence:"),i(),r(23),i(),n(24,"p",108)(25,"strong"),r(26,"Point de vente:"),i(),r(27),i()()(),n(28,"div",104)(29,"div",105)(30,"h5",106),m(31,"i",5),r(32,"Quantit\xE9s "),i(),n(33,"p",108)(34,"strong"),r(35,"Demand\xE9e:"),i(),r(36),i(),n(37,"p",108)(38,"strong"),r(39,"Valid\xE9e:"),i(),n(40,"span",109),r(41),i()(),g(42,ra,5,1,"p",108),i()()(),m(43,"p-divider"),n(44,"div",73)(45,"div",104)(46,"p",108),m(47,"i",110),n(48,"strong"),r(49,"Cr\xE9ation:"),i(),r(50),i()(),n(51,"div",104)(52,"p",108),m(53,"i",111),n(54,"strong"),r(55,"Acceptation:"),i(),r(56),i()()(),g(57,la,6,1,"div",112)(58,sa,6,1,"div",113),i()),o&2){let e=d();l(5),u(e.selectedStock().numeroCommande),l(2),u(e.selectedStock().service),l(),p("value",e.getValidationLabel(e.selectedStock().stateValidation))("severity",e.getValidationSeverity(e.selectedStock().stateValidation)),l(11),C(" ",e.selectedStock().userFullName,""),l(4),C(" ",e.selectedStock().agenceLibele,""),l(4),C(" ",e.selectedStock().pointventeLibele||"-",""),l(9),C(" ",e.selectedStock().qte,""),l(5),u(e.selectedStock().qteSuggeree||e.selectedStock().qte),l(),_(e.selectedStock().motifQte?42:-1),l(8),C(" ",e.formatDate(e.selectedStock().dateCreation)," "),l(6),C(" ",e.formatDate(e.selectedStock().dateTraitement)," "),l(),_(e.selectedStock().detailBonCommande?57:-1),l(),_(e.selectedStock().observations?58:-1)}}function ca(o,t){if(o&1){let e=y();n(0,"p-button",119),f("onClick",function(){v(e);let s=d();return b(s.closeDetailDialog())}),i()}}function ma(o,t){if(o&1){let e=y();n(0,"div",16)(1,"div",120)(2,"p",108)(3,"strong"),r(4,"Commande :"),i(),r(5),i(),n(6,"p",108)(7,"strong"),r(8,"Service :"),i(),r(9),i(),n(10,"p",108)(11,"strong"),r(12,"D\xE9l\xE9gation :"),i(),r(13),i(),n(14,"p",108)(15,"strong"),r(16,"Quantit\xE9 :"),i(),r(17),i()(),n(18,"div",121),m(19,"i",122),n(20,"span"),r(21,"En validant, cette commande sera marqu\xE9e comme "),n(22,"strong"),r(23,"trait\xE9e"),i(),r(24," et dispara\xEEtra de votre liste."),i()(),n(25,"div",123)(26,"label",124),r(27,"Observations (optionnel)"),i(),n(28,"textarea",125),k("ngModelChange",function(s){v(e);let c=d();return A(c.validationObservations,s)||(c.validationObservations=s),b(s)}),r(29,"            "),i()()()}if(o&2){let e=d();l(5),C(" ",e.selectedStock().numeroCommande,""),l(4),C(" ",e.selectedStock().service,""),l(4),C(" ",e.selectedStock().delegationLibele,""),l(4),C(" ",e.selectedStock().qteSuggeree||e.selectedStock().qte,""),l(11),I("ngModel",e.validationObservations),p("disabled",e.processingAction())}}function pa(o,t){if(o&1){let e=y();n(0,"p-button",126),f("onClick",function(){v(e);let s=d();return b(s.closeValidationDialog())}),i(),n(1,"p-button",127),f("onClick",function(){v(e);let s=d();return b(s.confirmValidation())}),i()}if(o&2){let e=d();p("text",!0)("disabled",e.processingAction()),l(),p("disabled",e.processingAction())("loading",e.processingAction())}}var Tt=class o{user;Object=Object;userService=P(V);messageService=P(w);printService=P(Dt);confirmationService=P(Z);stocks=E([]);loading=E(!1);expandedRows=E({});processingAction=E(!1);showValidationDialog=E(!1);validationObservations=E("");searchTerm=E("");selectedDelegation=E(null);showDetailDialog=E(!1);selectedStock=E(null);delegations=O(()=>{let t=[...new Set(this.stocks().map(e=>e.delegationLibele).filter(Boolean))];return[{label:"Toutes les d\xE9l\xE9gations",value:null},...t.map(e=>({label:e,value:e}))]});filteredStocks=O(()=>{let t=this.stocks();this.selectedDelegation()&&(t=t.filter(a=>a.delegationLibele===this.selectedDelegation()));let e=this.searchTerm().toLowerCase();return e&&(t=t.filter(a=>a.numeroCommande?.toLowerCase().includes(e)||a.service?.toLowerCase().includes(e)||a.userFullName?.toLowerCase().includes(e)||a.delegationLibele?.toLowerCase().includes(e)||a.agenceLibele?.toLowerCase().includes(e))),t});totalCommandes=O(()=>this.filteredStocks().length);totalQuantite=O(()=>this.filteredStocks().reduce((t,e)=>t+(e.qteSuggeree||e.qte||0),0));ngOnInit(){this.loadStockAcceptes()}loadStockAcceptes(){this.loading.set(!0),this.userService.getStockAcceptesPourLogistique$().pipe(Ke(t=>(console.error("Erreur lors du chargement des bons accept\xE9s:",t),this.showError("Erreur lors du chargement des bons de commande"),Ye({data:{stocks:[]}})))).subscribe(t=>{console.log("Bons accept\xE9s pour logistique:",t),t?.data?.stocks?(this.stocks.set(t.data.stocks),this.showSuccess(`${t.data.stocks.length} bon(s) de commande pr\xEAt(s) pour traitement`)):this.stocks.set([]),this.loading.set(!1)})}showSuccess(t){this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:t,life:3e3})}showError(t){this.messageService.add({severity:"error",summary:"Erreur",detail:t,life:5e3})}toggleRow(t){let e=this.expandedRows(),a=t.idCmd?.toString()||"";this.expandedRows.set(S(h({},e),{[a]:!e[a]}))}isExpanded(t){return this.expandedRows()[t.idCmd?.toString()||""]||!1}parseDetails(t){try{return t?JSON.parse(t):null}catch{return{detailStandard:t}}}getStatusSeverity(t){return{ENCOURS:"warn",TERMINE:"success",ANNULE:"danger",EN_ATTENTE:"info",VALIDE:"success",ACCEPTE:"success"}[t]||"secondary"}getStatusLabel(t){return{ENCOURS:"En cours",TERMINE:"Termin\xE9",ANNULE:"Annul\xE9",EN_ATTENTE:"En attente",VALIDE:"Valid\xE9 DR",ACCEPTE:"Accept\xE9 DE"}[t]||t}getValidationSeverity(t){switch(t){case"ACCEPTE":return"success";case"VALIDE":return"info";case"REFUSE":return"danger";default:return"warn"}}getValidationLabel(t){return{ACCEPTE:"Accept\xE9 par DE",VALIDE:"Valid\xE9 par DR",REFUSE:"Refus\xE9",EN_ATTENTE:"En attente"}[t]||t}formatDate(t){if(!t)return"-";if(Array.isArray(t)){let[e,a,s,c=0,x=0]=t;return new Date(e,a-1,s,c,x).toLocaleString("fr-FR")}return typeof t=="string"?new Date(t).toLocaleString("fr-FR"):"-"}openDetailDialog(t){this.selectedStock.set(t),this.showDetailDialog.set(!0)}closeDetailDialog(){this.showDetailDialog.set(!1),this.selectedStock.set(null)}printRapportSynthese(){if(this.filteredStocks().length===0){this.showError("Aucune commande \xE0 imprimer");return}this.printService.imprimerRapportLogistique(this.filteredStocks(),{includeSignature:!0,includeDetails:!1,autoClose:!1,companyName:"DIRECTION LOGISTIQUE"})}printRapportComplet(){if(this.filteredStocks().length===0){this.showError("Aucune commande \xE0 imprimer");return}this.printService.imprimerRapportLogistique(this.filteredStocks(),{includeSignature:!0,includeDetails:!0,autoClose:!1,companyName:"DIRECTION LOGISTIQUE"})}printCommande(t){this.printService.imprimerRapportLogistique([t],{includeSignature:!0,includeDetails:!0,autoClose:!1,companyName:"DIRECTION LOGISTIQUE"})}getCurrentDate(){return new Date().toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}openValidationDialog(t){this.selectedStock.set(t),this.validationObservations.set(""),this.showValidationDialog.set(!0)}closeValidationDialog(){this.showValidationDialog.set(!1),this.selectedStock.set(null),this.validationObservations.set("")}confirmValidation(){let t=this.selectedStock();t&&this.confirmationService.confirm({message:`\xCAtes-vous s\xFBr de vouloir valider la commande ${t.numeroCommande} ?
Cette action est d\xE9finitive et le bon dispara\xEEtra de votre liste.`,header:"Confirmation de traitement",icon:"pi pi-check-circle",acceptLabel:"Valider",rejectLabel:"Annuler",acceptButtonStyleClass:"p-button-success",accept:()=>{this.executeValidation(t)}})}executeValidation(t){this.processingAction.set(!0),this.userService.validationLogistique$(t.idCmd,this.validationObservations()||void 0).subscribe({next:e=>{this.showSuccess(`Commande ${t.numeroCommande} trait\xE9e avec succ\xE8s`),this.closeValidationDialog(),this.loadStockAcceptes()},error:e=>{console.error("Erreur validation logistique:",e),this.showError(e.error?.message||"Erreur lors du traitement de la commande")},complete:()=>{this.processingAction.set(!1)}})}quickValidate(t){this.confirmationService.confirm({message:`Valider la commande ${t.numeroCommande} ?
Le bon sera marqu\xE9 comme trait\xE9 et dispara\xEEtra de votre liste.`,header:"Confirmation rapide",icon:"pi pi-check",acceptLabel:"Oui, valider",rejectLabel:"Annuler",acceptButtonStyleClass:"p-button-success",accept:()=>{this.processingAction.set(!0),this.userService.validationLogistique$(t.idCmd).subscribe({next:()=>{this.showSuccess(`Commande ${t.numeroCommande} trait\xE9e`),this.loadStockAcceptes()},error:e=>{this.showError(e.error?.message||"Erreur lors du traitement")},complete:()=>{this.processingAction.set(!1)}})}})}getCommandesParDelegation(){let t=new Map;return this.filteredStocks().forEach(e=>{let a=e.delegationLibele||"Non sp\xE9cifi\xE9e",s=t.get(a)||{count:0,quantite:0};t.set(a,{count:s.count+1,quantite:s.quantite+(e.qteSuggeree||e.qte||0)})}),Array.from(t.entries()).map(([e,a])=>({delegation:e,count:a.count,quantite:a.quantite})).sort((e,a)=>a.count-e.count)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=D({type:o,selectors:[["app-logistique"]],inputs:{user:"user"},features:[G([w,Z])],decls:23,vars:24,consts:[[1,"logistique-container"],["position","top-right"],["styleClass","header-card mb-4"],[1,"flex","justify-content-between","align-items-center","flex-wrap","gap-3"],[1,"text-2xl","font-bold","text-primary","m-0","mb-2"],[1,"pi","pi-box","mr-2"],[1,"text-600","m-0"],[1,"flex","gap-2"],["icon","pi pi-refresh","label","Actualiser",3,"onClick","outlined","loading"],["icon","pi pi-print","label","Imprimer","severity","secondary","pTooltip","Imprimer le rapport synth\xE9tique",3,"onClick","disabled"],[1,"grid","mb-4"],[1,"flex","justify-content-center","align-items-center",2,"min-height","300px"],["header","D\xE9tails de la commande",3,"visibleChange","visible","modal","draggable","resizable","closable"],[1,"detail-dialog-content"],["pTemplate","footer"],["header","Validation de la commande",3,"visibleChange","visible","modal","draggable","resizable","closable"],[1,"validation-dialog-content"],[1,"col-12","md:col-4"],[1,"stat-card","stat-total"],[1,"stat-icon"],[1,"pi","pi-list"],[1,"stat-content"],[1,"stat-value"],[1,"stat-label"],[1,"stat-card","stat-quantity"],[1,"pi","pi-box"],[1,"stat-card","stat-delegations"],[1,"pi","pi-map-marker"],[1,"text-center"],[1,"mt-3","text-600"],["pTemplate","header"],["styleClass","p-datatable-striped p-datatable-gridlines","currentPageReportTemplate","Affichage {first} \xE0 {last} sur {totalRecords} commandes",3,"value","tableStyle","paginator","rows","rowsPerPageOptions","showCurrentPageReport"],[1,"empty-state-large"],["styleClass","mt-4"],[1,"p-4","border-bottom-1","surface-border"],[1,"m-0","text-xl","font-semibold"],[1,"pi","pi-check-circle","mr-2","text-green-500"],[1,"flex","gap-2","flex-wrap","align-items-center"],[1,"p-input-icon-left"],[1,"pi","pi-search"],["pInputText","","type","text","placeholder","Rechercher...",3,"ngModelChange","ngModel"],["optionLabel","label","optionValue","value","placeholder","Filtrer par d\xE9l\xE9gation",3,"ngModelChange","options","ngModel"],[1,"flex","gap-1","ml-2"],["icon","pi pi-file","severity","info","size","small","pTooltip","Rapport synth\xE9tique",3,"onClick","outlined","disabled"],["icon","pi pi-file-pdf","severity","danger","size","small","pTooltip","Rapport complet avec d\xE9tails",3,"onClick","outlined","disabled"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","summary"],[2,"width","3%"],[2,"width","12%"],[1,"text-center",2,"width","8%"],[1,"text-center",2,"width","10%"],["pButton","","type","button",1,"p-button-text","p-button-rounded","p-button-sm",3,"click","icon"],[1,"font-bold","text-primary"],[1,"service-badge"],[1,"delegation-badge"],[1,"pi","pi-map-marker","mr-1"],[1,"flex","flex-column"],[1,"font-semibold"],[1,"text-500"],[1,"quantity-display"],[1,"quantity-normal"],[3,"value","severity"],[1,"text-sm"],[1,"flex","gap-1","justify-content-center"],["pButton","","type","button","icon","pi pi-eye","pTooltip","Voir les d\xE9tails",1,"p-button-info","p-button-rounded","p-button-sm",3,"click"],["pButton","","type","button","icon","pi pi-print","pTooltip","Imprimer cette commande",1,"p-button-secondary","p-button-rounded","p-button-sm",3,"click"],["pButton","","type","button","icon","pi pi-check","pTooltip","Valider - Marquer comme trait\xE9",1,"p-button-success","p-button-rounded","p-button-sm",3,"click","disabled"],[1,"quantity-original"],[1,"pi","pi-arrow-right","mx-1","text-orange-500"],[1,"quantity-suggested"],["colspan","9"],[1,"detail-container"],[1,"grid"],[1,"detail-section"],[1,"detail-title"],[1,"pi","pi-info-circle"],[1,"detail-item"],[1,"label"],[1,"value"],[1,"observations-section","mt-3"],[1,"value","text-green-600","font-bold"],[1,"value","text-orange-600"],[1,"pi","pi-comment"],[1,"observations-text"],["colspan","9",1,"text-center","p-5"],[1,"empty-state"],[1,"pi","pi-inbox","text-5xl","text-400","mb-3"],[1,"text-400"],[1,"flex","justify-content-between","align-items-center"],[1,"pi","pi-check-circle","text-6xl","text-green-300","mb-4"],[1,"text-600","mb-2"],["icon","pi pi-refresh","label","Actualiser",1,"mt-3",3,"onClick","outlined"],[1,"col-12","md:col-6","lg:col-4","xl:col-3"],[1,"pi","pi-chart-bar","mr-2","text-primary"],[1,"delegation-summary-card",3,"click"],[1,"delegation-name"],[1,"pi","pi-map-marker","mr-2"],[1,"delegation-stats"],[1,"stat"],[1,"dialog-header-section","mb-4"],[1,"m-0","text-primary"],[1,"text-600"],["styleClass","text-lg px-3",3,"value","severity"],[1,"col-12","md:col-6"],[1,"info-group"],[1,"text-primary","mb-3"],[1,"pi","pi-user","mr-2"],[1,"mb-2"],[1,"text-green-600","font-bold"],[1,"pi","pi-calendar-plus","text-blue-500","mr-2"],[1,"pi","pi-calendar-check","text-green-500","mr-2"],[1,"detail-box","mt-3"],[1,"observations-box","mt-3"],[1,"text-orange-600"],[1,"text-primary","mb-2"],[1,"pi","pi-file-edit","mr-2"],[1,"m-0"],[1,"pi","pi-comment","mr-2"],["label","Fermer","icon","pi pi-times","severity","secondary",3,"onClick"],[1,"info-section","mb-3"],[1,"alert-info","mb-3"],[1,"pi","pi-info-circle","mr-2"],[1,"field"],["for","validation-obs"],["pTextarea","","id","validation-obs","rows","3","placeholder","Ajoutez des observations sur le traitement...",1,"w-full",3,"ngModelChange","ngModel","disabled"],["label","Annuler","icon","pi pi-times","severity","secondary",3,"onClick","text","disabled"],["label","Valider la commande","icon","pi pi-check","severity","success",3,"onClick","disabled","loading"]],template:function(e,a){e&1&&(n(0,"div",0),m(1,"p-toast",1),n(2,"p-card",2)(3,"div",3)(4,"div")(5,"h2",4),m(6,"i",5),r(7," Gestion Logistique - Bons Accept\xE9s "),i(),n(8,"p",6),r(9," Bons de commande valid\xE9s par le DE, pr\xEAts pour traitement "),i()(),n(10,"div",7)(11,"p-button",8),f("onClick",function(){return a.loadStockAcceptes()}),i(),n(12,"p-button",9),f("onClick",function(){return a.printRapportSynthese()}),i()()()(),g(13,qo,28,3,"div",10)(14,zo,5,0,"div",11)(15,aa,5,2),i(),n(16,"p-dialog",12),k("visibleChange",function(c){return A(a.showDetailDialog,c)||(a.showDetailDialog=c),c}),g(17,da,59,14,"div",13)(18,ca,1,0,"ng-template",14),i(),m(19,"p-confirmDialog"),n(20,"p-dialog",15),k("visibleChange",function(c){return A(a.showValidationDialog,c)||(a.showValidationDialog=c),c}),g(21,ma,30,6,"div",16)(22,pa,2,4,"ng-template",14),i()),e&2&&(l(11),p("outlined",!0)("loading",a.loading()),l(),p("disabled",a.filteredStocks().length===0),l(),_(a.loading()?-1:13),l(),_(a.loading()?14:-1),l(),_(a.loading()?-1:15),l(),X(M(22,Ro)),I("visible",a.showDetailDialog),p("modal",!0)("draggable",!1)("resizable",!1)("closable",!0),l(),_(a.selectedStock()?17:-1),l(3),X(M(23,Lo)),I("visible",a.showValidationDialog),p("modal",!0)("draggable",!1)("resizable",!1)("closable",!a.processingAction()),l(),_(a.selectedStock()?21:-1))},dependencies:[j,ie,Le,te,ne,Wt,F,ae,ue,N,W,ge,q,$,z,J,Y,Q,K,U,le,ut,nn,Oe,mt,ct,$e,an,H,re,ye,Me,je,rt,dt,st,fe,_e,vt,xt],styles:[".logistique-container[_ngcontent-%COMP%]{padding:2rem;min-height:100vh}.logistique-container[_ngcontent-%COMP%]   .header-card[_ngcontent-%COMP%]{background:linear-gradient(135deg,#22c55e,#16a34a)}.logistique-container[_ngcontent-%COMP%]   .header-card[_ngcontent-%COMP%]     .p-card-body{padding:1.5rem}.logistique-container[_ngcontent-%COMP%]   .header-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .logistique-container[_ngcontent-%COMP%]   .header-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#fff}.logistique-container[_ngcontent-%COMP%]   .header-card[_ngcontent-%COMP%]     .p-button-outlined{border-color:#fff;color:#fff}.logistique-container[_ngcontent-%COMP%]   .header-card[_ngcontent-%COMP%]     .p-button-outlined:hover{background:#ffffff1a}.stat-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1.5rem;border-radius:12px;background:#fff;box-shadow:0 2px 8px #00000014;transition:transform .2s,box-shadow .2s}.stat-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 12px #0000001f}.stat-card[_ngcontent-%COMP%]   .stat-icon[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:12px;display:flex;align-items:center;justify-content:center}.stat-card[_ngcontent-%COMP%]   .stat-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.75rem;color:#fff}.stat-card[_ngcontent-%COMP%]   .stat-content[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;line-height:1;margin-bottom:.25rem}.stat-card[_ngcontent-%COMP%]   .stat-content[_ngcontent-%COMP%]   .stat-label[_ngcontent-%COMP%]{font-size:.875rem;color:#6b7280}.stat-card.stat-total[_ngcontent-%COMP%]   .stat-icon[_ngcontent-%COMP%]{background:linear-gradient(135deg,#3b82f6,#2563eb)}.stat-card.stat-total[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#2563eb}.stat-card.stat-quantity[_ngcontent-%COMP%]   .stat-icon[_ngcontent-%COMP%]{background:linear-gradient(135deg,#22c55e,#16a34a)}.stat-card.stat-quantity[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#16a34a}.stat-card.stat-delegations[_ngcontent-%COMP%]   .stat-icon[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f59e0b,#d97706)}.stat-card.stat-delegations[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#d97706}.service-badge[_ngcontent-%COMP%]{background:#e0e7ff;color:#4338ca;padding:.25rem .75rem;border-radius:20px;font-size:.8rem;font-weight:600}.delegation-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;background:#fef3c7;color:#d97706;padding:.25rem .75rem;border-radius:20px;font-size:.8rem;font-weight:600}.delegation-badge[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.75rem}.quantity-display[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.25rem}.quantity-display[_ngcontent-%COMP%]   .quantity-original[_ngcontent-%COMP%]{text-decoration:line-through;color:#9ca3af;font-size:.875rem}.quantity-display[_ngcontent-%COMP%]   .quantity-suggested[_ngcontent-%COMP%]{font-weight:700;color:#22c55e;font-size:1.125rem}.quantity-display[_ngcontent-%COMP%]   .quantity-normal[_ngcontent-%COMP%]{font-weight:600;font-size:1rem}.row-expanded[_ngcontent-%COMP%]{background-color:#f0fdf4!important}.detail-container[_ngcontent-%COMP%]{padding:1.5rem;background:#f8fafc;border-radius:8px;animation:_ngcontent-%COMP%_slideDown .3s ease-out}@keyframes _ngcontent-%COMP%_slideDown{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.detail-section[_ngcontent-%COMP%]{background:#fff;padding:1rem;border-radius:8px;box-shadow:0 1px 3px #0000000d;height:100%}.detail-section[_ngcontent-%COMP%]   .detail-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;color:#374151;font-weight:600;font-size:.9rem;margin-bottom:.75rem;padding-bottom:.5rem;border-bottom:2px solid #e5e7eb}.detail-section[_ngcontent-%COMP%]   .detail-title[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#22c55e}.detail-section[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:.4rem 0;font-size:.875rem}.detail-section[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:#6b7280}.detail-section[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-weight:500;color:#1f2937;text-align:right}.observations-section[_ngcontent-%COMP%]{background:#fff;padding:1rem;border-radius:8px;border-left:4px solid #22c55e}.observations-section[_ngcontent-%COMP%]   .detail-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;color:#374151;font-weight:600;font-size:.9rem;margin-bottom:.5rem}.observations-section[_ngcontent-%COMP%]   .detail-title[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#22c55e}.observations-section[_ngcontent-%COMP%]   .observations-text[_ngcontent-%COMP%]{margin:0;color:#4b5563;font-size:.875rem;font-style:italic}.empty-state[_ngcontent-%COMP%]{padding:2rem}.empty-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{display:block}.empty-state-large[_ngcontent-%COMP%]{text-align:center;padding:4rem 2rem}.empty-state-large[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{display:block}.delegation-summary-card[_ngcontent-%COMP%]{background:#fff;border:1px solid #e5e7eb;border-radius:10px;padding:1rem;cursor:pointer;transition:all .2s}.delegation-summary-card[_ngcontent-%COMP%]:hover{border-color:#22c55e;box-shadow:0 4px 12px #22c55e26;transform:translateY(-2px)}.delegation-summary-card[_ngcontent-%COMP%]   .delegation-name[_ngcontent-%COMP%]{font-weight:600;color:#374151;margin-bottom:.5rem;display:flex;align-items:center}.delegation-summary-card[_ngcontent-%COMP%]   .delegation-name[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#22c55e}.delegation-summary-card[_ngcontent-%COMP%]   .delegation-stats[_ngcontent-%COMP%]{display:flex;gap:1rem}.delegation-summary-card[_ngcontent-%COMP%]   .delegation-stats[_ngcontent-%COMP%]   .stat[_ngcontent-%COMP%]{font-size:.875rem;color:#6b7280}.delegation-summary-card[_ngcontent-%COMP%]   .delegation-stats[_ngcontent-%COMP%]   .stat[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#22c55e}.detail-dialog-content[_ngcontent-%COMP%]   .dialog-header-section[_ngcontent-%COMP%]{background:#f8fafc;padding:1rem;border-radius:8px}.detail-dialog-content[_ngcontent-%COMP%]   .info-group[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:1rem}.detail-dialog-content[_ngcontent-%COMP%]   .info-group[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9rem;color:#4b5563}.detail-dialog-content[_ngcontent-%COMP%]   .detail-box[_ngcontent-%COMP%]{background:#f8fafc;padding:1rem;border-radius:8px;border:1px solid #e5e7eb}.detail-dialog-content[_ngcontent-%COMP%]   .detail-box[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.9rem}.detail-dialog-content[_ngcontent-%COMP%]   .detail-box[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#4b5563;font-size:.875rem}.detail-dialog-content[_ngcontent-%COMP%]   .observations-box[_ngcontent-%COMP%]{background:#fef3c7;padding:1rem;border-radius:8px;border-left:4px solid #f59e0b}.detail-dialog-content[_ngcontent-%COMP%]   .observations-box[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.9rem}.detail-dialog-content[_ngcontent-%COMP%]   .observations-box[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#92400e;font-size:.875rem;font-style:italic}.validation-dialog-content[_ngcontent-%COMP%]   .info-section[_ngcontent-%COMP%]{background:#f8fafc;padding:1rem;border-radius:8px}.validation-dialog-content[_ngcontent-%COMP%]   .info-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:.9rem;color:#4b5563}.validation-dialog-content[_ngcontent-%COMP%]   .alert-info[_ngcontent-%COMP%]{background:#dbeafe;color:#1e40af;padding:.75rem 1rem;border-radius:8px;border-left:4px solid #3b82f6;display:flex;align-items:center;font-size:.875rem}@media screen and (max-width: 768px){.logistique-container[_ngcontent-%COMP%], .stat-card[_ngcontent-%COMP%]{padding:1rem}.stat-card[_ngcontent-%COMP%]   .stat-icon[_ngcontent-%COMP%]{width:50px;height:50px}.stat-card[_ngcontent-%COMP%]   .stat-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .stat-card[_ngcontent-%COMP%]   .stat-content[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{font-size:1.5rem}}.print-view[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#e9ecef;z-index:9999;overflow-y:auto}.print-view[_ngcontent-%COMP%]   .print-header[_ngcontent-%COMP%]{position:sticky;top:0;z-index:100;padding:1rem;background-color:#e9ecef}.print-view[_ngcontent-%COMP%]   .print-content[_ngcontent-%COMP%]{padding:2rem;max-width:1400px;margin:0 auto}.print-view[_ngcontent-%COMP%]   .print-content[_ngcontent-%COMP%]   .print-page[_ngcontent-%COMP%]{min-height:calc(100vh - 6rem)}.print-view[_ngcontent-%COMP%]   .page-break-avoid[_ngcontent-%COMP%]{page-break-inside:avoid;break-inside:avoid}@media print{body[_ngcontent-%COMP%]{background:#fff!important}.no-print[_ngcontent-%COMP%]{display:none!important}.print-view[_ngcontent-%COMP%]{position:static;background-color:#fff;overflow:visible}.print-view[_ngcontent-%COMP%]   .print-header[_ngcontent-%COMP%]{display:none!important}.print-view[_ngcontent-%COMP%]   .print-content[_ngcontent-%COMP%]{padding:0;max-width:100%}.print-view[_ngcontent-%COMP%]   .print-content[_ngcontent-%COMP%]   .print-page[_ngcontent-%COMP%]{box-shadow:none!important;border-radius:0!important;min-height:auto}.page-break-avoid[_ngcontent-%COMP%]{page-break-inside:avoid;break-inside:avoid}*[_ngcontent-%COMP%]{-webkit-print-color-adjust:exact!important;print-color-adjust:exact!important;color-adjust:exact!important}.shadow-1[_ngcontent-%COMP%], .shadow-2[_ngcontent-%COMP%], .shadow-3[_ngcontent-%COMP%]{box-shadow:none!important}.border-round[_ngcontent-%COMP%]{border-radius:8px!important}.surface-card[_ngcontent-%COMP%]{border:1px solid #dee2e6!important;page-break-inside:avoid}h1[_ngcontent-%COMP%], h2[_ngcontent-%COMP%], h3[_ngcontent-%COMP%], h4[_ngcontent-%COMP%], h5[_ngcontent-%COMP%], h6[_ngcontent-%COMP%]{page-break-after:avoid}.grid[_ngcontent-%COMP%]{page-break-inside:avoid}}"],data:{animation:[nt("rowExpand",[Ve("collapsed",ke({height:"0px",minHeight:"0",display:"none"})),Ve("expanded",ke({height:"*"})),ot("expanded <=> collapsed",it("225ms cubic-bezier(0.4, 0.0, 0.2, 1)"))])]}})};var ua=()=>[10,25,50],ga=()=>["nom","prenom","numeroMembre","descriptionActivite"],_a=o=>["/dashboards/credit/individuel/attente/detail",o];function fa(o,t){if(o&1&&(n(0,"div",7)(1,"div",12)(2,"div",13)(3,"div",14),m(4,"i",15),i(),n(5,"div")(6,"div",16),r(7,"D\xE9l\xE9gations"),i(),n(8,"div",17),r(9),i()()()(),n(10,"div",18)(11,"div",13)(12,"div",19),m(13,"i",20),i(),n(14,"div")(15,"div",16),r(16,"Total Demandes"),i(),n(17,"div",17),r(18),i()()()(),n(19,"div",21)(20,"div",13)(21,"div",22),m(22,"i",23),i(),n(23,"div")(24,"div",16),r(25,"Montant Global"),i(),n(26,"div",17),r(27),L(28,"currency"),i()()()()()),o&2){let e=d();l(9),C(" ",e.state().delegations.length," "),l(9),C(" ",e.state().totalDemandes," "),l(9),C(" ",Xe(28,3,e.state().montantGlobal,"GNF ","symbol","1.0-0")," ")}}function Ca(o,t){o&1&&(n(0,"div",8),m(1,"p-progressSpinner",24),i())}function xa(o,t){if(o&1&&m(0,"p-message",9),o&2){let e=d();p("text",e.state().error)}}function va(o,t){o&1&&(n(0,"tr")(1,"th"),r(2,"R\xE9f\xE9rence"),i(),n(3,"th"),r(4,"Client"),i(),n(5,"th"),r(6,"N\xB0 Membre"),i(),n(7,"th"),r(8,"Montant"),i(),n(9,"th"),r(10,"Dur\xE9e"),i(),n(11,"th"),r(12,"Activit\xE9"),i(),n(13,"th"),r(14,"Statut"),i(),n(15,"th"),r(16,"Date"),i(),n(17,"th",35),r(18,"Actions"),i()())}function ba(o,t){if(o&1&&(n(0,"tr")(1,"td")(2,"span",36),r(3),i()(),n(4,"td")(5,"div",2)(6,"span",37),r(7),i(),n(8,"span",38),r(9),i()()(),n(10,"td")(11,"span",39),r(12),i()(),n(13,"td")(14,"span",40),r(15),L(16,"currency"),i()(),n(17,"td"),r(18),i(),n(19,"td")(20,"span",41),r(21),L(22,"slice"),i()(),n(23,"td"),m(24,"p-tag",28),i(),n(25,"td")(26,"span",42),r(27),i()(),n(28,"td",35)(29,"div",43),m(30,"p-button",44)(31,"p-button",45),i()()()),o&2){let e=t.$implicit,a=d(3);l(3),u(e.demandeIndividuelId),l(4),T("",e.prenom," ",e.nom,""),l(2),u(e.telephone),l(3),u(e.numeroMembre),l(3),C(" ",Xe(16,17,e.montantDemande,"GNF ","symbol","1.0-0")," "),l(3),C("",e.dureeDemande," mois"),l(2),p("pTooltip",e.descriptionActivite),l(),C(" ",$t(22,22,e.typeActivite||e.descriptionActivite,0,20),"... "),l(3),p("value",a.getStatusLabel(e.statutDemande,e.validationState))("severity",a.getStatusSeverity(e.statutDemande,e.validationState)),l(3),u(a.formatDate(e.createdAt)),l(3),p("routerLink",Je(26,_a,e.demandeIndividuelId))("rounded",!0)("text",!0),l(),p("rounded",!0)("text",!0)}}function ha(o,t){o&1&&(n(0,"tr")(1,"td",46),m(2,"i",47),n(3,"p",48),r(4,"Aucune demande pour cette d\xE9l\xE9gation"),i()()())}function Sa(o,t){if(o&1&&(n(0,"p-accordion-panel")(1,"p-accordion-header")(2,"div",25)(3,"div",13),m(4,"i",26),n(5,"span",27),r(6),i()(),n(7,"div",13),m(8,"p-tag",28),n(9,"span",29),r(10),L(11,"currency"),i()()()(),n(12,"p-accordion-content")(13,"div",30)(14,"p-table",31),g(15,va,19,0,"ng-template",32)(16,ba,32,28,"ng-template",33)(17,ha,5,0,"ng-template",34),i()()()()),o&2){let e=t.$implicit,a=d(2);l(6),u(e.delegationLibele),l(2),p("value",e.totalDemandes+" demande(s)")("severity",a.getDelegationSeverity(e.totalDemandes)),l(2),C(" ",Xe(11,10,e.montantTotal,"GNF ","symbol","1.0-0")," "),l(4),p("value",e.demandes)("paginator",e.demandes.length>10)("rows",10)("rowsPerPageOptions",M(15,ua))("globalFilterFields",M(16,ga))("rowHover",!0)}}function ya(o,t){if(o&1&&(n(0,"p-accordion",10),me(1,Sa,18,17,"p-accordion-panel",null,jt().trackByDelegation,!0),i()),o&2){let e=d();p("multiple",!0),l(),pe(e.state().delegations)}}function Ea(o,t){o&1&&(n(0,"div",11),m(1,"i",49),n(2,"p",50),r(3,"Aucune demande de cr\xE9dit trouv\xE9e"),i(),n(4,"p",51),r(5,"Les demandes en attente appara\xEEtront ici"),i()())}var He=class o{state=E({delegations:[],loading:!1,message:void 0,error:void 0,totalDemandes:0,montantGlobal:0});userService=P(V);destroyRef=P(oe);ngOnInit(){this.loadCreditParDelegation()}loadCreditParDelegation(){this.state.update(t=>S(h({},t),{loading:!0,error:void 0})),this.userService.getListCreditParDelegation$().pipe(B(this.destroyRef)).subscribe({next:t=>{let e=t.data.listCreditParDelegation||[],a=e.reduce((c,x)=>c+x.totalDemandes,0),s=e.reduce((c,x)=>c+(x.montantTotal||0),0);this.state.update(c=>S(h({},c),{delegations:e,totalDemandes:a,montantGlobal:s,loading:!1,message:t.message,error:void 0}))},error:t=>{this.state.update(e=>S(h({},e),{loading:!1,message:void 0,error:t}))}})}getStatusLabel(t,e){return t==="EN_ATTENTE"&&e==="NOUVEAU"?"NOUVELLE DEMANDE":t==="EN_ATTENTE"&&e==="SELECTION"?"S\xC9LECTION":t==="EN_ATTENTE"&&e==="APPROVED"?"EN COURS DE VALIDATION":t}getStatusSeverity(t,e){if(t==="EN_ATTENTE"&&e==="APPROVED")return"warn";if(t==="EN_ATTENTE"&&e==="NOUVEAU")return"info";if(t==="EN_ATTENTE"&&e==="SELECTION")return"secondary";if(t==="REJECTED")return"danger";if(t==="APPROVED")return"success"}getDelegationSeverity(t){return t>=10?"danger":t>=5?"warn":t>=1?"info":"success"}formatDate(t){return t?new Date(t).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-"}refreshData(){this.loadCreditParDelegation()}trackByDelegation(t,e){return e.delegationId}trackByDemande(t,e){return e.demandeIndividuelId||t}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=D({type:o,selectors:[["app-credit-par-delegation"]],features:[G([w])],decls:14,vars:5,consts:[[1,"card"],[1,"flex","flex-col","md:flex-row","justify-between","items-start","md:items-center","gap-4","mb-4"],[1,"flex","flex-col"],[1,"text-surface-900","dark:text-surface-0","text-2xl","font-semibold","mb-2"],[1,"text-surface-600","dark:text-surface-200"],[1,"flex","gap-2"],["icon","pi pi-refresh","label","Actualiser","severity","secondary",3,"onClick","loading"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","mb-4"],[1,"flex","justify-center","items-center","py-8"],["severity","error","styleClass","w-full mb-4",3,"text"],[3,"multiple"],[1,"flex","flex-col","items-center","justify-center","py-12"],[1,"bg-blue-50","dark:bg-blue-900/20","rounded-lg","p-4"],[1,"flex","items-center","gap-3"],[1,"bg-blue-500","rounded-full","p-3"],[1,"pi","pi-building","text-white","text-xl"],[1,"text-surface-600","dark:text-surface-300","text-sm"],[1,"text-2xl","font-bold","text-surface-900","dark:text-surface-0"],[1,"bg-green-50","dark:bg-green-900/20","rounded-lg","p-4"],[1,"bg-green-500","rounded-full","p-3"],[1,"pi","pi-file","text-white","text-xl"],[1,"bg-purple-50","dark:bg-purple-900/20","rounded-lg","p-4"],[1,"bg-purple-500","rounded-full","p-3"],[1,"pi","pi-wallet","text-white","text-xl"],["strokeWidth","4"],[1,"flex","justify-between","items-center","w-full","pr-4"],[1,"pi","pi-building","text-primary"],[1,"font-semibold","text-lg"],[3,"value","severity"],[1,"text-sm","text-surface-600","dark:text-surface-300"],[1,"p-2"],["responsiveLayout","scroll","styleClass","p-datatable-sm",3,"value","paginator","rows","rowsPerPageOptions","globalFilterFields","rowHover"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"text-center"],[1,"font-mono","text-sm"],[1,"font-medium"],[1,"text-xs","text-surface-500"],[1,"font-mono"],[1,"font-semibold","text-primary"],[1,"text-sm",3,"pTooltip"],[1,"text-sm"],[1,"flex","justify-center","gap-1"],["icon","pi pi-eye","severity","info","pTooltip","Voir d\xE9tails",3,"routerLink","rounded","text"],["icon","pi pi-check-circle","severity","success","pTooltip","Valider",3,"rounded","text"],["colspan","9",1,"text-center","py-4"],[1,"pi","pi-inbox","text-4xl","text-surface-300","mb-2"],[1,"text-surface-500"],[1,"pi","pi-folder-open","text-6xl","text-surface-300","mb-4"],[1,"text-xl","text-surface-500"],[1,"text-surface-400"]],template:function(e,a){e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),r(4," Liste des Cr\xE9dits par D\xE9l\xE9gation "),i(),n(5,"span",4),r(6," Vue consolid\xE9e des demandes de cr\xE9dit pour la mise en place "),i()(),n(7,"div",5)(8,"p-button",6),f("onClick",function(){return a.refreshData()}),i()()(),g(9,fa,29,8,"div",7)(10,Ca,2,0,"div",8)(11,xa,1,1,"p-message",9)(12,ya,3,1,"p-accordion",10)(13,Ea,6,0,"div",11),i()),e&2&&(l(8),p("loading",a.state().loading),l(),_(!a.state().loading&&a.state().delegations.length>0?9:-1),l(),_(a.state().loading?10:-1),l(),_(a.state().error?11:-1),l(),_(!a.state().loading&&a.state().delegations.length>0?12:a.state().loading?-1:13))},dependencies:[j,Bt,tt,bt,dn,N,rn,ln,sn,q,$,z,J,F,ue,U,$e,pt,W,ye,le,Ee,Pe,je,H,re,at],styles:["[_nghost-%COMP%]{display:block}.p-accordion-header-link[_ngcontent-%COMP%]{padding:1rem 1.25rem}"]})};var It=class o{user;CreditParDelegationComponent=He;static \u0275fac=function(e){return new(e||o)};static \u0275cmp=D({type:o,selectors:[["app-de"]],inputs:{user:"user"},decls:2,vars:0,consts:[[1,"de-container"]],template:function(e,a){e&1&&(n(0,"div",0),m(1,"app-credit-par-delegation"),i())},dependencies:[He],encapsulation:2})};var hn=()=>({"min-width":"100%"}),Pa=(o,t)=>t.periode;function Ma(o,t){if(o&1&&(n(0,"div",31),m(1,"i"),r(2),i()),o&2){let e=d(2);p("ngClass",e.getVariationClass(e.summaryStats().variations.enAttente)),l(),de(e.getVariationIcon(e.summaryStats().variations.enAttente)),l(),C(" ",e.formatVariation(e.summaryStats().variations.enAttente)," ")}}function Oa(o,t){if(o&1&&(n(0,"div",31),m(1,"i"),r(2),i()),o&2){let e=d(2);p("ngClass",e.getVariationClass(e.summaryStats().variations.rejete)),l(),de(e.getVariationIcon(e.summaryStats().variations.rejete)),l(),C(" ",e.formatVariation(e.summaryStats().variations.rejete)," ")}}function wa(o,t){if(o&1&&(n(0,"div",31),m(1,"i"),r(2),i()),o&2){let e=d(2);p("ngClass",e.getVariationClass(e.summaryStats().variations.valide)),l(),de(e.getVariationIcon(e.summaryStats().variations.valide)),l(),C(" ",e.formatVariation(e.summaryStats().variations.valide)," ")}}function Da(o,t){if(o&1&&(n(0,"div",31),m(1,"i"),r(2),i()),o&2){let e=d(2);p("ngClass",e.getVariationClass(e.summaryStats().variations.total)),l(),de(e.getVariationIcon(e.summaryStats().variations.total)),l(),C(" ",e.formatVariation(e.summaryStats().variations.total)," ")}}function Ta(o,t){if(o&1&&(n(0,"div",6)(1,"div",28)(2,"div",29),r(3,"En attente"),i(),n(4,"div",30),r(5),i(),g(6,Ma,3,4,"div",31),n(7,"div",32),r(8),i()(),n(9,"div",33)(10,"div",29),r(11,"Rejet\xE9es"),i(),n(12,"div",30),r(13),i(),g(14,Oa,3,4,"div",31),n(15,"div",32),r(16),i()(),n(17,"div",34)(18,"div",29),r(19,"Valid\xE9es"),i(),n(20,"div",30),r(21),i(),g(22,wa,3,4,"div",31),n(23,"div",32),r(24),i()(),n(25,"div",35)(26,"div",29),r(27,"Total"),i(),n(28,"div",30),r(29),i(),g(30,Da,3,4,"div",31),n(31,"div",32),r(32),i()()()),o&2){let e=d();l(5),u(e.summaryStats().current.enAttente),l(),_(e.summaryStats().variations.enAttente!==null?6:-1),l(2),C("vs ",e.summaryStats().previous.enAttente," p\xE9riode pr\xE9c."),l(5),u(e.summaryStats().current.rejete),l(),_(e.summaryStats().variations.rejete!==null?14:-1),l(2),C("vs ",e.summaryStats().previous.rejete," p\xE9riode pr\xE9c."),l(5),u(e.summaryStats().current.valide),l(),_(e.summaryStats().variations.valide!==null?22:-1),l(2),C("vs ",e.summaryStats().previous.valide," p\xE9riode pr\xE9c."),l(5),u(e.summaryStats().current.total),l(),_(e.summaryStats().variations.total!==null?30:-1),l(2),C("vs ",e.summaryStats().previous.total," p\xE9riode pr\xE9c.")}}function Ia(o,t){if(o&1&&(n(0,"div",7),r(1),i()),o&2){let e=d();l(),u(e.chartError())}}function Aa(o,t){o&1&&(n(0,"div",8),m(1,"p-progressSpinner"),i())}function ka(o,t){if(o&1&&(n(0,"div",9),m(1,"p-chart",36),i()),o&2){let e=d();l(),p("data",e.chartData())("options",e.chartOptions)}}function Va(o,t){o&1&&(n(0,"th",41),r(1,"Var. Total"),i())}function Ra(o,t){if(o&1&&(n(0,"tr")(1,"th"),r(2,"P\xE9riode"),i(),n(3,"th",41),r(4,"En attente"),i(),n(5,"th",41),r(6,"Rejet\xE9es"),i(),n(7,"th",41),r(8,"Valid\xE9es"),i(),n(9,"th",41),r(10,"Total"),i(),g(11,Va,2,0,"th",41),i()),o&2){let e=d(2);l(11),_(e.showComparison?11:-1)}}function La(o,t){if(o&1&&(n(0,"span",43),r(1),i()),o&2){let e=d().$implicit;l(),C("(",e.enAttentePrev,")")}}function ja(o,t){if(o&1&&(n(0,"span",43),r(1),i()),o&2){let e=d().$implicit;l(),C("(",e.rejetePrev,")")}}function Na(o,t){if(o&1&&(n(0,"span",43),r(1),i()),o&2){let e=d().$implicit;l(),C("(",e.validePrev,")")}}function Fa(o,t){if(o&1&&(n(0,"span",43),r(1),i()),o&2){let e=d().$implicit;l(),C("(",e.totalPrev,")")}}function $a(o,t){if(o&1&&(n(0,"td",41)(1,"span",47),m(2,"i"),r(3),i()()),o&2){let e=d().$implicit,a=d(2);l(),p("ngClass",a.getVariationClass(e.totalVariation)),l(),de(a.getVariationIcon(e.totalVariation)),l(),C(" ",a.formatVariation(e.totalVariation)," ")}}function qa(o,t){if(o&1&&(n(0,"tr")(1,"td"),r(2),i(),n(3,"td",42),r(4),g(5,La,2,1,"span",43),i(),n(6,"td",44),r(7),g(8,ja,2,1,"span",43),i(),n(9,"td",45),r(10),g(11,Na,2,1,"span",43),i(),n(12,"td",46),r(13),g(14,Fa,2,1,"span",43),i(),g(15,$a,4,4,"td",41),i()),o&2){let e=t.$implicit,a=d(2);l(2),u(e.periode),l(2),C(" ",e.enAttente," "),l(),_(a.showComparison&&e.enAttentePrev!==null?5:-1),l(2),C(" ",e.rejete," "),l(),_(a.showComparison&&e.rejetePrev!==null?8:-1),l(2),C(" ",e.valide," "),l(),_(a.showComparison&&e.validePrev!==null?11:-1),l(2),C(" ",e.total," "),l(),_(a.showComparison&&e.totalPrev!==null?14:-1),l(),_(a.showComparison?15:-1)}}function za(o,t){if(o&1&&(n(0,"tr")(1,"td",48),r(2," Aucune donn\xE9e disponible "),i()()),o&2){let e=d(2);l(),Ze("colspan",e.showComparison?6:5)}}function Ba(o,t){if(o&1&&(n(0,"div",10)(1,"p-table",37),g(2,Ra,12,1,"ng-template",38)(3,qa,16,10,"ng-template",39)(4,za,3,1,"ng-template",40),i()()),o&2){let e=d();l(),p("value",e.evolutionData())("tableStyle",M(3,hn))("scrollable",!0)}}function Ua(o,t){if(o&1&&(n(0,"div",50)(1,"div",51),r(2),i(),n(3,"div",52)(4,"div",53)(5,"span",54),r(6,"En attente"),i(),n(7,"span",55),r(8),i(),n(9,"span",56),r(10,"vs"),i(),n(11,"span",57),r(12),i(),n(13,"span",58),r(14),i()(),n(15,"div",53)(16,"span",54),r(17,"Rejet\xE9es"),i(),n(18,"span",59),r(19),i(),n(20,"span",56),r(21,"vs"),i(),n(22,"span",57),r(23),i(),n(24,"span",58),r(25),i()(),n(26,"div",53)(27,"span",54),r(28,"Valid\xE9es"),i(),n(29,"span",60),r(30),i(),n(31,"span",56),r(32,"vs"),i(),n(33,"span",57),r(34),i(),n(35,"span",58),r(36),i()(),n(37,"div",61)(38,"span",54),r(39,"Total"),i(),n(40,"span",62),r(41),i(),n(42,"span",56),r(43,"vs"),i(),n(44,"span",57),r(45),i(),n(46,"span",58),r(47),i()()()()),o&2){let e,a,s,c,x=t.$implicit,R=d(2);l(2),u(x.periode),l(6),u(x.enAttente),l(4),u((e=x.enAttentePrev)!==null&&e!==void 0?e:"-"),l(),p("ngClass",R.getVariationClass(x.enAttenteVariation)),l(),C(" ",R.formatVariation(x.enAttenteVariation)," "),l(5),u(x.rejete),l(4),u((a=x.rejetePrev)!==null&&a!==void 0?a:"-"),l(),p("ngClass",R.getVariationClass(x.rejeteVariation)),l(),C(" ",R.formatVariation(x.rejeteVariation)," "),l(5),u(x.valide),l(4),u((s=x.validePrev)!==null&&s!==void 0?s:"-"),l(),p("ngClass",R.getVariationClass(x.valideVariation)),l(),C(" ",R.formatVariation(x.valideVariation)," "),l(5),u(x.total),l(4),u((c=x.totalPrev)!==null&&c!==void 0?c:"-"),l(),p("ngClass",R.getVariationClass(x.totalVariation)),l(),C(" ",R.formatVariation(x.totalVariation)," ")}}function Ja(o,t){if(o&1&&(n(0,"div",11)(1,"div",49),me(2,Ua,48,17,"div",50,Pa),i()()),o&2){let e=d();l(2),pe(e.evolutionData())}}function Wa(o,t){o&1&&(n(0,"div",12),m(1,"i",63),n(2,"p"),r(3,"Aucune donn\xE9e d'\xE9volution disponible"),i()())}function Ga(o,t){if(o&1&&(n(0,"div",25),m(1,"i",64),n(2,"span"),r(3),L(4,"date"),L(5,"date"),i()()),o&2){let e=d();l(3),T("P\xE9riode: ",ee(4,2,e.dateDebut,"dd/MM/yyyy")," - ",ee(5,5,e.dateFin,"dd/MM/yyyy"),"")}}function Ha(o,t){if(o&1&&(n(0,"div",7),r(1),i()),o&2){let e=d();l(),C(" ",e.error()," ")}}function Qa(o,t){o&1&&(n(0,"div",8),m(1,"p-progressSpinner"),i())}function Ya(o,t){o&1&&(n(0,"tr")(1,"th",65),r(2,"D\xE9l\xE9gation"),i(),n(3,"th",66),r(4,"En attente"),i(),n(5,"th",66),r(6,"Rejet\xE9"),i(),n(7,"th",66),r(8,"Valid\xE9"),i(),n(9,"th",66),r(10,"Total"),i()())}function Ka(o,t){if(o&1){let e=y();n(0,"tr",67),f("click",function(){let s=v(e).$implicit,c=d(2);return b(c.onSelectDelegation(s))}),n(1,"td"),r(2),i(),n(3,"td",68),r(4),i(),n(5,"td",69),r(6),i(),n(7,"td",70),r(8),i(),n(9,"td",71),r(10),i()()}if(o&2){let e=t.$implicit;l(2),u(e.delegationLibele||"Non renseign\xE9e"),l(2),u(e.enAttente),l(2),u(e.rejete),l(2),u(e.valide),l(2),u(e.total)}}function Za(o,t){o&1&&(n(0,"tr")(1,"td",72),r(2,"Aucune donn\xE9e disponible"),i()())}function Xa(o,t){if(o&1&&(n(0,"p-table",26),g(1,Ya,11,0,"ng-template",38)(2,Ka,11,5,"ng-template",39)(3,Za,3,0,"ng-template",40),i()),o&2){let e=d();p("value",e.stats())("tableStyle",M(2,hn))}}function er(o,t){if(o&1){let e=y();n(0,"div",27)(1,"div",73)(2,"app-societariat-by-agence",74),f("agenceSelected",function(s){v(e);let c=d();return b(c.onSelectAgence(s))}),i()(),n(3,"div",73),m(4,"app-societariat-by-ps",75),i()()}if(o&2){let e,a,s=d();l(2),p("delegationLibele",(e=s.selectedDelegation())==null?null:e.delegationLibele)("stats",s.agences())("loading",s.loadingAgences())("error",s.agenceError()),l(2),p("agenceLibele",(a=s.selectedAgence())==null?null:a.agenceLibele)("stats",s.points())("loading",s.loadingPoints())("error",s.pointError())}}var At=class o{user;userService=P(V);dateDebut=null;dateFin=null;maxDate=new Date;usePeriodFilter=!1;chartPeriodOptions=[{label:"Par jour",value:"day"},{label:"Par semaine",value:"week"}];selectedPeriod="day";viewModeOptions=[{label:"Graphique",value:"chart",icon:"pi pi-chart-line"},{label:"Tableau",value:"table",icon:"pi pi-table"},{label:"Comparaison",value:"comparison",icon:"pi pi-arrows-h"}];selectedViewMode="chart";showComparison=!1;state=E({loading:!1,stats:[],error:void 0,loadingAgences:!1,agences:[],agenceError:void 0,loadingPoints:!1,points:[],pointError:void 0,selectedDelegation:null,selectedAgence:null,loadingChart:!1,evolutionByDay:[],evolutionByWeek:[],chartError:void 0});isLoading=O(()=>this.state().loading);stats=O(()=>this.state().stats);error=O(()=>this.state().error);agences=O(()=>this.state().agences);points=O(()=>this.state().points);loadingAgences=O(()=>this.state().loadingAgences);loadingPoints=O(()=>this.state().loadingPoints);selectedDelegation=O(()=>this.state().selectedDelegation);selectedAgence=O(()=>this.state().selectedAgence);agenceError=O(()=>this.state().agenceError);pointError=O(()=>this.state().pointError);loadingChart=O(()=>this.state().loadingChart);chartError=O(()=>this.state().chartError);evolutionData=O(()=>this.selectedPeriod==="day"?this.state().evolutionByDay:this.state().evolutionByWeek);summaryStats=O(()=>{let t=this.evolutionData();if(!t||t.length===0)return null;let e=t.reduce((c,x)=>({enAttente:c.enAttente+x.enAttente,rejete:c.rejete+x.rejete,valide:c.valide+x.valide,total:c.total+x.total}),{enAttente:0,rejete:0,valide:0,total:0}),a=t.reduce((c,x)=>({enAttente:c.enAttente+(x.enAttentePrev||0),rejete:c.rejete+(x.rejetePrev||0),valide:c.valide+(x.validePrev||0),total:c.total+(x.totalPrev||0)}),{enAttente:0,rejete:0,valide:0,total:0}),s=(c,x)=>x>0?Math.round((c-x)/x*100*100)/100:null;return{current:e,previous:a,variations:{enAttente:s(e.enAttente,a.enAttente),rejete:s(e.rejete,a.rejete),valide:s(e.valide,a.valide),total:s(e.total,a.total)}}});chartData=O(()=>{let t=this.evolutionData();if(!t||t.length===0)return null;let e=[{label:"En attente",data:t.map(a=>a.enAttente),fill:!1,borderColor:"#f59e0b",backgroundColor:"rgba(245, 158, 11, 0.2)",tension:.4},{label:"Rejet\xE9es",data:t.map(a=>a.rejete),fill:!1,borderColor:"#ef4444",backgroundColor:"rgba(239, 68, 68, 0.2)",tension:.4},{label:"Valid\xE9es",data:t.map(a=>a.valide),fill:!1,borderColor:"#22c55e",backgroundColor:"rgba(34, 197, 94, 0.2)",tension:.4},{label:"Total",data:t.map(a=>a.total),fill:!1,borderColor:"#6366f1",backgroundColor:"rgba(99, 102, 241, 0.2)",tension:.4,borderDash:[5,5]}];return this.showComparison&&e.push({label:"En attente (p\xE9riode pr\xE9c.)",data:t.map(a=>a.enAttentePrev||0),fill:!1,borderColor:"#f59e0b",backgroundColor:"rgba(245, 158, 11, 0.1)",tension:.4,borderDash:[10,5],borderWidth:1},{label:"Rejet\xE9es (p\xE9riode pr\xE9c.)",data:t.map(a=>a.rejetePrev||0),fill:!1,borderColor:"#ef4444",backgroundColor:"rgba(239, 68, 68, 0.1)",tension:.4,borderDash:[10,5],borderWidth:1},{label:"Valid\xE9es (p\xE9riode pr\xE9c.)",data:t.map(a=>a.validePrev||0),fill:!1,borderColor:"#22c55e",backgroundColor:"rgba(34, 197, 94, 0.1)",tension:.4,borderDash:[10,5],borderWidth:1},{label:"Total (p\xE9riode pr\xE9c.)",data:t.map(a=>a.totalPrev||0),fill:!1,borderColor:"#6366f1",backgroundColor:"rgba(99, 102, 241, 0.1)",tension:.4,borderDash:[10,5],borderWidth:1}),{labels:t.map(a=>a.periode),datasets:e}});chartOptions={maintainAspectRatio:!1,aspectRatio:.6,plugins:{legend:{labels:{color:"#495057"}},tooltip:{mode:"index",intersect:!1,callbacks:{afterBody:t=>{let e=t[0]?.dataIndex,a=this.evolutionData();if(e!==void 0&&a&&a[e]){let s=a[e],c=[];if(s.totalVariation!==null&&s.totalVariation!==void 0){let x=s.totalVariation>=0?"+":"";c.push(`Variation totale: ${x}${s.totalVariation}%`)}return c}return[]}}}},scales:{x:{ticks:{color:"#6b7280"},grid:{color:"#e5e7eb"}},y:{ticks:{color:"#6b7280"},grid:{color:"#e5e7eb"},beginAtZero:!0}}};ngOnInit(){this.loadStats(),this.loadChartData()}loadStats(){if(this.state.update(t=>S(h({},t),{loading:!0,error:void 0})),this.usePeriodFilter&&this.dateDebut&&this.dateFin){let t=this.formatDateForApi(this.dateDebut),e=this.formatDateForApi(this.dateFin);this.userService.getCorrectionStatsByDelegationWithPeriod$(t,e).subscribe({next:a=>{let s=a.data?.correctionStats||[];this.state.update(c=>S(h({},c),{stats:s,loading:!1,selectedDelegation:null,selectedAgence:null,agences:[],points:[]}))},error:a=>{let s=a.error?.message||"Erreur lors du chargement des statistiques.";this.state.update(c=>S(h({},c),{loading:!1,error:s}))}})}else this.userService.getCorrectionStatsByDelegation$().subscribe({next:t=>{let e=t.data?.correctionStats||[];this.state.update(a=>S(h({},a),{stats:e,loading:!1,selectedDelegation:null,selectedAgence:null,agences:[],points:[]}))},error:t=>{let e=t.error?.message||"Erreur lors du chargement des statistiques.";this.state.update(a=>S(h({},a),{loading:!1,error:e}))}})}formatDateForApi(t){let e=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");return`${e}-${a}-${s}`}onApplyPeriodFilter(){if(this.dateDebut&&this.dateFin){if(this.dateDebut>this.dateFin){this.state.update(t=>S(h({},t),{error:"La date de d\xE9but doit \xEAtre ant\xE9rieure \xE0 la date de fin."}));return}this.usePeriodFilter=!0,this.loadStats()}}onClearPeriodFilter(){this.dateDebut=null,this.dateFin=null,this.usePeriodFilter=!1,this.loadStats()}loadChartData(){this.state.update(t=>S(h({},t),{loadingChart:!0,chartError:void 0})),this.userService.getCorrectionEvolutionByDay$().subscribe({next:t=>{let e=t.data?.evolutionByDay||[];this.state.update(a=>S(h({},a),{evolutionByDay:e}))},error:t=>{console.error("Erreur chargement \xE9volution par jour:",t)}}),this.userService.getCorrectionEvolutionByWeek$().subscribe({next:t=>{let e=t.data?.evolutionByWeek||[];this.state.update(a=>S(h({},a),{evolutionByWeek:e,loadingChart:!1}))},error:t=>{let e=t.error?.message||"Erreur lors du chargement des donn\xE9es du graphique.";this.state.update(a=>S(h({},a),{loadingChart:!1,chartError:e}))}})}onPeriodChange(){}onViewModeChange(){}toggleComparison(){this.showComparison=!this.showComparison}getVariationClass(t){return t==null?"":t>0?"variation-up":t<0?"variation-down":"variation-neutral"}getVariationIcon(t){return t==null?"":t>0?"pi pi-arrow-up":t<0?"pi pi-arrow-down":"pi pi-minus"}formatVariation(t){return t==null?"-":`${t>=0?"+":""}${t}%`}onSelectDelegation(t){if(!t?.delegationId){this.state.update(e=>S(h({},e),{selectedDelegation:t,selectedAgence:null,agences:[],points:[],agenceError:"Identifiant de d\xE9l\xE9gation manquant"}));return}this.state.update(e=>S(h({},e),{selectedDelegation:t,selectedAgence:null,agences:[],points:[],agenceError:void 0,pointError:void 0,loadingAgences:!0})),this.userService.getCorrectionStatsByAgence$(t.delegationId).subscribe({next:e=>{let a=e.data?.correctionAgenceStats||[];this.state.update(s=>S(h({},s),{agences:a,loadingAgences:!1}))},error:e=>{let a=e.error?.message||"Erreur lors du chargement des agences.";this.state.update(s=>S(h({},s),{loadingAgences:!1,agenceError:a}))}})}onSelectAgence(t){if(!t?.agenceId){this.state.update(e=>S(h({},e),{selectedAgence:t,points:[],pointError:"Identifiant agence manquant"}));return}this.state.update(e=>S(h({},e),{selectedAgence:t,points:[],pointError:void 0,loadingPoints:!0})),this.userService.getCorrectionStatsByPointVente$(t.agenceId).subscribe({next:e=>{let a=e.data?.correctionPointVenteStats||[];this.state.update(s=>S(h({},s),{points:a,loadingPoints:!1}))},error:e=>{let a=e.error?.message||"Erreur lors du chargement des points de vente.";this.state.update(s=>S(h({},s),{loadingPoints:!1,pointError:a}))}})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=D({type:o,selectors:[["app-societariat"]],inputs:{user:"user"},decls:44,vars:23,consts:[[1,"societariat-card","chart-card"],[1,"header"],[1,"subtitle"],[1,"header-actions"],["optionLabel","label","optionValue","value",3,"ngModelChange","onChange","options","ngModel"],["pButton","","type","button",1,"p-button-outlined","p-button-secondary",3,"click","icon","label"],[1,"summary-cards"],[1,"error"],[1,"loading"],[1,"chart-container"],[1,"table-container"],[1,"comparison-container"],[1,"empty-chart"],[1,"societariat-card"],["pButton","","type","button","icon","pi pi-refresh","label","Rafra\xEEchir",1,"p-button-outlined",3,"click","disabled"],[1,"period-filter"],[1,"period-filter-inputs"],[1,"field"],["for","dateDebut"],["dateFormat","dd/mm/yy","inputId","dateDebut","placeholder","S\xE9lectionner...","appendTo","body",3,"ngModelChange","ngModel","maxDate","showIcon"],["for","dateFin"],["dateFormat","dd/mm/yy","inputId","dateFin","placeholder","S\xE9lectionner...","appendTo","body",3,"ngModelChange","ngModel","maxDate","showIcon"],[1,"field-buttons"],["pButton","","type","button","icon","pi pi-search","label","Appliquer",1,"p-button-primary",3,"click","disabled"],["pButton","","type","button","icon","pi pi-times","label","Effacer",1,"p-button-outlined","p-button-secondary",3,"click","disabled"],[1,"period-active-badge"],["styleClass","stats-table",3,"value","tableStyle"],[1,"grid"],[1,"summary-card","summary-attente"],[1,"summary-label"],[1,"summary-value"],[1,"summary-variation",3,"ngClass"],[1,"summary-prev"],[1,"summary-card","summary-rejete"],[1,"summary-card","summary-valide"],[1,"summary-card","summary-total"],["type","line","height","350px",3,"data","options"],["scrollHeight","400px",3,"value","tableStyle","scrollable"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"text-right"],[1,"text-right","en-attente"],[1,"prev-value"],[1,"text-right","rejete"],[1,"text-right","valide"],[1,"text-right","total"],[3,"ngClass"],[1,"empty"],[1,"comparison-grid"],[1,"comparison-card"],[1,"comparison-header"],[1,"comparison-body"],[1,"comparison-row"],[1,"label"],[1,"current","en-attente"],[1,"vs"],[1,"previous"],[1,"variation",3,"ngClass"],[1,"current","rejete"],[1,"current","valide"],[1,"comparison-row","total-row"],[1,"current","total"],[1,"pi","pi-chart-line"],[1,"pi","pi-filter"],[2,"width","40%"],[2,"width","15%","text-align","center"],[1,"clickable",3,"click"],[1,"number","en-attente",2,"text-align","center"],[1,"number","rejete",2,"text-align","center"],[1,"number","valide",2,"text-align","center"],[1,"number","total",2,"text-align","center"],["colspan","5",1,"empty"],[1,"col-12","md:col-6"],[3,"agenceSelected","delegationLibele","stats","loading","error"],[3,"agenceLibele","stats","loading","error"]],template:function(e,a){e&1&&(n(0,"p-card",0)(1,"div",1)(2,"div")(3,"h3"),r(4,"\xC9volution des corrections"),i(),n(5,"p",2),r(6),i()(),n(7,"div",3)(8,"p-selectButton",4),k("ngModelChange",function(c){return A(a.selectedPeriod,c)||(a.selectedPeriod=c),c}),f("onChange",function(){return a.onPeriodChange()}),i(),n(9,"button",5),f("click",function(){return a.toggleComparison()}),i(),n(10,"p-selectButton",4),k("ngModelChange",function(c){return A(a.selectedViewMode,c)||(a.selectedViewMode=c),c}),f("onChange",function(){return a.onViewModeChange()}),i()()(),g(11,Ta,33,12,"div",6)(12,Ia,2,1,"div",7)(13,Aa,2,0,"div",8)(14,ka,2,2,"div",9)(15,Ba,5,4,"div",10)(16,Ja,4,0,"div",11)(17,Wa,4,0,"div",12),i(),n(18,"p-card",13)(19,"div",1)(20,"div")(21,"h3"),r(22,"Statistiques des corrections"),i(),n(23,"p",2),r(24,"R\xE9partition par d\xE9l\xE9gation (EN_ATTENTE / REJETE / VALIDE)"),i()(),n(25,"button",14),f("click",function(){return a.loadStats(),a.loadChartData()}),i()(),n(26,"div",15)(27,"div",16)(28,"div",17)(29,"label",18),r(30,"Date d\xE9but"),i(),n(31,"p-datepicker",19),k("ngModelChange",function(c){return A(a.dateDebut,c)||(a.dateDebut=c),c}),i()(),n(32,"div",17)(33,"label",20),r(34,"Date fin"),i(),n(35,"p-datepicker",21),k("ngModelChange",function(c){return A(a.dateFin,c)||(a.dateFin=c),c}),i()(),n(36,"div",22)(37,"button",23),f("click",function(){return a.onApplyPeriodFilter()}),i(),n(38,"button",24),f("click",function(){return a.onClearPeriodFilter()}),i()()(),g(39,Ga,6,8,"div",25),i(),g(40,Ha,2,1,"div",7)(41,Qa,2,0,"div",8)(42,Xa,4,3,"p-table",26),i(),g(43,er,5,8,"div",27)),e&2&&(l(6),C("Tendance sur les derni\xE8res ",a.selectedPeriod==="day"?"30 jours":"12 semaines"," "),l(2),p("options",a.chartPeriodOptions),I("ngModel",a.selectedPeriod),l(),p("icon",a.showComparison?"pi pi-eye-slash":"pi pi-eye")("label",a.showComparison?"Masquer comparaison":"Comparer"),l(),p("options",a.viewModeOptions),I("ngModel",a.selectedViewMode),l(),_(a.summaryStats()?11:-1),l(),_(a.chartError()?12:-1),l(),_(a.loadingChart()?13:a.selectedViewMode==="chart"&&a.chartData()?14:a.selectedViewMode==="table"&&a.evolutionData().length>0?15:a.selectedViewMode==="comparison"&&a.evolutionData().length>0?16:17),l(12),p("disabled",a.isLoading()),l(6),I("ngModel",a.dateDebut),p("maxDate",a.maxDate)("showIcon",!0),l(4),I("ngModel",a.dateFin),p("maxDate",a.maxDate)("showIcon",!0),l(2),p("disabled",!a.dateDebut||!a.dateFin||a.isLoading()),l(),p("disabled",!a.usePeriodFilter||a.isLoading()),l(),_(a.usePeriodFilter&&a.dateDebut&&a.dateFin?39:-1),l(),_(a.error()?40:-1),l(),_(a.isLoading()?41:42),l(2),_(a.selectedDelegation()?43:-1))},dependencies:[j,et,Ae,W,ge,N,q,$,K,U,F,ae,mn,cn,Ht,Gt,ie,te,ne,H,z,Yt,Qt,pn,un],styles:[".societariat-card[_ngcontent-%COMP%]{width:100%;margin-bottom:1.5rem}.societariat-card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:1rem;margin-bottom:1rem;flex-wrap:wrap}.societariat-card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-weight:700}.societariat-card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{margin:.15rem 0 0;color:#6b7280;font-size:.95rem}.societariat-card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;flex-wrap:wrap}.societariat-card[_ngcontent-%COMP%]   .summary-cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:1rem;margin-bottom:1.5rem}.societariat-card[_ngcontent-%COMP%]   .summary-card[_ngcontent-%COMP%]{padding:1rem;border-radius:8px;background:#f9fafb;border:1px solid #e5e7eb}.societariat-card[_ngcontent-%COMP%]   .summary-card[_ngcontent-%COMP%]   .summary-label[_ngcontent-%COMP%]{font-size:.85rem;color:#6b7280;margin-bottom:.25rem}.societariat-card[_ngcontent-%COMP%]   .summary-card[_ngcontent-%COMP%]   .summary-value[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:700}.societariat-card[_ngcontent-%COMP%]   .summary-card[_ngcontent-%COMP%]   .summary-variation[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem;font-size:.85rem;font-weight:600;margin-top:.25rem}.societariat-card[_ngcontent-%COMP%]   .summary-card[_ngcontent-%COMP%]   .summary-variation[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.75rem}.societariat-card[_ngcontent-%COMP%]   .summary-card[_ngcontent-%COMP%]   .summary-prev[_ngcontent-%COMP%]{font-size:.75rem;color:#9ca3af;margin-top:.25rem}.societariat-card[_ngcontent-%COMP%]   .summary-card.summary-attente[_ngcontent-%COMP%]{border-left:4px solid #f59e0b}.societariat-card[_ngcontent-%COMP%]   .summary-card.summary-attente[_ngcontent-%COMP%]   .summary-value[_ngcontent-%COMP%]{color:#d97706}.societariat-card[_ngcontent-%COMP%]   .summary-card.summary-rejete[_ngcontent-%COMP%]{border-left:4px solid #ef4444}.societariat-card[_ngcontent-%COMP%]   .summary-card.summary-rejete[_ngcontent-%COMP%]   .summary-value[_ngcontent-%COMP%]{color:#dc2626}.societariat-card[_ngcontent-%COMP%]   .summary-card.summary-valide[_ngcontent-%COMP%]{border-left:4px solid #22c55e}.societariat-card[_ngcontent-%COMP%]   .summary-card.summary-valide[_ngcontent-%COMP%]   .summary-value[_ngcontent-%COMP%]{color:#15803d}.societariat-card[_ngcontent-%COMP%]   .summary-card.summary-total[_ngcontent-%COMP%]{border-left:4px solid #6366f1}.societariat-card[_ngcontent-%COMP%]   .summary-card.summary-total[_ngcontent-%COMP%]   .summary-value[_ngcontent-%COMP%]{color:#4f46e5}.societariat-card[_ngcontent-%COMP%]   .variation-up[_ngcontent-%COMP%]{color:#dc2626}.societariat-card[_ngcontent-%COMP%]   .variation-down[_ngcontent-%COMP%]{color:#15803d}.societariat-card[_ngcontent-%COMP%]   .variation-neutral[_ngcontent-%COMP%]{color:#6b7280}.societariat-card[_ngcontent-%COMP%]   .loading[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:2rem 0}.societariat-card[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]{padding:.75rem 1rem;margin-bottom:1rem;border-radius:6px;background:#fef2f2;color:#b91c1c;border:1px solid #fecdd3}.societariat-card[_ngcontent-%COMP%]   .period-filter[_ngcontent-%COMP%]{padding:1rem;margin-bottom:1rem;background:#f8fafc;border-radius:8px;border:1px solid #e2e8f0}.societariat-card[_ngcontent-%COMP%]   .period-filter[_ngcontent-%COMP%]   .period-filter-inputs[_ngcontent-%COMP%]{display:flex;align-items:flex-end;gap:1rem;flex-wrap:wrap}.societariat-card[_ngcontent-%COMP%]   .period-filter[_ngcontent-%COMP%]   .period-filter-inputs[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;min-width:180px}.societariat-card[_ngcontent-%COMP%]   .period-filter[_ngcontent-%COMP%]   .period-filter-inputs[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:#475569}.societariat-card[_ngcontent-%COMP%]   .period-filter[_ngcontent-%COMP%]   .period-filter-inputs[_ngcontent-%COMP%]   .field-buttons[_ngcontent-%COMP%]{display:flex;gap:.5rem}.societariat-card[_ngcontent-%COMP%]   .period-filter[_ngcontent-%COMP%]   .period-active-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.5rem;margin-top:.75rem;padding:.5rem 1rem;background:#dbeafe;color:#1e40af;border-radius:20px;font-size:.875rem;font-weight:500}.societariat-card[_ngcontent-%COMP%]   .period-filter[_ngcontent-%COMP%]   .period-active-badge[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.75rem}.societariat-card[_ngcontent-%COMP%]     .p-table .p-datatable-header{display:none}.societariat-card[_ngcontent-%COMP%]     .p-selectbutton .p-button{padding:.5rem 1rem;font-size:.875rem}.societariat-card[_ngcontent-%COMP%]   .text-right[_ngcontent-%COMP%]{text-align:right}.societariat-card[_ngcontent-%COMP%]   .number[_ngcontent-%COMP%]{text-align:center;font-weight:700}.societariat-card[_ngcontent-%COMP%]     .stats-table .p-datatable-thead>tr>th{background:#f8fafc;border-bottom:2px solid #e2e8f0;padding:1rem;font-weight:600;color:#475569}.societariat-card[_ngcontent-%COMP%]     .stats-table .p-datatable-tbody>tr>td{padding:.875rem 1rem;border-bottom:1px solid #f1f5f9}.societariat-card[_ngcontent-%COMP%]     .stats-table .p-datatable-tbody>tr:hover{background:#f8fafc}.societariat-card[_ngcontent-%COMP%]   .prev-value[_ngcontent-%COMP%]{color:#9ca3af;font-size:.85rem;margin-left:.25rem}.societariat-card[_ngcontent-%COMP%]   .clickable[_ngcontent-%COMP%]{cursor:pointer}.societariat-card[_ngcontent-%COMP%]   .clickable[_ngcontent-%COMP%]:hover{background:#f9fafb}.societariat-card[_ngcontent-%COMP%]   .en-attente[_ngcontent-%COMP%]{color:#d97706;font-weight:600}.societariat-card[_ngcontent-%COMP%]   .rejete[_ngcontent-%COMP%]{color:#dc2626;font-weight:600}.societariat-card[_ngcontent-%COMP%]   .valide[_ngcontent-%COMP%]{color:#15803d;font-weight:600}.societariat-card[_ngcontent-%COMP%]   .total[_ngcontent-%COMP%]{color:#111827;font-weight:700}.societariat-card[_ngcontent-%COMP%]   .empty[_ngcontent-%COMP%]{text-align:center;padding:1rem;color:#6b7280}.chart-card[_ngcontent-%COMP%]   .chart-container[_ngcontent-%COMP%]{padding:1rem 0;min-height:350px}.chart-card[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]{max-height:450px;overflow:auto}.chart-card[_ngcontent-%COMP%]   .empty-chart[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:3rem;color:#9ca3af}.chart-card[_ngcontent-%COMP%]   .empty-chart[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:1rem}.chart-card[_ngcontent-%COMP%]   .empty-chart[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:.95rem}.comparison-container[_ngcontent-%COMP%]{padding:1rem 0}.comparison-container[_ngcontent-%COMP%]   .comparison-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:1rem;max-height:500px;overflow-y:auto}.comparison-container[_ngcontent-%COMP%]   .comparison-card[_ngcontent-%COMP%]{border:1px solid #e5e7eb;border-radius:8px;overflow:hidden}.comparison-container[_ngcontent-%COMP%]   .comparison-card[_ngcontent-%COMP%]   .comparison-header[_ngcontent-%COMP%]{background:#f3f4f6;padding:.75rem 1rem;font-weight:600;color:#374151;border-bottom:1px solid #e5e7eb}.comparison-container[_ngcontent-%COMP%]   .comparison-card[_ngcontent-%COMP%]   .comparison-body[_ngcontent-%COMP%]{padding:.75rem}.comparison-container[_ngcontent-%COMP%]   .comparison-card[_ngcontent-%COMP%]   .comparison-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr auto auto auto auto;gap:.5rem;align-items:center;padding:.5rem 0;border-bottom:1px solid #f3f4f6}.comparison-container[_ngcontent-%COMP%]   .comparison-card[_ngcontent-%COMP%]   .comparison-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.comparison-container[_ngcontent-%COMP%]   .comparison-card[_ngcontent-%COMP%]   .comparison-row.total-row[_ngcontent-%COMP%]{border-top:2px solid #e5e7eb;margin-top:.5rem;padding-top:.75rem}.comparison-container[_ngcontent-%COMP%]   .comparison-card[_ngcontent-%COMP%]   .comparison-row[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:.85rem;color:#6b7280}.comparison-container[_ngcontent-%COMP%]   .comparison-card[_ngcontent-%COMP%]   .comparison-row[_ngcontent-%COMP%]   .current[_ngcontent-%COMP%]{font-weight:700;font-size:1rem}.comparison-container[_ngcontent-%COMP%]   .comparison-card[_ngcontent-%COMP%]   .comparison-row[_ngcontent-%COMP%]   .vs[_ngcontent-%COMP%]{font-size:.75rem;color:#9ca3af}.comparison-container[_ngcontent-%COMP%]   .comparison-card[_ngcontent-%COMP%]   .comparison-row[_ngcontent-%COMP%]   .previous[_ngcontent-%COMP%]{font-size:.85rem;color:#6b7280}.comparison-container[_ngcontent-%COMP%]   .comparison-card[_ngcontent-%COMP%]   .comparison-row[_ngcontent-%COMP%]   .variation[_ngcontent-%COMP%]{font-size:.85rem;font-weight:600;min-width:60px;text-align:right}@media (max-width: 768px){.societariat-card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.societariat-card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]{width:100%;justify-content:flex-start}.societariat-card[_ngcontent-%COMP%]   .summary-cards[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}.societariat-card[_ngcontent-%COMP%]   .period-filter[_ngcontent-%COMP%]   .period-filter-inputs[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.societariat-card[_ngcontent-%COMP%]   .period-filter[_ngcontent-%COMP%]   .period-filter-inputs[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]{width:100%;min-width:unset}.societariat-card[_ngcontent-%COMP%]   .period-filter[_ngcontent-%COMP%]   .period-filter-inputs[_ngcontent-%COMP%]   .field-buttons[_ngcontent-%COMP%]{width:100%;justify-content:flex-start}.comparison-container[_ngcontent-%COMP%]   .comparison-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})};var or=()=>({"min-width":"50rem"}),ar=(o,t)=>t.date;function rr(o,t){o&1&&(n(0,"span",7),m(1,"i",31),r(2," Les demandes sont OUVERTES "),i())}function lr(o,t){o&1&&(n(0,"span",8),m(1,"i",32),r(2," Les demandes sont FERM\xC9ES "),i())}function sr(o,t){if(o&1&&(m(0,"i",33),n(1,"span"),r(2,"En attente"),i(),m(3,"p-badge",34)),o&2){let e=d();l(3),p("value",e.selectedStatut()==="ENCOURS"?e.totalDemandes().toString():"")}}function dr(o,t){o&1&&(m(0,"i",35),n(1,"span"),r(2,"Valid\xE9es"),i())}function cr(o,t){o&1&&(m(0,"i",36),n(1,"span"),r(2,"Rejet\xE9es"),i())}function mr(o,t){if(o&1&&(n(0,"div",28)(1,"div",21),m(2,"i",37),i(),n(3,"div",23)(4,"span",24),r(5),i(),n(6,"span",25),r(7,"S\xE9lectionn\xE9es"),i()()()),o&2){let e=d();l(5),u(e.totalSelected())}}function pr(o,t){if(o&1){let e=y();n(0,"div",29)(1,"div",38),m(2,"i",39),n(3,"span"),r(4),i()(),n(5,"p-button",40),f("onClick",function(){v(e);let s=d();return b(s.confirmValiderSelection())}),i()()}if(o&2){let e=d();l(4),C("",e.totalSelected()," demande(s) s\xE9lectionn\xE9e(s)"),l(),p("loading",e.isValidating())}}function ur(o,t){o&1&&(n(0,"div",30),m(1,"p-progressSpinner"),n(2,"span"),r(3,"Chargement des demandes..."),i()())}function gr(o,t){if(o&1&&(n(0,"div",41),m(1,"i",43),n(2,"h3"),r(3,"Aucune demande"),i(),n(4,"p"),r(5),i()()),o&2){let e=d(2);l(5),C("Il n'y a pas de demandes ",e.selectedStatut()==="ENCOURS"?"en attente":e.selectedStatut()==="VALIDER"?"valid\xE9es":"rejet\xE9es"," pour le moment.")}}function _r(o,t){if(o&1){let e=y();n(0,"div",57),f("click",function(s){return v(e),b(s.stopPropagation())}),n(1,"p-button",58),f("onClick",function(){v(e);let s=d().$implicit,c=d(3);return b(c.confirmValiderJour(s))}),i()()}if(o&2){let e=d(4);l(),p("outlined",!0)("loading",e.isValidating())}}function fr(o,t){if(o&1){let e=y();n(0,"div",59)(1,"p-checkbox",62),k("ngModelChange",function(s){v(e);let c=d(2).$implicit;return A(c.allSelected,s)||(c.allSelected=s),b(s)}),f("onChange",function(){v(e);let s=d(2).$implicit,c=d(3);return b(c.toggleSelectAll(s))}),i(),n(2,"label",63),r(3),i()()}if(o&2){let e=d(2).$implicit;l(),he("inputId","selectAll-",e.date,""),I("ngModel",e.allSelected),p("binary",!0),l(),he("for","selectAll-",e.date,""),l(),T(" Tout s\xE9lectionner (",(e.selectedIds==null?null:e.selectedIds.length)||0,"/",e.count,") ")}}function Cr(o,t){o&1&&m(0,"th",64)}function xr(o,t){if(o&1&&(n(0,"tr"),g(1,Cr,1,0,"th",64),n(2,"th",65),r(3,"Matricule"),i(),n(4,"th"),r(5,"Nom & Pr\xE9nom"),i(),n(6,"th",66),r(7,"Montant"),i(),n(8,"th",67),r(9,"N\xB0 Compte"),i(),n(10,"th",68),r(11,"Heure"),i(),n(12,"th",66),r(13,"Actions"),i()()),o&2){let e=d(5);l(),_(e.selectedStatut()==="ENCOURS"?1:-1)}}function vr(o,t){if(o&1){let e=y();n(0,"td")(1,"p-checkbox",77),f("onChange",function(){v(e);let s=d().$implicit,c=d(2).$implicit,x=d(3);return b(x.toggleSelectDemande(c,s.id))}),i()()}if(o&2){let e=d().$implicit,a=d(2).$implicit,s=d(3);l(),p("binary",!0)("ngModel",s.isSelected(a,e.id))}}function br(o,t){if(o&1){let e=y();n(0,"div",75)(1,"p-button",78),f("onClick",function(){v(e);let s=d().$implicit,c=d(5);return b(c.confirmValider(s))}),i(),n(2,"p-button",79),f("onClick",function(){v(e);let s=d().$implicit,c=d(5);return b(c.confirmRejeter(s))}),i()()}if(o&2){let e=d().$implicit,a=d(5);l(),p("rounded",!0)("text",!0)("loading",a.validatingId()===e.id),l(),p("rounded",!0)("text",!0)("loading",a.validatingId()===e.id)}}function hr(o,t){if(o&1&&m(0,"p-tag",76),o&2){let e=d().$implicit,a=d(5);p("value",a.getStatutLabel(e.statut))("severity",a.getStatutSeverity(e.statut))}}function Sr(o,t){if(o&1&&(n(0,"tr"),g(1,vr,2,2,"td"),n(2,"td")(3,"span",69),r(4),i()(),n(5,"td")(6,"div",70)(7,"span",71),r(8),i()()(),n(9,"td",72)(10,"span",73),r(11),i()(),n(12,"td")(13,"span",74),r(14),i()(),n(15,"td"),r(16),L(17,"javaDate"),i(),n(18,"td"),g(19,br,3,6,"div",75)(20,hr,1,2,"p-tag",76),i()()),o&2){let e=t.$implicit,a=d(2).$implicit,s=d(3);Ce("selected-row",s.isSelected(a,e.id)),l(),_(s.selectedStatut()==="ENCOURS"?1:-1),l(3),u(e.matricule),l(4),T("",e.prenomPersonnel," ",e.nomPersonnel,""),l(3),u(s.formatMontant(e.amount)),l(3),u(e.numeroCompte||"-"),l(2),C(" ",ee(17,10,e.createdAt,"HH:mm")," "),l(3),_(s.selectedStatut()==="ENCOURS"?19:20)}}function yr(o,t){if(o&1&&(n(0,"div",56),g(1,fr,4,8,"div",59),n(2,"p-table",60),g(3,xr,14,1,"ng-template",18)(4,Sr,21,13,"ng-template",61),i()()),o&2){let e=d().$implicit,a=d(3);l(),_(a.selectedStatut()==="ENCOURS"?1:-1),l(),p("value",e.demandes)("tableStyle",M(3,or))}}function Er(o,t){if(o&1){let e=y();n(0,"div",45)(1,"div",46),f("click",function(){let s=v(e).$implicit,c=d(3);return b(c.toggleDay(s))}),n(2,"div",47)(3,"div",48),m(4,"i"),i(),n(5,"div",49)(6,"span",50),r(7),i(),n(8,"span",51),r(9),i()(),n(10,"div",52),m(11,"p-chip",53)(12,"p-chip",54),i()(),g(13,_r,2,2,"div",55),i(),g(14,yr,5,4,"div",56),i()}if(o&2){let e=t.$implicit,a=d(3);Ce("expanded",e.expanded),l(4),de(e.expanded?"pi pi-chevron-down":"pi pi-chevron-right"),l(3),u(a.formatDate(e.date)),l(2),u(a.formatDateShort(e.date)),l(2),p("label",e.count+" demande(s)"),l(),p("label",a.formatMontant(e.totalAmount)),l(),_(a.selectedStatut()==="ENCOURS"?13:-1),l(),_(e.expanded?14:-1)}}function Pr(o,t){if(o&1&&(n(0,"div",42),me(1,Er,15,10,"div",44,ar),i()),o&2){let e=d(2);l(),pe(e.demandesParJour())}}function Mr(o,t){if(o&1&&g(0,gr,6,1,"div",41)(1,Pr,3,0,"div",42),o&2){let e=d();_(e.demandesParJour().length===0?0:1)}}var kt=class o{user;salaireService=P(V);messageService=P(w);confirmationService=P(Z);isLoading=E(!1);isValidating=E(!1);validatingId=E(null);demandesParJour=E([]);selectedStatut=E("ENCOURS");isLoadingAuth=E(!1);authorizeSalaire=E(null);isDemandesAuthorized=O(()=>this.authorizeSalaire()?.isAuthorized??!1);totalDemandes=O(()=>this.demandesParJour().reduce((t,e)=>t+e.count,0));totalMontant=O(()=>this.demandesParJour().reduce((t,e)=>t+e.totalAmount,0));totalSelected=O(()=>this.demandesParJour().reduce((t,e)=>t+(e.selectedIds?.length||0),0));hasSelection=O(()=>this.totalSelected()>0);ngOnInit(){this.loadAuthorizeSalaire(),this.loadDemandesGroupedByDate()}loadAuthorizeSalaire(){this.salaireService.getAuthorizeSalaire().subscribe({next:t=>{t.data?.authorize&&this.authorizeSalaire.set(t.data.authorize)},error:t=>{console.error("Erreur chargement autorisation:",t)}})}toggleAuthorization(){let t=!this.isDemandesAuthorized();this.confirmationService.confirm({message:t?"Voulez-vous ACTIVER les demandes d'avance sur salaire ?":"Voulez-vous D\xC9SACTIVER les demandes d'avance sur salaire ?",header:"Confirmation",icon:t?"pi pi-check-circle":"pi pi-exclamation-triangle",acceptLabel:t?"Activer":"D\xE9sactiver",rejectLabel:"Annuler",acceptButtonStyleClass:t?"p-button-success":"p-button-danger",accept:()=>{this.isLoadingAuth.set(!0),(t?this.salaireService.enableAuthorizeSalaire():this.salaireService.disableAuthorizeSalaire()).subscribe({next:a=>{this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:t?"Les demandes d'avance sur salaire sont maintenant OUVERTES":"Les demandes d'avance sur salaire sont maintenant FERM\xC9ES"}),this.loadAuthorizeSalaire(),this.isLoadingAuth.set(!1)},error:a=>{console.error("Erreur toggle autorisation:",a),this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de modifier l'autorisation"}),this.isLoadingAuth.set(!1)}})}})}loadDemandesGroupedByDate(){this.isLoading.set(!0),this.salaireService.getDemandesGroupedByDate(this.selectedStatut()).subscribe({next:t=>{if(t.data?.groupedDemandes){let e=t.data.groupedDemandes;this.demandesParJour.set(e.map(a=>S(h({},a),{expanded:!1,selectedIds:[],allSelected:!1})))}this.isLoading.set(!1)},error:t=>{console.error("Erreur chargement demandes:",t),this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de charger les demandes"}),this.isLoading.set(!1)}})}onStatutChange(t){this.selectedStatut.set(t),this.loadDemandesGroupedByDate()}toggleDay(t){t.expanded=!t.expanded}toggleSelectAll(t){t.allSelected?t.selectedIds=t.demandes.map(e=>e.id):t.selectedIds=[],this.demandesParJour.set([...this.demandesParJour()])}toggleSelectDemande(t,e){t.selectedIds||(t.selectedIds=[]);let a=t.selectedIds.indexOf(e);a>-1?t.selectedIds.splice(a,1):t.selectedIds.push(e),t.allSelected=t.selectedIds.length===t.demandes.length,this.demandesParJour.set([...this.demandesParJour()])}isSelected(t,e){return t.selectedIds?.includes(e)||!1}confirmValider(t){this.confirmationService.confirm({message:`Voulez-vous valider la demande de ${this.formatMontant(t.amount)} pour ${t.prenomPersonnel} ${t.nomPersonnel} ?`,header:"Confirmer la validation",icon:"pi pi-check-circle",acceptLabel:"Valider",rejectLabel:"Annuler",acceptButtonStyleClass:"p-button-success",accept:()=>{this.validerDemande(t.id)}})}validerDemande(t){this.validatingId.set(t),this.salaireService.validerDemandeSalary(t).subscribe({next:e=>{this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Demande valid\xE9e avec succ\xE8s"}),this.validatingId.set(null),this.loadDemandesGroupedByDate()},error:e=>{console.error("Erreur validation:",e),this.messageService.add({severity:"error",summary:"Erreur",detail:e.error?.message||"Impossible de valider la demande"}),this.validatingId.set(null)}})}confirmValiderSelection(){let t=this.totalSelected();this.confirmationService.confirm({message:`Voulez-vous valider les ${t} demande(s) s\xE9lectionn\xE9e(s) ?`,header:"Validation massive",icon:"pi pi-check-circle",acceptLabel:`Valider ${t} demande(s)`,rejectLabel:"Annuler",acceptButtonStyleClass:"p-button-success",accept:()=>{this.validerSelection()}})}validerSelection(){let t=[];if(this.demandesParJour().forEach(e=>{e.selectedIds&&e.selectedIds.length>0&&t.push(...e.selectedIds)}),t.length===0){this.messageService.add({severity:"warn",summary:"Attention",detail:"Aucune demande s\xE9lectionn\xE9e"});return}this.isValidating.set(!0),this.salaireService.validerMultipleDemandeSalary(t).subscribe({next:e=>{let a=e.data?.totalValidated||0;this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:`${a} demande(s) valid\xE9e(s) avec succ\xE8s`}),this.isValidating.set(!1),this.loadDemandesGroupedByDate()},error:e=>{console.error("Erreur validation massive:",e),this.messageService.add({severity:"error",summary:"Erreur",detail:e.error?.message||"Erreur lors de la validation massive"}),this.isValidating.set(!1)}})}confirmValiderJour(t){this.confirmationService.confirm({message:`Voulez-vous valider les ${t.count} demande(s) du ${this.formatDate(t.date)} pour un total de ${this.formatMontant(t.totalAmount)} ?`,header:"Valider toutes les demandes du jour",icon:"pi pi-check-circle",acceptLabel:`Valider ${t.count} demande(s)`,rejectLabel:"Annuler",acceptButtonStyleClass:"p-button-success",accept:()=>{this.validerJour(t)}})}validerJour(t){let e=t.demandes.map(a=>a.id);this.isValidating.set(!0),this.salaireService.validerMultipleDemandeSalary(e).subscribe({next:a=>{let s=a.data?.totalValidated||0;this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:`${s} demande(s) du ${this.formatDate(t.date)} valid\xE9e(s)`}),this.isValidating.set(!1),this.loadDemandesGroupedByDate()},error:a=>{console.error("Erreur validation jour:",a),this.messageService.add({severity:"error",summary:"Erreur",detail:a.error?.message||"Erreur lors de la validation"}),this.isValidating.set(!1)}})}confirmRejeter(t){this.confirmationService.confirm({message:`Voulez-vous rejeter la demande de ${this.formatMontant(t.amount)} pour ${t.prenomPersonnel} ${t.nomPersonnel} ?`,header:"Confirmer le rejet",icon:"pi pi-times-circle",acceptLabel:"Rejeter",rejectLabel:"Annuler",acceptButtonStyleClass:"p-button-danger",accept:()=>{this.rejeterDemande(t.id)}})}rejeterDemande(t){this.validatingId.set(t),this.salaireService.rejeterDemandeSalary(t).subscribe({next:e=>{this.messageService.add({severity:"info",summary:"Information",detail:"Demande rejet\xE9e"}),this.validatingId.set(null),this.loadDemandesGroupedByDate()},error:e=>{console.error("Erreur rejet:",e),this.messageService.add({severity:"error",summary:"Erreur",detail:e.error?.message||"Impossible de rejeter la demande"}),this.validatingId.set(null)}})}formatMontant(t){return t==null?"-":new Intl.NumberFormat("fr-FR",{style:"currency",currency:"GNF",minimumFractionDigits:0,maximumFractionDigits:0}).format(t)}formatDate(t){return new Date(t).toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long",year:"numeric"})}formatDateShort(t){return new Date(t).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}getStatutSeverity(t){switch(t?.toUpperCase()){case"ENCOURS":return"info";case"VALIDER":return"success";case"CONFIRMER":return"success";case"REJET":return"danger";case"ANNULLER":return"secondary";default:return"info"}}getStatutLabel(t){switch(t?.toUpperCase()){case"ENCOURS":return"En cours";case"VALIDER":return"Valid\xE9e";case"CONFIRMER":return"Confirm\xE9e";case"REJET":return"Rejet\xE9e";case"ANNULLER":return"Annul\xE9e";default:return t}}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=D({type:o,selectors:[["app-rh"]],inputs:{user:"user"},features:[G([w,Z])],decls:55,vars:19,consts:[[1,"rh-container"],[1,"header-section"],[1,"authorization-control"],[1,"auth-content"],[1,"auth-info"],[1,"auth-status"],[1,"auth-text"],[1,"status-active"],[1,"status-inactive"],[1,"auth-action"],[3,"onClick","icon","label","severity","loading"],[1,"header-content"],[1,"pi","pi-briefcase"],[1,"subtitle"],[1,"header-actions"],["icon","pi pi-refresh","label","Actualiser",3,"onClick","text","loading"],[1,"filter-section"],[3,"onChange"],["pTemplate","header"],[1,"stats-section"],[1,"stat-card"],[1,"stat-icon"],[1,"pi","pi-file"],[1,"stat-info"],[1,"stat-value"],[1,"stat-label"],[1,"stat-card","amount"],[1,"pi","pi-wallet"],[1,"stat-card","selected"],[1,"bulk-action-bar"],[1,"loading-container"],[1,"pi","pi-check-circle"],[1,"pi","pi-times-circle"],[1,"pi","pi-clock","mr-2"],["severity","info",1,"ml-2",3,"value"],[1,"pi","pi-check-circle","mr-2"],[1,"pi","pi-times-circle","mr-2"],[1,"pi","pi-check-square"],[1,"selection-info"],[1,"pi","pi-info-circle"],["icon","pi pi-check-circle","label","Valider la s\xE9lection","severity","success",3,"onClick","loading"],[1,"empty-state"],[1,"days-list"],[1,"pi","pi-inbox"],[1,"day-card",3,"expanded"],[1,"day-card"],[1,"day-header",3,"click"],[1,"day-info"],[1,"day-toggle"],[1,"day-date"],[1,"date-full"],[1,"date-short"],[1,"day-badges"],["icon","pi pi-file",3,"label"],["icon","pi pi-wallet","styleClass","amount-chip",3,"label"],[1,"day-actions"],[1,"day-content"],[1,"day-actions",3,"click"],["icon","pi pi-check-circle","label","Tout valider","severity","success","size","small",3,"onClick","outlined","loading"],[1,"select-all-row"],["styleClass","p-datatable-sm p-datatable-striped",3,"value","tableStyle"],["pTemplate","body"],[3,"ngModelChange","onChange","ngModel","binary","inputId"],[3,"for"],[2,"width","50px"],[2,"width","80px"],[2,"width","150px"],[2,"width","130px"],[2,"width","100px"],[1,"matricule-badge"],[1,"person-info"],[1,"person-name"],[1,"text-right"],[1,"montant"],[1,"numero-compte"],[1,"action-buttons"],[3,"value","severity"],[3,"onChange","binary","ngModel"],["icon","pi pi-check","severity","success","size","small","pTooltip","Valider",3,"onClick","rounded","text","loading"],["icon","pi pi-times","severity","danger","size","small","pTooltip","Rejeter",3,"onClick","rounded","text","loading"]],template:function(e,a){e&1&&(m(0,"p-toast")(1,"p-confirmDialog"),n(2,"div",0)(3,"div",1)(4,"div",2)(5,"p-card")(6,"div",3)(7,"div",4)(8,"div",5),m(9,"i"),i(),n(10,"div",6)(11,"h4"),r(12,"Demandes d'avance sur salaire"),i(),n(13,"p"),g(14,rr,3,0,"span",7)(15,lr,3,0,"span",8),i()()(),n(16,"div",9)(17,"p-button",10),f("onClick",function(){return a.toggleAuthorization()}),i()()()()(),n(18,"div",11)(19,"h2"),m(20,"i",12),r(21," Gestion des demandes d'avance sur salaire"),i(),n(22,"p",13),r(23,"Validez les demandes d'avance des employ\xE9s"),i()(),n(24,"div",14)(25,"p-button",15),f("onClick",function(){return a.loadDemandesGroupedByDate()}),i()()(),n(26,"div",16)(27,"p-tabView",17),f("onChange",function(c){return a.onStatutChange(c.index===0?"ENCOURS":c.index===1?"VALIDER":"REJET")}),n(28,"p-tabPanel"),g(29,sr,4,1,"ng-template",18),i(),n(30,"p-tabPanel"),g(31,dr,3,0,"ng-template",18),i(),n(32,"p-tabPanel"),g(33,cr,3,0,"ng-template",18),i()()(),n(34,"div",19)(35,"div",20)(36,"div",21),m(37,"i",22),i(),n(38,"div",23)(39,"span",24),r(40),i(),n(41,"span",25),r(42,"Demandes"),i()()(),n(43,"div",26)(44,"div",21),m(45,"i",27),i(),n(46,"div",23)(47,"span",24),r(48),i(),n(49,"span",25),r(50,"Montant total"),i()()(),g(51,mr,8,1,"div",28),i(),g(52,pr,6,2,"div",29)(53,ur,4,0,"div",30)(54,Mr,2,1),i()),e&2&&(l(8),Ce("active",a.isDemandesAuthorized())("inactive",!a.isDemandesAuthorized()),l(),de(a.isDemandesAuthorized()?"pi pi-lock-open":"pi pi-lock"),l(5),_(a.isDemandesAuthorized()?14:15),l(3),p("icon",a.isDemandesAuthorized()?"pi pi-lock":"pi pi-lock-open")("label",a.isDemandesAuthorized()?"D\xE9sactiver":"Activer")("severity",a.isDemandesAuthorized()?"danger":"success")("loading",a.isLoadingAuth()),l(8),p("text",!0)("loading",a.isLoading()),l(15),u(a.totalDemandes()),l(8),u(a.formatMontant(a.totalMontant())),l(3),_(a.hasSelection()&&a.selectedStatut()==="ENCOURS"?51:-1),l(),_(a.hasSelection()&&a.selectedStatut()==="ENCOURS"?52:-1),l(),_(a.isLoading()?53:-1),l(),_(a.isLoading()?-1:54))},dependencies:[j,ie,te,ne,ht,W,ge,N,q,$,F,ue,z,J,Y,Q,fe,_e,H,re,ye,lt,le,bt,_t,gt,K,U,Oe,Ct,ft,Me,Be],styles:[".rh-container[_ngcontent-%COMP%]{padding:1.5rem}.header-section[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:1.5rem}.header-section[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:var(--primary-color);margin:0 0 .5rem}.header-section[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:.5rem}.header-section[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{color:var(--text-color-secondary);margin:0}.filter-section[_ngcontent-%COMP%]{margin-bottom:1.5rem}.stats-section[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-bottom:1.5rem;flex-wrap:wrap}.stats-section[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]{background:#fff;border-radius:8px;padding:1rem 1.5rem;display:flex;align-items:center;gap:1rem;box-shadow:0 2px 4px #0000000d;border-left:4px solid var(--surface-400);min-width:180px}.stats-section[_ngcontent-%COMP%]   .stat-card.amount[_ngcontent-%COMP%]{border-left-color:var(--green-500)}.stats-section[_ngcontent-%COMP%]   .stat-card.amount[_ngcontent-%COMP%]   .stat-icon[_ngcontent-%COMP%]{background:var(--green-100);color:var(--green-600)}.stats-section[_ngcontent-%COMP%]   .stat-card.selected[_ngcontent-%COMP%]{border-left-color:var(--blue-500);background:var(--blue-50)}.stats-section[_ngcontent-%COMP%]   .stat-card.selected[_ngcontent-%COMP%]   .stat-icon[_ngcontent-%COMP%]{background:var(--blue-100);color:var(--blue-600)}.stats-section[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .stat-icon[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:50%;background:var(--surface-100);display:flex;align-items:center;justify-content:center}.stats-section[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .stat-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.25rem}.stats-section[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .stat-info[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{display:block;font-size:1.5rem;font-weight:700;color:var(--text-color)}.stats-section[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .stat-info[_ngcontent-%COMP%]   .stat-label[_ngcontent-%COMP%]{font-size:.85rem;color:var(--text-color-secondary)}.bulk-action-bar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;background:var(--blue-50);border:1px solid var(--blue-200);border-radius:8px;padding:1rem 1.5rem;margin-bottom:1.5rem}.bulk-action-bar[_ngcontent-%COMP%]   .selection-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;color:var(--blue-700);font-weight:500}.bulk-action-bar[_ngcontent-%COMP%]   .selection-info[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.25rem}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:4rem}.loading-container[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-top:1rem;color:var(--text-color-secondary)}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:4rem;background:var(--surface-50);border-radius:8px}.empty-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:4rem;color:var(--surface-400)}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:1rem 0 .5rem;color:var(--text-color)}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-color-secondary);margin:0}.days-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.day-card[_ngcontent-%COMP%]{background:#fff;border-radius:8px;box-shadow:0 2px 4px #0000000d;overflow:hidden;border:1px solid var(--surface-border)}.day-card.expanded[_ngcontent-%COMP%]   .day-header[_ngcontent-%COMP%]{border-bottom:1px solid var(--surface-border)}.day-card[_ngcontent-%COMP%]   .day-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem 1.5rem;cursor:pointer;transition:background .2s}.day-card[_ngcontent-%COMP%]   .day-header[_ngcontent-%COMP%]:hover{background:var(--surface-50)}.day-card[_ngcontent-%COMP%]   .day-header[_ngcontent-%COMP%]   .day-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.day-card[_ngcontent-%COMP%]   .day-header[_ngcontent-%COMP%]   .day-info[_ngcontent-%COMP%]   .day-toggle[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--text-color-secondary);transition:transform .2s}.day-card[_ngcontent-%COMP%]   .day-header[_ngcontent-%COMP%]   .day-info[_ngcontent-%COMP%]   .day-date[_ngcontent-%COMP%]   .date-full[_ngcontent-%COMP%]{font-weight:600;color:var(--text-color);text-transform:capitalize}.day-card[_ngcontent-%COMP%]   .day-header[_ngcontent-%COMP%]   .day-info[_ngcontent-%COMP%]   .day-date[_ngcontent-%COMP%]   .date-short[_ngcontent-%COMP%]{display:none;color:var(--text-color-secondary)}.day-card[_ngcontent-%COMP%]   .day-header[_ngcontent-%COMP%]   .day-info[_ngcontent-%COMP%]   .day-badges[_ngcontent-%COMP%]{display:flex;gap:.5rem}.day-card[_ngcontent-%COMP%]   .day-content[_ngcontent-%COMP%]{padding:1rem;background:var(--surface-50)}.day-card[_ngcontent-%COMP%]   .day-content[_ngcontent-%COMP%]   .select-all-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.75rem 1rem;background:#fff;border-radius:6px;margin-bottom:1rem}.day-card[_ngcontent-%COMP%]   .day-content[_ngcontent-%COMP%]   .select-all-row[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{cursor:pointer;color:var(--text-color-secondary);font-size:.9rem}.matricule-badge[_ngcontent-%COMP%]{background:var(--primary-100);color:var(--primary-700);padding:.25rem .5rem;border-radius:4px;font-weight:600;font-size:.85rem}.person-info[_ngcontent-%COMP%]   .person-name[_ngcontent-%COMP%]{font-weight:500}.montant[_ngcontent-%COMP%]{font-weight:600;color:var(--text-color)}.numero-compte[_ngcontent-%COMP%]{font-family:monospace;font-size:.85rem}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:.25rem}.selected-row[_ngcontent-%COMP%]{background:var(--blue-50)!important}[_nghost-%COMP%]     .amount-chip{background:var(--green-100);color:var(--green-700)}@media (max-width: 768px){.stats-section[_ngcontent-%COMP%]{flex-direction:column}.stats-section[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]{width:100%}.bulk-action-bar[_ngcontent-%COMP%]{flex-direction:column;gap:1rem;align-items:stretch;text-align:center}.day-card[_ngcontent-%COMP%]   .day-header[_ngcontent-%COMP%]{flex-direction:column;gap:1rem;align-items:flex-start}.day-card[_ngcontent-%COMP%]   .day-header[_ngcontent-%COMP%]   .day-info[_ngcontent-%COMP%]{flex-wrap:wrap}.day-card[_ngcontent-%COMP%]   .day-header[_ngcontent-%COMP%]   .day-info[_ngcontent-%COMP%]   .day-date[_ngcontent-%COMP%]   .date-full[_ngcontent-%COMP%]{display:none}.day-card[_ngcontent-%COMP%]   .day-header[_ngcontent-%COMP%]   .day-info[_ngcontent-%COMP%]   .day-date[_ngcontent-%COMP%]   .date-short[_ngcontent-%COMP%]{display:block}}.authorization-control[_ngcontent-%COMP%]{margin-bottom:1.5rem}.authorization-control[_ngcontent-%COMP%]   .auth-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem}.authorization-control[_ngcontent-%COMP%]   .auth-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.authorization-control[_ngcontent-%COMP%]   .auth-status[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%;display:flex;align-items:center;justify-content:center}.authorization-control[_ngcontent-%COMP%]   .auth-status[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.75rem}.authorization-control[_ngcontent-%COMP%]   .auth-status.active[_ngcontent-%COMP%]{background:var(--green-100)}.authorization-control[_ngcontent-%COMP%]   .auth-status.active[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--green-600)}.authorization-control[_ngcontent-%COMP%]   .auth-status.inactive[_ngcontent-%COMP%]{background:var(--red-100)}.authorization-control[_ngcontent-%COMP%]   .auth-status.inactive[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--red-600)}.authorization-control[_ngcontent-%COMP%]   .auth-text[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 .25rem;color:var(--text-color)}.authorization-control[_ngcontent-%COMP%]   .auth-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.authorization-control[_ngcontent-%COMP%]   .auth-text[_ngcontent-%COMP%]   .status-active[_ngcontent-%COMP%]{color:var(--green-600);font-weight:500}.authorization-control[_ngcontent-%COMP%]   .auth-text[_ngcontent-%COMP%]   .status-active[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:.25rem}.authorization-control[_ngcontent-%COMP%]   .auth-text[_ngcontent-%COMP%]   .status-inactive[_ngcontent-%COMP%]{color:var(--red-600);font-weight:500}.authorization-control[_ngcontent-%COMP%]   .auth-text[_ngcontent-%COMP%]   .status-inactive[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:.25rem}"]})};var Or=()=>({"min-width":"60rem"}),wr=(o,t)=>t.date;function Dr(o,t){if(o&1){let e=y();n(0,"p-button",23),f("onClick",function(){v(e);let s=d();return b(s.exportAllConfirmed())}),i()}if(o&2){let e=d();p("outlined",!0)("loading",e.isExporting())}}function Tr(o,t){if(o&1&&(m(0,"i",24),n(1,"span"),r(2,"\xC0 confirmer (valid\xE9es par DRH)"),i(),m(3,"p-badge",25)),o&2){let e=d();l(3),p("value",e.selectedStatut()==="VALIDER"?e.totalDemandes().toString():"")}}function Ir(o,t){o&1&&(m(0,"i",26),n(1,"span"),r(2,"Confirm\xE9es"),i())}function Ar(o,t){if(o&1&&(n(0,"div",20)(1,"div",13),m(2,"i",27),i(),n(3,"div",15)(4,"span",16),r(5),i(),n(6,"span",17),r(7,"S\xE9lectionn\xE9es"),i()()()),o&2){let e=d();l(5),u(e.totalSelected())}}function kr(o,t){if(o&1){let e=y();n(0,"div",21)(1,"div",28),m(2,"i",29),n(3,"span"),r(4),i()(),n(5,"p-button",30),f("onClick",function(){v(e);let s=d();return b(s.confirmConfirmerSelection())}),i()()}if(o&2){let e=d();l(4),C("",e.totalSelected()," demande(s) s\xE9lectionn\xE9e(s)"),l(),p("loading",e.isConfirming())}}function Vr(o,t){o&1&&(n(0,"div",22),m(1,"p-progressSpinner"),n(2,"span"),r(3,"Chargement des demandes..."),i()())}function Rr(o,t){o&1&&r(0," Il n'y a pas de demandes valid\xE9es par le DRH \xE0 confirmer pour le moment. ")}function Lr(o,t){o&1&&r(0," Il n'y a pas de demandes confirm\xE9es pour le moment. ")}function jr(o,t){if(o&1&&(n(0,"div",31),m(1,"i",33),n(2,"h3"),r(3,"Aucune demande"),i(),n(4,"p"),g(5,Rr,1,0)(6,Lr,1,0),i()()),o&2){let e=d(2);l(5),_(e.selectedStatut()==="VALIDER"?5:6)}}function Nr(o,t){if(o&1){let e=y();n(0,"p-button",49),f("onClick",function(){v(e);let s=d().$implicit,c=d(3);return b(c.confirmConfirmerJour(s))}),i()}if(o&2){let e=d(4);p("outlined",!0)("loading",e.isConfirming())}}function Fr(o,t){if(o&1){let e=y();n(0,"p-button",50),f("onClick",function(){v(e);let s=d().$implicit,c=d(3);return b(c.exportJour(s))}),i()}if(o&2){let e=d(4);p("outlined",!0)("loading",e.isExporting())}}function $r(o,t){if(o&1){let e=y();n(0,"div",51)(1,"p-checkbox",55),k("ngModelChange",function(s){v(e);let c=d(2).$implicit;return A(c.allSelected,s)||(c.allSelected=s),b(s)}),f("onChange",function(){v(e);let s=d(2).$implicit,c=d(3);return b(c.toggleSelectAll(s))}),i(),n(2,"label",56),r(3),i()()}if(o&2){let e=d(2).$implicit;l(),he("inputId","selectAll-",e.date,""),I("ngModel",e.allSelected),p("binary",!0),l(),he("for","selectAll-",e.date,""),l(),T(" Tout s\xE9lectionner (",(e.selectedIds==null?null:e.selectedIds.length)||0,"/",e.count,") ")}}function qr(o,t){o&1&&m(0,"th",57)}function zr(o,t){if(o&1&&(n(0,"tr"),g(1,qr,1,0,"th",57),n(2,"th",58),r(3,"Matricule"),i(),n(4,"th"),r(5,"Nom & Pr\xE9nom"),i(),n(6,"th",59),r(7,"N\xB0 Compte"),i(),n(8,"th",60),r(9,"T\xE9l\xE9phone"),i(),n(10,"th",61),r(11,"Montant"),i(),n(12,"th",62),r(13,"Heure"),i(),n(14,"th",63),r(15,"Actions"),i()()),o&2){let e=d(5);l(),_(e.selectedStatut()==="VALIDER"?1:-1)}}function Br(o,t){if(o&1){let e=y();n(0,"td")(1,"p-checkbox",73),f("onChange",function(){v(e);let s=d().$implicit,c=d(2).$implicit,x=d(3);return b(x.toggleSelectDemande(c,s.id))}),i()()}if(o&2){let e=d().$implicit,a=d(2).$implicit,s=d(3);l(),p("binary",!0)("ngModel",s.isSelected(a,e.id))}}function Ur(o,t){if(o&1){let e=y();n(0,"div",71)(1,"p-button",74),f("onClick",function(){v(e);let s=d().$implicit,c=d(5);return b(c.confirmConfirmer(s))}),i(),n(2,"p-button",75),f("onClick",function(){v(e);let s=d().$implicit,c=d(5);return b(c.confirmRejeter(s))}),i()()}if(o&2){let e=d().$implicit,a=d(5);l(),p("rounded",!0)("text",!0)("loading",a.confirmingId()===e.id),l(),p("rounded",!0)("text",!0)("loading",a.confirmingId()===e.id)}}function Jr(o,t){if(o&1&&m(0,"p-tag",72),o&2){let e=d().$implicit,a=d(5);p("value",a.getStatutLabel(e.statut))("severity",a.getStatutSeverity(e.statut))}}function Wr(o,t){if(o&1&&(n(0,"tr"),g(1,Br,2,2,"td"),n(2,"td")(3,"span",64),r(4),i()(),n(5,"td")(6,"div",65)(7,"span",66),r(8),i()()(),n(9,"td")(10,"span",67),r(11),i()(),n(12,"td")(13,"span",68),r(14),i()(),n(15,"td",69)(16,"span",70),r(17),i()(),n(18,"td"),r(19),L(20,"javaDate"),i(),n(21,"td"),g(22,Ur,3,6,"div",71)(23,Jr,1,2,"p-tag",72),i()()),o&2){let e=t.$implicit,a=d(2).$implicit,s=d(3);Ce("selected-row",s.isSelected(a,e.id)),l(),_(s.selectedStatut()==="VALIDER"?1:-1),l(3),u(e.matricule),l(4),T("",e.prenomPersonnel," ",e.nomPersonnel,""),l(3),u(e.numeroCompte||"-"),l(3),u(e.phone||"-"),l(3),u(s.formatMontant(e.amount)),l(2),C(" ",ee(20,11,e.createdAt,"HH:mm")," "),l(3),_(s.selectedStatut()==="VALIDER"?22:23)}}function Gr(o,t){if(o&1&&(n(0,"tr")(1,"td",69)(2,"strong"),r(3,"Total du jour:"),i()(),n(4,"td",69)(5,"strong",76),r(6),i()(),m(7,"td",77),i()),o&2){let e=d(2).$implicit,a=d(3);l(),Ze("colspan",a.selectedStatut()==="VALIDER"?5:4),l(5),u(a.formatMontant(e.totalAmount))}}function Hr(o,t){if(o&1&&(n(0,"div",48),g(1,$r,4,8,"div",51),n(2,"p-table",52),g(3,zr,16,1,"ng-template",10)(4,Wr,24,14,"ng-template",53)(5,Gr,8,2,"ng-template",54),i()()),o&2){let e=d().$implicit,a=d(3);l(),_(a.selectedStatut()==="VALIDER"?1:-1),l(),p("value",e.demandes)("tableStyle",M(3,Or))}}function Qr(o,t){if(o&1){let e=y();n(0,"div",35)(1,"div",36),f("click",function(){let s=v(e).$implicit,c=d(3);return b(c.toggleDay(s))}),n(2,"div",37)(3,"div",38),m(4,"i"),i(),n(5,"div",39)(6,"span",40),r(7),i(),n(8,"span",41),r(9),i()(),n(10,"div",42),m(11,"p-chip",43)(12,"p-chip",44),i()(),n(13,"div",45),f("click",function(s){return v(e),b(s.stopPropagation())}),g(14,Nr,1,2,"p-button",46)(15,Fr,1,2,"p-button",47),i()(),g(16,Hr,6,4,"div",48),i()}if(o&2){let e=t.$implicit,a=d(3);Ce("expanded",e.expanded),l(4),de(e.expanded?"pi pi-chevron-down":"pi pi-chevron-right"),l(3),u(a.formatDate(e.date)),l(2),u(a.formatDateShort(e.date)),l(2),p("label",e.count+" demande(s)"),l(),p("label",a.formatMontant(e.totalAmount)),l(2),_(a.selectedStatut()==="VALIDER"?14:15),l(2),_(e.expanded?16:-1)}}function Yr(o,t){if(o&1&&(n(0,"div",32),me(1,Qr,17,10,"div",34,wr),i()),o&2){let e=d(2);l(),pe(e.demandesParJour())}}function Kr(o,t){if(o&1&&g(0,jr,7,1,"div",31)(1,Yr,3,0,"div",32),o&2){let e=d();_(e.demandesParJour().length===0?0:1)}}var Vt=class o{user;salaireService=P(V);messageService=P(w);confirmationService=P(Z);isLoading=E(!1);isConfirming=E(!1);isExporting=E(!1);confirmingId=E(null);demandesParJour=E([]);selectedStatut=E("VALIDER");totalDemandes=O(()=>this.demandesParJour().reduce((t,e)=>t+e.count,0));totalMontant=O(()=>this.demandesParJour().reduce((t,e)=>t+e.totalAmount,0));totalSelected=O(()=>this.demandesParJour().reduce((t,e)=>t+(e.selectedIds?.length||0),0));hasSelection=O(()=>this.totalSelected()>0);confirmedIds=E([]);ngOnInit(){this.loadDemandesGroupedByDate()}loadDemandesGroupedByDate(){this.isLoading.set(!0),this.salaireService.getDemandesGroupedByDate(this.selectedStatut()).subscribe({next:t=>{if(t.data?.groupedDemandes){let e=t.data.groupedDemandes;this.demandesParJour.set(e.map(a=>S(h({},a),{expanded:!1,selectedIds:[],allSelected:!1})))}this.isLoading.set(!1)},error:t=>{console.error("Erreur chargement demandes:",t),this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de charger les demandes"}),this.isLoading.set(!1)}})}onStatutChange(t){this.selectedStatut.set(t),this.loadDemandesGroupedByDate()}toggleDay(t){t.expanded=!t.expanded}toggleSelectAll(t){t.allSelected?t.selectedIds=t.demandes.map(e=>e.id):t.selectedIds=[],this.demandesParJour.set([...this.demandesParJour()])}toggleSelectDemande(t,e){t.selectedIds||(t.selectedIds=[]);let a=t.selectedIds.indexOf(e);a>-1?t.selectedIds.splice(a,1):t.selectedIds.push(e),t.allSelected=t.selectedIds.length===t.demandes.length,this.demandesParJour.set([...this.demandesParJour()])}isSelected(t,e){return t.selectedIds?.includes(e)||!1}confirmConfirmer(t){this.confirmationService.confirm({message:`Voulez-vous confirmer la demande de ${this.formatMontant(t.amount)} pour ${t.prenomPersonnel} ${t.nomPersonnel} ?`,header:"Confirmer la demande",icon:"pi pi-check-circle",acceptLabel:"Confirmer",rejectLabel:"Annuler",acceptButtonStyleClass:"p-button-success",accept:()=>{this.confirmerDemande(t.id)}})}confirmerDemande(t){this.confirmingId.set(t),this.salaireService.confirmerDemandeSalary(t).subscribe({next:e=>{this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Demande confirm\xE9e avec succ\xE8s"}),this.confirmingId.set(null),this.confirmedIds.update(a=>[...a,t]),this.loadDemandesGroupedByDate()},error:e=>{console.error("Erreur confirmation:",e),this.messageService.add({severity:"error",summary:"Erreur",detail:e.error?.message||"Impossible de confirmer la demande"}),this.confirmingId.set(null)}})}confirmConfirmerSelection(){let t=this.totalSelected();this.confirmationService.confirm({message:`Voulez-vous confirmer les ${t} demande(s) s\xE9lectionn\xE9e(s) ?`,header:"Confirmation massive",icon:"pi pi-check-circle",acceptLabel:`Confirmer ${t} demande(s)`,rejectLabel:"Annuler",acceptButtonStyleClass:"p-button-success",accept:()=>{this.confirmerSelection()}})}confirmerSelection(){let t=[];if(this.demandesParJour().forEach(e=>{e.selectedIds&&e.selectedIds.length>0&&t.push(...e.selectedIds)}),t.length===0){this.messageService.add({severity:"warn",summary:"Attention",detail:"Aucune demande s\xE9lectionn\xE9e"});return}this.isConfirming.set(!0),this.salaireService.confirmerMultipleDemandeSalary(t).subscribe({next:e=>{let a=e.data?.totalConfirmed||0;this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:`${a} demande(s) confirm\xE9e(s) avec succ\xE8s`}),this.isConfirming.set(!1),this.confirmedIds.update(s=>[...s,...t]),this.proposeExport(t),this.loadDemandesGroupedByDate()},error:e=>{console.error("Erreur confirmation massive:",e),this.messageService.add({severity:"error",summary:"Erreur",detail:e.error?.message||"Erreur lors de la confirmation massive"}),this.isConfirming.set(!1)}})}confirmConfirmerJour(t){this.confirmationService.confirm({message:`Voulez-vous confirmer les ${t.count} demande(s) du ${this.formatDate(t.date)} pour un total de ${this.formatMontant(t.totalAmount)} ?`,header:"Confirmer toutes les demandes du jour",icon:"pi pi-check-circle",acceptLabel:`Confirmer ${t.count} demande(s)`,rejectLabel:"Annuler",acceptButtonStyleClass:"p-button-success",accept:()=>{this.confirmerJour(t)}})}confirmerJour(t){let e=t.demandes.map(a=>a.id);this.isConfirming.set(!0),this.salaireService.confirmerMultipleDemandeSalary(e).subscribe({next:a=>{let s=a.data?.totalConfirmed||0;this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:`${s} demande(s) du ${this.formatDate(t.date)} confirm\xE9e(s)`}),this.isConfirming.set(!1),this.proposeExport(e),this.loadDemandesGroupedByDate()},error:a=>{console.error("Erreur confirmation jour:",a),this.messageService.add({severity:"error",summary:"Erreur",detail:a.error?.message||"Erreur lors de la confirmation"}),this.isConfirming.set(!1)}})}confirmRejeter(t){this.confirmationService.confirm({message:`Voulez-vous rejeter la demande de ${this.formatMontant(t.amount)} pour ${t.prenomPersonnel} ${t.nomPersonnel} ?`,header:"Confirmer le rejet",icon:"pi pi-times-circle",acceptLabel:"Rejeter",rejectLabel:"Annuler",acceptButtonStyleClass:"p-button-danger",accept:()=>{this.rejeterDemande(t.id)}})}rejeterDemande(t){this.confirmingId.set(t),this.salaireService.rejeterDemandeSalary(t).subscribe({next:e=>{this.messageService.add({severity:"info",summary:"Information",detail:"Demande rejet\xE9e"}),this.confirmingId.set(null),this.loadDemandesGroupedByDate()},error:e=>{console.error("Erreur rejet:",e),this.messageService.add({severity:"error",summary:"Erreur",detail:e.error?.message||"Impossible de rejeter la demande"}),this.confirmingId.set(null)}})}proposeExport(t){this.confirmationService.confirm({message:"Voulez-vous exporter ces demandes en Excel ?",header:"Export Excel",icon:"pi pi-file-excel",acceptLabel:"Exporter",rejectLabel:"Plus tard",acceptButtonStyleClass:"p-button-success",accept:()=>{this.exportExcel(t)}})}exportExcel(t){this.isExporting.set(!0),(t&&t.length>0?this.salaireService.exportDemandesExcel(t):this.salaireService.exportAllConfirmedDemandesExcel()).subscribe({next:a=>{if(a.type==="application/json"){a.text().then(c=>{try{let x=JSON.parse(c);this.messageService.add({severity:"warn",summary:"Attention",detail:x.message||"Aucune donn\xE9e \xE0 exporter"})}catch{this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible d'exporter le fichier"})}this.isExporting.set(!1)});return}let s=`avances_salaire_${new Date().toISOString().split("T")[0]}.xlsx`;this.downloadFile(a,s),this.messageService.add({severity:"success",summary:"Export r\xE9ussi",detail:"Le fichier Excel a \xE9t\xE9 t\xE9l\xE9charg\xE9"}),this.isExporting.set(!1)},error:a=>{console.error("Erreur export:",a),a.error instanceof Blob?a.error.text().then(s=>{try{let c=JSON.parse(s);this.messageService.add({severity:"error",summary:"Erreur",detail:c.message||"Impossible d'exporter le fichier"})}catch{this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible d'exporter le fichier"})}}):this.messageService.add({severity:"error",summary:"Erreur",detail:a.error?.message||"Impossible d'exporter le fichier"}),this.isExporting.set(!1)}})}exportAllConfirmed(){this.isExporting.set(!0),this.salaireService.exportAllConfirmedDemandesExcel().subscribe({next:t=>{if(t.type==="application/json"){t.text().then(a=>{try{let s=JSON.parse(a);this.messageService.add({severity:"warn",summary:"Attention",detail:s.message||"Aucune donn\xE9e \xE0 exporter"})}catch{this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible d'exporter le fichier"})}this.isExporting.set(!1)});return}let e=`avances_salaire_confirmees_${new Date().toISOString().split("T")[0]}.xlsx`;this.downloadFile(t,e),this.messageService.add({severity:"success",summary:"Export r\xE9ussi",detail:"Le fichier Excel a \xE9t\xE9 t\xE9l\xE9charg\xE9"}),this.isExporting.set(!1)},error:t=>{console.error("Erreur export:",t),t.error instanceof Blob?t.error.text().then(e=>{try{let a=JSON.parse(e);this.messageService.add({severity:"error",summary:"Erreur",detail:a.message||"Impossible d'exporter le fichier"})}catch{this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible d'exporter le fichier"})}}):this.messageService.add({severity:"error",summary:"Erreur",detail:t.error?.message||"Impossible d'exporter le fichier"}),this.isExporting.set(!1)}})}downloadFile(t,e){let a=window.URL.createObjectURL(t),s=document.createElement("a");s.href=a,s.download=e,s.click(),window.URL.revokeObjectURL(a)}formatMontant(t){return t==null?"-":new Intl.NumberFormat("fr-FR",{style:"currency",currency:"GNF",minimumFractionDigits:0,maximumFractionDigits:0}).format(t)}formatDate(t){return new Date(t).toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long",year:"numeric"})}formatDateShort(t){return new Date(t).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}getStatutSeverity(t){switch(t?.toUpperCase()){case"ENCOURS":return"info";case"VALIDER":return"warn";case"CONFIRMER":return"success";case"REJET":return"danger";case"ANNULLER":return"secondary";default:return"info"}}getStatutLabel(t){switch(t?.toUpperCase()){case"ENCOURS":return"En cours";case"VALIDER":return"Valid\xE9e (DRH)";case"CONFIRMER":return"Confirm\xE9e (DF)";case"REJET":return"Rejet\xE9e";case"ANNULLER":return"Annul\xE9e";default:return t}}getDemandeIds(t){return t.demandes.map(e=>e.id)}exportJour(t){let e=this.getDemandeIds(t);this.exportExcel(e)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=D({type:o,selectors:[["app-df"]],inputs:{user:"user"},features:[G([w,Z])],decls:40,vars:9,consts:[[1,"df-container"],[1,"header-section"],[1,"header-content"],[1,"pi","pi-building"],[1,"subtitle"],[1,"header-actions"],["icon","pi pi-refresh","label","Actualiser",3,"onClick","text","loading"],["icon","pi pi-file-excel","label","Exporter tout (Excel)","severity","success",3,"outlined","loading"],[1,"filter-section"],[3,"onChange"],["pTemplate","header"],[1,"stats-section"],[1,"stat-card"],[1,"stat-icon"],[1,"pi","pi-file"],[1,"stat-info"],[1,"stat-value"],[1,"stat-label"],[1,"stat-card","amount"],[1,"pi","pi-wallet"],[1,"stat-card","selected"],[1,"bulk-action-bar"],[1,"loading-container"],["icon","pi pi-file-excel","label","Exporter tout (Excel)","severity","success",3,"onClick","outlined","loading"],[1,"pi","pi-clock","mr-2"],["severity","warn",1,"ml-2",3,"value"],[1,"pi","pi-check-circle","mr-2"],[1,"pi","pi-check-square"],[1,"selection-info"],[1,"pi","pi-info-circle"],["icon","pi pi-check-circle","label","Confirmer la s\xE9lection","severity","success",3,"onClick","loading"],[1,"empty-state"],[1,"days-list"],[1,"pi","pi-inbox"],[1,"day-card",3,"expanded"],[1,"day-card"],[1,"day-header",3,"click"],[1,"day-info"],[1,"day-toggle"],[1,"day-date"],[1,"date-full"],[1,"date-short"],[1,"day-badges"],["icon","pi pi-file",3,"label"],["icon","pi pi-wallet","styleClass","amount-chip",3,"label"],[1,"day-actions",3,"click"],["icon","pi pi-check-circle","label","Tout confirmer","severity","success","size","small",3,"outlined","loading"],["icon","pi pi-file-excel","label","Exporter","severity","success","size","small",3,"outlined","loading"],[1,"day-content"],["icon","pi pi-check-circle","label","Tout confirmer","severity","success","size","small",3,"onClick","outlined","loading"],["icon","pi pi-file-excel","label","Exporter","severity","success","size","small",3,"onClick","outlined","loading"],[1,"select-all-row"],["styleClass","p-datatable-sm p-datatable-striped",3,"value","tableStyle"],["pTemplate","body"],["pTemplate","footer"],[3,"ngModelChange","onChange","ngModel","binary","inputId"],[3,"for"],[2,"width","50px"],[2,"width","80px"],[2,"width","130px"],[2,"width","120px"],[2,"width","140px"],[2,"width","100px"],[2,"width","150px"],[1,"matricule-badge"],[1,"person-info"],[1,"person-name"],[1,"numero-compte"],[1,"phone"],[1,"text-right"],[1,"montant"],[1,"action-buttons"],[3,"value","severity"],[3,"onChange","binary","ngModel"],["icon","pi pi-check","severity","success","size","small","pTooltip","Confirmer",3,"onClick","rounded","text","loading"],["icon","pi pi-times","severity","danger","size","small","pTooltip","Rejeter",3,"onClick","rounded","text","loading"],[1,"montant-total"],["colspan","2"]],template:function(e,a){e&1&&(m(0,"p-toast")(1,"p-confirmDialog"),n(2,"div",0)(3,"div",1)(4,"div",2)(5,"h2"),m(6,"i",3),r(7," Direction Financi\xE8re - Gestion des demandes"),i(),n(8,"p",4),r(9,"Confirmez les demandes valid\xE9es par le DRH et exportez les donn\xE9es"),i()(),n(10,"div",5)(11,"p-button",6),f("onClick",function(){return a.loadDemandesGroupedByDate()}),i(),g(12,Dr,1,2,"p-button",7),i()(),n(13,"div",8)(14,"p-tabView",9),f("onChange",function(c){return a.onStatutChange(c.index===0?"VALIDER":"CONFIRMER")}),n(15,"p-tabPanel"),g(16,Tr,4,1,"ng-template",10),i(),n(17,"p-tabPanel"),g(18,Ir,3,0,"ng-template",10),i()()(),n(19,"div",11)(20,"div",12)(21,"div",13),m(22,"i",14),i(),n(23,"div",15)(24,"span",16),r(25),i(),n(26,"span",17),r(27,"Demandes"),i()()(),n(28,"div",18)(29,"div",13),m(30,"i",19),i(),n(31,"div",15)(32,"span",16),r(33),i(),n(34,"span",17),r(35,"Montant total"),i()()(),g(36,Ar,8,1,"div",20),i(),g(37,kr,6,2,"div",21)(38,Vr,4,0,"div",22)(39,Kr,2,1),i()),e&2&&(l(11),p("text",!0)("loading",a.isLoading()),l(),_(a.selectedStatut()==="CONFIRMER"?12:-1),l(13),u(a.totalDemandes()),l(8),u(a.formatMontant(a.totalMontant())),l(3),_(a.hasSelection()&&a.selectedStatut()==="VALIDER"?36:-1),l(),_(a.hasSelection()&&a.selectedStatut()==="VALIDER"?37:-1),l(),_(a.isLoading()?38:-1),l(),_(a.isLoading()?-1:39))},dependencies:[j,ie,te,ne,ht,W,N,q,$,F,ue,z,J,Y,Q,fe,_e,H,re,ye,lt,le,_t,gt,K,U,Oe,Ct,ft,Me,Be],styles:[".df-container[_ngcontent-%COMP%]{padding:1.5rem}.header-section[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:1.5rem;flex-wrap:wrap;gap:1rem}.header-section[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:var(--primary-color);margin:0 0 .5rem}.header-section[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:.5rem}.header-section[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{color:var(--text-color-secondary);margin:0}.header-section[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem}.filter-section[_ngcontent-%COMP%]{margin-bottom:1.5rem}.stats-section[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-bottom:1.5rem;flex-wrap:wrap}.stats-section[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]{background:#fff;border-radius:8px;padding:1rem 1.5rem;display:flex;align-items:center;gap:1rem;box-shadow:0 2px 4px #0000000d;border-left:4px solid var(--surface-400);min-width:180px}.stats-section[_ngcontent-%COMP%]   .stat-card.amount[_ngcontent-%COMP%]{border-left-color:var(--green-500)}.stats-section[_ngcontent-%COMP%]   .stat-card.amount[_ngcontent-%COMP%]   .stat-icon[_ngcontent-%COMP%]{background:var(--green-100);color:var(--green-600)}.stats-section[_ngcontent-%COMP%]   .stat-card.selected[_ngcontent-%COMP%]{border-left-color:var(--blue-500);background:var(--blue-50)}.stats-section[_ngcontent-%COMP%]   .stat-card.selected[_ngcontent-%COMP%]   .stat-icon[_ngcontent-%COMP%]{background:var(--blue-100);color:var(--blue-600)}.stats-section[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .stat-icon[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:50%;background:var(--surface-100);display:flex;align-items:center;justify-content:center}.stats-section[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .stat-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.25rem}.stats-section[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .stat-info[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{display:block;font-size:1.5rem;font-weight:700;color:var(--text-color)}.stats-section[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .stat-info[_ngcontent-%COMP%]   .stat-label[_ngcontent-%COMP%]{font-size:.85rem;color:var(--text-color-secondary)}.bulk-action-bar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;background:var(--green-50);border:1px solid var(--green-200);border-radius:8px;padding:1rem 1.5rem;margin-bottom:1.5rem}.bulk-action-bar[_ngcontent-%COMP%]   .selection-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;color:var(--green-700);font-weight:500}.bulk-action-bar[_ngcontent-%COMP%]   .selection-info[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.25rem}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:4rem}.loading-container[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-top:1rem;color:var(--text-color-secondary)}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:4rem;background:var(--surface-50);border-radius:8px}.empty-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:4rem;color:var(--surface-400)}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:1rem 0 .5rem;color:var(--text-color)}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-color-secondary);margin:0}.days-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.day-card[_ngcontent-%COMP%]{background:#fff;border-radius:8px;box-shadow:0 2px 4px #0000000d;overflow:hidden;border:1px solid var(--surface-border)}.day-card.expanded[_ngcontent-%COMP%]   .day-header[_ngcontent-%COMP%]{border-bottom:1px solid var(--surface-border)}.day-card[_ngcontent-%COMP%]   .day-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem 1.5rem;cursor:pointer;transition:background .2s}.day-card[_ngcontent-%COMP%]   .day-header[_ngcontent-%COMP%]:hover{background:var(--surface-50)}.day-card[_ngcontent-%COMP%]   .day-header[_ngcontent-%COMP%]   .day-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.day-card[_ngcontent-%COMP%]   .day-header[_ngcontent-%COMP%]   .day-info[_ngcontent-%COMP%]   .day-toggle[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--text-color-secondary);transition:transform .2s}.day-card[_ngcontent-%COMP%]   .day-header[_ngcontent-%COMP%]   .day-info[_ngcontent-%COMP%]   .day-date[_ngcontent-%COMP%]   .date-full[_ngcontent-%COMP%]{font-weight:600;color:var(--text-color);text-transform:capitalize}.day-card[_ngcontent-%COMP%]   .day-header[_ngcontent-%COMP%]   .day-info[_ngcontent-%COMP%]   .day-date[_ngcontent-%COMP%]   .date-short[_ngcontent-%COMP%]{display:none;color:var(--text-color-secondary)}.day-card[_ngcontent-%COMP%]   .day-header[_ngcontent-%COMP%]   .day-info[_ngcontent-%COMP%]   .day-badges[_ngcontent-%COMP%]{display:flex;gap:.5rem}.day-card[_ngcontent-%COMP%]   .day-content[_ngcontent-%COMP%]{padding:1rem;background:var(--surface-50)}.day-card[_ngcontent-%COMP%]   .day-content[_ngcontent-%COMP%]   .select-all-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.75rem 1rem;background:#fff;border-radius:6px;margin-bottom:1rem}.day-card[_ngcontent-%COMP%]   .day-content[_ngcontent-%COMP%]   .select-all-row[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{cursor:pointer;color:var(--text-color-secondary);font-size:.9rem}.matricule-badge[_ngcontent-%COMP%]{background:var(--primary-100);color:var(--primary-700);padding:.25rem .5rem;border-radius:4px;font-weight:600;font-size:.85rem}.person-info[_ngcontent-%COMP%]   .person-name[_ngcontent-%COMP%]{font-weight:500}.montant[_ngcontent-%COMP%]{font-weight:600;color:var(--text-color)}.montant-total[_ngcontent-%COMP%]{font-size:1.1rem;color:var(--green-600)}.numero-compte[_ngcontent-%COMP%], .phone[_ngcontent-%COMP%]{font-family:monospace;font-size:.85rem}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:.25rem}.selected-row[_ngcontent-%COMP%]{background:var(--green-50)!important}[_nghost-%COMP%]     .amount-chip{background:var(--green-100);color:var(--green-700)}@media (max-width: 768px){.header-section[_ngcontent-%COMP%]{flex-direction:column}.header-section[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]{width:100%;justify-content:flex-end}.stats-section[_ngcontent-%COMP%]{flex-direction:column}.stats-section[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]{width:100%}.bulk-action-bar[_ngcontent-%COMP%]{flex-direction:column;gap:1rem;align-items:stretch;text-align:center}.day-card[_ngcontent-%COMP%]   .day-header[_ngcontent-%COMP%]{flex-direction:column;gap:1rem;align-items:flex-start}.day-card[_ngcontent-%COMP%]   .day-header[_ngcontent-%COMP%]   .day-info[_ngcontent-%COMP%]{flex-wrap:wrap}.day-card[_ngcontent-%COMP%]   .day-header[_ngcontent-%COMP%]   .day-info[_ngcontent-%COMP%]   .day-date[_ngcontent-%COMP%]   .date-full[_ngcontent-%COMP%]{display:none}.day-card[_ngcontent-%COMP%]   .day-header[_ngcontent-%COMP%]   .day-info[_ngcontent-%COMP%]   .day-date[_ngcontent-%COMP%]   .date-short[_ngcontent-%COMP%]{display:block}.day-card[_ngcontent-%COMP%]   .day-header[_ngcontent-%COMP%]   .day-actions[_ngcontent-%COMP%], .day-card[_ngcontent-%COMP%]   .day-header[_ngcontent-%COMP%]   .day-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}}"]})};function Zr(o,t){o&1&&m(0,"app-admin")}function Xr(o,t){o&1&&m(0,"app-agent-credit")}function el(o,t){if(o&1&&m(0,"app-resp-agent",0),o&2){let e=d();p("user",e.state().user)}}function tl(o,t){if(o&1&&m(0,"app-logistique",0),o&2){let e=d(2);p("user",e.state().user)}}function nl(o,t){if(o&1&&m(0,"app-societariat",0),o&2){let e=d(2);p("user",e.state().user)}}function il(o,t){if(o&1&&m(0,"app-demande-avance-salaire",0),o&2){let e=d(2);p("user",e.state().user)}}function ol(o,t){if(o&1&&m(0,"app-rh",0),o&2){let e=d(2);p("user",e.state().user)}}function al(o,t){if(o&1&&m(0,"app-de",0),o&2){let e=d(2);p("user",e.state().user)}}function rl(o,t){if(o&1&&m(0,"app-df",0),o&2){let e=d(2);p("user",e.state().user)}}function ll(o,t){if(o&1&&m(0,"app-digital-verification",0),o&2){let e=d(2);p("user",e.state().user)}}function sl(o,t){if(o&1&&g(0,tl,1,1,"app-logistique",0)(1,nl,1,1,"app-societariat",0)(2,il,1,1,"app-demande-avance-salaire",0)(3,ol,1,1,"app-rh",0)(4,al,1,1,"app-de",0)(5,rl,1,1,"app-df",0)(6,ll,1,1,"app-digital-verification",0),o&2){let e,a=d();_((e=(e=a.state().user)==null?null:e.service)==="Logistique"?0:e==="Societariat"?1:e==="Personnel"?2:e==="DRH"?3:e==="DE"?4:e==="DF"?5:6)}}function dl(o,t){if(o&1&&m(0,"app-demande-avance-salaire",0),o&2){let e=d(2);p("user",e.state().user)}}function cl(o,t){if(o&1&&g(0,dl,1,1,"app-demande-avance-salaire",0),o&2){let e,a=d();_((e=(e=a.state().user)==null?null:e.service)==="Personnel"?0:-1)}}function ml(o,t){if(o&1&&m(0,"app-list-stock",0),o&2){let e=d();p("user",e.state().user)}}function pl(o,t){if(o&1&&m(0,"app-rapprochement-caisse",0),o&2){let e=d();p("user",e.state().user)}}function ul(o,t){if(o&1&&m(0,"app-correction-rejet-pp",0),o&2){let e=d();p("user",e.state().user)}}function gl(o,t){o&1&&m(0,"app-rotation-agent")}function _l(o,t){o&1&&(n(0,"div",1)(1,"p"),r(2,"R\xF4le non reconnu. Veuillez contacter l'administrateur."),i()())}var Sn=class o{state=E({loading:!1,message:void 0,error:void 0});destroyRef=P(oe);userService=P(V);ngOnInit(){this.loadUserProfile()}loadUserProfile(){console.log("Loading user profile..."),this.state.update(t=>S(h({},t),{loading:!0,message:void 0,error:void 0})),this.userService.getInstanceUser$().pipe(B(this.destroyRef)).subscribe({next:t=>{this.state.update(e=>S(h({},e),{loading:!1,user:t.data.user,message:void 0,error:void 0}))},error:t=>{this.state.update(e=>S(h({},e),{loading:!1,user:void 0,message:void 0,error:t}))},complete:()=>{}})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=D({type:o,selectors:[["app-home"]],decls:10,vars:1,consts:[[3,"user"],[1,"alert","alert-warning"]],template:function(e,a){if(e&1&&g(0,Zr,1,0,"app-admin")(1,Xr,1,0,"app-agent-credit")(2,el,1,1,"app-resp-agent",0)(3,sl,7,1)(4,cl,1,1)(5,ml,1,1,"app-list-stock",0)(6,pl,1,1,"app-rapprochement-caisse",0)(7,ul,1,1,"app-correction-rejet-pp",0)(8,gl,1,0,"app-rotation-agent")(9,_l,3,0,"div",1),e&2){let s;_(((s=a.state().user)==null?null:s.role)==="SUPER_ADMIN"?0:((s=a.state().user)==null?null:s.role)==="AGENT_CREDIT"?1:((s=a.state().user)==null?null:s.role)==="DA"?2:((s=a.state().user)==null?null:s.role)==="MANAGER"?3:((s=a.state().user)==null?null:s.role)==="USER"?4:((s=a.state().user)==null?null:s.role)==="DR"?5:((s=a.state().user)==null?null:s.role)==="CAISSE"?6:((s=a.state().user)==null?null:s.role)==="AGENT_CORRECTEUR"?7:((s=a.state().user)==null?null:s.role)==="RA"?8:9)}},dependencies:[Zt,St,yt,Et,tn,on,Ot,wt,Tt,It,At,gn,kt,Vt],encapsulation:2})};export{Sn as HomeComponent};
