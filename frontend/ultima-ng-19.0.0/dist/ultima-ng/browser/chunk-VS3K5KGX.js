import{b as re}from"./chunk-7S2LPA2W.js";import{a as ee,b as te,c as ne,e as ie,f as oe}from"./chunk-MVMJFDGQ.js";import{b as Z}from"./chunk-4JPZ5GKU.js";import{a as q,b as z}from"./chunk-GBSAZIIF.js";import{b as J}from"./chunk-ML3LU6MO.js";import{a as Q,k as W}from"./chunk-SRGIHKGJ.js";import"./chunk-KLDL5O4H.js";import"./chunk-PXEEYFPS.js";import"./chunk-4MNJFNZT.js";import"./chunk-7A4CRAMP.js";import"./chunk-3WTE2CKQ.js";import"./chunk-LA2FUI34.js";import"./chunk-ZNTL7BEM.js";import{a as X,b as Y}from"./chunk-QZOXHZZK.js";import"./chunk-MPVO6A2U.js";import"./chunk-D6YNXGTA.js";import"./chunk-ED7TFTUL.js";import"./chunk-MZ7FZGG3.js";import"./chunk-HNZBC55R.js";import"./chunk-J62YMCRW.js";import"./chunk-J6B6CWYC.js";import"./chunk-IEQZB3PI.js";import"./chunk-ATSSA22C.js";import"./chunk-XYTTGGFW.js";import"./chunk-ZNT52ZF3.js";import{b as $,d as j}from"./chunk-Z7KSDRLV.js";import"./chunk-N4Q6Z3MW.js";import{a as G}from"./chunk-3BEM77IG.js";import{d as O,e as w}from"./chunk-UCSGE5ZL.js";import"./chunk-2O7XYKW4.js";import{a as H}from"./chunk-YTFCGSG6.js";import{b as V}from"./chunk-R2ZYXRFE.js";import"./chunk-NRZ4QNP7.js";import"./chunk-GFZUU5ZD.js";import"./chunk-BODZH67C.js";import"./chunk-KR7F45VC.js";import{f as B,g as K}from"./chunk-XKXBFP6V.js";import"./chunk-ULM4QL4Q.js";import{oa as T,sa as k}from"./chunk-3YZBLOIS.js";import"./chunk-2I6ZAGC7.js";import{b as U}from"./chunk-FVCMZ6IK.js";import"./chunk-VDYO34A5.js";import"./chunk-Y2QT2WK5.js";import"./chunk-S35HUXPS.js";import{u as P,w as R,y as L}from"./chunk-GZWLZB4Q.js";import{Bb as g,Db as h,Eb as M,Fb as b,Gb as o,Hb as i,Ib as m,Sb as c,Va as a,_ as f,cc as r,dc as u,fc as N,gb as A,lc as F,ma as D,mb as v,mc as x,nc as S,va as I,vb as p,wc as C,yc as y}from"./chunk-MKA3N2SS.js";import{a as _,b as E}from"./chunk-GAL4ENT6.js";var me=()=>[],se=()=>[10,25,50],pe=()=>["nom","prenom","numeroMembre","activite"],de=n=>["/dashboards/credit/individuel/attente/detail",n];function ce(n,t){n&1&&(o(0,"div",4),m(1,"p-progressSpinner"),i())}function ue(n,t){if(n&1&&m(0,"p-message",5),n&2){let e=c();p("text",e.state().error)}}function fe(n,t){n&1&&(o(0,"tr")(1,"th"),r(2,"R\xE9ference"),i(),o(3,"th"),r(4,"Client"),i(),o(5,"th"),r(6,"Num\xE9ro Membre"),i(),o(7,"th"),r(8,"Montant"),i(),o(9,"th"),r(10,"Activit\xE9"),i(),o(11,"th"),r(12,"Statut"),i(),o(13,"th"),r(14,"Heure"),i(),o(15,"th"),r(16,"Actions"),i()())}function ge(n,t){if(n&1&&(o(0,"span",19),r(1,"En cours de validation"),i(),m(2,"p-button",18)),n&2){let e=c().$implicit;a(2),p("routerLink",S(1,de,e.demandeIndividuelId))}}function _e(n,t){if(n&1&&m(0,"p-button",18),n&2){let e=c().$implicit;p("routerLink",S(1,de,e.demandeIndividuelId))}}function Ee(n,t){if(n&1&&(o(0,"tr")(1,"td"),r(2),i(),o(3,"td"),r(4),i(),o(5,"td"),r(6),i(),o(7,"td"),r(8),C(9,"currency"),i(),o(10,"td"),r(11),i(),o(12,"td"),m(13,"p-tag",17),i(),o(14,"td"),r(15),C(16,"date"),i(),o(17,"td"),v(18,ge,3,3)(19,_e,1,3,"p-button",18),i()()),n&2){let e=t.$implicit,d=c(3);a(2),u(e.demandeIndividuelId),a(2),N("",e.prenom," ",e.nom,""),a(2),u(e.numeroMembre),a(2),u(y(9,10,e.montantDemande,"GNF ")),a(3),u(e.descriptionActivite),a(2),p("value",d.getStatusLabel(e.statutDemande,e.validationState))("severity",d.getStatusSeverity(e.statutDemande,e.validationState)),a(2),u(y(16,13,e.createdAt,"short")),a(3),g(e.statutDemande==="EN_ATTENTE"&&e.validationState==="APPROVED"?18:19)}}function ve(n,t){n&1&&(o(0,"tr")(1,"td",20),r(2," Aucune demande trouv\xE9e pour cette date "),i()())}function xe(n,t){if(n&1&&(o(0,"p-accordion-panel")(1,"p-accordion-header")(2,"div",7)(3,"div",8),m(4,"i",9),o(5,"span",10),r(6),i()(),m(7,"p-tag",11),i()(),o(8,"p-accordion-content")(9,"div",12)(10,"p-table",13),v(11,fe,17,0,"ng-template",14)(12,Ee,20,16,"ng-template",15)(13,ve,3,0,"ng-template",16),i()()()()),n&2){let e,d,s=t.$implicit,l=c(2);a(6),u(l.formatDateHeader(s)),a(),p("value",((e=l.state().groupedDemandes.get(s))==null?null:e.length)+" demande(s)"),a(3),p("value",l.state().groupedDemandes.get(s)||x(7,me))("paginator",(((d=l.state().groupedDemandes.get(s))==null?null:d.length)||0)>10)("rows",10)("rowsPerPageOptions",x(8,se))("globalFilterFields",x(9,pe))}}function Se(n,t){if(n&1&&(o(0,"p-accordion"),M(1,xe,14,10,"p-accordion-panel",null,h),i()),n&2){let e=c();a(),b(e.state().dateKeys)}}function Ce(n,t){n&1&&m(0,"p-message",6)}var ae=class n{state=I({loading:!1,message:void 0,error:void 0,statusOptions:[],groupedDemandes:new Map,dateKeys:[]});userService=f(U);router=f(O);destroyRef=f(D);messageService=f(T);ngOnInit(){this.loadDemandeSelection()}loadDemandeSelection(){this.state.update(t=>E(_({},t),{loading:!0,error:void 0})),this.userService.getAllDemandeCreditByDate$().pipe(H(this.destroyRef)).subscribe({next:t=>{let e=t.data.demandeAttentes||[],d=this.groupDemandesByDate(e);this.state.update(s=>E(_({},s),{demandeAttentes:e,groupedDemandes:d,dateKeys:Array.from(d.keys()).sort((l,le)=>new Date(le).getTime()-new Date(l).getTime()),loading:!1,message:t.message,error:void 0}))},error:t=>{this.state.update(e=>E(_({},e),{loading:!1,message:void 0,error:t}))}})}groupDemandesByDate(t){let e=new Map;for(let d of t){let l=new Date(d.createdAt).toISOString().split("T")[0];e.has(l)||e.set(l,[]),e.get(l).push(d)}return e}getStatusLabel(t,e){return t==="EN_ATTENTE"&&e==="NOUVEAU"?"NOUVELLE DEMANDE":t==="EN_ATTENTE"&&e==="SELECTION"?"SELECTION":t==="EN_ATTENTE"&&e==="APPROVED"?"EN COURS DE VALIDATION PAR DA":t}getStatusSeverity(t,e){if(t==="EN_ATTENTE"&&e==="APPROVED")return"danger";if(t==="EN_ATTENTE")return"info";if(t==="REJECTED")return"danger"}formatDateHeader(t){return new Date(t).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}refreshData(){this.loadDemandeSelection()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=A({type:n,selectors:[["app-credit-selection"]],features:[F([T])],decls:11,vars:3,consts:[[1,"card"],[1,"flex","flex-col","text-center","md:text-left"],[1,"text-surface-900","dark:text-surface-0","text-2xl","mb-2"],[1,"text-surface-600","dark:text-surface-200","text-lg"],[1,"flex","justify-center","my-4"],["severity","error","styleClass","w-full mb-4",3,"text"],["severity","info","text","Aucune demande en s\xE9lection trouv\xE9e"],[1,"flex","justify-between","items-center","w-full"],[1,"flex","items-center","gap-2"],[1,"pi","pi-calendar"],[1,"font-semibold"],["severity","info",3,"value"],[1,"p-4"],["dataKey","demandeindividuel_id","responsiveLayout","scroll",3,"value","paginator","rows","rowsPerPageOptions","globalFilterFields"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[3,"value","severity"],["icon","pi pi-eye","severity","help","rounded","","pTooltip","G\xE9rer la s\xE9lection",3,"routerLink"],[1,"text-muted"],["colspan","7",1,"text-center"]],template:function(e,d){e&1&&(o(0,"div",0)(1,"div",1)(2,"span",2),r(3,"Liste des demandes de credits pour la selection "),i(),o(4,"span",3)(5,"p-message"),r(6,"Vous pouvez maintenant cliquer sur l'icon du bouton TELEVERSERVER LA FICHE DE SELECTION pour remonter le document"),i()()(),v(7,ce,2,0,"div",4)(8,ue,1,1,"p-message",5)(9,Se,3,0,"p-accordion")(10,Ce,1,0,"p-message",6),i()),e&2&&(a(7),g(d.state().loading?7:-1),a(),g(d.state().error?8:-1),a(),g(d.state().dateKeys&&d.state().dateKeys.length>0?9:10))},dependencies:[L,R,P,re,V,K,B,k,Z,W,Q,J,z,q,$,j,Y,X,G,oe,ie,ee,te,ne,w],encapsulation:2})};export{ae as CreditSelectionComponent};
