import{d as $}from"./chunk-UCSGE5ZL.js";import"./chunk-2O7XYKW4.js";import{x as R}from"./chunk-2I6ZAGC7.js";import{b as V}from"./chunk-FVCMZ6IK.js";import"./chunk-VDYO34A5.js";import"./chunk-Y2QT2WK5.js";import{l as L,y as F}from"./chunk-GZWLZB4Q.js";import{Bb as u,Eb as v,Fb as E,Gb as i,Hb as a,Ib as g,Mb as D,Mc as w,Rb as x,Sb as s,Va as l,_ as S,cc as r,dc as b,ec as m,fa as h,ga as M,gb as A,lc as I,mb as C,va as T,vb as y,xb as O}from"./chunk-MKA3N2SS.js";import{a as P,b as k,g as f}from"./chunk-GAL4ENT6.js";var z=(n,e)=>e.value,B=(n,e)=>e.delegation.id,N=(n,e)=>e.id;function U(n,e){if(n&1){let t=D();i(0,"button",15),x("click",function(){let c=h(t).$implicit,d=s();return M(d.onStatutChange(c.value))}),r(1),a()}if(n&2){let t=e.$implicit,o=s();O("active",o.state().selectedStatut===t.value),y("ngClass","btn-outline-"+t.color),l(),m(" ",t.label," ")}}function J(n,e){n&1&&(i(0,"div",12)(1,"div",16)(2,"span",17),r(3,"Chargement..."),a()(),i(4,"p"),r(5,"Chargement des donn\xE9es..."),a()())}function G(n,e){if(n&1&&(i(0,"div",13),g(1,"i",18),r(2),a()),n&2){let t=s();l(2),m(" ",t.state().error," ")}}function q(n,e){if(n&1&&(i(0,"span",29),r(1),a()),n&2){let t=s().$implicit;l(),m(" ",t.stats.encours," en cours ")}}function H(n,e){if(n&1&&(i(0,"span",30),r(1),a()),n&2){let t=s().$implicit;l(),m(" ",t.stats.valide," valid\xE9(s) ")}}function K(n,e){if(n&1&&(i(0,"span",31),r(1),a()),n&2){let t=s().$implicit;l(),m(" ",t.stats.accepte," accept\xE9(s) ")}}function Q(n,e){if(n&1&&(i(0,"span",32),r(1),a()),n&2){let t=s().$implicit;l(),m(" ",t.stats.rejet," rejet\xE9(s) ")}}function W(n,e){n&1&&(i(0,"div",35),g(1,"i",37),i(2,"p"),r(3,"Aucune demande trouv\xE9e pour cette d\xE9l\xE9gation"),a()())}function X(n,e){if(n&1){let t=D();i(0,"tr")(1,"td",39),r(2),a(),i(3,"td",40),g(4,"i",41),r(5),a(),i(6,"td",42),g(7,"i",43),r(8),a(),i(9,"td"),r(10),a(),i(11,"td"),r(12),a(),i(13,"td",44)(14,"span",45),g(15,"i",46),r(16),a()(),i(17,"td")(18,"span",47),r(19),a()(),i(20,"td",48),r(21),a(),i(22,"td",49)(23,"button",50),x("click",function(c){let d=h(t).$implicit;return s(5).viewDetail(d.id),M(c.stopPropagation())}),g(24,"i",51),r(25," D\xE9tails "),a()()()}if(n&2){let t=e.$implicit,o=s(5);l(2),m("#",t.id,""),l(3),m(" ",t.userFullName," "),l(3),m(" ",t.userPhone||"-"," "),l(2),b(t.agenceLibele||"-"),l(2),b(t.pointVenteLibele||"-"),l(4),m(" ",t.documentCount," "),l(2),y("ngClass",o.getStatutClass(t.statut)),l(),m(" ",o.getStatutLabel(t.statut)," "),l(2),b(o.formatDate(t.createdAt))}}function Y(n,e){if(n&1&&(i(0,"div",36)(1,"table",38)(2,"thead")(3,"tr")(4,"th"),r(5,"ID"),a(),i(6,"th"),r(7,"Utilisateur"),a(),i(8,"th"),r(9,"T\xE9l\xE9phone"),a(),i(10,"th"),r(11,"Agence"),a(),i(12,"th"),r(13,"Point de Vente"),a(),i(14,"th"),r(15,"Documents"),a(),i(16,"th"),r(17,"Statut"),a(),i(18,"th"),r(19,"Date"),a(),i(20,"th"),r(21,"Actions"),a()()(),i(22,"tbody"),v(23,X,26,9,"tr",null,N),a()()()),n&2){let t=s(2).$implicit;l(23),E(t.etats)}}function Z(n,e){if(n&1&&(i(0,"div",34),C(1,W,4,0,"div",35)(2,Y,25,0,"div",36),a()),n&2){let t=s().$implicit;l(),u(t.etats.length===0?1:2)}}function tt(n,e){if(n&1){let t=D();i(0,"div",21)(1,"div",22),x("click",function(){let c=h(t).$implicit,d=s(2);return M(d.toggleDelegation(c.delegation.id))}),i(2,"div",23),g(3,"i",24),i(4,"h3",25),r(5),a()(),i(6,"div",26)(7,"span",27),g(8,"i",28),r(9),a(),C(10,q,2,1,"span",29)(11,H,2,1,"span",30)(12,K,2,1,"span",31)(13,Q,2,1,"span",32),a(),g(14,"i",33),a(),C(15,Z,3,1,"div",34),a()}if(n&2){let t=e.$implicit,o=s(2);O("expanded",o.isDelegationExpanded(t.delegation.id)),l(5),b(t.delegation.libele),l(4),m(" ",t.stats.total," demande(s) "),l(),u(t.stats.encours>0?10:-1),l(),u(t.stats.valide>0?11:-1),l(),u(t.stats.accepte>0?12:-1),l(),u(t.stats.rejet>0?13:-1),l(2),u(o.isDelegationExpanded(t.delegation.id)?15:-1)}}function et(n,e){n&1&&(i(0,"div",20),g(1,"i",52),i(2,"h3"),r(3,"Aucune demande trouv\xE9e"),a(),i(4,"p"),r(5,"Il n'y a pas de demande de documents \xE0 v\xE9rifier pour le moment."),a()())}function nt(n,e){if(n&1&&(i(0,"div",14),v(1,tt,16,9,"div",19,B,!1,et,6,0,"div",20),a()),n&2){let t=s();l(),E(t.filteredEtats())}}var j=class n{userService=S(V);router=S($);state=T({delegations:[],etatsParDelegation:new Map,statistics:[],selectedDelegation:null,selectedStatut:"ALL",loading:!1,error:null,expandedDelegations:new Set});etatsGroupes=w(()=>{let{delegations:e,etatsParDelegation:t,statistics:o}=this.state();return e.map(c=>{let d=t.get(c.id)||[],p=o.find(_=>_.delegationId===c.id);return{delegation:c,etats:d,stats:p?{total:p.totalEtats,encours:p.encoursCount,valide:p.valideCount,accepte:p.accepteCount,rejet:p.rejetCount}:{total:d.length,encours:d.filter(_=>_.statut==="ENCOURS").length,valide:d.filter(_=>_.statut==="VALIDE").length,accepte:d.filter(_=>_.statut==="ACCEPTE").length,rejet:d.filter(_=>_.statut==="REJET").length}}}).filter(c=>c.etats.length>0||c.stats.total>0)});filteredEtats=w(()=>{let{selectedStatut:e}=this.state(),t=this.etatsGroupes();return e==="ALL"?t:t.map(o=>k(P({},o),{etats:o.etats.filter(c=>c.statut===e)})).filter(o=>o.etats.length>0)});statutOptions=[{value:"ALL",label:"Tous",color:"secondary"},{value:"ENCOURS",label:"En cours",color:"warning"},{value:"VALIDE",label:"Valid\xE9",color:"info"},{value:"ACCEPTE",label:"Accept\xE9",color:"success"},{value:"REJET",label:"Rejet\xE9",color:"danger"}];ngOnInit(){this.loadData()}loadData(){this.updateState({loading:!0,error:null}),Promise.all([this.loadDelegations(),this.loadStatistics(),this.loadAllEtats()]).finally(()=>{this.updateState({loading:!1})})}loadDelegations(){return f(this,null,function*(){try{let e=yield this.userService.getAllDelegationsBackoffice$().toPromise();e?.data?.delegations&&this.updateState({delegations:e.data.delegations})}catch(e){console.error("Erreur chargement d\xE9l\xE9gations:",e)}})}loadStatistics(){return f(this,null,function*(){try{let e=yield this.userService.getStatsEtatsDocuments$().toPromise();e?.data?.statistics&&this.updateState({statistics:e.data.statistics})}catch(e){console.error("Erreur chargement statistiques:",e)}})}loadAllEtats(){return f(this,null,function*(){try{let e=yield this.userService.getAllEtatsDocuments$(0,100).toPromise();if(e?.data?.etats){let t=new Map;e.data.etats.forEach(o=>{let c=o.delegationId||0;t.has(c)||t.set(c,[]),t.get(c).push(o)}),this.updateState({etatsParDelegation:t})}}catch(e){console.error("Erreur chargement \xE9tats:",e),this.updateState({error:"Erreur lors du chargement des donn\xE9es"})}})}loadEtatsByDelegation(e){return f(this,null,function*(){try{let{selectedStatut:t}=this.state(),o=t!=="ALL"?t:void 0,c=yield this.userService.getEtatsByDelegation$(e,0,50,o).toPromise();if(c?.data?.etats){let{etatsParDelegation:d}=this.state(),p=new Map(d);p.set(e,c.data.etats),this.updateState({etatsParDelegation:p})}}catch(t){console.error("Erreur chargement \xE9tats d\xE9l\xE9gation:",t)}})}toggleDelegation(e){let{expandedDelegations:t}=this.state(),o=new Set(t);o.has(e)?o.delete(e):(o.add(e),this.loadEtatsByDelegation(e)),this.updateState({expandedDelegations:o})}isDelegationExpanded(e){return this.state().expandedDelegations.has(e)}onStatutChange(e){this.updateState({selectedStatut:e});let{expandedDelegations:t}=this.state();t.forEach(o=>{this.loadEtatsByDelegation(o)})}viewDetail(e){this.router.navigate(["/dashboards/document-verification/documents",e])}getStatutClass(e){return{ENCOURS:"badge-warning",VALIDE:"badge-info",ACCEPTE:"badge-success",REJET:"badge-danger"}[e]||"badge-secondary"}getStatutLabel(e){return{ENCOURS:"En cours",VALIDE:"Valid\xE9",ACCEPTE:"Accept\xE9",REJET:"Rejet\xE9"}[e]||e}formatDate(e){return e?new Date(e).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-"}updateState(e){this.state.update(t=>P(P({},t),e))}refresh(){this.loadData()}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=A({type:n,selectors:[["app-document-verification"]],features:[I([V])],decls:21,vars:5,consts:[[1,"document-verification-container"],[1,"page-header"],[1,"header-content"],[1,"page-title"],[1,"fas","fa-file-alt"],[1,"page-subtitle"],[1,"btn","btn-primary",3,"click"],[1,"fas","fa-sync-alt"],[1,"filters-section"],[1,"filter-group"],[1,"btn-group"],[1,"btn","btn-filter",3,"active","ngClass"],[1,"loading-overlay"],[1,"alert","alert-danger"],[1,"delegations-list"],[1,"btn","btn-filter",3,"click","ngClass"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"fas","fa-exclamation-triangle"],[1,"delegation-card",3,"expanded"],[1,"empty-state-global"],[1,"delegation-card"],[1,"delegation-header",3,"click"],[1,"delegation-info"],[1,"fas","fa-building"],[1,"delegation-name"],[1,"delegation-stats"],[1,"stat-badge","total"],[1,"fas","fa-folder"],[1,"stat-badge","warning"],[1,"stat-badge","info"],[1,"stat-badge","success"],[1,"stat-badge","danger"],[1,"fas","fa-chevron-down","toggle-icon"],[1,"delegation-content"],[1,"empty-state"],[1,"etats-table-wrapper"],[1,"fas","fa-inbox"],[1,"etats-table"],[1,"id-cell"],[1,"user-cell"],[1,"fas","fa-user"],[1,"phone-cell"],[1,"fas","fa-phone"],[1,"docs-cell"],[1,"docs-badge"],[1,"fas","fa-file-image"],[1,"badge",3,"ngClass"],[1,"date-cell"],[1,"actions-cell"],[1,"btn","btn-sm","btn-primary",3,"click"],[1,"fas","fa-eye"],[1,"fas","fa-folder-open"]],template:function(t,o){t&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),g(4,"i",4),r(5," V\xE9rification des Documents "),a(),i(6,"p",5),r(7,"Gestion des demandes de carte pr\xE9pay\xE9e par d\xE9l\xE9gation"),a()(),i(8,"button",6),x("click",function(){return o.refresh()}),g(9,"i",7),r(10," Actualiser "),a()(),i(11,"div",8)(12,"div",9)(13,"label"),r(14,"Filtrer par statut :"),a(),i(15,"div",10),v(16,U,2,4,"button",11,z),a()()(),C(18,J,6,0,"div",12)(19,G,3,1,"div",13)(20,nt,4,1,"div",14),a()),t&2&&(l(9),O("fa-spin",o.state().loading),l(7),E(o.statutOptions),l(2),u(o.state().loading?18:-1),l(),u(o.state().error?19:-1),l(),u(!o.state().loading&&!o.state().error?20:-1))},dependencies:[F,L,R],styles:[".document-verification-container[_ngcontent-%COMP%]{padding:1.5rem;max-width:1400px;margin:0 auto}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem;padding-bottom:1rem;border-bottom:2px solid #e9ecef}.page-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .page-title[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:700;color:#2c3e50;margin:0;display:flex;align-items:center;gap:.75rem}.page-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .page-title[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#3498db}.page-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .page-subtitle[_ngcontent-%COMP%]{color:#6c757d;margin:.25rem 0 0;font-size:.95rem}.filters-section[_ngcontent-%COMP%]{background:#fff;padding:1rem 1.5rem;border-radius:10px;box-shadow:0 2px 8px #00000014;margin-bottom:1.5rem}.filters-section[_ngcontent-%COMP%]   .filter-group[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.filters-section[_ngcontent-%COMP%]   .filter-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;color:#495057;white-space:nowrap}.filters-section[_ngcontent-%COMP%]   .filter-group[_ngcontent-%COMP%]   .btn-group[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-wrap:wrap}.filters-section[_ngcontent-%COMP%]   .filter-group[_ngcontent-%COMP%]   .btn-filter[_ngcontent-%COMP%]{padding:.5rem 1rem;border-radius:20px;font-size:.875rem;transition:all .2s ease}.filters-section[_ngcontent-%COMP%]   .filter-group[_ngcontent-%COMP%]   .btn-filter.active[_ngcontent-%COMP%]{transform:scale(1.05);box-shadow:0 2px 8px #00000026}.loading-overlay[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:4rem;color:#6c757d}.loading-overlay[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:1rem}.delegations-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.delegation-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;box-shadow:0 2px 12px #00000014;overflow:hidden;transition:all .3s ease}.delegation-card[_ngcontent-%COMP%]:hover{box-shadow:0 4px 20px #0000001f}.delegation-card.expanded[_ngcontent-%COMP%]   .toggle-icon[_ngcontent-%COMP%]{transform:rotate(180deg)}.delegation-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:1.25rem 1.5rem;cursor:pointer;background:linear-gradient(135deg,#f8f9fa,#fff);border-bottom:1px solid transparent;transition:all .2s ease}.delegation-header[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#e9ecef,#f8f9fa)}.delegation-header[_ngcontent-%COMP%]   .delegation-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.delegation-header[_ngcontent-%COMP%]   .delegation-info[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.5rem;color:#3498db}.delegation-header[_ngcontent-%COMP%]   .delegation-info[_ngcontent-%COMP%]   .delegation-name[_ngcontent-%COMP%]{font-size:1.15rem;font-weight:600;color:#2c3e50;margin:0}.delegation-header[_ngcontent-%COMP%]   .delegation-stats[_ngcontent-%COMP%]{display:flex;gap:.75rem;flex-wrap:wrap}.delegation-header[_ngcontent-%COMP%]   .delegation-stats[_ngcontent-%COMP%]   .stat-badge[_ngcontent-%COMP%]{padding:.35rem .75rem;border-radius:20px;font-size:.8rem;font-weight:500;display:flex;align-items:center;gap:.35rem}.delegation-header[_ngcontent-%COMP%]   .delegation-stats[_ngcontent-%COMP%]   .stat-badge.total[_ngcontent-%COMP%]{background:#e9ecef;color:#495057}.delegation-header[_ngcontent-%COMP%]   .delegation-stats[_ngcontent-%COMP%]   .stat-badge.warning[_ngcontent-%COMP%]{background:#fff3cd;color:#856404}.delegation-header[_ngcontent-%COMP%]   .delegation-stats[_ngcontent-%COMP%]   .stat-badge.info[_ngcontent-%COMP%]{background:#cce5ff;color:#004085}.delegation-header[_ngcontent-%COMP%]   .delegation-stats[_ngcontent-%COMP%]   .stat-badge.success[_ngcontent-%COMP%]{background:#d4edda;color:#155724}.delegation-header[_ngcontent-%COMP%]   .delegation-stats[_ngcontent-%COMP%]   .stat-badge.danger[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24}.delegation-header[_ngcontent-%COMP%]   .toggle-icon[_ngcontent-%COMP%]{color:#6c757d;transition:transform .3s ease}.delegation-content[_ngcontent-%COMP%]{padding:1.5rem;background:#fafbfc;animation:_ngcontent-%COMP%_slideDown .3s ease}@keyframes _ngcontent-%COMP%_slideDown{0%{opacity:0;max-height:0}to{opacity:1;max-height:1000px}}.etats-table-wrapper[_ngcontent-%COMP%]{overflow-x:auto}.etats-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;background:#fff;border-radius:8px;overflow:hidden;box-shadow:0 1px 4px #0000000d}.etats-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{background:#f1f3f4}.etats-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.875rem 1rem;text-align:left;font-weight:600;color:#495057;font-size:.85rem;text-transform:uppercase;letter-spacing:.5px;white-space:nowrap}.etats-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{border-bottom:1px solid #e9ecef;transition:background .2s ease}.etats-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:#f8f9fa}.etats-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:last-child{border-bottom:none}.etats-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:1rem;vertical-align:middle;font-size:.9rem}.etats-table[_ngcontent-%COMP%]   .id-cell[_ngcontent-%COMP%]{font-weight:600;color:#3498db}.etats-table[_ngcontent-%COMP%]   .user-cell[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .etats-table[_ngcontent-%COMP%]   .phone-cell[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#6c757d;margin-right:.5rem}.etats-table[_ngcontent-%COMP%]   .docs-cell[_ngcontent-%COMP%]   .docs-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.35rem;padding:.25rem .75rem;background:#e3f2fd;color:#1976d2;border-radius:20px;font-weight:500}.etats-table[_ngcontent-%COMP%]   .date-cell[_ngcontent-%COMP%]{color:#6c757d;font-size:.85rem}.etats-table[_ngcontent-%COMP%]   .actions-cell[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.35rem}.badge[_ngcontent-%COMP%]{padding:.4rem .75rem;border-radius:20px;font-size:.8rem;font-weight:500}.badge.badge-warning[_ngcontent-%COMP%]{background:#fff3cd;color:#856404}.badge.badge-info[_ngcontent-%COMP%]{background:#cce5ff;color:#004085}.badge.badge-success[_ngcontent-%COMP%]{background:#d4edda;color:#155724}.badge.badge-danger[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24}.empty-state[_ngcontent-%COMP%], .empty-state-global[_ngcontent-%COMP%]{text-align:center;padding:3rem;color:#6c757d}.empty-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .empty-state-global[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:1rem;opacity:.5}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .empty-state-global[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .5rem;color:#495057}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .empty-state-global[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.empty-state-global[_ngcontent-%COMP%]{background:#fff;border-radius:12px;box-shadow:0 2px 12px #00000014}@media (max-width: 768px){.page-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:1rem}.filters-section[_ngcontent-%COMP%]   .filter-group[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.delegation-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:1rem}.delegation-stats[_ngcontent-%COMP%]{width:100%}}"]})};export{j as DocumentVerificationComponent};
