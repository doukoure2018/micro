import{b as X}from"./chunk-FGMPEHU4.js";import"./chunk-X2KUNYA6.js";import"./chunk-AMXAFO4A.js";import"./chunk-2QPLZWUI.js";import{a as ae,b as se}from"./chunk-KRA3R5HH.js";import{a as oe,b as re}from"./chunk-IDKLANHK.js";import{a as le,b as de}from"./chunk-GBSAZIIF.js";import{c as ee,d as te}from"./chunk-JK4JG2UW.js";import{b as me}from"./chunk-5YYAURUY.js";import{c as pe}from"./chunk-HNZBC55R.js";import"./chunk-J62YMCRW.js";import"./chunk-J6B6CWYC.js";import"./chunk-ATSSA22C.js";import{a as ie,b as ne}from"./chunk-3BEM77IG.js";import{b as F,e as q,j as A}from"./chunk-UCSGE5ZL.js";import"./chunk-2O7XYKW4.js";import{a as b}from"./chunk-YTFCGSG6.js";import"./chunk-RHLJ6NE2.js";import{a as Z,b as J}from"./chunk-R2ZYXRFE.js";import"./chunk-GFZUU5ZD.js";import"./chunk-BODZH67C.js";import"./chunk-KR7F45VC.js";import{e as Y,g as H}from"./chunk-XKXBFP6V.js";import"./chunk-ULM4QL4Q.js";import{oa as w}from"./chunk-3YZBLOIS.js";import{b as B,e as D,f as $,h as z,i as G,j as O,r as j,t as K,x as W}from"./chunk-2I6ZAGC7.js";import{b as Q}from"./chunk-FVCMZ6IK.js";import{a as S}from"./chunk-VDYO34A5.js";import"./chunk-Y2QT2WK5.js";import"./chunk-S35HUXPS.js";import"./chunk-GZWLZB4Q.js";import{Bb as m,Gb as n,Hb as o,Ib as s,Mb as L,O as E,Qa as h,Rb as U,Sb as p,Va as r,_ as v,bc as x,cc as d,dc as y,fa as V,ga as P,gb as k,i as M,lc as N,ma as T,mb as u,mc as C,va as R,vb as l,yb as I}from"./chunk-MKA3N2SS.js";import{a as g,b as _}from"./chunk-GAL4ENT6.js";var ue=()=>({width:"5rem",height:"5rem"}),fe=()=>["/auth/forgotpassword"],ge=()=>["/"],_e=()=>["/auth/home"];function ve(e,i){e&1&&(n(0,"div",6),s(1,"p-progress-spinner",7),n(2,"div",8),s(3,"i",9),o()(),n(4,"div",10)(5,"h2",11),d(6,"Verifying account..."),o(),n(7,"p",12),d(8,"Please wait while we validate your credentials"),o()()),e&2&&(r(),I(C(2,ue)))}function xe(e,i){if(e&1&&(n(0,"div",13)(1,"div")(2,"div",14)(3,"p-message",15),d(4),o()(),n(5,"div",16),s(6,"a",17),o(),n(7,"div",16),s(8,"a",18),o()()()),e&2){let t=p(4);r(3),l("closable",!0),r(),y(t.state().error),r(2),l("href",t.getLoginUrl(),h),r(2),l("routerLink",C(4,fe))}}function ye(e,i){if(e&1&&u(0,xe,9,5,"div",13),e&2){let t=p(3);m(t.state().error?0:-1)}}function Ce(e,i){if(e&1&&u(0,ye,1,1),e&2){let t=p(2);m(t.state().loading?-1:0)}}function he(e,i){if(e&1&&u(0,ve,9,3)(1,Ce,1,1),e&2){let t=p();m(t.state().loading?0:1)}}function we(e,i){if(e&1&&(n(0,"div",13)(1,"div")(2,"div",14)(3,"p-message",19),d(4),o()(),n(5,"div",20)(6,"a",21),d(7,"Forgot password?"),o()(),n(8,"div",16),s(9,"a",22),o(),n(10,"div",16),s(11,"a",23),o()()()),e&2){let t=p(2);r(3),l("closable",!0),r(),y(t.state().message),r(5),l("href",t.getLoginUrl(),h),r(2),l("routerLink",C(4,ge))}}function Se(e,i){if(e&1&&(n(0,"p-message",19),d(1),o()),e&2){let t=p(3);l("closable",!0),r(),y(t.state().message)}}function be(e,i){if(e&1&&(n(0,"p-message",15),d(1),o()),e&2){let t=p(3);l("closable",!0),r(),y(t.state().error)}}function Me(e,i){e&1&&(n(0,"p-message",32),d(1," Password is required "),o())}function Ee(e,i){e&1&&(n(0,"p-message",32),d(1," This password is too short "),o())}function Ve(e,i){e&1&&(n(0,"p-message",32),d(1," Confirm Password is required "),o())}function Pe(e,i){e&1&&(n(0,"p-message",32),d(1," This password confirmation is too short "),o())}function Te(e,i){if(e&1){let t=L();n(0,"div",13)(1,"div",24)(2,"h1",25),d(3,"RESET PASSWORD"),o()(),n(4,"div")(5,"div",14),u(6,Se,2,2,"p-message",19)(7,be,2,2,"p-message",15),o(),n(8,"div",20)(9,"a",21),d(10,"Mot de passe Oubli\xE9?"),o()(),n(11,"form",26,0),U("ngSubmit",function(){V(t);let c=x(12),f=p(2);return P(f.createNewPassword(c))}),n(13,"div",27)(14,"p-input-group"),s(15,"input",28)(16,"input",29),n(17,"p-inputgroup-addon"),s(18,"i",30),o(),s(19,"input",31,1),u(21,Me,2,0,"p-message",32)(22,Ee,2,0,"p-message",32),o(),n(23,"p-input-group")(24,"p-inputgroup-addon"),s(25,"i",30),o(),s(26,"input",33,2),u(28,Ve,2,0,"p-message",32)(29,Pe,2,0,"p-message",32),o()(),n(30,"div",16),s(31,"button",34),o()(),n(32,"div",16),s(33,"a",35),o()()()}if(e&2){let t=x(12),a=x(20),c=x(27),f=p(2);r(6),m(f.state().message?6:-1),r(),m(f.state().error?7:-1),r(8),l("ngModel",f.state().userUuid),r(),l("ngModel",f.state().token),r(5),m(a.invalid&&a.touched&&(a.errors!=null&&a.errors.required)?21:-1),r(),m(a.invalid&&a.touched&&(a.errors!=null&&a.errors.minlength)?22:-1),r(6),m(c.invalid&&c.touched&&(c.errors!=null&&c.errors.required)?28:-1),r(),m(c.invalid&&c.touched&&(c.errors!=null&&c.errors.minlength)?29:-1),r(2),l("disabled",t.invalid||f.state().loading),r(2),l("routerLink",C(10,_e))}}function Re(e,i){if(e&1&&u(0,we,12,5,"div",13)(1,Te,34,11,"div",13),e&2){let t=p();m(t.state().success?0:1)}}var ce=class e{state=R({mode:"verify",success:!1,loading:!1,message:void 0,error:void 0});authServer=S.authServer;redirectUri=S.redirectUri;codeChallenge="vesLhZA4cwKsKZAR7zvEJ9q3uI6dRM8nwna-IpuKkkk";destroyRef=v(T);userService=v(Q);messageService=v(w);activatedRouter=v(F);ngOnInit(){console.log("Verification in action"),this.activatedRouter.queryParamMap.pipe(E(i=>{let t=i.get("token");return t?(this.state.set({token:t,mode:"verify",loading:!0,message:void 0,error:void 0,success:!1}),this.userService.verifyPasswordToken$(t)):(this.state.set({mode:"verify",success:!1,loading:!1,message:void 0,error:"Invalide Link. Please try again"}),M)}),b(this.destroyRef)).subscribe(this.verifySubscriber)}closeMessage=()=>this.state.update(i=>_(g({},i),{message:void 0,error:void 0}));getLoginUrl(){return`${this.authServer}/oauth2/authorize?response_type=code&client_id=client&scope=openid&redirect_uri=${this.redirectUri}&code_challenge_method=S256&code_challenge=${this.codeChallenge}`}createNewPassword=i=>{console.log("form",i.value),this.userService.createNewPassword$(i.value).pipe(b(this.destroyRef)).subscribe({next:t=>{this.state.update(a=>_(g({},a),{success:!0,loading:!1,message:t.message,error:void 0})),this.messageService.add({severity:"success",summary:"Success",detail:t.message})},error:t=>{this.state.update(a=>_(g({},a),{success:!1,loading:!1,message:void 0,error:t})),this.messageService.add({severity:"error",summary:"Error",detail:t})},complete:()=>{}})};verifySubscriber={next:i=>{this.state.update(t=>_(g({},t),{loading:!1,mode:"reset",userUuid:i.data.user?.userUuid,message:`${i.message} for ${i.data.user?.email}`,error:void 0})),this.messageService.add({severity:"success",summary:"Verification Account",detail:"Link has been verified"})},error:i=>{this.state.set({mode:"verify",loading:!1,message:void 0,error:i}),this.messageService.add({severity:"error",summary:"Verification Password",detail:i})},complete:()=>{}};static \u0275fac=function(t){return new(t||e)};static \u0275cmp=k({type:e,selectors:[["app-verifypassword"]],features:[N([w])],decls:5,vars:4,consts:[["form","ngForm"],["password","ngModel"],["confirmPassword","ngModel"],[1,"flex","flex-col","items-center","justify-center","gap-6","py-8"],[3,"position","life"],["simple",""],[1,"relative"],["ariaLabel","Verifying account","strokeWidth","4","animationDuration",".5s",1,"text-primary"],[1,"absolute","inset-0","flex","items-center","justify-center"],[1,"pi","pi-lock","text-lg","text-primary"],[1,"text-center"],[1,"text-2xl","font-semibold","mb-2"],[1,"text-surface-600","dark:text-surface-300"],[1,"bg-surface-0","dark:bg-surface-900","p-6","shadow","rounded","w-full","lg:w-6/12"],[1,"flex","flex-col","gap-4","mb-4"],["severity","error",3,"closable"],[1,"mt-4"],["pButton","","pRipple","","label","Se connecter",1,"w-full",3,"href"],["pButton","","pRipple","","text","","label","R\xE9initialiser le mot de passe",1,"w-full","text-primary-500",3,"routerLink"],["severity","success",3,"closable"],[1,"flex","items-center","justify-between","mb-12"],[1,"font-medium","no-underline","ml-2","text-primary","text-right","cursor-pointer"],["pButton","","pRipple","","label","Log in",1,"w-full",3,"href"],["pButton","","pRipple","","text","","label","Reset Password",1,"w-full","text-primary-500",3,"routerLink"],[1,"mt-6"],[1,"m-0","text-primary","font-semibold","text-4xl"],[3,"ngSubmit"],[1,"flex","flex-col","gap-4","mt-12"],["type","hidden","name","userUuid","id","userUuid","required","",3,"ngModel"],["type","hidden","name","token","id","token","required","",3,"ngModel"],[1,"pi","pi-key"],["pInputText","","id","password","type","password","name","password","ngModel","","placeholder","Password","required","","minlength","6"],["severity","error","size","small","styleClass","h-full w-full"],["pInputText","","id","confirmPassword","type","password","name","confirmPassword","ngModel","","placeholder","Confirmer le mot de passe","required","","minlength","6"],["pButton","","type","submit","pRipple","","label","Reset Password",1,"w-full",3,"disabled"],["pButton","","pRipple","","text","","label","Page d'accueil",1,"w-full","text-primary-500",3,"routerLink"]],template:function(t,a){t&1&&(n(0,"div",3),u(1,he,2,1)(2,Re,2,1),s(3,"p-toast",4)(4,"app-configurator",5),o()),t&2&&(r(),m(a.state().mode==="verify"?1:-1),r(),m(a.state().mode==="reset"?2:-1),r(),l("position","top-right")("life",3e3))},dependencies:[H,Y,A,q,W,O,B,D,$,j,K,G,z,X,te,ee,de,le,me,ne,ie,J,Z,re,oe,se,ae,pe],encapsulation:2})};export{ce as VerifypasswordComponent};
