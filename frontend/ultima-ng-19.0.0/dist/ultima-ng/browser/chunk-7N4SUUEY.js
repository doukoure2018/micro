import{b as Xe}from"./chunk-ARUR4BWX.js";import{a as We,b as Ye}from"./chunk-LUIQEVTA.js";import"./chunk-FVKECR4K.js";import{a as Be}from"./chunk-E24E7YRI.js";import{b as qe}from"./chunk-4JPZ5GKU.js";import{b as Ae}from"./chunk-GBSAZIIF.js";import{b as we}from"./chunk-F6BLPIFZ.js";import"./chunk-SQPWYWAP.js";import"./chunk-TOQUJNDH.js";import{c as De,d as Fe}from"./chunk-JK4JG2UW.js";import{b as Re}from"./chunk-5YYAURUY.js";import{a as Ne,b as $e}from"./chunk-ML3LU6MO.js";import{a as Le,k as Ge}from"./chunk-SRGIHKGJ.js";import"./chunk-KLDL5O4H.js";import"./chunk-PXEEYFPS.js";import"./chunk-4MNJFNZT.js";import"./chunk-7A4CRAMP.js";import"./chunk-3WTE2CKQ.js";import"./chunk-LA2FUI34.js";import"./chunk-ZNTL7BEM.js";import{a as je,b as ze}from"./chunk-QZOXHZZK.js";import"./chunk-MPVO6A2U.js";import"./chunk-D6YNXGTA.js";import"./chunk-ED7TFTUL.js";import"./chunk-MZ7FZGG3.js";import{a as Ue,b as He}from"./chunk-C4WQ325L.js";import{b as Ve,c as ke}from"./chunk-HNZBC55R.js";import"./chunk-J62YMCRW.js";import"./chunk-J6B6CWYC.js";import"./chunk-IEQZB3PI.js";import"./chunk-ATSSA22C.js";import{b as Oe}from"./chunk-BGHZ5NVU.js";import"./chunk-XYTTGGFW.js";import"./chunk-ZNT52ZF3.js";import"./chunk-Z7KSDRLV.js";import"./chunk-N4Q6Z3MW.js";import{b as ue,d as pe,e as ge}from"./chunk-UCSGE5ZL.js";import"./chunk-2O7XYKW4.js";import{a as A}from"./chunk-YTFCGSG6.js";import"./chunk-RHLJ6NE2.js";import{b as _e}from"./chunk-R2ZYXRFE.js";import{a as Pe,b as Te}from"./chunk-NRZ4QNP7.js";import"./chunk-GFZUU5ZD.js";import"./chunk-BODZH67C.js";import"./chunk-KR7F45VC.js";import{b as Me,e as ye,f as Ee,g as Se}from"./chunk-XKXBFP6V.js";import"./chunk-ULM4QL4Q.js";import{ka as Q,oa as J,sa as he}from"./chunk-3YZBLOIS.js";import{c as y,e as fe,i as be,w as ve,x as Ce,y as xe}from"./chunk-2I6ZAGC7.js";import{b as Ie}from"./chunk-FVCMZ6IK.js";import"./chunk-VDYO34A5.js";import"./chunk-Y2QT2WK5.js";import"./chunk-S35HUXPS.js";import{l as le,n as ce,v as de,y as me}from"./chunk-GZWLZB4Q.js";import{Bb as E,D as q,Db as z,Eb as V,Fb as k,Gb as o,Gc as oe,H as N,Hb as l,Ib as h,Mb as F,Mc as w,Rb as O,Sb as g,U as j,Va as c,_ as S,cc as d,dc as P,ec as C,fa as I,fc as L,g as G,ga as D,gb as ne,hc as W,lc as se,ma as te,mb as _,mc as Y,nc as ae,o as ee,oc as U,qa as ie,ub as $,va as M,vb as f,wc as X,xb as R,yc as Z,zb as re}from"./chunk-MKA3N2SS.js";import{a as u,b as p}from"./chunk-GAL4ENT6.js";var Ze=[{code:"ACHAT_MARCHANDISES",libelle:"Achat marchandises",ordre:1},{code:"MAIN_OEUVRE",libelle:"Co\xFBt de main d'\u0153uvre",ordre:2},{code:"INVESTISSEMENT",libelle:"Investissement",ordre:3},{code:"IMPOTS_TAXES",libelle:"Imp\xF4ts et taxes",ordre:4},{code:"LOYER",libelle:"Loyers",ordre:5},{code:"UTILITIES",libelle:"Eau, \xC9lectricit\xE9, t\xE9l\xE9phone",ordre:6},{code:"TRANSPORT",libelle:"Transport",ordre:7},{code:"SALAIRES",libelle:"Salaire personnel",ordre:8},{code:"FRAIS_TELEPHONE",libelle:"Frais de t\xE9l\xE9phone",ordre:9},{code:"CHARGES_FINANCIERES",libelle:"Charges Financi\xE8res",ordre:10},{code:"ENTRETIEN",libelle:"Entretien et r\xE9paration",ordre:11},{code:"AUTRES_DEPENSES",libelle:"Autres d\xE9penses",ordre:12}];var H=class a{previsions=new Map;currentMonthSubject=new G(0);previsionsChangedSubject=new G(void 0);savedMonthsSubject=new G(new Set);currentMonth$=this.currentMonthSubject.asObservable().pipe(N());previsions$=this.previsionsChangedSubject.asObservable().pipe(ee(()=>this.previsions));savedMonths$=this.savedMonthsSubject.asObservable();get currentMonth(){return this.currentMonthSubject.value}get savedMonths(){return this.savedMonthsSubject.value}setCurrentMonth(t){t>=0&&t<=12&&this.currentMonthSubject.next(t)}getPrevision(t){return this.previsions.get(t)}updatePrevision(t,e,i=!1,n=!0){let r=this.previsions.get(t);this.previsions.set(t,{numeroMois:t,data:u({},e),saved:i,dirty:!i,hasData:n,lastUpdated:new Date});let s=new Set(this.savedMonthsSubject.value);i?s.add(t):n||s.delete(t),this.savedMonthsSubject.next(s),this.previsionsChangedSubject.next(void 0)}markAsSaved(t){let e=this.previsions.get(t);if(e){this.previsions.set(t,p(u({},e),{saved:!0,dirty:!1}));let i=new Set(this.savedMonthsSubject.value);i.add(t),this.savedMonthsSubject.next(i),this.previsionsChangedSubject.next(void 0)}}markAsDirty(t){let e=this.previsions.get(t);e&&(this.previsions.set(t,p(u({},e),{dirty:!0})),this.previsionsChangedSubject.next(void 0))}hasUnsavedChanges(){return Array.from(this.previsions.values()).some(t=>t.dirty)}getMonthsWithData(){return Array.from(this.previsions.entries()).filter(([t,e])=>e.hasData).map(([t,e])=>t)}getSavedMonths(){return Array.from(this.previsions.entries()).filter(([t,e])=>e.saved).map(([t,e])=>t)}getUnsavedMonths(){return Array.from(this.previsions.entries()).filter(([t,e])=>e.hasData&&!e.saved).map(([t,e])=>t)}clearMonth(t){this.previsions.delete(t);let e=new Set(this.savedMonthsSubject.value);e.delete(t),this.savedMonthsSubject.next(e),this.previsionsChangedSubject.next(void 0)}clearAll(){this.previsions.clear(),this.savedMonthsSubject.next(new Set),this.previsionsChangedSubject.next(void 0)}loadAllPrevisions(t){this.previsions.clear();let e=new Set;t.forEach(i=>{this.previsions.set(i.numeroMois,{numeroMois:i.numeroMois,data:i.data,saved:!0,dirty:!1,hasData:!0,lastUpdated:new Date}),e.add(i.numeroMois)}),this.savedMonthsSubject.next(e),this.previsionsChangedSubject.next(void 0)}getAllPrevisionsForSave(){return Array.from(this.previsions.entries()).filter(([t,e])=>e.hasData).map(([t,e])=>({numeroMois:t,data:e.data}))}monthHasData(t){return this.previsions.get(t)?.hasData||!1}getMonthStatus(t){let e=this.previsions.get(t);return!e||!e.hasData?"empty":e.saved?"saved":"filled"}static \u0275fac=function(e){return new(e||a)};static \u0275prov=j({token:a,factory:a.\u0275fac,providedIn:"root"})};var B=class a{imprimerTableauTresorerie(t,e,i){let n=window.open("","_blank","width=1400,height=900");if(!n){console.error("Impossible d'ouvrir la fen\xEAtre d'impression");return}let r=i?.dureeDemande||e?.duree||12,s=this.genererHTMLTableau(t,e,i,r);n.document.write(s),n.document.close(),n.onload=()=>{setTimeout(()=>{n.print(),n.close()},500)}}genererHTMLTableau(t,e,i,n){let r=this.getTableauStyles(n),s=this.genererContenuTableau(t,e,i,n);return`
      <!DOCTYPE html>
      <html>
      <head>
        <meta charset="utf-8">
        <title>Pr\xE9vision de Tr\xE9sorerie</title>
        <style>${r}</style>
      </head>
      <body>
        ${s}
      </body>
      </html>
    `}genererContenuTableau(t,e,i,n){let r=new Date().toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),s=this.extraireDonneesMois(t,n),m=this.calculerTotauxAnnuels(s);return`
      <div class="print-container">
        <!-- En-t\xEAte -->
        <div class="header">
          <h1>PR\xC9VISION DE TR\xC9SORERIE</h1>
          <div class="header-info">
            <div class="header-left">
              ${i?`
                <p><strong>Demandeur:</strong> ${i.prenom} ${i.nom}</p>
                <p><strong>Demande N\xB0:</strong> ${i.id||"N/A"}</p>
              `:`
                <p><strong>Client:</strong> ${e.clientNom||"N/A"}</p>
              `}
              <p><strong>Montant du cr\xE9dit:</strong> ${this.formatCurrency(e.montantCredit)}</p>
            </div>
            <div class="header-right">
              <p><strong>Dur\xE9e:</strong> ${n} mois</p>
              <p><strong>Taux:</strong> ${e.tauxInteret}% annuel</p>
              <p><strong>Date d'impression:</strong> ${r}</p>
            </div>
          </div>
        </div>

        <!-- Tableau principal -->
        <div class="table-container">
          ${this.genererTableauPrincipal(s,m,n)}
        </div>

        <!-- Analyses et indicateurs -->
        <div class="analysis-section">
          ${this.genererAnalyseFinanciere(s,m,e,n)}
        </div>

        <!-- Pied de page -->
        <div class="footer">
          <div class="footer-left">
            <p>Document g\xE9n\xE9r\xE9 automatiquement le ${r}</p>
          </div>
          <div class="footer-right">
            <p>Page 1/1</p>
          </div>
        </div>
      </div>
    `}genererTableauPrincipal(t,e,i){let n=Array.from({length:i+1},(s,m)=>`P${m}`),r=i+3;return`
      <table class="main-table">
        <thead>
          <tr>
            <th class="category-header">\xC9L\xC9MENTS</th>
            ${n.map((s,m)=>`<th class="month-header ${m===0?"month-start":""}">${s}</th>`).join("")}
            <th class="total-header">TOTAL</th>
          </tr>
        </thead>
        <tbody>
          <!-- SOLDE D\xC9BUT -->
          <tr class="solde-row">
            <td class="category-cell"><strong>SOLDE D\xC9BUT</strong></td>
            ${t.map(s=>`<td class="amount-cell">${this.formatNumber(s.soldeDebut)}</td>`).join("")}
            <td class="total-cell">-</td>
          </tr>

          <!-- ENCAISSEMENTS -->
          <tr class="section-header">
            <td class="section-title" colspan="${r}"><strong>ENCAISSEMENTS</strong></td>
          </tr>
          
          <tr>
            <td class="category-cell">Ventes</td>
            ${t.map(s=>`<td class="amount-cell">${this.formatNumber(s.ventes)}</td>`).join("")}
            <td class="total-cell total-revenue">${this.formatNumber(e.ventes)}</td>
          </tr>
          
          <tr>
            <td class="category-cell">Autres revenus</td>
            ${t.map(s=>`<td class="amount-cell">${this.formatNumber(s.autresRevenus)}</td>`).join("")}
            <td class="total-cell total-revenue">${this.formatNumber(e.autresRevenus)}</td>
          </tr>
          
          <tr>
            <td class="category-cell">Pr\xEAt re\xE7u</td>
            ${t.map(s=>`<td class="amount-cell">${this.formatNumber(s.pret)}</td>`).join("")}
            <td class="total-cell total-revenue">${this.formatNumber(e.pret)}</td>
          </tr>
          
          <tr class="subtotal-row">
            <td class="category-cell"><strong>TOTAL ENCAISSEMENTS</strong></td>
            ${t.map(s=>`<td class="amount-cell total-revenue"><strong>${this.formatNumber(s.totalEncaissements)}</strong></td>`).join("")}
            <td class="total-cell total-revenue"><strong>${this.formatNumber(e.totalEncaissements)}</strong></td>
          </tr>

          <!-- D\xC9CAISSEMENTS -->
          <tr class="section-header">
            <td class="section-title" colspan="${r}"><strong>D\xC9CAISSEMENTS</strong></td>
          </tr>
          
          <tr>
            <td class="category-cell">Achat marchandises</td>
            ${t.map(s=>`<td class="amount-cell">${this.formatNumber(s.achatmarchandises)}</td>`).join("")}
            <td class="total-cell total-expense">${this.formatNumber(e.achatmarchandises)}</td>
          </tr>
          
          <tr>
            <td class="category-cell">Main d'\u0153uvre</td>
            ${t.map(s=>`<td class="amount-cell">${this.formatNumber(s.mainoeuvre)}</td>`).join("")}
            <td class="total-cell total-expense">${this.formatNumber(e.mainoeuvre)}</td>
          </tr>
          
          <tr>
            <td class="category-cell">Investissement</td>
            ${t.map(s=>`<td class="amount-cell">${this.formatNumber(s.investissement)}</td>`).join("")}
            <td class="total-cell total-expense">${this.formatNumber(e.investissement)}</td>
          </tr>
          
          <tr>
            <td class="category-cell">Imp\xF4ts et taxes</td>
            ${t.map(s=>`<td class="amount-cell">${this.formatNumber(s.impotstaxes)}</td>`).join("")}
            <td class="total-cell total-expense">${this.formatNumber(e.impotstaxes)}</td>
          </tr>
          
          <tr>
            <td class="category-cell">Loyers</td>
            ${t.map(s=>`<td class="amount-cell">${this.formatNumber(s.loyer)}</td>`).join("")}
            <td class="total-cell total-expense">${this.formatNumber(e.loyer)}</td>
          </tr>
          
          <tr>
            <td class="category-cell">Eau, \xC9lectricit\xE9</td>
            ${t.map(s=>`<td class="amount-cell">${this.formatNumber(s.utilities)}</td>`).join("")}
            <td class="total-cell total-expense">${this.formatNumber(e.utilities)}</td>
          </tr>
          
          <tr>
            <td class="category-cell">Transport</td>
            ${t.map(s=>`<td class="amount-cell">${this.formatNumber(s.transport)}</td>`).join("")}
            <td class="total-cell total-expense">${this.formatNumber(e.transport)}</td>
          </tr>
          
          <tr>
            <td class="category-cell">Salaires</td>
            ${t.map(s=>`<td class="amount-cell">${this.formatNumber(s.salaires)}</td>`).join("")}
            <td class="total-cell total-expense">${this.formatNumber(e.salaires)}</td>
          </tr>
          
          <tr>
            <td class="category-cell">Frais t\xE9l\xE9phone</td>
            ${t.map(s=>`<td class="amount-cell">${this.formatNumber(s.fraistelephone)}</td>`).join("")}
            <td class="total-cell total-expense">${this.formatNumber(e.fraistelephone)}</td>
          </tr>
          
          <tr>
            <td class="category-cell">Charges financi\xE8res</td>
            ${t.map(s=>`<td class="amount-cell">${this.formatNumber(s.chargesfinancieres)}</td>`).join("")}
            <td class="total-cell total-expense">${this.formatNumber(e.chargesfinancieres)}</td>
          </tr>
          
          <tr>
            <td class="category-cell">Entretien</td>
            ${t.map(s=>`<td class="amount-cell">${this.formatNumber(s.entretien)}</td>`).join("")}
            <td class="total-cell total-expense">${this.formatNumber(e.entretien)}</td>
          </tr>
          
          <tr>
            <td class="category-cell">Autres d\xE9penses</td>
            ${t.map(s=>`<td class="amount-cell">${this.formatNumber(s.autresdepenses)}</td>`).join("")}
            <td class="total-cell total-expense">${this.formatNumber(e.autresdepenses)}</td>
          </tr>

          <!-- REMBOURSEMENTS -->
          <tr class="section-header">
            <td class="section-title" colspan="${r}"><strong>REMBOURSEMENTS CR\xC9DIT</strong></td>
          </tr>
          
          <tr>
            <td class="category-cell">Int\xE9r\xEAts \xE0 verser</td>
            ${t.map(s=>`<td class="amount-cell remboursement">${this.formatNumber(s.interetsAVerser)}</td>`).join("")}
            <td class="total-cell total-remboursement">${this.formatNumber(e.interetsAVerser)}</td>
          </tr>
          
          <tr>
            <td class="category-cell">Remboursement capital</td>
            ${t.map(s=>`<td class="amount-cell remboursement">${this.formatNumber(s.remboursementCapital)}</td>`).join("")}
            <td class="total-cell total-remboursement">${this.formatNumber(e.remboursementCapital)}</td>
          </tr>
          
          <tr class="subtotal-row">
            <td class="category-cell"><strong>TOTAL D\xC9CAISSEMENTS</strong></td>
            ${t.map(s=>`<td class="amount-cell total-expense"><strong>${this.formatNumber(s.totalDecaissements)}</strong></td>`).join("")}
            <td class="total-cell total-expense"><strong>${this.formatNumber(e.totalDecaissements)}</strong></td>
          </tr>

          <!-- R\xC9SULTATS -->
          <tr class="section-header">
            <td class="section-title" colspan="${r}"><strong>R\xC9SULTATS</strong></td>
          </tr>
          
          <tr>
            <td class="category-cell">Disponible en caisse</td>
            ${t.map(s=>`<td class="amount-cell">${this.formatNumber(s.disponibleEnCaisse)}</td>`).join("")}
            <td class="total-cell">-</td>
          </tr>
          
          <tr class="result-row">
            <td class="category-cell"><strong>EXC\xC9DENT (D\xC9FICIT)</strong></td>
            ${t.map(s=>`<td class="amount-cell ${s.excedentDeficit>=0?"positive":"negative"}"><strong>${this.formatNumber(s.excedentDeficit)}</strong></td>`).join("")}
            <td class="total-cell ${e.excedentDeficit>=0?"positive":"negative"}"><strong>${this.formatNumber(e.excedentDeficit)}</strong></td>
          </tr>
          
          <tr class="solde-row final-row">
            <td class="category-cell"><strong>SOLDE FIN</strong></td>
            ${t.map(s=>`<td class="amount-cell ${s.soldeFin>=0?"positive":"negative"}"><strong>${this.formatNumber(s.soldeFin)}</strong></td>`).join("")}
            <td class="total-cell">-</td>
          </tr>
        </tbody>
      </table>
    `}genererAnalyseFinanciere(t,e,i,n){let r=e.excedentDeficit/n,s=(e.interetsAVerser+e.remboursementCapital)/n,m=e.totalEncaissements>0?(e.interetsAVerser+e.remboursementCapital)/e.totalEncaissements*100:0,b=t.map((v,T)=>({mois:T,deficit:v.excedentDeficit})).filter(v=>v.deficit<0),x=t[t.length-1]?.soldeFin||0;return`
      <div class="analysis-grid">
        <div class="analysis-block">
          <h3>\u{1F4CA} INDICATEURS CL\xC9S (${n} p\xE9riodes)</h3>
          <div class="indicators">
            <div class="indicator">
              <span class="indicator-label">Cash Flow moyen mensuel:</span>
              <span class="indicator-value ${r>=0?"positive":"negative"}">${this.formatCurrency(r)}</span>
            </div>
            <div class="indicator">
              <span class="indicator-label">Remboursement mensuel moyen:</span>
              <span class="indicator-value">${this.formatCurrency(s)}</span>
            </div>
            <div class="indicator">
              <span class="indicator-label">Ratio remboursement/revenus:</span>
              <span class="indicator-value ${m<=30?"positive":m<=50?"warning":"negative"}">${m.toFixed(1)}%</span>
            </div>
            <div class="indicator">
              <span class="indicator-label">Solde final (P\xE9riode ${n}):</span>
              <span class="indicator-value ${x>=0?"positive":"negative"}">${this.formatCurrency(x)}</span>
            </div>
          </div>
        </div>

        <div class="analysis-block">
          <h3>\u26A0\uFE0F POINTS D'ATTENTION</h3>
          <div class="alerts">
            ${b.length>0?`
              <div class="alert alert-danger">
                <strong>P\xE9riodes d\xE9ficitaires identifi\xE9es (${b.length}/${n}):</strong>
                ${b.map(v=>`P${v.mois} (${this.formatCurrency(v.deficit)})`).join(", ")}
              </div>
            `:`
              <div class="alert alert-success">
                <strong>\u2713 Aucun d\xE9ficit identifi\xE9 sur les ${n} p\xE9riodes</strong>
              </div>
            `}
            
            ${m>50?`
              <div class="alert alert-warning">
                <strong>Ratio de remboursement \xE9lev\xE9 (${m.toFixed(1)}%)</strong> - Risque de tension de tr\xE9sorerie
              </div>
            `:""}
            
            ${r<0?`
              <div class="alert alert-danger">
                <strong>Cash Flow moyen n\xE9gatif</strong> - Viabilit\xE9 \xE0 long terme questionn\xE9e
              </div>
            `:""}

            ${x<0?`
              <div class="alert alert-danger">
                <strong>Solde final n\xE9gatif</strong> - Insuffisance de tr\xE9sorerie en fin de p\xE9riode
              </div>
            `:""}
          </div>
        </div>

        <div class="analysis-block">
          <h3>\u{1F4B0} SYNTH\xC8SE FINANCI\xC8RE (${n} p\xE9riodes)</h3>
          <div class="synthesis">
            <p><strong>Total revenus sur la p\xE9riode:</strong> ${this.formatCurrency(e.totalEncaissements)}</p>
            <p><strong>Total charges sur la p\xE9riode:</strong> ${this.formatCurrency(e.totalDecaissements)}</p>
            <p><strong>R\xE9sultat net sur la p\xE9riode:</strong> 
              <span class="${e.excedentDeficit>=0?"positive":"negative"}">
                ${this.formatCurrency(e.excedentDeficit)}
              </span>
            </p>
            <p><strong>Total remboursements:</strong> ${this.formatCurrency(e.interetsAVerser+e.remboursementCapital)}</p>
            <p><strong>Capacit\xE9 de remboursement:</strong> 
              <span class="${r>=s?"positive":"negative"}">
                ${r>=s?"Suffisante":"Insuffisante"}
              </span>
            </p>
          </div>
        </div>
      </div>
    `}extraireDonneesMois(t,e){let i=[];for(let n=0;n<=e;n++){let r=t.get(`mois${n}`)?.getRawValue()||{};i.push({numeroMois:n,soldeDebut:r.soldeDebut||0,ventes:r.ventes||0,autresRevenus:r.autresRevenus||0,pret:r.pret||0,achatmarchandises:r.achatmarchandises||0,mainoeuvre:r.mainoeuvre||0,investissement:r.investissement||0,impotstaxes:r.impotstaxes||0,loyer:r.loyer||0,utilities:r.utilities||0,transport:r.transport||0,salaires:r.salaires||0,fraistelephone:r.fraistelephone||0,chargesfinancieres:r.chargesfinancieres||0,entretien:r.entretien||0,autresdepenses:r.autresdepenses||0,interetsAVerser:r.interetsAVerser||0,remboursementCapital:r.remboursementCapital||0,totalEncaissements:r.totalEncaissements||0,totalDecaissements:r.totalDecaissements||0,disponibleEnCaisse:r.disponibleEnCaisse||0,excedentDeficit:r.excedentDeficit||0,soldeFin:r.soldeFin||0})}return i}calculerTotauxAnnuels(t){let e={};return["ventes","autresRevenus","pret","achatmarchandises","mainoeuvre","investissement","impotstaxes","loyer","utilities","transport","salaires","fraistelephone","chargesfinancieres","entretien","autresdepenses","interetsAVerser","remboursementCapital","totalEncaissements","totalDecaissements","excedentDeficit"].forEach(n=>{e[n]=t.reduce((r,s)=>r+(s[n]||0),0)}),e}formatCurrency(t){return t==null?"0 GNF":new Intl.NumberFormat("fr-FR",{style:"currency",currency:"GNF",minimumFractionDigits:0,maximumFractionDigits:0}).format(t)}formatNumber(t){return t==null||t===0?"-":new Intl.NumberFormat("fr-FR",{minimumFractionDigits:0,maximumFractionDigits:0}).format(t)}getTableauStyles(t){let e=t>12,i=e?"40px":"55px",n=e?"6px":"7px",r=e?"6px":"8px",s=t>18?"A3 landscape":"A4 landscape";return`
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Arial', sans-serif;
        font-size: 10px;
        line-height: 1.3;
        color: #333;
        background: white;
      }

      .print-container {
        max-width: ${t>18?"420mm":"297mm"};
        margin: 0 auto;
        padding: 10mm;
      }

      .header {
        text-align: center;
        margin-bottom: 20px;
        border-bottom: 2px solid #333;
        padding-bottom: 15px;
      }

      .header h1 {
        font-size: 18px;
        font-weight: bold;
        color: #2c3e50;
        margin-bottom: 10px;
      }

      .header-info {
        display: flex;
        justify-content: space-between;
        font-size: 9px;
      }

      .header-left, .header-right {
        text-align: left;
      }

      .table-container {
        margin-bottom: 20px;
        overflow-x: auto;
      }

      .main-table {
        width: 100%;
        border-collapse: collapse;
        font-size: ${n};
        table-layout: fixed;
      }

      .main-table th,
      .main-table td {
        border: 1px solid #333;
        padding: 2px 1px;
        text-align: center;
        vertical-align: middle;
      }

      .category-header {
        background: #2c3e50;
        color: white;
        font-weight: bold;
        width: ${e?"100px":"120px"};
        font-size: 9px;
      }

      .month-header {
        background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
        color: #ffffff;
        font-weight: bold;
        width: ${i};
        font-size: ${r};
        text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.3);
        ${e?"writing-mode: vertical-rl; text-orientation: mixed;":""}
      }

      .month-start {
        background: linear-gradient(135deg, #0f766e 0%, #14b8a6 100%);
      }

      .total-header {
        background: #2c3e50;
        color: white;
        font-weight: bold;
        width: ${e?"60px":"80px"};
        font-size: 9px;
      }

      .section-header td {
        background: #ecf0f1;
        font-weight: bold;
        color: #2c3e50;
        text-align: center;
        font-size: 9px;
      }

      .category-cell {
        background: #f8f9fa;
        text-align: left;
        padding-left: 5px;
        font-weight: 500;
        font-size: ${e?"7px":"8px"};
      }

      .amount-cell {
        text-align: right;
        padding-right: 2px;
        font-size: ${n};
      }

      .total-cell {
        background: #ecf0f1;
        text-align: right;
        padding-right: 2px;
        font-weight: bold;
        font-size: ${e?"7px":"8px"};
      }

      .total-revenue {
        background: #d5edda;
        color: #155724;
      }

      .total-expense {
        background: #f8d7da;
        color: #721c24;
      }

      .total-remboursement {
        background: #fff3cd;
        color: #856404;
      }

      .subtotal-row td {
        background: #e2e6ea;
        font-weight: bold;
        border-top: 2px solid #333;
      }

      .result-row td {
        background: #e7f3ff;
        font-weight: bold;
        border-top: 2px solid #333;
        font-size: 9px;
      }

      .solde-row td {
        background: #f0f8ff;
        font-weight: bold;
      }

      .final-row td {
        border-bottom: 3px solid #333;
        background: #e6f3ff;
      }

      .positive {
        color: #28a745;
        font-weight: bold;
      }

      .negative {
        color: #dc3545;
        font-weight: bold;
      }

      .warning {
        color: #ffc107;
        font-weight: bold;
      }

      .remboursement {
        background: #fff8e1;
      }

      .analysis-section {
        margin-top: 20px;
        page-break-inside: avoid;
      }

      .analysis-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
      }

      .analysis-block {
        border: 1px solid #dee2e6;
        border-radius: 6px;
        padding: 10px;
        background: #f8f9fa;
      }

      .analysis-block h3 {
        color: #2c3e50;
        font-size: 11px;
        margin-bottom: 8px;
        border-bottom: 1px solid #dee2e6;
        padding-bottom: 3px;
      }

      .indicators,
      .alerts,
      .synthesis {
        font-size: 9px;
      }

      .indicator {
        display: flex;
        justify-content: space-between;
        margin-bottom: 5px;
        padding: 3px 0;
      }

      .indicator-label {
        font-weight: 500;
      }

      .indicator-value {
        font-weight: bold;
      }

      .alert {
        padding: 6px;
        margin-bottom: 6px;
        border-radius: 3px;
        font-size: 8px;
      }

      .alert-success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .alert-warning {
        background: #fff3cd;
        color: #856404;
        border: 1px solid #ffeaa7;
      }

      .alert-danger {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      .synthesis p {
        margin-bottom: 4px;
        display: flex;
        justify-content: space-between;
      }

      .footer {
        margin-top: 30px;
        padding-top: 10px;
        border-top: 1px solid #dee2e6;
        display: flex;
        justify-content: space-between;
        font-size: 8px;
        color: #6c757d;
      }

      @media print {
        body { margin: 0; }
        .print-container { padding: 5mm; }
        .analysis-section { page-break-inside: avoid; }
        .footer { page-break-inside: avoid; }
      }

      @page {
        margin: 8mm;
        size: ${s};
      }
    `}static \u0275fac=function(e){return new(e||a)};static \u0275prov=j({token:a,factory:a.\u0275fac,providedIn:"root"})};var Ke=(a,t)=>({"bg-green-50 border-green-200":a,"bg-red-50 border-red-200":t}),et=(a,t)=>({"text-green-600":a,"text-red-600":t}),tt=a=>["/dashboards/credit/individuel/attente/detail",a],it=(a,t)=>({"text-red-500":a,"text-green-600":t}),nt=()=>({showDelay:300}),rt=()=>({showDelay:300,hideDelay:0}),st=(a,t)=>t.id;function at(a,t){if(a&1&&(o(0,"div",19)(1,"h2"),h(2,"i",20),d(3," Informations du Demandeur "),l(),h(4,"p-tag",21),l()),a&2){let e=g(2);c(4),f("value","Demande N\xB0"+e.demandeIndividuelId)}}function ot(a,t){a&1&&(o(0,"tr")(1,"th"),d(2,"Type"),l(),o(3,"th"),d(4,"Description"),l(),o(5,"th",25),d(6,"Valeur garantie"),l(),o(7,"th",26),d(8,"Couverture"),l()())}function lt(a,t){if(a&1&&(o(0,"tr")(1,"td"),d(2),l(),o(3,"td"),d(4),l(),o(5,"td",25),d(6),l(),o(7,"td",26),h(8,"p-tag",27),l()()),a&2){let e=t.$implicit,i=g(3);c(2),P(e.typeGarantie),c(2),P(e.descriptionGarantie),c(2),P(i.formatMontant(e.valeurGarantie)),c(2),f("value",(e.valeurGarantie/i.demandeIndividuel().montantDemande*100).toFixed(0)+"%")("severity",e.valeurGarantie>=i.demandeIndividuel().montantDemande?"success":"warn")}}function ct(a,t){if(a&1&&(o(0,"div",14),h(1,"p-divider"),o(2,"h4",5),h(3,"i",22),d(4),l(),o(5,"p-table",23),_(6,ot,9,0,"ng-template",3)(7,lt,9,5,"ng-template",24),l()()),a&2){let e=g(2);c(4),C(" Garanties propos\xE9es (",e.garanties().length,") "),c(),f("value",e.garanties())("scrollable",!0)}}function dt(a,t){if(a&1&&(o(0,"p-card",5),_(1,at,5,1,"ng-template",3),o(2,"div",6)(3,"div",7)(4,"div",8)(5,"label",9),d(6,"Nom complet"),l(),o(7,"div",10),d(8),l()()(),o(9,"div",7)(10,"div",8)(11,"label",9),d(12,"Date de naissance"),l(),o(13,"div",11),d(14),o(15,"span",12),d(16),l()()()(),o(17,"div",7)(18,"div",8)(19,"label",9),d(20,"T\xE9l\xE9phone"),l(),o(21,"div",11),h(22,"i",13),d(23),l()()(),o(24,"div",14),h(25,"p-divider"),l(),o(26,"div",15)(27,"div",8)(28,"label",9),d(29,"Montant demand\xE9"),l(),o(30,"div",16),d(31),l()()(),o(32,"div",15)(33,"div",8)(34,"label",9),d(35,"Dur\xE9e du pr\xEAt"),l(),o(36,"div",11),d(37),l()()(),o(38,"div",15)(39,"div",8)(40,"label",9),d(41,"Taux d'int\xE9r\xEAt"),l(),o(42,"div",11),d(43),l()()(),o(44,"div",15)(45,"div",8)(46,"label",9),d(47,"\xC9ch\xE9ance mensuelle"),l(),o(48,"div",11),d(49),l()()(),o(50,"div",14),h(51,"p-divider"),o(52,"div",8)(53,"label",9),d(54,"Description de l'activit\xE9"),l(),o(55,"div",11),d(56),l(),o(57,"small",17),d(58),l()()(),_(59,ct,8,3,"div",18),l()()),a&2){let e=g();c(8),L(" ",e.demandeIndividuel().prenom," ",e.demandeIndividuel().nom," "),c(6),C(" ",e.formatDateFromArray(e.demandeIndividuel().dateNaissance)," "),c(2),C(" (",e.calculateAge(e.demandeIndividuel().dateNaissance)," ans) "),c(7),C(" ",e.demandeIndividuel().telephone," "),c(8),C(" ",e.formatMontant(e.demandeIndividuel().montantDemande)," "),c(6),C(" ",e.demandeIndividuel().dureeDemande," mois "),c(6),C(" ",e.demandeIndividuel().tauxInteret,"% annuel "),c(6),C(" ",e.formatMontant(e.mensualite().total)," "),c(7),C(" ",e.demandeIndividuel().descriptionActivite," "),c(2),L(" Anciennet\xE9: ",e.demandeIndividuel().nombreAnneeActivite," ans | Lieu: ",e.demandeIndividuel().adresseLieuActivite," "),c(),f("ngIf",e.garanties().length>0)}}function mt(a,t){if(a&1&&(o(0,"div",31)(1,"div",32)(2,"div",33)(3,"div",34)(4,"div",35),h(5,"i",36),l(),o(6,"div")(7,"div",37),d(8),l(),o(9,"div",38),d(10),l()()(),o(11,"div",39),h(12,"p-tag",40),o(13,"span",9),d(14," Mensualit\xE9: "),o(15,"strong",41),d(16),l()()()()()()),a&2){let e=g(2);c(8),C(" Dossier N\xB0",e.creditParams().dossierId," cr\xE9\xE9 "),c(2),W(" ",e.demandeIndividuel().prenom," ",e.demandeIndividuel().nom," \u2022 ",e.formatMontant(e.creditParams().montantCredit)," \u2022 ",e.creditParams().duree," mois \xE0 ",e.creditParams().tauxInteret,"% "),c(6),P(e.formatMontant(e.mensualite().total))}}function ut(a,t){if(a&1){let e=F();o(0,"div",42)(1,"div",43)(2,"div",33)(3,"div",34)(4,"div",44),h(5,"i",45),l(),o(6,"div")(7,"div",46),d(8," Dossier de cr\xE9dit \xE0 cr\xE9er "),l(),o(9,"div",47),d(10),l()()(),o(11,"div",48)(12,"div",49)(13,"div",50),d(14,"Mensualit\xE9 calcul\xE9e"),l(),o(15,"div",51),d(16),l(),o(17,"div",50),d(18),l()(),o(19,"p-button",52),O("onClick",function(){I(e);let n=g(2);return D(n.createDossierCredit())}),l()()()()()}if(a&2){let e=g(2);c(10),W(" ",e.demandeIndividuel().prenom," ",e.demandeIndividuel().nom," \u2022 ",e.formatMontant(e.creditParams().montantCredit)," \u2022 ",e.creditParams().duree," mois \xE0 ",e.creditParams().tauxInteret,"% "),c(6),P(e.formatMontant(e.mensualite().total)),c(2),L(" (",e.formatMontant(e.mensualite().capital)," + ",e.formatMontant(e.mensualite().interet),") "),c(),f("loading",e.state().saving)}}function pt(a,t){if(a&1&&(o(0,"div",28),_(1,mt,17,7,"div",29)(2,ut,20,9,"div",30),l()),a&2){let e=g();c(),f("ngIf",e.creditParams().dossierId>0),c(),f("ngIf",!e.creditParams().dossierId||e.creditParams().dossierId===0)}}function gt(a,t){a&1&&h(0,"p-tag",58)}function ht(a,t){if(a&1&&h(0,"p-tag",64),a&2){let e=g(2);f("value",e.getTableMonthsWithData()+"/"+(e.nombreMois()+1)+" p\xE9riodes")}}function ft(a,t){a&1&&h(0,"p-tag",65)}function bt(a,t){a&1&&h(0,"p-tag",66)}function vt(a,t){if(a&1){let e=F();o(0,"div",62)(1,"p-button",67),O("onClick",function(){I(e);let n=g(2);return D(n.imprimerTableauTresorerie())}),l(),h(2,"p-splitButton",68),l()}if(a&2){let e=g(2);c(2),f("model",e.splitButtonOptions)}}function Ct(a,t){a&1&&h(0,"p-button",63),a&2&&f("disabled",!0)}function xt(a,t){if(a&1&&(o(0,"div",53)(1,"div",54)(2,"div",34)(3,"h2",55),h(4,"i",56),d(5," Pr\xE9vision de Tr\xE9sorerie "),l(),o(6,"div",57),_(7,gt,1,0,"p-tag",58)(8,ht,1,1,"p-tag",59)(9,ft,1,0,"p-tag",60)(10,bt,1,0,"p-tag",61),l()(),o(11,"div",48),_(12,vt,3,1,"div",62)(13,Ct,1,1,"p-button",63),l()()()),a&2){let e=g();c(7),E(e.hasDossierCredit()?-1:7),c(),f("ngIf",e.getTableMonthsWithData()>0&&e.hasDossierCredit()),c(),f("ngIf",e.tresorerieState.hasUnsavedChanges()&&e.hasDossierCredit()),c(),f("ngIf",!e.tresorerieState.hasUnsavedChanges()&&e.getTableMonthsWithData()>0&&e.hasDossierCredit()),c(2),E(e.peutImprimer()&&e.hasDossierCredit()?12:13)}}function _t(a,t){if(a&1){let e=F();o(0,"div",4)(1,"div",69)(2,"div",70),h(3,"i",71),l(),o(4,"h3",72),d(5," Dossier de cr\xE9dit requis "),l(),o(6,"p",73),d(7," Avant de pouvoir saisir les pr\xE9visions de tr\xE9sorerie, vous devez d'abord cr\xE9er le dossier de cr\xE9dit. Cette \xE9tape est obligatoire pour enregistrer vos donn\xE9es. "),l(),o(8,"div",74)(9,"p-button",75),O("onClick",function(){I(e);let n=g();return D(n.createDossierCredit())}),l()(),o(10,"div",76),h(11,"i",77),d(12," Montant: "),o(13,"strong"),d(14),l(),d(15," | Dur\xE9e: "),o(16,"strong"),d(17),l(),d(18," | Taux: "),o(19,"strong"),d(20),l()()()()}if(a&2){let e=g();c(9),f("loading",e.state().saving),c(5),P(e.formatMontant(e.creditParams().montantCredit)),c(3),C("",e.creditParams().duree," mois"),c(3),C("",e.creditParams().tauxInteret,"%")}}function Mt(a,t){if(a&1&&(o(0,"div",111)(1,"span",112),d(2),l()()),a&2){let e=t.$implicit,i=g(3);R("segment-empty",!i.checkIfMoisHasData(i.getMoisFormGroup(e).getRawValue()))("segment-filled",i.checkIfMoisHasData(i.getMoisFormGroup(e).getRawValue())&&!i.moisSauvegardes().has(e))("segment-saved",i.moisSauvegardes().has(e)),f("pTooltip","P"+e+(i.moisSauvegardes().has(e)?" \u2713":"")),c(2),P(e)}}function yt(a,t){if(a&1&&(o(0,"div",78)(1,"div",98)(2,"div",99)(3,"span",100),h(4,"i",101),d(5),l(),o(6,"span",102),d(7," Solde final: "),o(8,"strong"),d(9),l()()(),o(10,"div",103),V(11,Mt,3,8,"div",104,z),l(),o(13,"div",105)(14,"div",106)(15,"span",107),h(16,"span",108),d(17," Vide "),l(),o(18,"span",107),h(19,"span",109),d(20," Renseign\xE9 "),l(),o(21,"span",107),h(22,"span",110),d(23," Sauvegard\xE9 "),l()()()()()),a&2){let e,i,n=g(2);c(5),L(" Progression: ",n.getTableMonthsWithData(),"/",n.nombreMois()+1," p\xE9riodes "),c(),f("ngClass",U(4,it,((e=n.getCellValue("soldeFin",n.dernierMois()))!==null&&e!==void 0?e:0)<0,((e=n.getCellValue("soldeFin",n.dernierMois()))!==null&&e!==void 0?e:0)>=0)),c(3),P(n.formatMontant((i=n.getCellValue("soldeFin",n.dernierMois()))!==null&&i!==void 0?i:0)),c(2),k(n.moisColumns())}}function Et(a,t){a&1&&(o(0,"small",115),d(1,"D\xE9marrage"),l())}function St(a,t){if(a&1&&(o(0,"th",113),d(1),_(2,Et,2,0,"small",114),l()),a&2){let e=t.$implicit,i=g(2);R("col-mois-0",e===0),c(),C(" ",i.getTableMoisLabel(e)," "),c(),f("ngIf",e===0)}}function Pt(a,t){if(a&1&&(o(0,"tr",116)(1,"td",122),h(2,"i",123),d(3," ENCAISSEMENTS "),l()()),a&2){let e=g(3);c(),$("colspan",e.moisColumns().length+2)}}function Tt(a,t){if(a&1&&(o(0,"tr",116)(1,"td",124),h(2,"i",125),d(3," D\xC9CAISSEMENTS "),l()()),a&2){let e=g(3);c(),$("colspan",e.moisColumns().length+2)}}function It(a,t){if(a&1&&(o(0,"tr",116)(1,"td",126),h(2,"i",127),d(3," R\xC9SULTATS "),l()()),a&2){let e=g(3);c(),$("colspan",e.moisColumns().length+2)}}function Dt(a,t){if(a&1&&(o(0,"tr",116)(1,"td",128),h(2,"i",129),d(3," REMBOURSEMENTS CR\xC9DIT "),l()()),a&2){let e=g(3);c(),$("colspan",e.moisColumns().length+2)}}function Ft(a,t){if(a&1){let e=F();o(0,"button",135),O("click",function(n){I(e);let r=g(2).$implicit,s=g().$implicit;return g(2).copyToFollowingMonths(s.id,r),D(n.stopPropagation())}),l()}if(a&2){let e=g(2).$implicit,i=g(3);f("pTooltip","Copier vers P"+(e+1)+" \xE0 P"+i.nombreMois())}}function Ot(a,t){if(a&1){let e=F();o(0,"div",131)(1,"p-inputNumber",133),O("ngModelChange",function(n){I(e);let r=g().$implicit,s=g().$implicit,m=g(2);return D(m.onTableCellChange(s.id,r,n))}),l(),_(2,Ft,1,1,"button",134),l()}if(a&2){let e=g().$implicit,i=g().$implicit,n=g(2);c(),f("ngModel",n.getCellValue(i.id,e))("minFractionDigits",0)("maxFractionDigits",0)("useGrouping",!0)("placeholder","-"),c(),E(e<n.nombreMois()&&n.getCellValue(i.id,e)!==null&&n.getCellValue(i.id,e)!==0?2:-1)}}function wt(a,t){if(a&1&&(o(0,"span",132),d(1),X(2,"number"),l()),a&2){let e=g().$implicit,i=g().$implicit,n=g(2);c(),C(" ",Z(2,1,n.getCellValue(i.id,e),"1.0-0")," ")}}function At(a,t){if(a&1&&(o(0,"td",130),_(1,Ot,3,6,"div",131)(2,wt,3,4,"span",132),l()),a&2){let e,i,n=t.$implicit,r=g().$implicit,s=g(2);R("col-mois-0",n===0)("cell-editable",s.isCellEditable(r,n))("cell-readonly",!s.isCellEditable(r,n))("cell-negative",((e=s.getCellValue(r.id,n))!==null&&e!==void 0?e:0)<0)("cell-positive",((i=s.getCellValue(r.id,n))!==null&&i!==void 0?i:0)>0&&r.type==="calcul"),f("pTooltip",s.getCellTooltip(r,n))("tooltipOptions",Y(13,rt)),c(),E(s.isCellEditable(r,n)?1:2)}}function Nt(a,t){if(a&1&&(_(0,Pt,4,1,"tr",116)(1,Tt,4,1,"tr",116)(2,It,4,1,"tr",116)(3,Dt,4,1,"tr",116),o(4,"tr")(5,"td",85)(6,"div",117)(7,"span",118),d(8),l()()(),V(9,At,3,14,"td",119,z),o(11,"td",120)(12,"span",121),d(13),X(14,"number"),l()()()),a&2){let e=t.$implicit,i=g(2);E(e.id==="ventes"?0:-1),c(),E(e.id==="achatmarchandises"?1:-1),c(),E(e.id==="disponibleEnCaisse"?2:-1),c(),E(e.id==="interetsAVerser"?3:-1),c(),re(e.cssClass),c(4),P(e.libelle),c(),k(i.moisColumns()),c(2),f("pTooltip",i.getCumulTooltip(e))("tooltipOptions",Y(13,nt)),c(2),C(" ",Z(14,10,i.getCumulForLigne(e.id),"1.0-0")," ")}}function $t(a,t){a&1&&(o(0,"span",92),d(1," Commencez par saisir les donn\xE9es dans le tableau "),l())}function Rt(a,t){if(a&1&&(o(0,"span",92),d(1),l()),a&2){let e=g(2);c(),C(" ",e.getTableMonthsWithData()," p\xE9riodes renseign\xE9es - Modifications non sauvegard\xE9es ")}}function Vt(a,t){a&1&&(o(0,"span",93),h(1,"i",136),d(2," Tous les changements sont sauvegard\xE9s "),l())}function kt(a,t){if(a&1){let e=F();o(0,"p-button",137),O("onClick",function(){I(e);let n=g(2);return D(n.imprimerTableauTresorerie())}),l()}}function Lt(a,t){if(a&1){let e=F();_(0,yt,24,7,"div",78),o(1,"div",79)(2,"div")(3,"span",80),d(4),l()(),o(5,"div")(6,"span",81),d(7),l()()(),o(8,"div",82)(9,"table",83)(10,"thead")(11,"tr",84)(12,"th",85),d(13,"Libell\xE9"),l(),V(14,St,3,4,"th",86,z),o(16,"th",87),d(17,"Cumul"),l()()(),o(18,"tbody"),V(19,Nt,15,14,null,null,st),l()()(),o(21,"div",88)(22,"div",89)(23,"div",90),h(24,"i",91),o(25,"span",80),_(26,$t,2,0,"span",92)(27,Rt,2,1,"span",92)(28,Vt,3,0,"span",93),l()(),o(29,"div",94),h(30,"p-button",95),_(31,kt,1,0,"p-button",96),o(32,"p-button",97),O("onClick",function(){I(e);let n=g();return D(n.savePrevisions())}),l()()()()}if(a&2){let e,i,n,r=g();E(r.peutImprimer()?0:-1),c(),f("ngClass",U(10,Ke,((e=r.getCellValue("soldeFin",r.dernierMois()))!==null&&e!==void 0?e:0)>=0,((e=r.getCellValue("soldeFin",r.dernierMois()))!==null&&e!==void 0?e:0)<0)),c(3),C("Solde final pr\xE9vu (P\xE9riode ",r.dernierMois(),"):"),c(2),f("ngClass",U(13,et,((i=r.getCellValue("soldeFin",r.dernierMois()))!==null&&i!==void 0?i:0)>=0,((i=r.getCellValue("soldeFin",r.dernierMois()))!==null&&i!==void 0?i:0)<0)),c(),C(" ",r.formatMontant((n=r.getCellValue("soldeFin",r.dernierMois()))!==null&&n!==void 0?n:0)," "),c(7),k(r.moisColumns()),c(5),k(r.lignesTableau),c(7),E(r.getTableMonthsWithData()===0?26:r.tresorerieState.hasUnsavedChanges()?27:28),c(4),f("routerLink",ae(16,tt,r.demandeIndividuelId)),c(),E(r.peutImprimer()?31:-1),c(),f("loading",r.state().saving)("disabled",!r.canSaveTableau())}}var Je=class a{fb=S(ve);userService=S(Ie);messageService=S(J);confirmationService=S(Q);route=S(ue);router=S(pe);cdr=S(oe);destroyRef=S(te);tresorerieState=S(H);tresoreriePrintService=S(B);demandeIndividuelId=null;demandeIndividuel=M(null);garanties=M([]);loadingDemande=M(!1);tresorerieForm;creditParamsForm;newClientForm;showNewClientDialog=!1;savingClient=!1;showHistoryDialog=!1;ngZone=S(ie);state=M({hasDossierCredit:!1,loading:!1,saving:!1,viewMode:"saisie",error:null});lignesTableau=[{id:"soldeDebut",categorie:"SOLDE_DEBUT",libelle:"Solde D\xE9but de p\xE9riode",type:"calcul",editable:!1,cssClass:"row-solde-debut"},{id:"ventes",categorie:"VENTES",libelle:"Ventes",type:"encaissement",editable:!0,cssClass:"row-encaissement"},{id:"autresRevenus",categorie:"AUTRES_REVENUS",libelle:"Autres revenus",type:"encaissement",editable:!0,cssClass:"row-encaissement"},{id:"pret",categorie:"PRET",libelle:"Pr\xEAt re\xE7u",type:"encaissement",editable:!0,cssClass:"row-encaissement row-pret"},{id:"totalEncaissements",categorie:"TOTAL_ENC",libelle:"Total Encaissements",type:"calcul",editable:!1,cssClass:"row-total row-total-enc"},{id:"achatmarchandises",categorie:"ACHAT_MARCHANDISES",libelle:"Achat marchandises",type:"decaissement",editable:!0,cssClass:"row-decaissement"},{id:"mainoeuvre",categorie:"MAIN_OEUVRE",libelle:"Main d'\u0153uvre",type:"decaissement",editable:!0,cssClass:"row-decaissement"},{id:"investissement",categorie:"INVESTISSEMENT",libelle:"Investissement",type:"decaissement",editable:!0,cssClass:"row-decaissement"},{id:"impotstaxes",categorie:"IMPOTS_TAXES",libelle:"Imp\xF4ts et taxes",type:"decaissement",editable:!0,cssClass:"row-decaissement"},{id:"loyer",categorie:"LOYER",libelle:"Loyer",type:"decaissement",editable:!0,cssClass:"row-decaissement"},{id:"utilities",categorie:"UTILITIES",libelle:"Eau, \xC9lectricit\xE9",type:"decaissement",editable:!0,cssClass:"row-decaissement"},{id:"transport",categorie:"TRANSPORT",libelle:"Transport",type:"decaissement",editable:!0,cssClass:"row-decaissement"},{id:"salaires",categorie:"SALAIRES",libelle:"Salaires",type:"decaissement",editable:!0,cssClass:"row-decaissement"},{id:"fraistelephone",categorie:"FRAIS_TELEPHONE",libelle:"Frais t\xE9l\xE9phone",type:"decaissement",editable:!0,cssClass:"row-decaissement"},{id:"chargesfinancieres",categorie:"CHARGES_FINANCIERES",libelle:"Charges financi\xE8res",type:"decaissement",editable:!0,cssClass:"row-decaissement"},{id:"entretien",categorie:"ENTRETIEN",libelle:"Entretien",type:"decaissement",editable:!0,cssClass:"row-decaissement"},{id:"autresdepenses",categorie:"AUTRES_DEPENSES",libelle:"Autres d\xE9penses",type:"decaissement",editable:!0,cssClass:"row-decaissement"},{id:"totalDecaissements",categorie:"TOTAL_DEC",libelle:"Total D\xE9caissements",type:"calcul",editable:!1,cssClass:"row-total row-total-dec"},{id:"disponibleEnCaisse",categorie:"DISPONIBLE",libelle:"Disponible en caisse",type:"calcul",editable:!1,cssClass:"row-calcul"},{id:"excedentDeficit",categorie:"EXCEDENT",libelle:"Exc\xE9dent (D\xE9ficit)",type:"calcul",editable:!1,cssClass:"row-calcul row-excedent"},{id:"interetsAVerser",categorie:"INTERETS",libelle:"Int\xE9r\xEAts \xE0 verser",type:"remboursement",editable:!0,cssClass:"row-remboursement"},{id:"remboursementCapital",categorie:"CAPITAL",libelle:"Remboursement capital",type:"remboursement",editable:!0,cssClass:"row-remboursement"},{id:"soldeFin",categorie:"SOLDE_FIN",libelle:"Solde Fin de p\xE9riode",type:"calcul",editable:!1,cssClass:"row-solde-fin"}];nombreMois=w(()=>this.demandeIndividuel()?.dureeDemande||12);moisColumns=w(()=>{let t=this.nombreMois();return Array.from({length:t+1},(e,i)=>i)});dernierMois=w(()=>this.nombreMois());getCellValue(t,e){let i=this.getMoisFormGroup(e);return i?i.get(t)?.value:null}setCellValue(t,e,i){let n=this.getMoisFormGroup(e);n&&n.patchValue({[t]:i},{emitEvent:!1})}onTableCellChange(t,e,i){this.setCellValue(t,e,i),this.calculateMonth(e),this.propagateSoldesToFollowingMonths(e);let n=this.getMoisFormGroup(e);n&&this.tresorerieState.updatePrevision(e,n.getRawValue(),!1,!0),this.cdr.detectChanges()}propagateSoldesToFollowingMonths(t){let e=this.nombreMois();for(let i=t;i<e;i++){let n=this.getMoisFormGroup(i),r=this.getMoisFormGroup(i+1);if(n&&r){let s=n.get("soldeFin")?.value||0;r.patchValue({soldeDebut:s},{emitEvent:!1}),this.calculateMonth(i+1)}}}isCellEditable(t,e){return t.id==="soldeDebut"?e===0:t.id==="ventes"&&e===0||t.type==="remboursement"&&e===0?!1:t.editable}getPeriodPrefix(){return"P"}getTableMoisLabel(t){return`${this.getPeriodPrefix()}${t}`}getPeriodiciteLabel(){let e=this.demandeIndividuel()?.periodiciteRemboursement||"Mensuelle";return{Mensuelle:"mois",Bimestrielle:"bimestre",Trimestrielle:"trimestre",Quatrimestrielle:"quadrimestre",Semestrielle:"semestre",Annuelle:"ann\xE9e"}[e]||"p\xE9riode"}getCumulForLigne(t){let e=this.nombreMois();if(t==="soldeDebut"||t==="soldeFin"||t==="disponibleEnCaisse"||t==="excedentDeficit")return this.getCellValue(t,e)||0;let i=0;for(let n=0;n<=e;n++)i+=this.getCellValue(t,n)||0;return i}copyToFollowingMonths(t,e){let i=this.getCellValue(t,e),n=this.lignesTableau.find(b=>b.id===t),r=this.nombreMois();if(!n)return;if(e>=r){this.messageService.add({severity:"warn",summary:"Attention",detail:"Aucune p\xE9riode suivante disponible pour la copie"});return}let s=0;for(let b=e+1;b<=r;b++)this.isCellEditable(n,b)&&(this.setCellValue(t,b,i),s++);this.calculateAllMonths();let m=this.getPeriodPrefix();this.messageService.add({severity:"info",summary:"Copi\xE9",detail:`Valeur "${this.formatMontant(i||0)}" copi\xE9e de ${m}${e} vers ${m}${e+1} \xE0 ${m}${r} (${s} p\xE9riodes)`})}copyToMonthRange(t,e,i){let n=this.getCellValue(t,e),r=this.lignesTableau.find(v=>v.id===t),s=this.nombreMois();if(!r)return;let m=Math.min(i,s),b=0;for(let v=e+1;v<=m;v++)this.isCellEditable(r,v)&&(this.setCellValue(t,v,n),b++);this.calculateAllMonths();let x=this.getPeriodPrefix();this.messageService.add({severity:"info",summary:"Copi\xE9",detail:`Valeur copi\xE9e vers ${b} p\xE9riodes (${x}${e+1} \xE0 ${x}${m})`})}resetTableau(){this.confirmationService.confirm({message:"R\xE9initialiser toutes les donn\xE9es du tableau ?",header:"Confirmation",icon:"pi pi-exclamation-triangle",accept:()=>{let t=this.nombreMois();for(let e=0;e<=t;e++)this.resetMonthToDefaults(e);this.creditParams().montantCredit>0&&this.setCellValue("pret",0,this.creditParams().montantCredit),this.calculateAllMonths(),this.tresorerieState.clearAll(),this.messageService.add({severity:"success",summary:"R\xE9initialis\xE9",detail:"Toutes les donn\xE9es ont \xE9t\xE9 effac\xE9es"})}})}getTableMonthsWithData(){let t=this.nombreMois(),e=0;for(let i=0;i<=t;i++)this.checkIfMoisHasData(this.getMoisFormGroup(i)?.getRawValue())&&e++;return e}canSaveTableau(){let t=this.getTableMonthsWithData()>0,e=this.creditParams().dossierId>0,i=!this.state().saving;return t&&e&&i}currentMonth=M(0);moisRenseignes=M(new Set);moisSauvegardes=M(new Set);clients=M([]);dossiers=M([]);selectedDossier=M(null);hasExistingAnalysis=M(!1);mois=Array.from({length:13},(t,e)=>e);categoriesDecaissement=Ze;showDossiersHistory(){this.showHistoryDialog=!0}getStatutSeverity(t){return t==="Valid\xE9"?"success":t==="En attente"?"info":t==="Rejet\xE9"?"danger":"secondary"}moisEnCoursModification=M(null);typesActivite=[{label:"Commerce",value:"COMMERCE"},{label:"Service",value:"SERVICE"},{label:"Production",value:"PRODUCTION"},{label:"Agriculture",value:"AGRICULTURE"},{label:"Artisanat",value:"ARTISANAT"},{label:"Autre",value:"AUTRE"}];creditParams=M({montantCredit:0,tauxInteret:0,duree:12,clientId:0,clientNom:"",dossierId:0});hasDossierCredit=w(()=>this.creditParams().dossierId>0);formRefreshTrigger=M(0);mensualite=w(()=>{let t=this.creditParams();if(!t.montantCredit||!t.duree||!t.tauxInteret)return{capital:0,interet:0,total:0};let e=t.tauxInteret/100/12,i=t.duree,n=t.montantCredit;if(e===0){let b=n/i;return{capital:b,interet:0,total:b}}let r=n*(e*Math.pow(1+e,i))/(Math.pow(1+e,i)-1),s=r-n/i;return{capital:n/i,interet:s,total:r}});constructor(){this.tresorerieState.currentMonth$.pipe(A(this.destroyRef)).subscribe(t=>{this.currentMonth.set(t),this.loadMonthData(t)}),this.tresorerieState.previsions$.pipe(A(this.destroyRef)).subscribe(()=>{this.updateTrackingSets()})}updateTrackingSets(){let t=this.tresorerieState.getMonthsWithData(),e=this.tresorerieState.getSavedMonths();this.moisRenseignes.set(new Set(t)),this.moisSauvegardes.set(new Set(e))}ngOnInit(){this.initializeCreditParamsForm(),this.initializeNewClientForm(),this.route.params.pipe(A(this.destroyRef)).subscribe(t=>{this.demandeIndividuelId=t.demandeindividuelId?parseInt(t.demandeindividuelId,10):null,this.demandeIndividuelId&&this.loadDemandeIndividuel()}),this.loadInitialParams()}loadDemandeIndividuel(){this.demandeIndividuelId&&(this.loadingDemande.set(!0),this.userService.getDemandeWithGaranties$(this.demandeIndividuelId).subscribe({next:t=>{if(console.log("Response demandeIndividuel:",t),t.data?.demandeIndividuel){let e=t.data.demandeIndividuel;this.demandeIndividuel.set(e),this.garanties.set(e.garanties||[]),this.initializeForm(),this.setupCalculations(),this.preFillCreditParams(e),t.data.hasDossierCredit&&t.data.dossierCredit?(console.log("Dossier de cr\xE9dit existant trouv\xE9:",t.data.dossierCredit),this.handleExistingDossierWithPrevisions(t.data.dossierCredit)):t.data.hasDemandeCredit&&t.data.demande_credit&&this.handleExistingDemandeCredit(t.data.demande_credit)}this.loadingDemande.set(!1)},error:t=>{console.error("Erreur chargement demande:",t),this.loadingDemande.set(!1),this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de charger la demande individuelle"})}}))}handleExistingDemandeCredit(t){console.log("Handling existing demande credit:",t),this.messageService.add({severity:"info",summary:"Demande de cr\xE9dit existante",detail:"Une demande de cr\xE9dit existe mais aucun dossier d'analyse n'a \xE9t\xE9 cr\xE9\xE9"})}handleExistingDossierWithPrevisions(t){console.log("Handling existing dossier with previsions:",t),this.creditParams.update(e=>p(u({},e),{dossierId:t.id,montantCredit:t.montantDemande||e.montantCredit,duree:t.dureeMois||e.duree,tauxInteret:t.tauxInteret||e.tauxInteret})),this.creditParamsForm.patchValue({montantCredit:t.montantDemande,duree:t.dureeMois,tauxInteret:t.tauxInteret},{emitEvent:!1}),this.messageService.add({severity:"info",summary:"Dossier existant",detail:`Dossier de cr\xE9dit N\xB0${t.id} trouv\xE9 - Chargement des pr\xE9visions...`}),this.loadPrevisionsForDossier(t.id)}loadPrevisionsForDossier(t){console.log("Loading previsions for dossier:",t),this.state.update(e=>p(u({},e),{loading:!0})),this.userService.getPrevisionsTresorerie$(t).subscribe({next:e=>{if(e.data?.previsions?.length>0){this.tresorerieState.clearAll();let i=e.data.previsions;i.forEach(n=>{this.loadPrevisionIntoForm(n)}),setTimeout(()=>{this.calculateAllMonths(),this.cdr.detectChanges()},100),this.messageService.add({severity:"success",summary:"Pr\xE9visions charg\xE9es",detail:`${i.length} p\xE9riodes charg\xE9es`})}this.state.update(i=>p(u({},i),{loading:!1}))},error:e=>{console.error("Erreur chargement pr\xE9visions:",e),this.state.update(i=>p(u({},i),{loading:!1}))}})}loadPrevisionIntoForm(t){let e=t.numeroMois,i=this.getMoisFormGroup(e);if(!i){console.warn(`FormGroup pour mois ${e} non trouv\xE9`);return}let n=this.extractPrevisionFormData(t);i.patchValue(n,{emitEvent:!1}),this.tresorerieState.updatePrevision(e,n,!0,!0),this.moisSauvegardes.update(r=>(r.add(e),new Set(r))),this.moisRenseignes.update(r=>(r.add(e),new Set(r))),console.log(`Mois ${e} charg\xE9:`,n)}loadPrevisionData(t){let e=t.numeroMois,i=this.getMoisFormGroup(e);if(!i){console.warn(`FormGroup pour mois ${e} non trouv\xE9`);return}let n=this.extractPrevisionFormData(t);i.patchValue(n,{emitEvent:!1}),this.tresorerieState.updatePrevision(e,n,!0,!0),this.cdr.detectChanges()}extractPrevisionFormData(t){let e={soldeDebut:t.soldeDebut||0,totalEncaissements:t.totalEncaissements||0,totalDecaissements:t.totalDecaissements||0,disponibleEnCaisse:(t.soldeDebut||0)+(t.totalEncaissements||0),excedentDeficit:t.excedentDeficit||0,soldeFin:t.soldeFin||0,ventes:0,autresRevenus:0,pret:0,achatmarchandises:0,mainoeuvre:0,investissement:0,impotstaxes:0,loyer:0,utilities:0,transport:0,salaires:0,fraistelephone:0,chargesfinancieres:0,entretien:0,autresdepenses:0,interetsAVerser:0,remboursementCapital:0};return t.lignesEncaissement?.length&&t.lignesEncaissement.forEach(i=>{let n=i.montant||0;switch(i.categorie){case"VENTES":e.ventes=n;break;case"AUTRES_REVENUS":e.autresRevenus=n;break;case"PRET":e.pret=n;break}}),t.lignesDecaissement?.length&&t.lignesDecaissement.forEach(i=>{let n=i.montant||0;switch(i.categorie){case"ACHAT_MARCHANDISES":e.achatmarchandises=n;break;case"MAIN_OEUVRE":e.mainoeuvre=n;break;case"INVESTISSEMENT":e.investissement=n;break;case"IMPOTS_TAXES":e.impotstaxes=n;break;case"LOYER":e.loyer=n;break;case"UTILITIES":e.utilities=n;break;case"TRANSPORT":e.transport=n;break;case"SALAIRES":e.salaires=n;break;case"FRAIS_TELEPHONE":e.fraistelephone=n;break;case"CHARGES_FINANCIERES":e.chargesfinancieres=n;break;case"ENTRETIEN":e.entretien=n;break;case"AUTRES_DEPENSES":e.autresdepenses=n;break;case"INTERETS":e.interetsAVerser=n;break;case"CAPITAL":e.remboursementCapital=n;break}}),e}handleExistingDossier(t){console.log("Handling existing dossier:",t),this.creditParams.update(e=>p(u({},e),{dossierId:t.id})),this.messageService.add({severity:"info",summary:"Dossier existant",detail:`Dossier de cr\xE9dit N\xB0${t.id} trouv\xE9 - Chargement des pr\xE9visions...`}),this.loadExistingPrevisionsForDossier(t.id)}loadExistingPrevisionsForDossier(t){console.log("Loading previsions for dossier:",t),this.state.update(e=>p(u({},e),{loading:!0})),this.userService.getPrevisionsTresorerie$(t).subscribe({next:e=>{if(console.log("Previsions loaded:",e),e.data?.previsions&&e.data.previsions.length>0){let i=e.data.previsions;i.forEach(n=>{let r=n.numeroMois,s=this.getMoisFormGroup(r);s&&(s.patchValue({soldeDebut:n.soldeDebut||0,totalEncaissements:n.totalEncaissements||0,totalDecaissements:n.totalDecaissements||0,excedentDeficit:n.excedentDeficit||0,soldeFin:n.soldeFin||0}),n.lignesEncaissement&&n.lignesEncaissement.forEach(m=>{switch(m.categorie){case"VENTES":s.patchValue({ventes:m.montant});break;case"AUTRES_REVENUS":s.patchValue({autresRevenus:m.montant});break;case"PRET":s.patchValue({pret:m.montant});break}}),n.lignesDecaissement&&n.lignesDecaissement.forEach(m=>{switch(m.categorie){case"ACHAT_MARCHANDISES":s.patchValue({achatmarchandises:m.montant});break;case"MAIN_OEUVRE":s.patchValue({mainoeuvre:m.montant});break;case"INVESTISSEMENT":s.patchValue({investissement:m.montant});break;case"IMPOTS_TAXES":s.patchValue({impotstaxes:m.montant});break;case"LOYER":s.patchValue({loyer:m.montant});break;case"UTILITIES":s.patchValue({utilities:m.montant});break;case"TRANSPORT":s.patchValue({transport:m.montant});break;case"SALAIRES":s.patchValue({salaires:m.montant});break;case"FRAIS_TELEPHONE":s.patchValue({fraistelephone:m.montant});break;case"CHARGES_FINANCIERES":s.patchValue({chargesfinancieres:m.montant});break;case"ENTRETIEN":s.patchValue({entretien:m.montant});break;case"AUTRES_DEPENSES":s.patchValue({autresdepenses:m.montant});break;case"INTERETS":s.patchValue({interetsAVerser:m.montant});break;case"CAPITAL":s.patchValue({remboursementCapital:m.montant});break}}),this.moisSauvegardes.update(m=>(m.add(r),new Set(m))),this.moisRenseignes.update(m=>(m.add(r),new Set(m))))}),this.calculateAllMonths(),this.messageService.add({severity:"success",summary:"Pr\xE9visions charg\xE9es",detail:`${i.length} p\xE9riodes de pr\xE9visions charg\xE9es avec succ\xE8s`})}else this.messageService.add({severity:"info",summary:"Aucune pr\xE9vision",detail:"Aucune pr\xE9vision trouv\xE9e pour ce dossier. Vous pouvez commencer la saisie."});this.state.update(i=>p(u({},i),{loading:!1}))},error:e=>{console.error("Erreur chargement pr\xE9visions:",e),this.state.update(i=>p(u({},i),{loading:!1})),e.status!==404&&this.messageService.add({severity:"warn",summary:"Attention",detail:"Impossible de charger les pr\xE9visions existantes"})}})}preFillCreditParams(t){this.creditParamsForm.patchValue({montantCredit:t.montantDemande||0,duree:t.dureeDemande||12,tauxInteret:t.tauxInteret||3}),this.creditParams.update(e=>p(u({},e),{montantCredit:t.montantDemande||0,duree:t.dureeDemande||12,tauxInteret:t.tauxInteret||3,clientNom:`${t.prenom} ${t.nom}`})),setTimeout(()=>{this.applyCalculations()},100)}initializeCreditParamsForm(){this.creditParamsForm=this.fb.group({clientId:[null,y.required],montantCredit:[null,[y.required,y.min(1e5)]],duree:[12,[y.required,y.min(1),y.max(60)]],tauxInteret:[3,[y.required,y.min(0),y.max(100)]]}),this.creditParamsForm.valueChanges.subscribe(t=>{if(this.creditParamsForm.valid){let e=this.clients().find(i=>i.id===t.clientId);this.creditParams.update(i=>p(u(u({},i),t),{clientNom:e?`${e.prenom} ${e.nom}`:""}))}})}initializeNewClientForm(){this.newClientForm=this.fb.group({nom:["",y.required],prenom:["",y.required],telephone:["",[y.required,y.pattern(/^[0-9]{9}$/)]],email:["",y.email],adresse:[""],typeActivite:[""],numeroIdentite:[""]})}trackByIndex(t){return t}loadInitialParams(){let t=this.route.snapshot.queryParams;t.clientId&&this.creditParamsForm.patchValue({clientId:+t.clientId,montantCredit:t.montant?+t.montant:null,duree:t.duree?+t.duree:12,tauxInteret:t.taux?+t.taux:3})}loadClientDossiers(t){console.log("Loading dossiers for client:",t),this.state.update(e=>p(u({},e),{loading:!0})),this.userService.getDossiersByClient$(t).subscribe({next:e=>{if(console.log("Response getDossiersByClient:",e),e?.data?.dossiers&&e.data.dossiers.length>0){let i=e.data.dossiers;this.dossiers.set(i);let n=i[0];console.log("Latest dossier:",n),this.selectedDossier.set(n),this.hasExistingAnalysis.set(!0),this.showAnalysisChoiceDialog(n)}else console.log("Pas de dossier trouv\xE9"),this.hasExistingAnalysis.set(!1),this.dossiers.set([]),this.selectedDossier.set(null),this.messageService.add({severity:"info",summary:"Nouveau client",detail:"Aucune analyse existante pour ce client"});this.state.update(i=>p(u({},i),{loading:!1}))},error:e=>{console.error("Erreur chargement dossiers:",e),this.state.update(i=>p(u({},i),{loading:!1})),this.hasExistingAnalysis.set(!1),this.dossiers.set([]),this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de charger les dossiers"})}})}showAnalysisChoiceDialog(t){console.log("Showing dialog for dossier:",t);let e=this.formatDateFromArray(t.dateDemande);this.confirmationService.confirm({message:`Ce client a d\xE9j\xE0 un dossier (N\xB0${t.id}) du ${e}. 
                      Montant: ${this.formatMontant(t.montantDemande)} | 
                      Dur\xE9e: ${t.dureeMois} mois | 
                      Taux: ${t.tauxInteret}% |
                      Statut: ${t.statut}`,header:"Analyse existante trouv\xE9e",icon:"pi pi-info-circle",acceptLabel:"Charger l'analyse",rejectLabel:"Nouvelle analyse",accept:()=>{console.log("Chargement de l'analyse existante"),this.loadExistingAnalysis(t)},reject:()=>{console.log("Cr\xE9ation d'une nouvelle analyse"),this.startNewAnalysis()}})}formatDateFromArray(t){if(!t)return"";if(typeof t=="string")return new Date(t).toLocaleDateString("fr-FR");if(Array.isArray(t)&&t.length>=3){let[e,i,n]=t;return new Date(e,i-1,n).toLocaleDateString("fr-FR")}return""}calculateAge(t){if(!t||!Array.isArray(t)||t.length<3)return 0;let[e,i,n]=t,r=new Date(e,i-1,n),s=new Date,m=s.getFullYear()-r.getFullYear(),b=s.getMonth()-r.getMonth();return(b<0||b===0&&s.getDate()<r.getDate())&&m--,m}getTotalGaranties(){return this.garanties().reduce((t,e)=>t+(e.valeurGarantie||0),0)}getCouvertureGaranties(){let t=this.getTotalGaranties(),e=this.creditParams().montantCredit;return!e||e===0?0:t/e*100}formatDate(t){return t?new Date(t).toLocaleDateString("fr-FR"):""}formatMontant(t){return t?new Intl.NumberFormat("fr-FR",{style:"currency",currency:"GNF",minimumFractionDigits:0,maximumFractionDigits:0}).format(t):"0 GNF"}startNewAnalysis(){console.log("Starting new analysis");let t=this.creditParams().clientId,e=this.creditParams().clientNom;this.creditParams.update(i=>p(u({},i),{dossierId:0,montantCredit:0,duree:12,tauxInteret:0})),this.creditParamsForm.patchValue({montantCredit:0,duree:12,tauxInteret:0}),this.resetTresorerieForm(),this.messageService.add({severity:"info",summary:"Nouvelle analyse",detail:"Vous pouvez cr\xE9er une nouvelle analyse pour ce client"})}resetTresorerieForm(){let t=this.nombreMois();for(let e=1;e<=t;e++){let i=this.getMoisFormGroup(e);i&&i.reset({soldeDebut:e===1?0:null,ventes:0,autresRevenus:0,pret:0,achatmarchandises:0,mainoeuvre:0,investissement:0,impotstaxes:0,loyer:0,utilities:0,transport:0,salaires:0,fraistelephone:0,chargesfinancieres:0,entretien:0,autresdepenses:0,interetsAVerser:0,remboursementCapital:0,totalEncaissements:0,totalDecaissements:0,disponibleEnCaisse:0,excedentDeficit:0,soldeFin:0})}}resetAll(){this.confirmationService.confirm({message:"\xCAtes-vous s\xFBr de vouloir r\xE9initialiser toutes les donn\xE9es ?",header:"Confirmation",icon:"pi pi-exclamation-triangle",accept:()=>{this.creditParams.set({clientId:0,clientNom:"",montantCredit:0,duree:12,tauxInteret:0,dossierId:0}),this.creditParamsForm.reset({clientId:0,montantCredit:0,duree:12,tauxInteret:0}),this.resetTresorerieForm(),this.hasExistingAnalysis.set(!1),this.selectedDossier.set(null),this.messageService.add({severity:"success",summary:"R\xE9initialisation",detail:"Toutes les donn\xE9es ont \xE9t\xE9 r\xE9initialis\xE9es"})}})}loadExistingAnalysis(t){console.log("Loading existing analysis:",t),this.creditParams.update(e=>p(u({},e),{dossierId:t.id,montantCredit:t.montantDemande,duree:t.dureeMois,tauxInteret:t.tauxInteret,clientNom:t.clientNomComplet})),this.creditParamsForm.patchValue({clientId:t.clientId,montantCredit:t.montantDemande,duree:t.dureeMois,tauxInteret:t.tauxInteret}),this.applyCalculations(),this.loadPrevisions(t.id),this.messageService.add({severity:"success",summary:"Analyse charg\xE9e",detail:`Dossier N\xB0${t.id} charg\xE9 avec succ\xE8s`})}loadPrevisions(t){this.state.update(e=>p(u({},e),{loading:!0})),this.userService.getPrevisionsTresorerie$(t).subscribe({next:e=>{e.data?.previsions&&(this.populatePrevisionsForm(e.data.previsions),e.data.previsions.forEach(i=>{this.moisSauvegardes.update(n=>(n.add(i.numeroMois),new Set(n))),this.moisRenseignes.update(n=>(n.add(i.numeroMois),new Set(n)))}),e.data.previsions.forEach(i=>{this.loadLignesPrevision(i)})),this.state.update(i=>p(u({},i),{loading:!1}))},error:e=>{console.error("Erreur chargement pr\xE9visions:",e),this.state.update(i=>p(u({},i),{loading:!1}))}})}populatePrevisionsForm(t){t.forEach(e=>{let i=this.getMoisFormGroup(e.numeroMois);i&&i.patchValue({soldeDebut:e.soldeDebut,totalEncaissements:e.totalEncaissements,totalDecaissements:e.totalDecaissements,excedentDeficit:e.excedentDeficit,soldeFin:e.soldeFin})})}loadLignesPrevision(t){let e=t.numeroMois;t.id&&(this.userService.getLignesEncaissement$(t.id).subscribe({next:i=>{i.data?.encaissements&&this.populateLignesEncaissement(e,i.data.encaissements)},error:i=>console.error("Erreur chargement encaissements:",i)}),this.userService.getLignesDecaissement$(t.id).subscribe({next:i=>{i.data?.decaissements&&this.populateLignesDecaissement(e,i.data.decaissements)},error:i=>console.error("Erreur chargement d\xE9caissements:",i)}))}populateLignesDecaissement(t,e){let i=this.getMoisFormGroup(t);i&&e.forEach(n=>{switch(n.categorie){case"ACHAT_MARCHANDISES":i.patchValue({achatmarchandises:n.montant});break;case"MAIN_OEUVRE":i.patchValue({mainoeuvre:n.montant});break;case"INVESTISSEMENT":i.patchValue({investissement:n.montant});break;case"IMPOTS_TAXES":i.patchValue({impotstaxes:n.montant});break;case"LOYER":i.patchValue({loyer:n.montant});break;case"UTILITIES":i.patchValue({utilities:n.montant});break;case"TRANSPORT":i.patchValue({transport:n.montant});break;case"SALAIRES":i.patchValue({salaires:n.montant});break;case"FRAIS_TELEPHONE":i.patchValue({fraistelephone:n.montant});break;case"CHARGES_FINANCIERES":i.patchValue({chargesfinancieres:n.montant});break;case"ENTRETIEN":i.patchValue({entretien:n.montant});break;case"AUTRES_DEPENSES":i.patchValue({autresdepenses:n.montant});break}})}populateLignesEncaissement(t,e){let i=this.getMoisFormGroup(t);i&&e.forEach(n=>{switch(n.categorie){case"VENTES":i.patchValue({ventes:n.montant});break;case"AUTRES_REVENUS":i.patchValue({autresRevenus:n.montant});break;case"PRET":i.patchValue({pret:n.montant});break}})}applyCalculations(){this.calculateAllMonths(),this.messageService.add({severity:"success",summary:"Param\xE8tres appliqu\xE9s",detail:"Les param\xE8tres du cr\xE9dit ont \xE9t\xE9 mis \xE0 jour"})}updateRemboursementsInForm(t,e){for(let i=1;i<=12;i++){let n=this.getMoisFormGroup(i);n&&n.patchValue({interetsAVerser:e,remboursementCapital:t},{emitEvent:!1})}}saveNewClient(){if(this.newClientForm.invalid)return;this.savingClient=!0;let t=this.newClientForm.value;this.userService.createClient$(t).subscribe({next:e=>{if(e.data?.client){let i=p(u({},e.data.client),{nomComplet:`${e.data.client.prenom} ${e.data.client.nom}`});this.clients.update(n=>[...n,i]),this.creditParamsForm.patchValue({clientId:i.id}),this.showNewClientDialog=!1,this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Client cr\xE9\xE9 avec succ\xE8s"})}this.savingClient=!1},error:e=>{this.savingClient=!1,this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de cr\xE9er le client"})}})}resetCreditParams(){this.creditParamsForm.reset({clientId:null,montantCredit:null,duree:12,tauxInteret:3}),this.creditParams.set({montantCredit:0,tauxInteret:0,duree:12,clientId:0,clientNom:"",dossierId:0}),this.initializeForm()}applyCreditParams(){if(this.creditParamsForm.invalid){Object.keys(this.creditParamsForm.controls).forEach(t=>{this.creditParamsForm.get(t)?.markAsTouched()}),this.messageService.add({severity:"warn",summary:"Formulaire invalide",detail:"Veuillez remplir tous les champs obligatoires"});return}!this.creditParams().dossierId||this.creditParams().dossierId===0?this.createDossierCredit():this.applyCalculations()}createDossierCredit(){let t=this.creditParams(),e=this.demandeIndividuel(),i={demandeindividuelId:this.demandeIndividuelId,clientId:t.clientId||null,montantDemande:t.montantCredit,dureeMois:t.duree,tauxInteret:t.tauxInteret,statut:"EN_COURS"};this.state.update(n=>p(u({},n),{saving:!0})),this.userService.createDossierCredit$(i).subscribe({next:n=>{n.data?.dossier&&(this.creditParams.update(r=>p(u({},r),{dossierId:n.data.dossier.id})),this.messageService.add({severity:"success",summary:"Dossier cr\xE9\xE9",detail:`Dossier N\xB0${n.data.dossier.id} cr\xE9\xE9 avec succ\xE8s`}),this.applyCalculations()),this.state.update(r=>p(u({},r),{saving:!1}))},error:n=>{this.state.update(r=>p(u({},r),{saving:!1})),this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de cr\xE9er le dossier de cr\xE9dit"})}})}loadCreditParams(){let t=this.route.snapshot.queryParams,e=this.route.snapshot.params,i=t.clientId||e.clientId,n=t.dossierId||e.dossierId,r=t.montant||e.montant,s=t.duree||e.duree,m=t.taux||e.taux,b=t.clientNom||e.clientNom;n?this.loadDossierFromAPI(+n):i?(this.creditParams.set({clientId:+i,dossierId:n?+n:0,montantCredit:r?+r:0,duree:s?+s:12,tauxInteret:m?+m:0,clientNom:b||""}),!b&&i&&this.loadClientInfo(+i)):(this.messageService.add({severity:"warn",summary:"Param\xE8tres manquants",detail:"Veuillez s\xE9lectionner un client et d\xE9finir les param\xE8tres du cr\xE9dit"}),this.router.navigate(["/credit/nouveau"]))}loadDossierFromAPI(t){this.state.update(e=>p(u({},e),{loading:!0})),this.userService.getDossierCredit$(t).subscribe({next:e=>{if(e.data?.dossier){let i=e.data.dossier;this.creditParams.set({clientId:i.clientId,clientNom:i.clientNomComplet||"",dossierId:i.id,montantCredit:i.montantDemande,duree:i.dureeMois,tauxInteret:i.tauxInteret}),this.loadExistingPrevisions(t)}this.state.update(i=>p(u({},i),{loading:!1}))},error:e=>{this.state.update(i=>p(u({},i),{loading:!1})),this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de charger les informations du dossier"}),console.error("Erreur chargement dossier:",e)}})}loadExistingPrevisions(t){this.userService.getPrevisionsTresorerie$(t).subscribe({next:e=>{if(e.data?.previsions||e.data?.previsionsTresorerie){let i=e.data.previsions||e.data.previsionsTresorerie;this.populateForm(i)}},error:e=>{console.error("Erreur chargement pr\xE9visions:",e)}})}loadClientInfo(t){this.userService.getClient$(t).subscribe({next:e=>{e.data?.client&&this.creditParams.update(i=>p(u({},i),{clientNom:`${e.data.client?.prenom} ${e.data.client?.nom}`}))},error:e=>{console.error("Erreur chargement client:",e)}})}initializeForm(){let t={},e=this.nombreMois();for(let n=0;n<=e;n++)t[`mois${n}`]=this.fb.group({numeroMois:[n],soldeDebut:[{value:null,disabled:n>0}],ventes:[{value:null,disabled:n===0}],autresRevenus:[null],pret:[null],achatmarchandises:[null],mainoeuvre:[null],investissement:[null],impotstaxes:[null],loyer:[null],utilities:[null],transport:[null],salaires:[null],fraistelephone:[null],chargesfinancieres:[null],entretien:[null],autresdepenses:[null],interetsAVerser:[null],remboursementCapital:[null],totalEncaissements:[{value:0,disabled:!0}],totalDecaissements:[{value:0,disabled:!0}],disponibleEnCaisse:[{value:0,disabled:!0}],excedentDeficit:[{value:0,disabled:!0}],soldeFin:[{value:0,disabled:!0}]});this.tresorerieForm=this.fb.group(t);let i=this.getMoisFormGroup(0);i&&i.patchValue({soldeDebut:0},{emitEvent:!1}),this.setupFormChangeListeners()}checkIfMoisHasData(t){return t?["ventes","autresRevenus","pret","achatmarchandises","mainoeuvre","investissement","impotstaxes","loyer","utilities","transport","salaires","fraistelephone","chargesfinancieres","entretien","autresdepenses","interetsAVerser","remboursementCapital"].some(i=>{let n=t[i];return n!=null&&n!==""&&n!==0}):!1}getMoisFormGroup(t){return this.tresorerieForm?.get(`mois${t}`)}calculateMonth(t){let e=this.getMoisFormGroup(t);if(!e)return;let i=e.getRawValue(),n=T=>{if(T==null||T==="")return 0;let K=Number(T);return isNaN(K)?0:K},r=n(i.ventes)+n(i.autresRevenus)+n(i.pret),s=n(i.achatmarchandises)+n(i.mainoeuvre)+n(i.investissement)+n(i.impotstaxes)+n(i.loyer)+n(i.utilities)+n(i.transport)+n(i.salaires)+n(i.fraistelephone)+n(i.chargesfinancieres)+n(i.entretien)+n(i.autresdepenses),m=n(i.soldeDebut)+r,b=m-s,x=b-n(i.interetsAVerser)-n(i.remboursementCapital);e.patchValue({totalEncaissements:r,totalDecaissements:s,disponibleEnCaisse:m,excedentDeficit:b,soldeFin:x},{emitEvent:!1,onlySelf:!0});let v=this.nombreMois();if(t<v){let T=this.getMoisFormGroup(t+1);T&&T.patchValue({soldeDebut:x},{emitEvent:!1})}this.cdr.markForCheck()}resetMonth(t){this.confirmationService.confirm({message:`\xCAtes-vous s\xFBr de vouloir r\xE9initialiser les donn\xE9es du ${this.getMoisLabel(t)} ?`,header:"Confirmation",icon:"pi pi-exclamation-triangle",accept:()=>{this.resetMonthToDefaults(t),this.tresorerieState.clearMonth(t);for(let e=t+1;e<=12;e++)this.calculateMonth(e);this.messageService.add({severity:"success",summary:"R\xE9initialisation",detail:`${this.getMoisLabel(t)} r\xE9initialis\xE9 avec succ\xE8s`}),this.cdr.detectChanges()}})}getFormSummary(){let t=this.tresorerieState.getMonthsWithData(),e=this.tresorerieState.getSavedMonths(),i=this.nombreMois()+1;return{totalMois:i,moisRenseignes:t.length,moisSauvegardes:e.length,pourcentageComplete:Math.round(t.length/i*100),pourcentageSauvegarde:Math.round(e.length/i*100),peutSauvegarder:this.canSave()}}calculateAllMonths(){let t=this.nombreMois();for(let e=0;e<=t;e++)this.calculateMonth(e)}setupCalculations(){let t=this.nombreMois();for(let e=0;e<=t;e++){let i=this.getMoisFormGroup(e);if(!i)continue;["ventes","autresRevenus","pret","achatmarchandises","mainoeuvre","investissement","impotstaxes","loyer","utilities","transport","salaires","fraistelephone","chargesfinancieres","entretien","autresdepenses","interetsAVerser","remboursementCapital"].forEach(r=>{let s=i.get(r);s&&s.valueChanges.pipe(q(300),N(),A(this.destroyRef)).subscribe(()=>{e===this.currentMonth()&&this.calculateMonth(e)})})}}updateMoisStatus(t,e){e?this.moisRenseignes.update(i=>(i.add(t),new Set(i))):(this.moisRenseignes.update(i=>(i.delete(t),new Set(i))),this.moisSauvegardes.update(i=>(i.delete(t),new Set(i))))}applySuggestedRepayments(){let t=this.mensualite(),e=this.nombreMois();if(t.total===0){this.messageService.add({severity:"warn",summary:"Attention",detail:"Veuillez d'abord d\xE9finir les param\xE8tres du cr\xE9dit"});return}this.confirmationService.confirm({message:`Voulez-vous appliquer les remboursements sugg\xE9r\xE9s aux mois 1 \xE0 ${e} ?`,header:"Appliquer les remboursements",icon:"pi pi-question-circle",accept:()=>{for(let i=1;i<=e;i++){let n=this.getMoisFormGroup(i);n&&n.patchValue({interetsAVerser:t.interet,remboursementCapital:t.capital})}this.calculateAllMonths(),this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:`Remboursements appliqu\xE9s aux p\xE9riodes 1 \xE0 ${e}`})}})}loadClientData(){let t=this.route.snapshot.queryParams.clientId,e=this.route.snapshot.queryParams.dossierId;t&&(this.creditParams.update(i=>p(u({},i),{clientId:+t,dossierId:e?+e:0})),this.loadExistingData(e))}loadExistingData(t){t&&(this.state.update(e=>p(u({},e),{loading:!0})),this.userService.getPrevisionsTresorerie$(t).subscribe({next:e=>{e.data?.previsionsTresorerie&&this.populateForm(e.data.previsionsTresorerie),this.state.update(i=>p(u({},i),{loading:!1}))},error:e=>{this.state.update(i=>p(u({},i),{loading:!1,error:e})),this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de charger les donn\xE9es"})}}))}populateForm(t){console.log("Populating form with:",t)}savePrevisions(){if(!this.creditParams().dossierId||this.creditParams().dossierId===0){this.createDossierAndSavePrevisions();return}this.saveAllPrevisions()}saveAllPrevisions(){let t=this.creditParams().dossierId;if(!t||t===0){this.messageService.add({severity:"error",summary:"Erreur",detail:"ID du dossier invalide"});return}let e=this.prepareAllPrevisionsData();this.state.update(i=>p(u({},i),{saving:!0})),this.userService.savePrevisionsTresorerie$(t,e).subscribe({next:i=>{e.forEach(n=>{this.tresorerieState.markAsSaved(n.numeroMois)}),this.state.update(n=>p(u({},n),{saving:!1})),this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Toutes les pr\xE9visions ont \xE9t\xE9 sauvegard\xE9es"})},error:i=>{console.error("Erreur sauvegarde globale:",i),this.state.update(n=>p(u({},n),{saving:!1})),this.messageService.add({severity:"error",summary:"Erreur",detail:i.error?.message||"Impossible de sauvegarder les pr\xE9visions"})}})}validateDataBeforeSave(t){let e=!0;return t.forEach((i,n)=>{console.log(`Validation Mois ${i.numeroMois}:`);let r=i.lignesDecaissement.find(x=>x.categorie==="INTERETS"),s=i.lignesDecaissement.find(x=>x.categorie==="CAPITAL");console.log(r?`  - Int\xE9r\xEAts: ${r.montant} GNF`:"  - Int\xE9r\xEAts: non d\xE9finis"),console.log(s?`  - Capital: ${s.montant} GNF`:"  - Capital: non d\xE9fini");let m=i.lignesEncaissement.reduce((x,v)=>x+v.montant,0),b=i.lignesDecaissement.reduce((x,v)=>x+v.montant,0);console.log(`  - Total encaissements calcul\xE9: ${m}`),console.log(`  - Total d\xE9caissements calcul\xE9: ${b}`)}),e}prepareAllPrevisionsData(){let t=[],e=this.nombreMois();for(let i=0;i<=e;i++){let n=this.getMoisFormGroup(i);if(n&&this.checkIfMoisHasData(n.getRawValue())){let r=this.prepareMonthData(i);t.push(r)}}return t}savePrevisionsOnly(){let t=this.creditParams().dossierId;if(!t||t===0){this.messageService.add({severity:"error",summary:"Erreur",detail:"ID du dossier invalide"});return}let e=this.preparePrevisionData();this.state.update(i=>p(u({},i),{saving:!0})),this.userService.savePrevisionsTresorerie$(t,e).subscribe({next:i=>{this.state.update(n=>p(u({},n),{saving:!1})),this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Pr\xE9visions de tr\xE9sorerie sauvegard\xE9es"})},error:i=>{this.state.update(n=>p(u({},n),{saving:!1})),this.messageService.add({severity:"error",summary:"Erreur",detail:i.error?.message||"Impossible de sauvegarder les pr\xE9visions"}),console.error("Erreur sauvegarde pr\xE9visions:",i)}})}createDossierAndSavePrevisions(){let t=this.creditParams();if(!t.clientId||!t.montantCredit||!t.duree){this.messageService.add({severity:"error",summary:"Param\xE8tres manquants",detail:"Veuillez remplir tous les param\xE8tres du cr\xE9dit"});return}let e={clientId:t.clientId,montantDemande:t.montantCredit,dureeMois:t.duree,tauxInteret:t.tauxInteret||0,statut:"EN_COURS"};this.state.update(i=>p(u({},i),{saving:!0})),this.userService.createDossierCredit$(e).subscribe({next:i=>{if(i.data?.dossier){let n=i.data.dossier.id;this.creditParams.update(r=>p(u({},r),{dossierId:n})),this.messageService.add({severity:"success",summary:"Dossier cr\xE9\xE9",detail:`Dossier N\xB0${n} cr\xE9\xE9 avec succ\xE8s`}),this.savePrevisionsOnly()}else throw new Error("R\xE9ponse invalide lors de la cr\xE9ation du dossier")},error:i=>{this.state.update(n=>p(u({},n),{saving:!1})),this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de cr\xE9er le dossier de cr\xE9dit"}),console.error("Erreur cr\xE9ation dossier:",i)}})}preparePrevisionData(){let t=this.tresorerieForm.getRawValue(),e=[];for(let i=1;i<=12;i++){let n=t[`mois${i}`],r={numeroMois:i,soldeDebut:n.soldeDebut||0,lignesEncaissement:[{categorie:"VENTES",libelle:"Ventes",montant:n.ventes||0},{categorie:"AUTRES_REVENUS",libelle:"Autres revenus",montant:n.autresRevenus||0},{categorie:"PRET",libelle:"Pr\xEAt",montant:n.pret||0}].filter(s=>s.montant>0),lignesDecaissement:[{categorie:"ACHAT_MARCHANDISES",libelle:"Achat marchandises",montant:n.achatmarchandises||0},{categorie:"MAIN_OEUVRE",libelle:"Main d'\u0153uvre",montant:n.mainoeuvre||0},{categorie:"INVESTISSEMENT",libelle:"Investissement",montant:n.investissement||0},{categorie:"IMPOTS_TAXES",libelle:"Imp\xF4ts et taxes",montant:n.impotstaxes||0},{categorie:"LOYER",libelle:"Loyer",montant:n.loyer||0},{categorie:"UTILITIES",libelle:"Utilities",montant:n.utilities||0},{categorie:"TRANSPORT",libelle:"Transport",montant:n.transport||0},{categorie:"SALAIRES",libelle:"Salaires",montant:n.salaires||0},{categorie:"FRAIS_TELEPHONE",libelle:"Frais t\xE9l\xE9phone",montant:n.fraistelephone||0},{categorie:"CHARGES_FINANCIERES",libelle:"Charges financi\xE8res",montant:n.chargesfinancieres||0},{categorie:"ENTRETIEN",libelle:"Entretien",montant:n.entretien||0},{categorie:"AUTRES_DEPENSES",libelle:"Autres d\xE9penses",montant:n.autresdepenses||0}].filter(s=>s.montant>0),totalEncaissements:n.totalEncaissements||0,totalDecaissements:n.totalDecaissements||0,excedentDeficit:n.excedentDeficit||0,soldeFin:n.soldeFin||0};e.push(r)}return e}performMonthTransition(t){this.state.update(e=>p(u({},e),{currentMonth:t})),this.ngZone.run(()=>{this.refreshMonthData(t),this.updateFieldsStateForMonth(t),setTimeout(()=>{this.calculateMonth(t),this.cdr.detectChanges()},0)})}refreshMonthData(t){let e=this.getMoisFormGroup(t);if(e){if(this.moisSauvegardes().has(t)){let i=e.getRawValue();e.patchValue(i,{emitEvent:!1})}else if(this.moisRenseignes().has(t)){let i=e.getRawValue();e.patchValue(i,{emitEvent:!1})}else this.initializeEmptyMonth(t);e.updateValueAndValidity({emitEvent:!1})}}updateFieldsStateForMonth(t){let e=this.getMoisFormGroup(t);if(!e)return;let i=e.get("soldeDebut");i&&(t===0?i.enable({emitEvent:!1}):i.disable({emitEvent:!1}));let n=e.get("ventes"),r=e.get("autresRevenus");t===0?(n?.disable({emitEvent:!1}),n?.setValue(null,{emitEvent:!1})):n?.enable({emitEvent:!1}),["totalEncaissements","totalDecaissements","disponibleEnCaisse","excedentDeficit","soldeFin"].forEach(s=>{e.get(s)?.disable({emitEvent:!1})})}resetMonthToDefaults(t){let e=this.getMoisFormGroup(t);if(!e)return;let i=0;if(t===0)i=0;else if(t>0){let r=this.getMoisFormGroup(t-1);r&&(i=r.get("soldeFin")?.value||0)}let n={numeroMois:t,soldeDebut:i,ventes:null,autresRevenus:null,pret:t===0&&this.creditParams().montantCredit>0?this.creditParams().montantCredit:null,achatmarchandises:null,mainoeuvre:null,investissement:null,impotstaxes:null,loyer:null,utilities:null,transport:null,salaires:null,fraistelephone:null,chargesfinancieres:null,entretien:null,autresdepenses:null,interetsAVerser:null,remboursementCapital:null,totalEncaissements:0,totalDecaissements:0,disponibleEnCaisse:0,excedentDeficit:0,soldeFin:0};e.reset(n,{emitEvent:!1}),e.markAsPristine(),e.markAsUntouched(),this.calculateMonth(t),e.updateValueAndValidity(),this.cdr.detectChanges()}initializeEmptyMonth(t){let e=this.getMoisFormGroup(t);if(!e)return;let i=0;if(t===0)i=0;else if(t>0){let r=this.getMoisFormGroup(t-1);r&&(i=r.get("soldeFin")?.value||0)}let n={numeroMois:t,soldeDebut:i,ventes:null,autresRevenus:null,pret:t===0&&this.creditParams().montantCredit>0?this.creditParams().montantCredit:null,achatmarchandises:null,mainoeuvre:null,investissement:null,impotstaxes:null,loyer:null,utilities:null,transport:null,salaires:null,fraistelephone:null,chargesfinancieres:null,entretien:null,autresdepenses:null,interetsAVerser:t>0&&this.mensualite().interet>0?this.mensualite().interet:null,remboursementCapital:t>0&&this.mensualite().capital>0?this.mensualite().capital:null,totalEncaissements:0,totalDecaissements:0,disponibleEnCaisse:0,excedentDeficit:0,soldeFin:0};e.patchValue(n,{emitEvent:!1}),e.markAsPristine(),e.markAsUntouched()}refreshMonthForm(t){let e=this.getMoisFormGroup(t);if(!e)return;let i=e.getRawValue();!this.moisRenseignes().has(t)&&!this.moisSauvegardes().has(t)?this.resetMonthFormValues(t):e.patchValue(i,{emitEvent:!0}),e.updateValueAndValidity(),this.calculateMonth(t)}resetMonthFormValues(t){let e=this.getMoisFormGroup(t);if(!e)return;let i=0;if(t===0)i=0;else if(t>0){let r=this.getMoisFormGroup(t-1);r&&(i=r.get("soldeFin")?.value||0)}let n={numeroMois:t,soldeDebut:i,ventes:0,autresRevenus:0,pret:t===0?this.creditParams().montantCredit:0,achatmarchandises:0,mainoeuvre:0,investissement:0,impotstaxes:0,loyer:0,utilities:0,transport:0,salaires:0,fraistelephone:0,chargesfinancieres:0,entretien:0,autresdepenses:0,interetsAVerser:0,remboursementCapital:0,totalEncaissements:0,totalDecaissements:0,disponibleEnCaisse:0,excedentDeficit:0,soldeFin:0};e.reset(n),e.updateValueAndValidity()}hasUnsavedChanges(t){let e=this.getMoisFormGroup(t);return e?e.dirty&&!this.moisSauvegardes().has(t):!1}proceedToMonth(t){this.state.update(e=>p(u({},e),{currentMonth:t})),this.loadMonthData(t),this.cdr.detectChanges()}loadMonthData(t){let e=this.tresorerieState.getPrevision(t),i=this.getMoisFormGroup(t);if(i){if(t>0){let n=this.getMoisFormGroup(t-1);if(n){let r=n.get("soldeFin")?.value||0;i.patchValue({soldeDebut:r},{emitEvent:!1})}}if(e&&e.hasData){let n=u({},e.data);t>0&&delete n.soldeDebut,i.patchValue(n,{emitEvent:!1}),e.saved?i.markAsPristine():i.markAsDirty()}else this.resetMonthToDefaults(t);this.calculateMonth(t),this.updateFieldsStateForMonth(t),this.cdr.detectChanges()}}saveCurrentMonth(){let t=this.currentMonth(),e=this.getMoisFormGroup(t);if(!e||!this.creditParams().dossierId){this.messageService.add({severity:"warn",summary:"Attention",detail:"Veuillez cr\xE9er un dossier avant de sauvegarder"});return}if(!this.checkIfMoisHasData(e.getRawValue())){this.messageService.add({severity:"warn",summary:"Attention",detail:"Aucune donn\xE9e \xE0 sauvegarder pour cette p\xE9riode"});return}let i=this.prepareMonthData(t);this.state.update(n=>p(u({},n),{saving:!0})),this.userService.savePrevisionsTresorerie$(this.creditParams().dossierId,[i]).subscribe({next:n=>{this.tresorerieState.markAsSaved(t),e.markAsPristine(),this.state.update(r=>p(u({},r),{saving:!1})),this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:`P\xE9riode ${t} sauvegard\xE9e avec succ\xE8s`})},error:n=>{console.error("Erreur sauvegarde:",n),this.state.update(r=>p(u({},r),{saving:!1})),this.messageService.add({severity:"error",summary:"Erreur",detail:n.error?.message||"Impossible de sauvegarder la p\xE9riode"})}})}goToMonth(t){this.saveCurrentMonthState(),this.calculateMonth(this.currentMonth()),this.propagateSoldes(),this.tresorerieState.setCurrentMonth(t)}propagateSoldes(){let t=this.nombreMois();for(let e=0;e<t;e++){let i=this.getMoisFormGroup(e),n=this.getMoisFormGroup(e+1);if(i&&n){let r=i.get("soldeFin")?.value||0;n.patchValue({soldeDebut:r},{emitEvent:!1})}}}saveCurrentMonthState(){let t=this.currentMonth(),e=this.getMoisFormGroup(t);e&&this.checkIfMoisHasData(e.getRawValue())&&this.tresorerieState.updatePrevision(t,e.getRawValue(),this.moisSauvegardes().has(t),!0)}prepareMonthData(t){let e=this.getMoisFormGroup(t).getRawValue(),i=s=>{if(s==null||s==="")return 0;let m=Number(s);return isNaN(m)?0:m},n=[];i(e.ventes)>0&&n.push({categorie:"VENTES",libelle:"Ventes",montant:i(e.ventes)}),i(e.autresRevenus)>0&&n.push({categorie:"AUTRES_REVENUS",libelle:"Autres revenus",montant:i(e.autresRevenus)}),i(e.pret)>0&&n.push({categorie:"PRET",libelle:"Pr\xEAt",montant:i(e.pret)});let r=[];return i(e.achatmarchandises)>0&&r.push({categorie:"ACHAT_MARCHANDISES",libelle:"Achat marchandises",montant:i(e.achatmarchandises)}),i(e.mainoeuvre)>0&&r.push({categorie:"MAIN_OEUVRE",libelle:"Main d'\u0153uvre",montant:i(e.mainoeuvre)}),i(e.investissement)>0&&r.push({categorie:"INVESTISSEMENT",libelle:"Investissement",montant:i(e.investissement)}),i(e.impotstaxes)>0&&r.push({categorie:"IMPOTS_TAXES",libelle:"Imp\xF4ts et taxes",montant:i(e.impotstaxes)}),i(e.loyer)>0&&r.push({categorie:"LOYER",libelle:"Loyer",montant:i(e.loyer)}),i(e.utilities)>0&&r.push({categorie:"UTILITIES",libelle:"Utilities",montant:i(e.utilities)}),i(e.transport)>0&&r.push({categorie:"TRANSPORT",libelle:"Transport",montant:i(e.transport)}),i(e.salaires)>0&&r.push({categorie:"SALAIRES",libelle:"Salaires",montant:i(e.salaires)}),i(e.fraistelephone)>0&&r.push({categorie:"FRAIS_TELEPHONE",libelle:"Frais t\xE9l\xE9phone",montant:i(e.fraistelephone)}),i(e.chargesfinancieres)>0&&r.push({categorie:"CHARGES_FINANCIERES",libelle:"Charges financi\xE8res",montant:i(e.chargesfinancieres)}),i(e.entretien)>0&&r.push({categorie:"ENTRETIEN",libelle:"Entretien",montant:i(e.entretien)}),i(e.autresdepenses)>0&&r.push({categorie:"AUTRES_DEPENSES",libelle:"Autres d\xE9penses",montant:i(e.autresdepenses)}),i(e.interetsAVerser)>0&&r.push({categorie:"INTERETS",libelle:"Int\xE9r\xEAts \xE0 verser",montant:i(e.interetsAVerser)}),i(e.remboursementCapital)>0&&r.push({categorie:"CAPITAL",libelle:"Remboursement capital",montant:i(e.remboursementCapital)}),{numeroMois:t,soldeDebut:i(e.soldeDebut),lignesEncaissement:n,lignesDecaissement:r,totalEncaissements:i(e.totalEncaissements),totalDecaissements:i(e.totalDecaissements),excedentDeficit:i(e.excedentDeficit),soldeFin:i(e.soldeFin)}}clearMoisForm(t){let e=this.getMoisFormGroup(t);if(!e)return;let i=null;if(t===0)i=0;else if(t>0){let r=this.getMoisFormGroup(t-1);r&&(i=r.get("soldeFin")?.value||0)}let n={numeroMois:t,soldeDebut:i,ventes:null,autresRevenus:null,pret:null,achatmarchandises:null,mainoeuvre:null,investissement:null,impotstaxes:null,loyer:null,utilities:null,transport:null,salaires:null,fraistelephone:null,chargesfinancieres:null,entretien:null,autresdepenses:null,interetsAVerser:null,remboursementCapital:null,totalEncaissements:0,totalDecaissements:0,disponibleEnCaisse:0,excedentDeficit:0,soldeFin:0};t===0&&this.creditParams().montantCredit>0&&(n.pret=this.creditParams().montantCredit),e.reset(n,{emitEvent:!1}),e.updateValueAndValidity(),setTimeout(()=>{this.calculateMonth(t)},0)}setupFormChangeListeners(){let t=this.nombreMois();for(let e=0;e<=t;e++){let i=this.getMoisFormGroup(e);i&&i.valueChanges.pipe(q(300),N(),A(this.destroyRef)).subscribe(n=>{e===this.currentMonth()&&(this.checkIfMoisHasData(n)?this.tresorerieState.updatePrevision(e,n,!1,!0):this.tresorerieState.getPrevision(e)&&this.tresorerieState.clearMonth(e),this.calculateMonth(e))})}}canSave(){return this.moisRenseignes().size>0&&this.creditParams().dossierId>0&&!this.state().saving}getMoisStatus(t){return this.currentMonth()===t?"current":this.tresorerieState.getMonthStatus(t)}getMoisLabel(t){return t===0?"P\xE9riode 0 (D\xE9marrage)":`P\xE9riode ${t}`}toggleView(){this.state.update(t=>p(u({},t),{viewMode:t.viewMode==="saisie"?"vue-ensemble":"saisie"}))}importExcel(t){let e=t.target.files[0];if(e){let i=new FormData;i.append("file",e),this.state.update(n=>p(u({},n),{loading:!0})),this.userService.importPrevisionsTresorerie$(this.creditParams().dossierId,i).subscribe({next:n=>{n.data&&(this.populateForm(n.data),this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Donn\xE9es import\xE9es avec succ\xE8s"})),this.state.update(r=>p(u({},r),{loading:!1}))},error:n=>{this.state.update(r=>p(u({},r),{loading:!1,error:n})),this.messageService.add({severity:"error",summary:"Erreur",detail:"Erreur lors de l'import"})}})}}exportExcel(){this.userService.exportPrevisionsTresorerie$(this.creditParams().dossierId).subscribe({next:t=>{let e=window.URL.createObjectURL(t),i=document.createElement("a");i.href=e,i.download=`previsions_tresorerie_${this.creditParams().clientNom}.xlsx`,i.click(),window.URL.revokeObjectURL(e)},error:t=>{this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible d'exporter les donn\xE9es"})}})}validateAndProceed(){this.calculateAllMonths(),this.validateCoherence()?this.savePrevisions():this.messageService.add({severity:"warn",summary:"Attention",detail:"Veuillez v\xE9rifier la coh\xE9rence des donn\xE9es"})}validateCoherence(){for(let t=1;t<=12;t++)if(this.tresorerieState.monthHasData(t)){let e=this.getMoisFormGroup(t).getRawValue(),i=(e.interetsAVerser||0)+(e.remboursementCapital||0);if(e.excedentDeficit<i)return this.messageService.add({severity:"warn",summary:`P\xE9riode ${t}`,detail:"L'exc\xE9dent ne couvre pas les remboursements"}),!1}return!0}getCumuls(){let t={ventes:0,autresRevenus:0,pret:0,totalEncaissements:0,achatMarchandises:0,totalDecaissements:0,excedentDeficit:0};for(let e=1;e<=12;e++){let i=this.getMoisFormGroup(e).getRawValue();t.ventes+=i.ventes||0,t.autresRevenus+=i.autresRevenus||0,t.pret+=i.pret||0,t.totalEncaissements+=i.totalEncaissements||0,t.achatMarchandises+=i.achatMarchandises||0,t.totalDecaissements+=i.totalDecaissements||0,t.excedentDeficit+=i.excedentDeficit||0}return t}imprimerTableauTresorerie(){if(!this.tresorerieForm){this.messageService.add({severity:"warn",summary:"Attention",detail:"Aucune donn\xE9e de tr\xE9sorerie disponible pour l'impression"});return}if(!(this.getFormSummary().moisRenseignes>0)){this.messageService.add({severity:"warn",summary:"Attention",detail:"Veuillez saisir au moins une p\xE9riode de donn\xE9es avant d'imprimer"});return}try{this.tresoreriePrintService.imprimerTableauTresorerie(this.tresorerieForm,this.creditParams(),this.demandeIndividuel()),this.messageService.add({severity:"success",summary:"Impression",detail:"Fen\xEAtre d'impression ouverte"})}catch(e){console.error("Erreur lors de l'impression:",e),this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de g\xE9n\xE9rer le document d'impression"})}}peutImprimer(){return!!(this.tresorerieForm&&this.getFormSummary().moisRenseignes>0)}getApercuImpression(){if(!this.peutImprimer())return"Aucune donn\xE9e disponible";let t=this.getFormSummary(),e=this.creditParams(),i=this.demandeIndividuel(),n=i?`${i.prenom} ${i.nom}`:e.clientNom||"Client non d\xE9fini",r=this.formatMontant(e.montantCredit);return`${n} - ${r} - ${t.moisRenseignes} mois renseign\xE9s`}previsualiserTableauTresorerie(){if(!this.peutImprimer()){this.messageService.add({severity:"warn",summary:"Attention",detail:"Aucune donn\xE9e disponible pour la pr\xE9visualisation"});return}this.imprimerTableauTresorerie()}exporterTableauPDF(){if(!this.peutImprimer()){this.messageService.add({severity:"warn",summary:"Attention",detail:"Aucune donn\xE9e disponible pour l'export"});return}this.messageService.add({severity:"info",summary:"Export PDF",detail:`Dans la fen\xEAtre d'impression, choisissez "Enregistrer au format PDF"`}),setTimeout(()=>{this.imprimerTableauTresorerie()},1e3)}validerDonneesAvantImpression(){return this.getFormSummary().moisRenseignes===0?(this.messageService.add({severity:"error",summary:"Donn\xE9es insuffisantes",detail:"Veuillez saisir au moins une p\xE9riode de donn\xE9es"}),!1):!this.creditParams().montantCredit||this.creditParams().montantCredit===0?(this.messageService.add({severity:"warn",summary:"Param\xE8tres incomplets",detail:"Le montant du cr\xE9dit n'est pas d\xE9fini"}),!1):!0}imprimerAvecOptions(t={}){if(this.validerDonneesAvantImpression())try{this.tresoreriePrintService.imprimerTableauTresorerie(this.tresorerieForm,this.creditParams(),this.demandeIndividuel()),this.messageService.add({severity:"success",summary:"Impression",detail:"Document g\xE9n\xE9r\xE9 avec les options demand\xE9es"})}catch(e){console.error("Erreur impression avec options:",e),this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de g\xE9n\xE9rer le document avec ces options"})}}getResumeImpressionPourAffichage(){if(!this.peutImprimer())return{status:"unavailable",message:"Donn\xE9es insuffisantes",details:"Veuillez saisir au moins un mois de pr\xE9visions"};let t=this.getFormSummary(),e=this.creditParams();return{status:"ready",message:"Pr\xEAt pour impression",details:{moisRenseignes:t.moisRenseignes,moisSauvegardes:t.moisSauvegardes,client:this.demandeIndividuel()?`${this.demandeIndividuel().prenom} ${this.demandeIndividuel().nom}`:e.clientNom,montantCredit:this.formatMontant(e.montantCredit),duree:`${e.duree} mois`,tauxInteret:`${e.tauxInteret}%`}}}splitButtonOptions=[{label:"Aper\xE7u avant impression",icon:"pi pi-eye",command:()=>this.previsualiserTableauTresorerie()},{label:"Exporter en PDF",icon:"pi pi-file-pdf",command:()=>this.exporterTableauPDF()},{separator:!0},{label:"Imprimer avec en-t\xEAte",icon:"pi pi-id-card",command:()=>this.imprimerAvecOptions({inclureAnalyse:!0})},{label:"Imprimer tableau seul",icon:"pi pi-table",command:()=>this.imprimerTableauTresorerie()}];getTrimestreStats(t){let e=0,i=0,n=0;return t.forEach(r=>{let s=this.getMoisStatus(r);s==="saved"?i++:s==="filled"?e++:n++}),{filled:e,saved:i,empty:n}}getMonthTooltip(t){let e=this.getMoisStatus(t),n=this.getMoisFormGroup(t)?.get("soldeFin")?.value||0,r=`Mois ${t}`;return e==="saved"?r+=" - \u2713 Sauvegard\xE9":e==="filled"?r+=" - \u26A0 Non sauvegard\xE9":r+=" - \xC0 renseigner",n!==0&&(r+=` | Solde: ${this.formatMontant(n)}`),r}getTotalAnnuelEncaissements(){let t=0;for(let e=0;e<=12;e++){let i=this.getMoisFormGroup(e);i&&(t+=i.get("totalEncaissements")?.value||0)}return t}getTotalAnnuelDecaissements(){let t=0;for(let e=0;e<=12;e++){let i=this.getMoisFormGroup(e);i&&(t+=i.get("totalDecaissements")?.value||0)}return t}getSoldeAnnuelFinal(){let t=this.nombreMois();return this.getMoisFormGroup(t)?.get("soldeFin")?.value||0}getSoldeAnnuelClass(){let t=this.getSoldeAnnuelFinal();return t>0?"bg-green-50":t<0?"bg-red-50":"bg-gray-50"}goToFirstEmptyMonth(){for(let t=0;t<=12;t++)if(this.getMoisStatus(t)==="empty"){this.goToMonth(t);return}}hasEmptyMonths(){for(let t=0;t<=12;t++)if(this.getMoisStatus(t)==="empty")return!0;return!1}getMoisResume(){let t=[],e=this.nombreMois();for(let i=0;i<=e;i++){let n=this.getMoisFormGroup(i);t.push({mois:i,status:this.getMoisStatus(i),soldeFin:n?.get("soldeFin")?.value||0})}return t}getCellTooltip(t,e){let i=this.getCellValue(t.id,e);if(i==null)return`${t.libelle} - M${e}
Aucune valeur`;let n=this.formatMontant(i),r=this.getCellStatus(t.id,e),s=`${t.libelle}
`;return s+=`Mois ${e}${e===0?" (D\xE9marrage)":""}
`,s+=`\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501
`,s+=`\u{1F4B0} ${n}`,t.type==="calcul"?s+=`
\u{1F4CA} Calcul\xE9 automatiquement`:t.editable&&(s+=`
\u270F\uFE0F Modifiable`,i!==0&&e<this.nombreMois()&&(s+=`
\u27A1\uFE0F Clic droit pour copier`)),i<0&&(s+=`
\u26A0\uFE0F Valeur n\xE9gative`),s}getCumulTooltip(t){let e=this.getCumulForLigne(t.id),i=this.formatMontant(e),n=this.nombreMois(),r=`${t.libelle}
`;if(r+=`\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501
`,r+=`\u{1F4CA} Cumul M0 \xE0 M${n}
`,r+=`\u{1F4B0} ${i}`,(t.id==="soldeFin"||t.id==="soldeDebut")&&(r=`${t.libelle}
`,r+=`\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501
`,r+=`\u{1F4CA} Valeur au M${n}
`,r+=`\u{1F4B0} ${i}`),t.type!=="calcul"||t.id==="totalEncaissements"||t.id==="totalDecaissements"){let s=e/(n+1);r+=`
\u{1F4C8} Moyenne: ${this.formatMontant(s)}/mois`}return r}getCellStatus(t,e){return this.moisSauvegardes().has(e)?"saved":this.moisRenseignes().has(e)?"filled":"empty"}get isDurationLong(){return this.nombreMois()>12&&this.nombreMois()<=18}get isDurationExtraLong(){return this.nombreMois()>18}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=ne({type:a,selectors:[["app-analyse-flux-tresorerie"]],hostVars:4,hostBindings:function(e,i){e&2&&R("duration-long",i.isDurationLong)("duration-extra-long",i.isDurationExtraLong)},features:[se([J,Q])],decls:10,vars:3,consts:[[1,"analyse-flux-container"],["class","mb-3",4,"ngIf"],["class","credit-status-section mb-4",4,"ngIf"],["pTemplate","header"],[1,"dossier-required-overlay"],[1,"mb-3"],[1,"grid"],[1,"col-12","md:col-6","lg:col-4"],[1,"info-group"],[1,"text-sm","text-gray-600"],[1,"font-semibold","text-lg"],[1,"font-semibold"],[1,"text-sm","text-gray-500","ml-2"],[1,"pi","pi-phone","mr-1"],[1,"col-12"],[1,"col-12","md:col-6","lg:col-3"],[1,"font-semibold","text-primary","text-xl"],[1,"text-gray-500"],["class","col-12",4,"ngIf"],[1,"flex","justify-content-between","align-items-center","p-3"],[1,"pi","pi-user","mr-2"],["severity","info",3,"value"],[1,"pi","pi-shield","mr-2"],["styleClass","p-datatable-sm",3,"value","scrollable"],["pTemplate","body"],[1,"text-right"],[1,"text-center"],[3,"value","severity"],[1,"credit-status-section","mb-4"],["class","dossier-existant",4,"ngIf"],["class","dossier-a-creer",4,"ngIf"],[1,"dossier-existant"],[1,"status-card","bg-green-50","border-round-lg","border-1","border-green-300","p-3"],[1,"flex","align-items-center","justify-content-between","flex-wrap","gap-3"],[1,"flex","align-items-center","gap-3"],[1,"status-icon","bg-green-500","border-circle","p-3"],[1,"pi","pi-check-circle","text-white","text-2xl"],[1,"text-green-800","font-bold","text-lg"],[1,"text-green-600","text-sm"],[1,"flex","gap-2","align-items-center"],["severity","success","value","Pr\xEAt pour saisie","icon","pi pi-check"],[1,"text-primary"],[1,"dossier-a-creer"],[1,"status-card","bg-orange-50","border-round-lg","border-1","border-orange-300","p-3"],[1,"status-icon","bg-orange-500","border-circle","p-3"],[1,"pi","pi-exclamation-circle","text-white","text-2xl"],[1,"text-orange-800","font-bold","text-lg"],[1,"text-orange-600","text-sm"],[1,"flex","gap-2","align-items-center","flex-wrap"],[1,"mensualite-preview","text-center","px-3","py-2","bg-white","border-round","border-1","border-orange-200"],[1,"text-xs","text-gray-500"],[1,"font-bold","text-primary","text-lg"],["label","Cr\xE9er le dossier","icon","pi pi-plus-circle","severity","warn","pTooltip","Cr\xE9er le dossier pour pouvoir sauvegarder les pr\xE9visions",3,"onClick","loading"],[1,"card-header-tresorerie","p-3"],[1,"flex","justify-content-between","align-items-center","flex-wrap","gap-2"],[1,"m-0","flex","align-items-center","gap-2"],[1,"pi","pi-table","text-primary"],[1,"flex","gap-2"],["severity","danger","value","Dossier requis","icon","pi pi-lock"],["severity","info","icon","pi pi-calendar",3,"value",4,"ngIf"],["severity","warn","value","Modifications","icon","pi pi-exclamation-triangle",4,"ngIf"],["severity","success","value","Sauvegard\xE9","icon","pi pi-check",4,"ngIf"],[1,"btn-group-print","flex","gap-1"],["icon","pi pi-print","label","Imprimer","severity","secondary","size","small","pTooltip","Cr\xE9ez d'abord le dossier pour imprimer",3,"disabled"],["severity","info","icon","pi pi-calendar",3,"value"],["severity","warn","value","Modifications","icon","pi pi-exclamation-triangle"],["severity","success","value","Sauvegard\xE9","icon","pi pi-check"],["icon","pi pi-print","label","Imprimer","severity","success","size","small","pTooltip","Imprimer le tableau",3,"onClick"],["icon","pi pi-ellipsis-v","size","small","severity","success","styleClass","split-btn-only-icon",3,"model"],[1,"overlay-content","text-center","p-5"],[1,"overlay-icon","mb-4"],[1,"pi","pi-lock","text-6xl","text-orange-500"],[1,"text-xl","font-bold","text-gray-800","mb-2"],[1,"text-gray-600","mb-4","max-w-30rem","mx-auto"],[1,"flex","justify-content-center","gap-3","flex-wrap"],["label","Cr\xE9er le dossier maintenant","icon","pi pi-plus-circle","severity","warn","size","large",3,"onClick","loading"],[1,"mt-4","text-sm","text-gray-500"],[1,"pi","pi-info-circle","mr-1"],[1,"progress-banner","mb-3"],[1,"solde-final-info","mb-3","p-3","border-round","flex","justify-content-between","align-items-center",3,"ngClass"],[1,"text-sm"],[1,"font-bold","text-2xl",3,"ngClass"],[1,"tresorerie-table-wrapper"],[1,"tresorerie-table"],[1,"header-row"],[1,"col-libelle","sticky-col"],[1,"col-mois",3,"col-mois-0"],[1,"col-cumul"],[1,"actions-footer","mt-4","pt-4","border-top-1","surface-border"],[1,"flex","justify-content-between","align-items-center","flex-wrap","gap-3"],[1,"status-info","flex","align-items-center","gap-2"],[1,"pi","pi-info-circle","text-primary"],[1,"text-orange-500"],[1,"text-green-600"],[1,"flex","gap-2","flex-wrap"],["label","Retour","icon","pi pi-arrow-left","outlined","",3,"routerLink"],["label","Imprimer","icon","pi pi-print","severity","secondary"],["label","Sauvegarder","icon","pi pi-save","severity","success",3,"onClick","loading","disabled"],[1,"p-3","surface-100","border-round-lg","border-1","surface-border"],[1,"flex","align-items-center","justify-content-between","mb-2"],[1,"font-semibold","text-gray-700"],[1,"pi","pi-chart-line","mr-2"],[3,"ngClass"],[1,"month-segments","flex","gap-1"],["tooltipPosition","top",1,"month-segment","flex-1",3,"segment-empty","segment-filled","segment-saved","pTooltip"],[1,"flex","justify-content-between","align-items-center","mt-2"],[1,"flex","gap-3","text-xs"],[1,"flex","align-items-center","gap-1"],[1,"legend-dot","bg-gray-300"],[1,"legend-dot","bg-orange-400"],[1,"legend-dot","bg-green-500"],["tooltipPosition","top",1,"month-segment","flex-1",3,"pTooltip"],[1,"segment-label"],[1,"col-mois"],["class","block text-xs opacity-70",4,"ngIf"],[1,"block","text-xs","opacity-70"],[1,"section-header-row"],[1,"flex","align-items-center","justify-content-between"],[1,"libelle-text"],["tooltipPosition","top",1,"col-mois",3,"col-mois-0","cell-editable","cell-readonly","cell-negative","cell-positive","pTooltip","tooltipOptions"],["tooltipPosition","top",1,"col-cumul",3,"pTooltip","tooltipOptions"],[1,"cumul-value"],[1,"section-title","section-encaissement"],[1,"pi","pi-download","mr-2"],[1,"section-title","section-decaissement"],[1,"pi","pi-upload","mr-2"],[1,"section-title","section-calcul"],[1,"pi","pi-calculator","mr-2"],[1,"section-title","section-remboursement"],[1,"pi","pi-money-bill","mr-2"],["tooltipPosition","top",1,"col-mois",3,"pTooltip","tooltipOptions"],[1,"cell-container"],[1,"cell-value-display"],["mode","decimal","locale","fr-FR","inputStyleClass","table-cell-input",3,"ngModelChange","ngModel","minFractionDigits","maxFractionDigits","useGrouping","placeholder"],["pButton","","type","button","icon","pi pi-arrow-right","tooltipPosition","top",1,"copy-cell-btn","p-button-text","p-button-sm","p-button-rounded",3,"pTooltip"],["pButton","","type","button","icon","pi pi-arrow-right","tooltipPosition","top",1,"copy-cell-btn","p-button-text","p-button-sm","p-button-rounded",3,"click","pTooltip"],[1,"pi","pi-check-circle","mr-1"],["label","Imprimer","icon","pi pi-print","severity","secondary",3,"onClick"]],template:function(e,i){e&1&&(o(0,"div",0),h(1,"p-confirmDialog")(2,"p-toast"),_(3,dt,60,13,"p-card",1),h(4,"p-divider"),_(5,pt,3,2,"div",2),o(6,"p-card"),_(7,xt,14,5,"ng-template",3)(8,_t,21,4,"div",4)(9,Lt,33,18),l()()),e&2&&(c(3),f("ngIf",i.demandeIndividuel()),c(2),f("ngIf",i.demandeIndividuel()),c(3),E(i.hasDossierCredit()?9:8))},dependencies:[me,le,ce,de,ge,Se,ye,Ee,he,Ge,Le,ke,Ve,He,Ue,Fe,De,we,Oe,xe,fe,Xe,$e,Ne,_e,qe,ze,je,Ae,Be,Re,Te,Pe,Me,Ye,We,Ce,be],styles:[`.tresorerie-table-wrapper[_ngcontent-%COMP%]{overflow-x:auto;max-width:100%;border:1px solid #dee2e6;border-radius:8px;box-shadow:0 2px 4px #0000000d}.tresorerie-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;font-size:.85rem;min-width:1600px}.tresorerie-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .tresorerie-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid #dee2e6;padding:.5rem;text-align:right;vertical-align:middle}.tresorerie-table[_ngcontent-%COMP%]   .col-libelle[_ngcontent-%COMP%]{text-align:left;min-width:200px;max-width:250px;font-weight:500;background:#f8f9fa}.tresorerie-table[_ngcontent-%COMP%]   .col-libelle[_ngcontent-%COMP%]   .libelle-text[_ngcontent-%COMP%]{flex:1}.tresorerie-table[_ngcontent-%COMP%]   .col-libelle[_ngcontent-%COMP%]   .copy-btn[_ngcontent-%COMP%]{opacity:0;transition:opacity .2s}.tresorerie-table[_ngcontent-%COMP%]   .col-libelle[_ngcontent-%COMP%]:hover   .copy-btn[_ngcontent-%COMP%]{opacity:1}.tresorerie-table[_ngcontent-%COMP%]   .sticky-col[_ngcontent-%COMP%]{position:sticky;left:0;z-index:10}.tresorerie-table[_ngcontent-%COMP%]   .col-mois[_ngcontent-%COMP%]{min-width:115px;max-width:140px;width:115px}.tresorerie-table[_ngcontent-%COMP%]   .col-mois-0[_ngcontent-%COMP%]{background:#fff3cd!important;border-left:2px solid #ffc107}.tresorerie-table[_ngcontent-%COMP%]   .col-cumul[_ngcontent-%COMP%]{min-width:130px;width:130px;background:#e9ecef;font-weight:700;border-left:2px solid #6c757d}.tresorerie-table[_ngcontent-%COMP%]   .header-row[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:linear-gradient(135deg,#1e3a5f,#2563eb);color:#fff;font-weight:700;font-size:.95rem;text-align:center;position:sticky;top:0;z-index:20;padding:.75rem .5rem;text-shadow:1px 1px 2px rgba(0,0,0,.3);letter-spacing:.5px}.tresorerie-table[_ngcontent-%COMP%]   .header-row[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-weight:500;color:#e0e7ff}.tresorerie-table[_ngcontent-%COMP%]   .section-header-row[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.75rem 1rem;font-weight:700;font-size:.9rem}.tresorerie-table[_ngcontent-%COMP%]   .section-title.section-encaissement[_ngcontent-%COMP%]{background:linear-gradient(90deg,#d4edda,#e8f5e9);color:#155724}.tresorerie-table[_ngcontent-%COMP%]   .section-title.section-decaissement[_ngcontent-%COMP%]{background:linear-gradient(90deg,#f8d7da,#ffebee);color:#721c24}.tresorerie-table[_ngcontent-%COMP%]   .section-title.section-calcul[_ngcontent-%COMP%]{background:linear-gradient(90deg,#d1ecf1,#e3f2fd);color:#0c5460}.tresorerie-table[_ngcontent-%COMP%]   .section-title.section-remboursement[_ngcontent-%COMP%]{background:linear-gradient(90deg,#fff3cd,#fff8e1);color:#856404}.tresorerie-table[_ngcontent-%COMP%]   .row-solde-debut[_ngcontent-%COMP%]{background:#e3f2fd;font-weight:700}.tresorerie-table[_ngcontent-%COMP%]   .row-solde-debut[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background:#e3f2fd}.tresorerie-table[_ngcontent-%COMP%]   .row-encaissement[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:not(.col-libelle):not(.col-cumul){background:#f1f8e9}.tresorerie-table[_ngcontent-%COMP%]   .row-pret[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:not(.col-libelle):not(.col-cumul){background:#c8e6c9}.tresorerie-table[_ngcontent-%COMP%]   .row-total-enc[_ngcontent-%COMP%]{font-weight:700}.tresorerie-table[_ngcontent-%COMP%]   .row-total-enc[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background:#a5d6a7!important}.tresorerie-table[_ngcontent-%COMP%]   .row-decaissement[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:not(.col-libelle):not(.col-cumul){background:#ffebee}.tresorerie-table[_ngcontent-%COMP%]   .row-total-dec[_ngcontent-%COMP%]{font-weight:700}.tresorerie-table[_ngcontent-%COMP%]   .row-total-dec[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background:#ef9a9a!important}.tresorerie-table[_ngcontent-%COMP%]   .row-calcul[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:not(.col-libelle):not(.col-cumul){background:#f5f5f5}.tresorerie-table[_ngcontent-%COMP%]   .row-excedent[_ngcontent-%COMP%]{font-weight:700}.tresorerie-table[_ngcontent-%COMP%]   .row-remboursement[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:not(.col-libelle):not(.col-cumul){background:#fff3e0}.tresorerie-table[_ngcontent-%COMP%]   .row-solde-fin[_ngcontent-%COMP%]{font-weight:700;font-size:1rem}.tresorerie-table[_ngcontent-%COMP%]   .row-solde-fin[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background:#bbdefb!important;border-top:2px solid #2196f3}.tresorerie-table[_ngcontent-%COMP%]   .cell-editable[_ngcontent-%COMP%]{background:#fff!important;cursor:text}.tresorerie-table[_ngcontent-%COMP%]   .cell-editable[_ngcontent-%COMP%]:hover{background:#f0f7ff!important}.tresorerie-table[_ngcontent-%COMP%]   .cell-editable[_ngcontent-%COMP%]:focus-within{outline:2px solid #2196f3;outline-offset:-2px}.tresorerie-table[_ngcontent-%COMP%]   .cell-readonly[_ngcontent-%COMP%]{cursor:default}.tresorerie-table[_ngcontent-%COMP%]   .cell-negative[_ngcontent-%COMP%]{color:#dc3545!important;font-weight:600}.tresorerie-table[_ngcontent-%COMP%]   .cell-positive[_ngcontent-%COMP%]{color:#28a745!important}.tresorerie-table[_ngcontent-%COMP%]   .cell-value-display[_ngcontent-%COMP%]{display:block;padding:.25rem;font-variant-numeric:tabular-nums}.tresorerie-table[_ngcontent-%COMP%]   .cumul-value[_ngcontent-%COMP%]{font-weight:700;color:#495057;font-variant-numeric:tabular-nums}.cell-container[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;justify-content:flex-end;gap:4px;width:100%;min-height:32px}.cell-container[_ngcontent-%COMP%]   p-inputNumber[_ngcontent-%COMP%]{flex:1;min-width:0}.cell-container[_ngcontent-%COMP%]   p-inputNumber[_ngcontent-%COMP%]     .p-inputnumber{width:100%}.cell-container[_ngcontent-%COMP%]   p-inputNumber[_ngcontent-%COMP%]     .p-inputnumber-input, .cell-container[_ngcontent-%COMP%]   p-inputNumber[_ngcontent-%COMP%]     .table-cell-input{width:100%!important;min-width:75px;text-align:right!important;padding:.35rem .5rem!important;font-size:.85rem!important;border:1px solid transparent!important;background:transparent!important;border-radius:4px;transition:all .2s ease;font-variant-numeric:tabular-nums}.cell-container[_ngcontent-%COMP%]   p-inputNumber[_ngcontent-%COMP%]     .p-inputnumber-input:hover, .cell-container[_ngcontent-%COMP%]   p-inputNumber[_ngcontent-%COMP%]     .table-cell-input:hover{border-color:#90caf9!important;background:#fff!important}.cell-container[_ngcontent-%COMP%]   p-inputNumber[_ngcontent-%COMP%]     .p-inputnumber-input:focus, .cell-container[_ngcontent-%COMP%]   p-inputNumber[_ngcontent-%COMP%]     .table-cell-input:focus{border-color:#2196f3!important;background:#fff!important;box-shadow:0 0 0 2px #2196f333!important;outline:none!important}.cell-container[_ngcontent-%COMP%]   .copy-cell-btn[_ngcontent-%COMP%]{opacity:0;transition:all .2s ease;padding:.2rem!important;width:1.4rem!important;min-width:1.4rem!important;height:1.4rem!important;flex-shrink:0;border-radius:4px!important}.cell-container[_ngcontent-%COMP%]   .copy-cell-btn[_ngcontent-%COMP%]   .pi[_ngcontent-%COMP%]{font-size:.65rem}.cell-container[_ngcontent-%COMP%]   .copy-cell-btn[_ngcontent-%COMP%]:hover{background-color:#e3f2fd!important;color:#1976d2!important;transform:scale(1.1)}.cell-container[_ngcontent-%COMP%]:hover   .copy-cell-btn[_ngcontent-%COMP%]{opacity:1}[_nghost-%COMP%]     .table-cell-input{width:100%!important;text-align:right!important;padding:.35rem .5rem!important;font-size:.85rem!important;border:none!important;background:transparent!important}[_nghost-%COMP%]     .table-cell-input:focus{outline:none!important;background:#fff!important}[_nghost-%COMP%]     .p-inputnumber{width:100%}[_nghost-%COMP%]     .p-inputnumber-input{width:100%!important;text-align:right!important;padding:.35rem .5rem!important;font-size:.85rem!important}[_nghost-%COMP%]     .tresorerie-table .p-inputnumber-button-group{display:none}.tableau-actions[_ngcontent-%COMP%]{border:1px solid #dee2e6}.solde-final-info[_ngcontent-%COMP%]{border:2px solid;transition:all .3s ease}@media (max-width: 1800px){.tresorerie-table[_ngcontent-%COMP%]{min-width:1400px}.tresorerie-table[_ngcontent-%COMP%]   .col-mois[_ngcontent-%COMP%]{min-width:105px;width:105px}.tresorerie-table[_ngcontent-%COMP%]   .col-cumul[_ngcontent-%COMP%]{min-width:120px;width:120px}}@media (max-width: 1400px){.tresorerie-table[_ngcontent-%COMP%]{font-size:.8rem;min-width:1200px}.tresorerie-table[_ngcontent-%COMP%]   .col-libelle[_ngcontent-%COMP%]{min-width:170px}.tresorerie-table[_ngcontent-%COMP%]   .col-mois[_ngcontent-%COMP%]{min-width:95px;width:95px}.tresorerie-table[_ngcontent-%COMP%]   .col-cumul[_ngcontent-%COMP%]{min-width:110px;width:110px}.tresorerie-table[_ngcontent-%COMP%]   .cell-container[_ngcontent-%COMP%]   p-inputNumber[_ngcontent-%COMP%]     .p-inputnumber-input{min-width:65px;padding:.3rem .4rem!important;font-size:.8rem!important}.tresorerie-table[_ngcontent-%COMP%]   .cell-container[_ngcontent-%COMP%]   .copy-cell-btn[_ngcontent-%COMP%]{width:1.2rem!important;min-width:1.2rem!important;height:1.2rem!important}.tresorerie-table[_ngcontent-%COMP%]   .cell-container[_ngcontent-%COMP%]   .copy-cell-btn[_ngcontent-%COMP%]   .pi[_ngcontent-%COMP%]{font-size:.6rem}}@media (max-width: 768px){.tresorerie-table[_ngcontent-%COMP%]{font-size:.75rem}.tresorerie-table[_ngcontent-%COMP%]   .col-libelle[_ngcontent-%COMP%]{min-width:150px}.tresorerie-table[_ngcontent-%COMP%]   .col-mois[_ngcontent-%COMP%]{min-width:80px;width:80px}.tresorerie-table[_ngcontent-%COMP%]   .col-cumul[_ngcontent-%COMP%]{min-width:100px;width:100px}.tableau-actions[_ngcontent-%COMP%]{flex-direction:column}}@media (hover: none){.cell-container[_ngcontent-%COMP%]   .copy-cell-btn[_ngcontent-%COMP%]{opacity:.6}}.duration-long[_nghost-%COMP%]   .tresorerie-table[_ngcontent-%COMP%]   .col-mois[_ngcontent-%COMP%], .duration-long   [_nghost-%COMP%]   .tresorerie-table[_ngcontent-%COMP%]   .col-mois[_ngcontent-%COMP%]{min-width:90px;width:90px}.duration-long[_nghost-%COMP%]   .tresorerie-table[_ngcontent-%COMP%]   .cell-container[_ngcontent-%COMP%]   p-inputNumber[_ngcontent-%COMP%]     .p-inputnumber-input, .duration-long   [_nghost-%COMP%]   .tresorerie-table[_ngcontent-%COMP%]   .cell-container[_ngcontent-%COMP%]   p-inputNumber[_ngcontent-%COMP%]     .p-inputnumber-input{min-width:60px;font-size:.78rem!important}.duration-extra-long[_nghost-%COMP%]   .tresorerie-table[_ngcontent-%COMP%]   .col-mois[_ngcontent-%COMP%], .duration-extra-long   [_nghost-%COMP%]   .tresorerie-table[_ngcontent-%COMP%]   .col-mois[_ngcontent-%COMP%]{min-width:80px;width:80px}.duration-extra-long[_nghost-%COMP%]   .tresorerie-table[_ngcontent-%COMP%]   .cell-container[_ngcontent-%COMP%]   p-inputNumber[_ngcontent-%COMP%]     .p-inputnumber-input, .duration-extra-long   [_nghost-%COMP%]   .tresorerie-table[_ngcontent-%COMP%]   .cell-container[_ngcontent-%COMP%]   p-inputNumber[_ngcontent-%COMP%]     .p-inputnumber-input{min-width:52px;font-size:.72rem!important;padding:.25rem .3rem!important}.duration-extra-long[_nghost-%COMP%]   .tresorerie-table[_ngcontent-%COMP%]   .cell-container[_ngcontent-%COMP%]   .copy-cell-btn[_ngcontent-%COMP%], .duration-extra-long   [_nghost-%COMP%]   .tresorerie-table[_ngcontent-%COMP%]   .cell-container[_ngcontent-%COMP%]   .copy-cell-btn[_ngcontent-%COMP%]{width:1.1rem!important;min-width:1.1rem!important;height:1.1rem!important;padding:.15rem!important}.duration-extra-long[_nghost-%COMP%]   .tresorerie-table[_ngcontent-%COMP%]   .cell-container[_ngcontent-%COMP%]   .copy-cell-btn[_ngcontent-%COMP%]   .pi[_ngcontent-%COMP%], .duration-extra-long   [_nghost-%COMP%]   .tresorerie-table[_ngcontent-%COMP%]   .cell-container[_ngcontent-%COMP%]   .copy-cell-btn[_ngcontent-%COMP%]   .pi[_ngcontent-%COMP%]{font-size:.55rem}@keyframes _ngcontent-%COMP%_cellHighlight{0%{background-color:#fff3cd}to{background-color:inherit}}.cell-changed[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_cellHighlight .5s ease}@media print{.tableau-actions[_ngcontent-%COMP%], .actions-footer[_ngcontent-%COMP%], .copy-btn[_ngcontent-%COMP%], .copy-cell-btn[_ngcontent-%COMP%]{display:none!important}.tresorerie-table-wrapper[_ngcontent-%COMP%]{overflow:visible;box-shadow:none}.tresorerie-table[_ngcontent-%COMP%]{font-size:9pt}.tresorerie-table[_ngcontent-%COMP%]   .sticky-col[_ngcontent-%COMP%]{position:static}.tresorerie-table[_ngcontent-%COMP%]   .col-mois[_ngcontent-%COMP%]{min-width:60px;width:auto}}.credit-status-section[_ngcontent-%COMP%]   .status-card[_ngcontent-%COMP%]{transition:all .3s ease}.credit-status-section[_ngcontent-%COMP%]   .status-card[_ngcontent-%COMP%]:hover{box-shadow:0 4px 12px #0000001a}.credit-status-section[_ngcontent-%COMP%]   .status-icon[_ngcontent-%COMP%]{width:56px;height:56px;display:flex;align-items:center;justify-content:center;flex-shrink:0}.credit-status-section[_ngcontent-%COMP%]   .mensualite-preview[_ngcontent-%COMP%]{min-width:140px}.card-header-tresorerie[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f8f9fa,#fff);border-bottom:1px solid #e9ecef}.btn-group-print[_ngcontent-%COMP%]   .p-button[_ngcontent-%COMP%]{border-radius:6px 0 0 6px}.btn-group-print[_ngcontent-%COMP%]   .p-splitbutton[_ngcontent-%COMP%]   .p-button[_ngcontent-%COMP%]{border-radius:0 6px 6px 0;border-left:1px solid rgba(255,255,255,.3)}[_nghost-%COMP%]     .split-btn-only-icon .p-splitbutton-defaultbutton{display:none}[_nghost-%COMP%]     .split-btn-only-icon .p-splitbutton-menubutton{border-radius:0 6px 6px 0!important}.print-ready-banner[_ngcontent-%COMP%]   .icon-container[_ngcontent-%COMP%]{width:40px;height:40px;display:flex;align-items:center;justify-content:center}.p-tag[_ngcontent-%COMP%]{transition:transform .2s ease}.p-tag[_ngcontent-%COMP%]:hover{transform:scale(1.05)}@media (max-width: 768px){.credit-status-section[_ngcontent-%COMP%]   .status-card[_ngcontent-%COMP%]   .flex[_ngcontent-%COMP%]{flex-direction:column;text-align:center}.credit-status-section[_ngcontent-%COMP%]   .status-card[_ngcontent-%COMP%]   .status-icon[_ngcontent-%COMP%]{margin:0 auto}.card-header-tresorerie[_ngcontent-%COMP%]   .flex[_ngcontent-%COMP%]{flex-direction:column;gap:1rem}.card-header-tresorerie[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.2rem}.print-ready-banner[_ngcontent-%COMP%]   .flex[_ngcontent-%COMP%]{flex-direction:column;text-align:center;gap:1rem}}.progress-banner[_ngcontent-%COMP%]   .p-progressbar[_ngcontent-%COMP%]{background:#e9ecef}.progress-banner[_ngcontent-%COMP%]   .p-progressbar[_ngcontent-%COMP%]   .p-progressbar-value[_ngcontent-%COMP%]{background:linear-gradient(90deg,#3b82f6,#10b981);transition:width .5s ease}.progress-banner.complete[_ngcontent-%COMP%]   .p-progressbar[_ngcontent-%COMP%]   .p-progressbar-value[_ngcontent-%COMP%]{background:linear-gradient(90deg,#10b981,#059669);animation:_ngcontent-%COMP%_pulse-success 2s infinite}@keyframes _ngcontent-%COMP%_pulse-success{0%,to{opacity:1}50%{opacity:.8}}@media (max-width: 768px){.progress-banner[_ngcontent-%COMP%]   .flex[_ngcontent-%COMP%]{flex-direction:column}.progress-banner[_ngcontent-%COMP%]   .flex-grow-1[_ngcontent-%COMP%]{width:100%;min-width:unset!important}}.month-segments[_ngcontent-%COMP%]{height:28px}.month-segments[_ngcontent-%COMP%]   .month-segment[_ngcontent-%COMP%]{height:100%;border-radius:4px;display:flex;align-items:center;justify-content:center;transition:all .2s ease;cursor:default}.month-segments[_ngcontent-%COMP%]   .month-segment[_ngcontent-%COMP%]   .segment-label[_ngcontent-%COMP%]{font-size:11px;font-weight:700;color:#fff;text-shadow:1px 1px 2px rgba(0,0,0,.4)}.month-segments[_ngcontent-%COMP%]   .month-segment.segment-empty[_ngcontent-%COMP%]{background:linear-gradient(135deg,#94a3b8,#64748b)}.month-segments[_ngcontent-%COMP%]   .month-segment.segment-empty[_ngcontent-%COMP%]   .segment-label[_ngcontent-%COMP%]{color:#fff;text-shadow:1px 1px 2px rgba(0,0,0,.5)}.month-segments[_ngcontent-%COMP%]   .month-segment.segment-filled[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f97316,#ea580c)}.month-segments[_ngcontent-%COMP%]   .month-segment.segment-filled[_ngcontent-%COMP%]   .segment-label[_ngcontent-%COMP%]{color:#fff}.month-segments[_ngcontent-%COMP%]   .month-segment.segment-saved[_ngcontent-%COMP%]{background:linear-gradient(135deg,#22c55e,#16a34a)}.month-segments[_ngcontent-%COMP%]   .month-segment.segment-saved[_ngcontent-%COMP%]   .segment-label[_ngcontent-%COMP%]{color:#fff}.month-segments[_ngcontent-%COMP%]   .month-segment[_ngcontent-%COMP%]:hover{transform:scaleY(1.1);box-shadow:0 2px 4px #00000026}.legend-dot[_ngcontent-%COMP%]{width:10px;height:10px;border-radius:2px;display:inline-block}[_nghost-%COMP%]     .p-tooltip{max-width:280px}[_nghost-%COMP%]     .p-tooltip .p-tooltip-text{background:linear-gradient(135deg,#1e293b,#334155);color:#fff;padding:.75rem 1rem;border-radius:8px;font-size:.85rem;line-height:1.5;white-space:pre-line;box-shadow:0 4px 12px #00000040;border:1px solid rgba(255,255,255,.1)}[_nghost-%COMP%]     .p-tooltip .p-tooltip-arrow{border-top-color:#1e293b}[_nghost-%COMP%]     .p-tooltip.p-tooltip-top .p-tooltip-arrow{border-top-color:#334155}[_nghost-%COMP%]     .p-tooltip.p-tooltip-bottom .p-tooltip-arrow{border-bottom-color:#1e293b}.cell-negative   [_nghost-%COMP%]     .p-tooltip .p-tooltip-text{background:linear-gradient(135deg,#7f1d1d,#991b1b);border-color:#ef44444d}.cell-positive   [_nghost-%COMP%]     .p-tooltip .p-tooltip-text{background:linear-gradient(135deg,#14532d,#166534);border-color:#22c55e4d}.dossier-required-overlay[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;min-height:400px;background:linear-gradient(135deg,#fff7ed,#ffedd5,#fed7aa);border-radius:12px;border:2px dashed #f97316;margin:1rem 0;position:relative;overflow:hidden}.dossier-required-overlay[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:0;background:url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23f97316' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");pointer-events:none}.dossier-required-overlay[_ngcontent-%COMP%]   .overlay-content[_ngcontent-%COMP%]{position:relative;z-index:1;background:#fffffff2;border-radius:16px;box-shadow:0 10px 40px #f9731626;padding:2.5rem;max-width:500px;margin:1rem}.dossier-required-overlay[_ngcontent-%COMP%]   .overlay-icon[_ngcontent-%COMP%]{width:100px;height:100px;margin:0 auto;background:linear-gradient(135deg,#fff7ed,#ffedd5);border-radius:50%;display:flex;align-items:center;justify-content:center;border:3px solid #f97316;animation:_ngcontent-%COMP%_pulse-icon 2s ease-in-out infinite}@keyframes _ngcontent-%COMP%_pulse-icon{0%,to{transform:scale(1);box-shadow:0 0 #f9731666}50%{transform:scale(1.05);box-shadow:0 0 0 15px #f9731600}}`]})};export{Je as AnalyseFluxTresorerieComponent};
